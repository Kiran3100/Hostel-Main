# Complete Admin Schema Classes Breakdown

## 1. `admin_hostel_assignment.py` - Admin-Hostel Assignment Management

### Classes:
- **`AdminHostelAssignment`** - Complete assignment record with permissions, activity tracking, and performance metrics
- **`AssignmentCreate`** - Create new admin-hostel assignment with permission configuration
- **`AssignmentUpdate`** - Update existing assignment (permissions, status, notes)
- **`BulkAssignment`** - Assign one admin to multiple hostels in batch operation
- **`RevokeAssignment`** - Revoke admin assignment with audit trail and handover options
- **`AssignmentList`** - List all assignments for an admin with summary statistics
- **`HostelAdminItem`** - Individual admin details within a hostel's admin list
- **`HostelAdminList`** - List all admins assigned to a specific hostel

### Purpose:
- Manage admin-hostel relationships
- Track permissions and access levels
- Monitor assignment performance and activity
- Handle bulk operations and revocations

---

## 2. `admin_override.py` - Admin Override System

### Classes:
- **`AdminOverrideRequest`** - Request to override supervisor decision with detailed justification
- **`OverrideLog`** - Complete record of override action with audit trail
- **`OverrideReason`** - Predefined standard reasons for overrides
- **`OverrideSummary`** - Aggregated override statistics for a time period
- **`SupervisorOverrideStats`** - Override statistics for specific supervisor performance analysis

### Purpose:
- Enable admin oversight of supervisor decisions
- Track override patterns and trends
- Maintain accountability and audit trails
- Identify supervisor training needs

---

## 3. `admin_permissions.py` - Permission Management

### Classes:
- **`AdminPermissions`** - Granular permissions for admin in a specific hostel
- **`PermissionMatrix`** - Mapping of user roles to their allowed permissions
- **`RolePermissions`** - Permissions configuration for a specific role with metadata
- **`PermissionCheck`** - Verify if user has specific permission with reasoning

### Purpose:
- Define what actions admins can perform in each hostel
- Role-based access control
- Permission verification for security
- Authorization management

---

## 4. `hostel_context.py` - Multi-Hostel Context Management

### Classes:
- **`HostelContext`** - Current active hostel session with real-time metrics
- **`HostelSwitchRequest`** - Request to switch between hostel contexts
- **`ActiveHostelResponse`** - Response after successful context switch
- **`ContextSwitch`** - Individual context switch record with timing and metrics
- **`ContextHistory`** - Historical view of all context switches with analytics

### Purpose:
- Manage admin working context across multiple hostels
- Track session duration and productivity
- Provide seamless context switching
- Analyze admin work patterns

---

## 5. `hostel_selector.py` - Hostel Selection UI

### Classes:
- **`HostelSelectorItem`** - Individual hostel in selection dropdown with quick stats
- **`HostelSelectorResponse`** - Complete hostel selector data with categorization
- **`RecentHostelItem`** - Recently accessed hostel with access patterns
- **`RecentHostels`** - List of recently accessed hostels with analytics
- **`FavoriteHostelItem`** - Favorite hostel with custom labels and notes
- **`FavoriteHostels`** - Organized list of favorite hostels
- **`UpdateFavoriteRequest`** - Add/remove hostel from favorites with customization

### Purpose:
- Provide efficient hostel selection interface
- Track recent access patterns
- Support favorites and personalization
- Quick access to important hostels

---

## 6. `multi_hostel_dashboard.py` - Dashboard Analytics

### Classes:
- **`MultiHostelDashboard`** - Main dashboard with aggregated portfolio view
- **`AggregatedStats`** - Portfolio-wide statistics across all hostels
- **`HostelQuickStats`** - Quick statistics for individual hostel in dashboard
- **`CrossHostelComparison`** - Comparative analysis between hostels
- **`TopPerformer`** - Best performing hostel in specific metrics
- **`BottomPerformer`** - Worst performing hostel needing attention
- **`HostelMetricComparison`** - Specific metric comparison across hostels
- **`HostelTaskSummary`** - Task management summary across portfolio

### Purpose:
- Provide comprehensive portfolio overview
- Compare performance across hostels
- Identify top and bottom performers
- Monitor portfolio health and metrics
- Support data-driven decision making

---

## Key Functions Across All Classes:

### Computed Properties:
- Performance calculations
- Status indicators
- Time-based metrics
- Health scores
- Activity levels

### Validators:
- Data consistency checks
- Business rule enforcement
- Input sanitization
- Cross-field validation

### Analytics:
- Trend identification
- Pattern recognition
- Comparative analysis
- Performance scoring

This structure enables complete admin management across multiple hostels with comprehensive tracking, analytics, and user experience optimization.

================================================================================================================================================

# Complete Analytics Schema Classes Overview

## 1. booking_analytics.py

### Classes:

**`BookingKPI`**
- **Purpose**: Key Performance Indicators for booking operations
- **Use**: Track total bookings, conversion rates, cancellation statistics
- **Key Functions**: 
  - `approval_rate` - Calculate confirmed/(confirmed + rejected) percentage
  - `completion_rate` - Calculate non-pending/total percentage

**`BookingTrendPoint`**
- **Purpose**: Single data point in booking trend analysis
- **Use**: Represent booking metrics for a specific date
- **Key Functions**:
  - `conversion_rate` - Calculate conversion rate for specific date

**`BookingFunnel`**
- **Purpose**: Booking conversion funnel analytics
- **Use**: Track user journey from page views to confirmed bookings
- **Key Functions**:
  - `total_drop_offs` - Calculate users who dropped off
  - `largest_drop_off_stage` - Identify stage with biggest drop-off

**`CancellationAnalytics`**
- **Purpose**: Detailed analytics for booking cancellations
- **Use**: Analyze cancellation patterns, reasons, and timing
- **Key Functions**:
  - `top_cancellation_reason` - Most common cancellation reason
  - `early_cancellation_rate` - Cancellations >7 days before check-in

**`BookingSourceMetrics`**
- **Purpose**: Metrics for specific booking source
- **Use**: Track performance of individual booking channels
- **Key Functions**:
  - `revenue_per_confirmed_booking` - Revenue/confirmed booking ratio

**`BookingAnalyticsSummary`**
- **Purpose**: Comprehensive booking analytics summary
- **Use**: Consolidate all booking metrics into single report
- **Key Functions**:
  - `best_performing_source` - Source with highest conversion
  - `get_trend_summary()` - Generate trend insights dictionary

---

## 2. complaint_analytics.py

### Classes:

**`SLAMetrics`**
- **Purpose**: Service Level Agreement metrics for complaint handling
- **Use**: Track compliance with defined service level targets
- **Key Functions**:
  - `at_risk_count` - Complaints at risk of SLA breach

**`ComplaintKPI`**
- **Purpose**: Key Performance Indicators for complaint management
- **Use**: Track complaint volumes, resolution efficiency, service quality
- **Key Functions**:
  - `resolution_rate` - Percentage of complaints resolved
  - `backlog` - Current complaint backlog count
  - `efficiency_score` - Overall efficiency score (0-100)

**`ComplaintTrendPoint`**
- **Purpose**: Single data point in complaint trend analysis
- **Use**: Represent complaint metrics for specific date
- **Key Functions**:
  - `resolution_rate` - Resolution rate for specific date

**`ComplaintTrend`**
- **Purpose**: Time-series trend analysis for complaints
- **Use**: Historical data points and trend indicators
- **Key Functions**:
  - `trend_direction` - Overall trend direction (increasing/decreasing/stable)
  - `peak_complaint_date` - Date with highest complaint volume

**`CategoryBreakdown`**
- **Purpose**: Complaint breakdown by category
- **Use**: Insights into complaint distribution by category
- **Key Functions**:
  - `resolution_rate` - Resolution rate for specific category

**`PriorityBreakdown`**
- **Purpose**: Complaint breakdown by priority level
- **Use**: Resource allocation based on urgency distribution
- **Key Functions**:
  - `priority_score` - Numeric priority score for sorting

**`ComplaintDashboard`**
- **Purpose**: Comprehensive complaint dashboard analytics
- **Use**: Consolidate all complaint metrics into actionable dashboard
- **Key Functions**:
  - `most_common_category` - Most frequent complaint category
  - `high_priority_percentage` - Percentage of high priority complaints
  - `get_actionable_insights()` - Generate action recommendations

---

## 3. custom_reports.py

### Classes:

**`CustomReportFilter`**
- **Purpose**: Filter definition for custom reports
- **Use**: Define filter conditions to narrow down report data
- **Key Functions**:
  - `filter_display` - Human-readable filter description

**`CustomReportField`**
- **Purpose**: Field definition for custom reports
- **Use**: Define fields with optional aggregation and display labels
- **Key Functions**:
  - `effective_label` - Get effective display label

**`CustomReportRequest`**
- **Purpose**: Request schema for generating custom report
- **Use**: Define all parameters for custom report generation
- **Key Functions**:
  - `to_sql_hint()` - Generate SQL-like representation for debugging

**`CustomReportDefinition`**
- **Purpose**: Saved custom report definition
- **Use**: Store reusable report configurations
- **Key Functions**:
  - `is_shared` - Check if report is shared
  - `complexity_score` - Calculate report complexity (0-100)

**`CustomReportResult`**
- **Purpose**: Result of executing custom report
- **Use**: Contains generated data, summary statistics, chart data
- **Key Functions**:
  - `is_paginated` - Check if results are paginated
  - `get_export_filename()` - Generate appropriate export filename

**`ReportExportRequest`**
- **Purpose**: Request to export report in specific format
- **Use**: Export cached report results

**`ReportSchedule`**
- **Purpose**: Schedule configuration for recurring reports
- **Use**: Automate report generation and delivery

---

## 4. dashboard_analytics.py

### Classes:

**`KPIResponse`**
- **Purpose**: Single Key Performance Indicator for dashboard
- **Use**: Represent measurable metric with trend information
- **Key Functions**:
  - `is_on_target` - Check if current value meets target
  - `performance_status` - Get performance status (excellent/good/warning/critical)
  - `format_value()` - Format value for display

**`QuickStats`**
- **Purpose**: Quick statistics for dashboard cards
- **Use**: Snapshot metrics for immediate system visibility
- **Key Functions**:
  - `occupancy_rate` - Calculate approximate occupancy rate
  - `payment_collection_health` - Assess payment collection status

**`TimeseriesPoint`**
- **Purpose**: Single data point in time series
- **Use**: Represent metric values over time
- **Key Functions**:
  - `formatted_date` - Get formatted date string

**`AlertNotification`**
- **Purpose**: Dashboard alert notification
- **Use**: Display important alerts and notifications
- **Key Functions**:
  - `is_active` - Check if alert is still active

**`DashboardWidget`**
- **Purpose**: Configuration for dashboard widget
- **Use**: Define widget layout and behavior

**`DashboardMetrics`**
- **Purpose**: Aggregated dashboard metrics
- **Use**: Comprehensive analytics for specific scope
- **Key Functions**:
  - `active_alert_count` - Count active alerts
  - `get_kpi_by_key()` - Retrieve specific KPI
  - `get_trending_kpis()` - Get KPIs that are trending

**`RoleSpecificDashboard`**
- **Purpose**: Role-specific dashboard configuration
- **Use**: Customized dashboard views based on user role
- **Key Functions**:
  - `has_critical_alerts` - Check for critical alerts
  - `get_all_alerts()` - Get all alerts from all sections

---

## 5. financial_analytics.py

### Classes:

**`RevenueBreakdown`**
- **Purpose**: Detailed breakdown of revenue by source and type
- **Use**: Granular visibility into revenue streams
- **Key Functions**:
  - `collection_rate` - Calculate collection rate percentage
  - `primary_revenue_source` - Largest revenue source
  - `revenue_concentration_risk` - Assess revenue diversification

**`ExpenseBreakdown`**
- **Purpose**: Detailed breakdown of expenses by category
- **Use**: Granular visibility into cost structure
- **Key Functions**:
  - `largest_expense_category` - Identify largest expense category
  - `expense_ratio_staff` - Staff expense as percentage of total

**`FinancialRatios`**
- **Purpose**: Key financial ratios and metrics
- **Use**: Analytical ratios for financial health assessment
- **Key Functions**:
  - `profitability_status` - Assess profitability status

**`BudgetComparison`**
- **Purpose**: Budget vs actual comparison
- **Use**: Compare actual performance against budgeted targets
- **Key Functions**:
  - `is_favorable` - Determine if variance is favorable
  - `variance_severity` - Assess severity of budget variance

**`TaxSummary`**
- **Purpose**: Tax-related summary for financial reporting
- **Use**: Tax liability and compliance information
- **Key Functions**:
  - `effective_tax_rate` - Calculate effective tax rate

**`ProfitAndLossReport`**
- **Purpose**: Profit & Loss statement
- **Use**: Comprehensive income statement
- **Key Functions**:
  - `is_profitable` - Check if period was profitable
  - `break_even_revenue` - Calculate break-even revenue
  - `get_performance_summary()` - Generate performance summary

**`CashflowPoint`**
- **Purpose**: Single data point in cashflow time series
- **Use**: Represent cash movements for specific date
- **Key Functions**:
  - `is_positive_flow` - Check if net flow is positive

**`CashflowSummary`**
- **Purpose**: Cashflow summary and analysis
- **Use**: Comprehensive view of cash movements
- **Key Functions**:
  - `cashflow_health` - Assess overall cashflow health
  - `burn_rate_days` - Calculate runway in days
  - `operating_cash_ratio` - Operating cash flow ratio

**`FinancialReport`**
- **Purpose**: Comprehensive financial report
- **Use**: Consolidate P&L, cashflow, and key metrics
- **Key Functions**:
  - `financial_health_score` - Overall financial health (0-100)
  - `performance_grade` - Letter grade for performance
  - `get_executive_summary()` - Executive summary dictionary

---

## 6. occupancy_analytics.py

### Classes:

**`OccupancyKPI`**
- **Purpose**: Key occupancy metrics and performance indicators
- **Use**: Comprehensive occupancy statistics for capacity planning
- **Key Functions**:
  - `occupancy_status` - Classify occupancy status (high/optimal/low/critical)
  - `capacity_pressure` - Calculate capacity pressure score
  - `vacancy_rate` - Calculate vacancy rate

**`OccupancyTrendPoint`**
- **Purpose**: Single data point in occupancy trend analysis
- **Use**: Represent occupancy metrics for specific date
- **Key Functions**:
  - `net_change` - Calculate net change in occupancy for day

**`OccupancyByRoomType`**
- **Purpose**: Occupancy breakdown by room type
- **Use**: Granular occupancy metrics for optimization
- **Key Functions**:
  - `available_beds` - Calculate available beds
  - `revenue_per_bed` - Calculate revenue per bed

**`OccupancyByFloor`**
- **Purpose**: Occupancy breakdown by floor
- **Use**: Floor-wise occupancy metrics for facility management

**`ForecastPoint`**
- **Purpose**: Single forecast data point
- **Use**: Represent predicted occupancy for future date

**`SeasonalPattern`**
- **Purpose**: Identified seasonal occupancy pattern
- **Use**: Describe recurring occupancy patterns
- **Key Functions**:
  - `is_high_season` - Check if high-occupancy season

**`ForecastData`**
- **Purpose**: Occupancy forecast data with model information
- **Use**: Predicted occupancy with methodology metadata
- **Key Functions**:
  - `average_forecasted_occupancy` - Calculate average forecast
  - `peak_forecasted_date` - Date with highest forecast

**`OccupancyReport`**
- **Purpose**: Comprehensive occupancy analytics report
- **Use**: Consolidate all occupancy metrics and forecasts
- **Key Functions**:
  - `best_performing_room_type` - Room type with highest occupancy
  - `occupancy_trend_direction` - Overall trend direction
  - `get_optimization_insights()` - Generate optimization recommendations

---

## 7. platform_analytics.py

### Classes:

**`TenantMetrics`**
- **Purpose**: Metrics for single tenant (hostel)
- **Use**: Individual tenant performance for platform aggregation
- **Key Functions**:
  - `is_at_risk` - Check if tenant at risk of churning
  - `revenue_per_bed` - Calculate revenue per bed
  - `engagement_status` - Assess tenant engagement level

**`PlatformMetrics`**
- **Purpose**: High-level platform metrics across all tenants
- **Use**: Aggregate statistics for platform monitoring
- **Key Functions**:
  - `activation_rate` - Calculate percentage of active hostels
  - `trial_conversion_potential` - Estimate trial conversions

**`MonthlyMetric`**
- **Purpose**: Monthly metric data point for trend analysis
- **Use**: Represent single metric value for specific month
- **Key Functions**:
  - `month_name` - Get human-readable month name

**`GrowthMetrics`**
- **Purpose**: Growth metrics and trends over time
- **Use**: Detailed growth analysis for strategic planning
- **Key Functions**:
  - `is_growing` - Check if platform is growing
  - `growth_health_score` - Overall growth health (0-100)
  - `compound_annual_growth_rate` - Calculate CAGR

**`ChurnAnalysis`**
- **Purpose**: Customer churn analysis and prediction
- **Use**: Insights into churn patterns and at-risk tenants
- **Key Functions**:
  - `top_churn_reason` - Most common churn reason
  - `churn_risk_status` - Assess overall churn risk

**`SystemHealthMetrics`**
- **Purpose**: Platform system health and performance metrics
- **Use**: Track technical performance and reliability
- **Key Functions**:
  - `health_status` - Overall system health status
  - `performance_grade` - Performance grade based on response times

**`RevenueMetrics`**
- **Purpose**: Platform-wide revenue metrics and analysis
- **Use**: Aggregate revenue data across all tenants
- **Key Functions**:
  - `revenue_diversity_score` - Revenue diversification (0-100)
  - `net_new_mrr` - Calculate net new MRR

**`PlatformUsageAnalytics`**
- **Purpose**: Platform usage and engagement analytics
- **Use**: Track tenant and user platform interactions
- **Key Functions**:
  - `most_used_module` - Most frequently used module
  - `platform_health_indicator` - Overall platform health

---

## 8. supervisor_analytics.py

### Classes:

**`SupervisorWorkload`**
- **Purpose**: Supervisor workload metrics
- **Use**: Track task distribution and capacity utilization
- **Key Functions**:
  - `available_capacity` - Calculate available capacity
  - `workload_status` - Assess workload status

**`SupervisorPerformanceRating`**
- **Purpose**: Performance rating breakdown
- **Use**: Detailed scoring across performance dimensions
- **Key Functions**:
  - `performance_grade` - Letter grade for performance
  - `strengths` - Identify performance strengths
  - `improvement_areas` - Areas needing improvement

**`SupervisorKPI`**
- **Purpose**: Key Performance Indicators for supervisor
- **Use**: Comprehensive performance metrics for assessment
- **Key Functions**:
  - `complaint_resolution_rate` - Calculate resolution rate
  - `reopen_rate` - Calculate complaint reopen rate
  - `performance_status` - Overall performance classification

**`SupervisorTrendPoint`**
- **Purpose**: Performance trend data point
- **Use**: Track supervisor performance over time
- **Key Functions**:
  - `total_tasks_completed` - Total tasks completed in period

**`SupervisorDashboardAnalytics`**
- **Purpose**: Supervisor dashboard analytics
- **Use**: Personalized dashboard for performance monitoring
- **Key Functions**:
  - `most_common_complaint_category` - Most frequent category
  - `improvement_trend` - Performance improvement trend

**`SupervisorComparison`**
- **Purpose**: Comparative analysis of supervisors
- **Use**: Benchmarking and identifying top performers
- **Key Functions**:
  - `top_performer` - Get top performing supervisor
  - `get_supervisor_rank()` - Get rank for specific metric

**`TeamAnalytics`**
- **Purpose**: Team-level analytics for supervisor groups
- **Use**: Aggregate supervisor metrics at team level
- **Key Functions**:
  - `team_efficiency` - Assess overall team efficiency

---

## 9. visitor_analytics.py

### Classes:

**`TrafficSourceMetrics`**
- **Purpose**: Metrics for specific traffic source
- **Use**: Detailed performance data for acquisition channels
- **Key Functions**:
  - `engagement_score` - Calculate engagement score (0-100)
  - `quality_score` - Calculate source quality score

**`VisitorFunnel`**
- **Purpose**: Visitor acquisition and conversion funnel
- **Use**: Track visitor journey with drop-off analysis
- **Key Functions**:
  - `total_drop_offs` - Calculate total visitors who dropped off
  - `largest_drop_off_stage` - Stage with largest drop-off
  - `funnel_efficiency_score` - Overall funnel efficiency

**`TrafficSourceAnalytics`**
- **Purpose**: Comprehensive traffic source analysis
- **Use**: Aggregate and compare all traffic channels
- **Key Functions**:
  - `best_converting_source` - Source with highest conversion
  - `highest_volume_source` - Source with highest visits
  - `best_roi_source` - Source with best ROI

**`SearchBehavior`**
- **Purpose**: Search behavior analytics
- **Use**: Analyze how visitors search for hostels
- **Key Functions**:
  - `search_effectiveness_score` - Search effectiveness (0-100)

**`EngagementMetrics`**
- **Purpose**: Visitor engagement metrics
- **Use**: Measure depth and quality of interaction
- **Key Functions**:
  - `engagement_level` - Classify engagement level (high/moderate/low)

**`VisitorBehaviorAnalytics`**
- **Purpose**: Comprehensive visitor behavior analytics
- **Use**: Consolidate search, engagement, and exit behavior
- **Key Functions**:
  - `visitor_quality_score` - Overall visitor quality (0-100)
  - `get_optimization_recommendations()` - Generate recommendations

**`ConversionPathAnalysis`**
- **Purpose**: Conversion path and attribution analysis
- **Use**: Track multi-touch visitor journeys
- **Key Functions**:
  - `conversion_complexity` - Assess conversion path complexity

This comprehensive overview shows all 63 classes across 9 analytics modules, each serving specific analytics needs for the hostel management platform.

================================================================================================================================================
# Complete Announcement Schema Classes Breakdown

## 1. **announcement_approval.py** - Approval Workflow Management

### Classes:

**ApprovalStatus (Enum)**
- Purpose: Define approval states (PENDING, APPROVED, REJECTED, NOT_REQUIRED)
- Use: Track approval workflow status

**ApprovalRequest**
- Purpose: Submit announcement for admin approval
- Use: Supervisors request approval for announcements they create
- Functions: Validate approval requirements, track urgency, preferred approver

**ApprovalResponse**
- Purpose: Return approval/rejection decision details
- Use: Inform supervisor of admin's decision with feedback
- Functions: Track approver, decision time, auto-publication status

**RejectionRequest**
- Purpose: Reject announcement with detailed feedback
- Use: Admins reject announcements with improvement suggestions
- Functions: Provide constructive feedback, allow resubmission option

**ApprovalWorkflow**
- Purpose: Complete approval process status tracking
- Use: Show entire approval lifecycle and current state
- Functions: Track timeline, pending reviewers, decision history

**PendingApprovalItem**
- Purpose: Lightweight approval queue item
- Use: Display pending approvals in admin dashboard lists
- Functions: Show urgency, submission time, content preview

**SupervisorApprovalQueue**
- Purpose: Supervisor's view of their pending approvals
- Use: Show supervisor all their submitted announcements status
- Functions: Track approval counts, response times, pending items

**BulkApproval**
- Purpose: Approve/reject multiple announcements at once
- Use: Admin batch processing of approval queue
- Functions: Validate bulk decisions, require rejection reasons

**ApprovalHistory**
- Purpose: Audit trail of approval actions
- Use: Track all approval workflow actions for compliance
- Functions: Log actions, actors, status changes, timestamps

---

## 2. **announcement_base.py** - Core CRUD Operations

### Classes:

**AnnouncementBase**
- Purpose: Base schema with common announcement fields
- Use: Foundation for all announcement operations
- Functions: Validate content, targeting, expiry, normalize data

**AnnouncementCreate**
- Purpose: Create new announcement
- Use: Accept announcement creation data from users
- Functions: Validate delivery channels, scheduling, acknowledgment settings

**AnnouncementUpdate**
- Purpose: Update existing announcement
- Use: Modify announcement content and settings
- Functions: Partial updates, validate published announcement restrictions

**AnnouncementPublish**
- Purpose: Publish draft announcement
- Use: Make announcement live for recipients
- Functions: Handle immediate vs scheduled publication

**AnnouncementUnpublish**
- Purpose: Remove published announcement
- Use: Hide announcement from recipients with reason
- Functions: Track unpublishing reason, notification options

---

## 3. **announcement_delivery.py** - Multi-Channel Delivery System

### Classes:

**DeliveryChannel (Enum)**
- Purpose: Define delivery channels (EMAIL, SMS, PUSH, IN_APP)
- Use: Specify which channels to use for delivery

**DeliveryStrategy (Enum)**
- Purpose: Define delivery timing (IMMEDIATE, SCHEDULED, BATCHED)
- Use: Control when and how announcements are sent

**DeliveryState (Enum)**
- Purpose: Track delivery progress (PENDING, PROCESSING, COMPLETED, FAILED)
- Use: Monitor delivery status in real-time

**DeliveryChannels**
- Purpose: Configure which channels are enabled
- Use: Set delivery preferences with primary/fallback channels
- Functions: Validate channel selection, priority ordering

**DeliveryConfig**
- Purpose: Complete delivery configuration
- Use: Define delivery strategy, batching, rate limits, retries
- Functions: Configure delivery behavior, validate batch settings

**ChannelDeliveryStats**
- Purpose: Statistics for individual delivery channel
- Use: Track performance metrics per channel (email, SMS, etc.)
- Functions: Calculate delivery rates, timing metrics

**DeliveryStatus**
- Purpose: Real-time delivery progress tracking
- Use: Show current delivery state across all channels
- Functions: Track counts by channel, calculate completion percentage

**FailedDelivery**
- Purpose: Record failed delivery attempts
- Use: Troubleshoot delivery issues and track retries
- Functions: Log failure reasons, retry attempts, resolution status

**DeliveryReport**
- Purpose: Comprehensive delivery analytics
- Use: Generate delivery performance reports
- Functions: Aggregate metrics, failed delivery analysis

**BatchDelivery**
- Purpose: Track batched delivery progress
- Use: Monitor large-scale delivery operations
- Functions: Track batch completion, pause/resume capability

**RetryDelivery**
- Purpose: Retry failed deliveries
- Use: Recover from delivery failures
- Functions: Selective retry, fallback channel usage

**DeliveryPause/DeliveryResume**
- Purpose: Control delivery operations
- Use: Pause and resume delivery processing
- Functions: Pause with reason, auto-resume scheduling

---

## 4. **announcement_filters.py** - Search, Filter & Export

### Classes:

**ExportFormat (Enum)**
- Purpose: Define export file formats (PDF, EXCEL, CSV, JSON)
- Use: Specify desired export format

**AnnouncementSortField (Enum)**
- Purpose: Define sortable fields (CREATED_AT, TITLE, PRIORITY, etc.)
- Use: Control announcement list sorting

**AnnouncementFilterParams**
- Purpose: Comprehensive filtering for announcement lists
- Use: Filter announcements by various criteria
- Functions: Text search, date ranges, status filters, pagination

**SearchRequest**
- Purpose: Full-text search across announcements
- Use: Advanced search with highlighting and scope control
- Functions: Search in title/content/attachments, result highlighting

**ArchiveRequest**
- Purpose: Archive old announcements
- Use: Move old announcements to archive storage
- Functions: Archive criteria, exclusion rules, dry-run preview

**AnnouncementExportRequest**
- Purpose: Export announcements to files
- Use: Generate downloadable reports in various formats
- Functions: Content options, engagement metrics, email delivery

**BulkDeleteRequest**
- Purpose: Delete multiple announcements
- Use: Batch deletion with safety confirmations
- Functions: Validate permissions, confirmation requirements

**AnnouncementStatsRequest**
- Purpose: Generate announcement statistics
- Use: Analytics dashboard data generation
- Functions: Time period analysis, breakdown options, trends

---

## 5. **announcement_response.py** - API Response Schemas

### Classes:

**AnnouncementResponse**
- Purpose: Standard announcement response
- Use: Return basic announcement data after operations
- Functions: Include read statistics, computed properties

**AnnouncementDetail**
- Purpose: Complete announcement information
- Use: Detailed view with all metadata and metrics
- Functions: Full targeting info, delivery status, engagement metrics

**AnnouncementListItem**
- Purpose: Lightweight list display format
- Use: Optimized for announcement lists and tables
- Functions: Essential info only, display priority calculation

**AnnouncementList**
- Purpose: Paginated announcement collection
- Use: List endpoints with summary statistics
- Functions: Aggregate counts, filtering context

**StudentAnnouncementView**
- Purpose: Student-optimized announcement view
- Use: Student-facing interfaces with read/acknowledgment status
- Functions: Student-specific fields, action requirements

**AnnouncementSummary**
- Purpose: Minimal announcement info
- Use: Notifications and quick previews
- Functions: Essential info for notifications

---

## 6. **announcement_scheduling.py** - Scheduling & Recurrence

### Classes:

**RecurrencePattern (Enum)**
- Purpose: Define recurrence types (DAILY, WEEKLY, BIWEEKLY, MONTHLY)
- Use: Specify recurring announcement patterns

**ScheduleStatus (Enum)**
- Purpose: Track schedule states (PENDING, PUBLISHED, CANCELLED, FAILED)
- Use: Monitor scheduled announcement status

**ScheduleRequest**
- Purpose: Schedule announcement for later publication
- Use: Set publication time with auto-expiry options
- Functions: Validate future time, timezone handling, expiry settings

**ScheduleConfig**
- Purpose: Complete schedule configuration view
- Use: Show current scheduling state including recurrence
- Functions: Track schedule status, next occurrence, completion count

**RecurringAnnouncement**
- Purpose: Create recurring announcement series
- Use: Auto-publish announcements on schedule
- Functions: Validate recurrence settings, end conditions, time patterns

**ScheduleUpdate**
- Purpose: Modify scheduled publication time
- Use: Reschedule pending announcements
- Functions: Validate new time, track reasons

**ScheduleCancel**
- Purpose: Cancel scheduled publication
- Use: Prevent scheduled announcement publication
- Functions: Handle recurring cancellation, deletion options

**PublishNow**
- Purpose: Override schedule and publish immediately
- Use: Emergency publication bypassing schedule
- Functions: Schedule override confirmation

**ScheduledAnnouncementItem**
- Purpose: Scheduled announcement list item
- Use: Display scheduled announcements in lists
- Functions: Show recurrence info, next occurrence

**ScheduledAnnouncementsList**
- Purpose: Collection of scheduled announcements
- Use: Scheduled announcement dashboard
- Functions: Summary statistics, upcoming counts

---

## 7. **announcement_targeting.py** - Audience Selection

### Classes:

**TargetType (Enum)**
- Purpose: Define targeting methods (ALL, SPECIFIC_ROOMS, SPECIFIC_FLOORS, etc.)
- Use: Specify audience selection strategy

**CombineMode (Enum)**
- Purpose: Define rule combination (UNION, INTERSECTION)
- Use: Combine multiple targeting rules

**TargetingConfig**
- Purpose: Core targeting configuration
- Use: Define who receives announcements
- Functions: Validate targeting consistency, handle exclusions

**AudienceSelection**
- Purpose: Comprehensive recipient selection
- Use: Advanced audience targeting with filters
- Functions: Student status filters, room type filters, exclusions

**TargetRooms**
- Purpose: Simple room-based targeting
- Use: Target specific rooms
- Functions: Validate room selection, occupant options

**TargetFloors**
- Purpose: Simple floor-based targeting
- Use: Target entire floors
- Functions: Validate floor selection, maintenance exclusions

**IndividualTargeting**
- Purpose: Target specific students
- Use: Direct communication to individuals
- Functions: Validate student selection, limit counts

**TargetingSummary**
- Purpose: Targeting result preview
- Use: Show targeting outcome before sending
- Functions: Recipient counts, breakdown by location, validation warnings

**BulkTargeting**
- Purpose: Apply multiple targeting rules
- Use: Complex targeting scenarios
- Functions: Rule combination, conflict validation

**TargetingPreview**
- Purpose: Preview targeting results
- Use: Test targeting configuration
- Functions: Estimate recipients, student list preview

---

## 8. **announcement_tracking.py** - Engagement Analytics

### Classes:

**DeviceType (Enum)**
- Purpose: Track device types (MOBILE, WEB, TABLET, DESKTOP)
- Use: Analyze reading patterns by device

**ReadReceipt**
- Purpose: Mark announcement as read
- Use: Track when students view announcements
- Functions: Reading time tracking, scroll percentage, device detection

**ReadReceiptResponse**
- Purpose: Confirm read receipt recording
- Use: Acknowledge read status and show next actions
- Functions: Indicate acknowledgment requirements

**AcknowledgmentRequest**
- Purpose: Submit acknowledgment for announcement
- Use: Students confirm understanding of announcements
- Functions: Optional notes, action confirmation

**AcknowledgmentResponse**
- Purpose: Confirm acknowledgment submission
- Use: Acknowledge receipt with timing status
- Functions: Track deadline compliance

**PendingAcknowledgment**
- Purpose: Student pending acknowledgment record
- Use: Track who hasn't acknowledged yet
- Functions: Contact info for follow-up, delivery tracking

**AcknowledgmentTracking**
- Purpose: Complete acknowledgment overview
- Use: Monitor acknowledgment progress
- Functions: Deadline tracking, pending student lists

**EngagementMetrics**
- Purpose: Comprehensive engagement analytics
- Use: Measure announcement effectiveness
- Functions: Calculate engagement scores, compare to averages

**ReadingTime**
- Purpose: Reading time analysis
- Use: Understand how thoroughly announcements are read
- Functions: Statistics, reader categorization

**StudentEngagement**
- Purpose: Individual student interaction record
- Use: Track specific student's engagement patterns
- Functions: Time-to-read calculation, device tracking

**EngagementTrend**
- Purpose: Engagement over time analysis
- Use: Understand engagement patterns and peak times
- Functions: Hourly/daily trends, device breakdowns

**AnnouncementAnalytics**
- Purpose: Complete analytics dashboard
- Use: Comprehensive announcement performance view
- Functions: Combine all metrics, generate insights

---

## **Key Functions Summary:**

### **Data Validation Functions:**
- Field validation (dates, text length, IDs)
- Cross-field validation (targeting consistency)
- Business rule validation (approval requirements)

### **Computed Properties:**
- Engagement calculations (read rates, acknowledgment rates)
- Status derivation (active, expired, overdue)
- Time calculations (hours until deadline, time spent)

### **Workflow Management:**
- State transitions (draft → published → archived)
- Approval workflows (submit → approve → publish)
- Scheduling workflows (schedule → publish → track)

### **Analytics Functions:**
- Metric aggregation (counts, rates, averages)
- Trend analysis (engagement over time)
- Comparative analysis (above/below average)

### **Utility Functions:**
- Data normalization (title formatting, list deduplication)
- Safety validations (confirmation requirements)
- Preview generation (targeting estimates)

================================================================================================================================================

# Complete Attendance Schema Classes Breakdown

## 1. **attendance_alert.py** - Proactive Attendance Monitoring

### Classes:

**AttendanceAlert**
- Purpose: Record attendance-related alerts with tracking and resolution
- Use: Track low attendance, consecutive absences, late entry patterns
- Functions: Alert classification, acknowledgment tracking, escalation management, resolution workflow

**AlertConfig**
- Purpose: Configure alert generation rules and thresholds
- Use: Define when alerts should trigger and notification preferences
- Functions: Threshold validation, notification channel setup, escalation rules, suppression settings

**AlertTrigger**
- Purpose: Manually create alerts for specific attendance concerns
- Use: Allow authorized users to flag attendance issues manually
- Functions: Custom message validation, severity assignment, immediate notification

**AlertAcknowledgment**
- Purpose: Record acknowledgment of alerts with action details
- Use: Track who acknowledged alerts and what actions were taken
- Functions: Action validation, assignment tracking, resolution marking

**AlertList**
- Purpose: Paginated list of alerts with summary statistics
- Use: Display alerts in admin dashboards with filtering
- Functions: Aggregate metrics by type/severity, breakdown statistics

**AlertSummary**
- Purpose: High-level alert overview for monitoring dashboards
- Use: Show alert trends and key metrics at a glance
- Functions: Trend analysis, performance metrics, student impact assessment

---

## 2. **attendance_base.py** - Core Attendance Operations

### Classes:

**AttendanceBase**
- Purpose: Base schema with common attendance fields
- Use: Foundation for all attendance operations with core validation
- Functions: Date validation, time consistency checks, late status validation, notes normalization

**AttendanceCreate**
- Purpose: Create new attendance record with location tracking
- Use: Record attendance from various sources (manual, mobile app)
- Functions: Location coordinate validation, device info tracking, geo-fencing support

**AttendanceUpdate**
- Purpose: Update existing attendance records with partial fields
- Use: Modify attendance records after initial creation
- Functions: Partial update validation, consistency checks, audit trail support

**SingleAttendanceRecord**
- Purpose: Individual record for bulk operations
- Use: Component of bulk attendance operations
- Functions: Lightweight validation, late status consistency, status-specific rules

**BulkAttendanceCreate**
- Purpose: Create multiple attendance records in single operation
- Use: Efficient batch processing for daily attendance marking
- Functions: Duplicate prevention, batch validation, unique student enforcement

---

## 3. **attendance_filters.py** - Search & Export Functionality

### Classes:

**AttendanceFilterParams**
- Purpose: Comprehensive filtering for attendance queries
- Use: Filter attendance records by multiple criteria
- Functions: Multi-dimensional filtering, date range validation, status combination logic

**DateRangeRequest**
- Purpose: Simple date range specification with validation
- Use: Reports and queries requiring date boundaries
- Functions: Range validation, historical limits, reasonable period enforcement

**AttendanceExportRequest**
- Purpose: Export attendance data in various formats
- Use: Generate downloadable reports (CSV, Excel, PDF)
- Functions: Format-specific validation, content options, performance limits, filename sanitization

---

## 4. **attendance_policy.py** - Policy Management & Compliance

### Classes:

**AttendancePolicy**
- Purpose: Define attendance rules and requirements for hostels
- Use: Set minimum attendance percentages, late entry thresholds, alert triggers
- Functions: Threshold validation, notification configuration, auto-marking setup, effective date management

**PolicyConfig**
- Purpose: Extended policy configuration with calculation rules
- Use: Define how attendance percentages are calculated
- Functions: Period calculation setup, leave handling rules, weekend/holiday configuration, penalty systems

**PolicyUpdate**
- Purpose: Update policy settings with partial fields
- Use: Modify existing policies without full replacement
- Functions: Partial update validation, consistency checks, threshold relationship validation

**PolicyViolation**
- Purpose: Track attendance policy violations with corrective actions
- Use: Record when students violate attendance policies
- Functions: Violation type classification, notification tracking, resolution workflow, action planning

---

## 5. **attendance_record.py** - Various Recording Methods

### Classes:

**AttendanceRecordRequest**
- Purpose: Record attendance for single student with comprehensive validation
- Use: Individual attendance marking with full validation
- Functions: Status-specific validation, time consistency checks, late calculation

**StudentAttendanceRecord**
- Purpose: Lightweight student record for bulk operations
- Use: Component of bulk attendance processing
- Functions: Optional field validation, consistency checks, status-specific rules

**BulkAttendanceRequest**
- Purpose: Mark attendance for multiple students efficiently
- Use: Daily attendance marking for entire hostel/floor
- Functions: Default status application, per-student overrides, duplicate prevention

**AttendanceCorrection**
- Purpose: Correct previously marked attendance with audit trail
- Use: Fix attendance errors with mandatory documentation
- Functions: Correction validation, audit trail creation, reason enforcement

**QuickAttendanceMarkAll**
- Purpose: Quickly mark all students with exception handling
- Use: Streamlined daily attendance for present-by-default scenarios
- Functions: Exception list management, overlap prevention, bulk efficiency

---

## 6. **attendance_report.py** - Analytics & Reporting

### Classes:

**AttendanceSummary**
- Purpose: Comprehensive attendance statistics for any period
- Use: Aggregate metrics, percentages, streaks, status assessment
- Functions: Percentage calculation, streak tracking, status categorization, compliance checking

**DailyAttendanceRecord**
- Purpose: Single day's attendance record for reports
- Use: Timeline views and detailed daily reports
- Functions: Status display formatting, holiday/weekend flagging, note inclusion

**WeeklyAttendance**
- Purpose: Week-level attendance aggregation
- Use: Weekly trend analysis and reporting
- Functions: ISO week calculation, working day counting, percentage computation

**MonthlyComparison**
- Purpose: Month-over-month attendance comparison
- Use: Trend analysis and month-to-month tracking
- Functions: Trend indication, working day normalization, percentage comparison

**TrendAnalysis**
- Purpose: Attendance pattern analysis over time
- Use: Identify improvement/decline trends and patterns
- Functions: Pattern detection, improvement rate calculation, projection analysis

**AttendanceReport**
- Purpose: Comprehensive attendance report combining all data
- Use: Generate complete attendance analysis documents
- Functions: Data aggregation, trend integration, metadata tracking

**StudentMonthlySummary**
- Purpose: Individual student's monthly attendance summary
- Use: Monthly reports showing per-student performance
- Functions: Performance categorization, improvement tracking, action flag determination

**MonthlyReport**
- Purpose: Complete monthly report for entire hostel
- Use: Hostel-wide monthly attendance analysis
- Functions: Student aggregation, hostel metrics, compliance rate calculation

**ComparisonItem**
- Purpose: Individual entity in comparative analysis
- Use: Component of benchmark comparisons
- Functions: Ranking calculation, percentile assignment, performance categorization

**AttendanceComparison**
- Purpose: Comparative analysis across multiple entities
- Use: Benchmark students/hostels/rooms against each other
- Functions: Statistical analysis, ranking validation, performance distribution

---

## 7. **attendance_response.py** - API Response Optimization

### Classes:

**AttendanceResponse**
- Purpose: Standard attendance response for API calls
- Use: Lightweight response for list views and basic queries
- Functions: Status display formatting, essential data only

**AttendanceDetail**
- Purpose: Complete attendance information with all metadata
- Use: Detailed views requiring full attendance context
- Functions: Location data inclusion, device info tracking, audit trail display, marking method interpretation

**AttendanceListItem**
- Purpose: Minimal attendance item for efficient list rendering
- Use: Paginated lists and table views
- Functions: Status badge coloring, minimal data transfer, UI optimization

**DailyAttendanceSummary**
- Purpose: Daily attendance summary with statistics
- Use: Dashboard views showing daily hostel performance
- Functions: Percentage calculation, pending student counting, status quality assessment

---

## **Key Functions Summary:**

### **Data Validation Functions:**
- Date range validation (no future dates, reasonable periods)
- Time consistency validation (check-out after check-in)
- Status-specific validation (absent students can't be late)
- Threshold and percentage validation (0-100% ranges)

### **Computed Properties:**
- Attendance percentage calculations
- Status display formatting and color coding
- Streak counting (consecutive present/absent days)
- Performance indicators and quality ratings

### **Business Logic Functions:**
- Policy compliance checking
- Alert threshold evaluation
- Trend analysis and improvement detection
- Ranking and percentile calculations

### **Data Processing Functions:**
- Bulk operation validation (duplicate prevention)
- Aggregation and summary calculations
- Report generation and formatting
- Export preparation and sanitization

### **Workflow Management:**
- Alert acknowledgment and resolution tracking
- Correction audit trails
- Policy violation workflows
- Escalation management

### **Analytics Functions:**
- Statistical analysis (mean, median, standard deviation)
- Trend detection and projection
- Comparative analysis and benchmarking
- Performance categorization and recommendations

### **Utility Functions:**
- Text normalization and validation
- Date and time formatting
- Status mapping and display
- Color coding for UI elements

### **Configuration Management:**
- Policy threshold management
- Alert configuration validation
- Notification preference handling
- Calculation rule enforcement

================================================================================================================================================

# Complete Audit Schema Classes Breakdown

## 1. **admin_override_log.py** - Admin Override Accountability

### Classes:

**AdminOverrideBase**
- Purpose: Track admin interventions in supervisor decisions for accountability
- Use: Record when admins override supervisor actions/decisions
- Functions: Impact score calculation, validation of override logic, approval workflow tracking

**AdminOverrideCreate**
- Purpose: Create new admin override log entries
- Use: Services use this to record admin interventions
- Functions: Factory methods for complaint/maintenance overrides, standardized creation patterns

**AdminOverrideLogResponse**
- Purpose: List view of override logs for tables/dashboards
- Use: Display override events in admin oversight dashboards
- Functions: Display text generation, severity badge colors, impact score validation

**AdminOverrideDetail**
- Purpose: Complete override information for investigation
- Use: Detailed view of specific override events for analysis
- Functions: Approval status checking, resolution time calculation, pending approval identification

**AdminOverrideSummary**
- Purpose: Aggregated override statistics for governance
- Use: Executive reporting on admin intervention patterns
- Functions: Most common override identification, most active admin tracking, trend analysis

**AdminOverrideTimelinePoint**
- Purpose: Time-bucketed override data for trend analysis
- Use: Visualize override patterns over time
- Functions: Alert level determination, category breakdown, impact averaging

**SupervisorImpactAnalysis**
- Purpose: Analysis of override impact on specific supervisors
- Use: Performance feedback and training needs identification
- Functions: Override risk assessment, training needs determination, performance scoring

**AdminOverrideAnalytics**
- Purpose: Advanced analytics for override patterns and governance
- Use: Process improvement and supervisory training insights
- Functions: Health score calculation, pattern identification, recommendation generation

---

## 2. **audit_filters.py** - Advanced Query Capabilities

### Classes:

**AuditSortField (Enum)**
- Purpose: Define sortable fields for audit queries
- Use: Specify sort options in audit log queries

**AuditFilterParams**
- Purpose: Comprehensive filtering for audit log queries
- Use: Filter audit logs by actor, action, entity, time, location, security attributes
- Functions: Active filter detection, time filter validation, conflict resolution

**AuditSearchParams**
- Purpose: Full-text search capabilities for audit logs
- Use: Search across audit descriptions, entity names, user emails
- Functions: Search scope configuration, fuzzy matching, phrase searching

**AuditExportParams**
- Purpose: Export audit data with privacy and format options
- Use: Generate audit reports in various formats with data protection
- Functions: Field selection validation, privacy options, format-specific validation

---

## 3. **audit_log_base.py** - Core Audit Infrastructure

### Classes:

**AuditContext**
- Purpose: Capture request and environment context for audit events
- Use: Store IP, user agent, geographic, device, and API context
- Functions: IP validation, user agent sanitization, mobile detection, browser identification

**ChangeDetail**
- Purpose: Track specific field-level changes in entities
- Use: Granular change tracking for compliance and rollback
- Functions: Change validation, sensitive data masking, display value generation

**AuditLogBase**
- Purpose: Foundation schema for all audit log entries
- Use: Core audit logging with actor, action, entity, and change tracking
- Functions: Severity assessment, review requirements, changed field extraction, log message generation

**AuditLogCreate**
- Purpose: Create new audit log entries from application events
- Use: Services use this to record all system actions
- Functions: Factory methods for different event types, request context extraction

---

## 4. **audit_log_response.py** - Response Optimization

### Classes:

**AuditLogResponse**
- Purpose: Lightweight audit log for list views and tables
- Use: Efficient display of audit logs in dashboards
- Functions: Display text generation, status badge colors, category icons

**AuditLogDetail**
- Purpose: Complete audit information for detailed investigation
- Use: Full audit trail with all context and metadata
- Functions: Change summary generation, location summary, field change extraction

**AuditLogSummary**
- Purpose: Aggregated audit statistics for reporting periods
- Use: Dashboard metrics and executive reporting
- Functions: Success rate calculation, security scoring, attention requirements

**AuditLogTimeline**
- Purpose: Time-series view of audit events for visualizations
- Use: Timeline charts and trend analysis
- Functions: Severity indication, notable event highlighting, category breakdown

---

## 5. **audit_reports.py** - Advanced Analytics & Reporting

### Classes:

**ReportFormat (Enum)**
- Purpose: Define available export formats for reports
- Use: Specify output format for audit reports

**CategoryAnalytics**
- Purpose: Detailed analytics for specific audit action categories
- Use: Category-level performance analysis and trend identification
- Functions: Success/failure rate calculation, trend analysis, top action identification

**UserActivitySummary**
- Purpose: Comprehensive user activity analysis for investigation
- Use: Track individual user behavior patterns and anomalies
- Functions: Activity scoring, risk assessment, pattern analysis, geographic tracking

**AuditSummary**
- Purpose: Executive-level audit overview for governance
- Use: High-level audit health and performance metrics
- Functions: Security health scoring, compliance assessment, attention requirements

**EntityChangeSummary**
- Purpose: Track modification patterns for entity types
- Use: Monitor data integrity and change frequency
- Functions: Change rate calculation, volatility scoring, most changed entity tracking

**EntityChangeRecord**
- Purpose: Individual change event in entity lifecycle
- Use: Component of complete entity change history
- Functions: Change summary generation, actor display formatting

**EntityChangeHistory**
- Purpose: Complete audit trail for single entity instance
- Use: Full lifecycle tracking for compliance and rollback
- Functions: Entity age calculation, change frequency analysis, field history extraction

**ComplianceReport**
- Purpose: Regulatory compliance focused audit analysis
- Use: GDPR, HIPAA, SOC2 compliance reporting
- Functions: Compliance grading, risk assessment, violation tracking

**SecurityAuditReport**
- Purpose: Security-focused threat and risk analysis
- Use: Security posture assessment and threat detection
- Functions: Threat level assessment, login success tracking, risk scoring

**AuditTrendAnalysis**
- Purpose: Time-series trend analysis for audit metrics
- Use: Pattern identification and anomaly detection
- Functions: Volatility scoring, anomaly detection, trend strength measurement

**AuditReport**
- Purpose: Comprehensive audit report combining all analytics
- Use: Executive audit review with all insights and recommendations
- Functions: Executive summary generation, health scoring, insight compilation

---

## 6. **supervisor_activity_log.py** - Supervisor Performance Tracking

### Classes:

**SupervisorActionCategory (Enum)**
- Purpose: Categorize types of supervisor activities
- Use: Classify supervisor actions for reporting and analysis

**SupervisorActivityBase**
- Purpose: Core supervisor activity tracking with performance metrics
- Use: Record all supervisor actions during shifts
- Functions: Efficiency scoring, time validation, performance calculation

**SupervisorActivityCreate**
- Purpose: Create supervisor activity log entries
- Use: Services record supervisor actions throughout shifts
- Functions: Factory methods for complaint/attendance actions, context capture

**SupervisorActivityLogResponse**
- Purpose: List view of supervisor activities for management dashboards
- Use: Track supervisor productivity and task completion
- Functions: Display formatting, status coloring, priority indication

**SupervisorActivityDetail**
- Purpose: Complete supervisor activity information for review
- Use: Detailed analysis of specific supervisor actions
- Functions: Performance rating, overdue detection, follow-up tracking

**SupervisorActivityFilter**
- Purpose: Filter and search supervisor activities
- Use: Query supervisor performance data with multiple criteria
- Functions: Time filter validation, performance threshold filtering

**SupervisorActivitySummary**
- Purpose: Aggregated supervisor performance over time periods
- Use: Performance dashboards and supervisor evaluation
- Functions: Daily activity averaging, common action identification, achievement tracking

**SupervisorActivityTimelinePoint**
- Purpose: Time-bucketed supervisor activity data
- Use: Timeline visualizations and workload analysis
- Functions: Completion rate calculation, workload intensity assessment

**SupervisorPerformanceMetrics**
- Purpose: Comprehensive performance scoring for supervisors
- Use: Performance reviews, recognition, and improvement planning
- Functions: Overall performance scoring, grade calculation, productivity measurement

**SupervisorShiftReport**
- Purpose: End-of-shift summary for handover and records
- Use: Shift transition documentation and activity logging
- Functions: Productivity rate calculation, completion tracking, handover documentation

---

## **Key Functions Summary:**

### **Validation Functions:**
- **Data Integrity**: IP address, decimal precision, date ranges
- **Business Logic**: Override justification, approval workflows, activity consistency
- **Security**: Sensitive data handling, access control validation
- **Performance**: Score ranges, efficiency thresholds, quality metrics

### **Computed Properties:**
- **Scoring Systems**: Performance scores, efficiency ratings, security health
- **Rate Calculations**: Success rates, completion rates, compliance percentages
- **Status Indicators**: Risk levels, performance grades, health assessments
- **Display Helpers**: Color codes, badge indicators, formatted text

### **Analytics Functions:**
- **Trend Analysis**: Direction detection, percentage changes, volatility measurement
- **Pattern Recognition**: Anomaly detection, usage patterns, behavioral analysis
- **Comparative Analysis**: Benchmarking, percentile ranking, performance comparison
- **Aggregation**: Summary statistics, rollups, time-series data

### **Workflow Management:**
- **Approval Processes**: Override approvals, escalation handling
- **State Transitions**: Activity status tracking, completion workflows
- **Follow-up Management**: Task tracking, deadline monitoring
- **Handover Processes**: Shift transitions, pending task management

### **Reporting Functions:**
- **Executive Summaries**: High-level overview generation
- **Detailed Analytics**: Comprehensive performance analysis
- **Compliance Reporting**: Regulatory requirement tracking
- **Security Analysis**: Threat detection and risk assessment

### **Performance Monitoring:**
- **Efficiency Tracking**: Time-to-completion, productivity rates
- **Quality Assessment**: Feedback scores, accuracy ratings
- **Workload Analysis**: Task distribution, intensity measurement
- **Recognition Systems**: Achievement tracking, performance highlighting

### **Data Export and Formatting:**
- **Multi-format Support**: PDF, Excel, CSV, JSON exports
- **Privacy Controls**: Data masking, anonymization, redaction
- **Customization**: Field selection, grouping options
- **Visualization**: Chart data, timeline formatting, dashboard optimization


================================================================================================================================================
# Complete Auth Schema Classes Breakdown

## 1. **login.py** - User Authentication

### Classes:

**LoginRequest**
- Purpose: Handle email/password-based user authentication
- Use: Standard login form submission from web/mobile apps
- Functions: Email validation, password length validation, whitespace stripping

**PhoneLoginRequest**
- Purpose: Handle phone number-based authentication
- Use: Alternative login method using phone number instead of email
- Functions: Phone number normalization (remove spaces/dashes), E.164 format validation

**TokenData**
- Purpose: Structure data embedded in JWT token payload
- Use: Carry minimal user identification within JWT tokens
- Functions: User context storage, role-based authorization support

**UserLoginInfo**
- Purpose: User profile information returned after successful login
- Use: Provide essential user data without sensitive information
- Functions: Profile data serialization, verification status tracking

**LoginResponse**
- Purpose: Complete login response following OAuth 2.0 format
- Use: Return JWT tokens and user information after authentication
- Functions: Token delivery, user context establishment, session management

---

## 2. **otp.py** - One-Time Password Management

### Classes:

**OTPGenerateRequest**
- Purpose: Request OTP generation for verification workflows
- Use: Initiate OTP delivery via email or SMS
- Functions: Contact method validation, phone normalization, multi-channel support

**OTPVerifyRequest**
- Purpose: Submit OTP code for verification
- Use: Complete verification process with 6-digit code
- Functions: OTP format validation (exactly 6 digits), contact method consistency

**OTPResponse**
- Purpose: Confirm OTP generation and provide delivery information
- Use: Inform user about OTP delivery status and expiration
- Functions: Delivery confirmation, masked contact display, attempt tracking

**OTPVerifyResponse**
- Purpose: Return OTP verification results
- Use: Confirm verification success/failure with details
- Functions: Verification status tracking, remaining attempts calculation

**ResendOTPRequest**
- Purpose: Handle OTP resend requests when user doesn't receive original
- Use: Retry OTP delivery for failed/missed messages
- Functions: Contact method validation, resend attempt management

---

## 3. **password.py** - Password Security Management

### Classes:

**PasswordValidator (Utility Class)**
- Purpose: Centralized password strength validation logic
- Use: Reusable password validation across the application
- Functions: Strength assessment (0-5 scale), requirement checking, special character validation

**PasswordResetRequest**
- Purpose: Initiate password reset flow (forgot password)
- Use: Start password recovery process via email
- Functions: Email normalization, format validation

**PasswordResetConfirm**
- Purpose: Complete password reset with token and new password
- Use: Finalize password reset after email verification
- Functions: Token validation, password strength checking, confirmation matching

**PasswordChangeRequest**
- Purpose: Change password for authenticated users
- Use: Allow logged-in users to update their password
- Functions: Current password verification, new password validation, change prevention (same password)

**PasswordChangeResponse**
- Purpose: Confirm successful password change
- Use: Acknowledge password update completion
- Functions: Success confirmation, user identification

**PasswordStrengthCheck**
- Purpose: Real-time password strength evaluation
- Use: Provide live feedback during password entry
- Functions: Strength scoring without persistence

**PasswordStrengthResponse**
- Purpose: Detailed password strength analysis results
- Use: Display comprehensive strength feedback to users
- Functions: Requirement breakdown, suggestion generation, strength categorization

---

## 4. **register.py** - User Registration

### Classes:

**RegisterRequest**
- Purpose: Handle new user registration with comprehensive validation
- Use: Process user signup from registration forms
- Functions: Email/phone normalization, age validation, password strength checking, role restriction

**RegisterResponse**
- Purpose: Confirm successful user registration
- Use: Provide registration confirmation and next steps
- Functions: User ID generation, verification requirement indication

**VerifyEmailRequest**
- Purpose: Verify email address with 6-digit code
- Use: Complete email verification during registration
- Functions: Code format validation (exactly 6 digits)

**VerifyPhoneRequest**
- Purpose: Verify phone number with SMS code
- Use: Complete phone verification during registration
- Functions: SMS code format validation

**ResendVerificationRequest**
- Purpose: Resend verification codes for email/phone
- Use: Retry verification when user doesn't receive codes
- Functions: Verification type normalization, resend management

---

## 5. **social_auth.py** - OAuth Social Authentication

### Classes:

**SocialAuthRequest**
- Purpose: Generic OAuth provider authentication
- Use: Handle authentication from various social providers
- Functions: Provider normalization, token validation

**GoogleAuthRequest**
- Purpose: Google-specific OAuth authentication
- Use: Handle Google Sign-In with ID tokens
- Functions: Google ID token validation, access token handling

**FacebookAuthRequest**
- Purpose: Facebook-specific OAuth authentication
- Use: Handle Facebook Login integration
- Functions: Facebook token and user ID validation

**SocialUserInfo**
- Purpose: User information after successful social authentication
- Use: Return minimal user profile from OAuth providers
- Functions: Profile data extraction, auto-verification marking

**SocialProfileData**
- Purpose: Comprehensive profile data from OAuth providers
- Use: Extract detailed user information from social providers
- Functions: Profile parsing, email normalization, locale handling

**SocialAuthResponse**
- Purpose: Complete social authentication response
- Use: Return JWT tokens and user data after OAuth success
- Functions: Token generation, new user detection, profile integration

---

## 6. **token.py** - JWT Token Management

### Classes:

**Token**
- Purpose: Standard OAuth 2.0 token response structure
- Use: Return access and refresh tokens after authentication
- Functions: Token delivery, expiration tracking

**TokenPayload**
- Purpose: JWT token internal structure and claims
- Use: Define what data is embedded in JWT tokens
- Functions: Timestamp validation, claim structure, token identification

**RefreshTokenRequest**
- Purpose: Request new access token using refresh token
- Use: Extend session without re-authentication
- Functions: Refresh token validation, whitespace handling

**RefreshTokenResponse**
- Purpose: Return new tokens after refresh operation
- Use: Provide fresh access/refresh tokens (token rotation)
- Functions: New token delivery, expiration updating

**TokenValidationRequest**
- Purpose: Validate token without authenticated request
- Use: Check token validity for security purposes
- Functions: Token format validation

**TokenValidationResponse**
- Purpose: Return token validation results
- Use: Provide detailed token status and user information
- Functions: Validity confirmation, user extraction, error reporting

**RevokeTokenRequest**
- Purpose: Invalidate specific tokens or all user tokens
- Use: Logout, security breach response, token cleanup
- Functions: Token identification, bulk revocation support

**LogoutRequest**
- Purpose: Terminate user session(s)
- Use: Handle user logout from single or all devices
- Functions: Session termination, multi-device logout, token cleanup

---

## **Key Functions Summary:**

### **Validation Functions:**
- **Format Validation**: Email format, phone E.164, OTP 6-digit format
- **Security Validation**: Password strength (8+ chars, mixed case, digits, special chars)
- **Age Validation**: Date of birth constraints (13+ years, not future)
- **Token Validation**: JWT format, expiration, signature verification

### **Normalization Functions:**
- **Data Cleaning**: Email lowercase, phone number formatting, whitespace removal
- **Provider Normalization**: Social auth provider names, verification types
- **Contact Method**: Phone number standardization, email format consistency

### **Security Functions:**
- **Password Strength**: Scoring (0-5), requirement checking, suggestion generation
- **Token Management**: JWT creation, refresh token rotation, revocation
- **OTP Security**: 6-digit generation, expiration tracking, attempt limiting

### **Business Logic Functions:**
- **Role Restrictions**: Prevent self-registration as admin roles
- **Verification Workflows**: Email/phone verification, OTP flows
- **Session Management**: Login/logout, multi-device support, token refresh

### **Response Formatting:**
- **OAuth 2.0 Compliance**: Standard token response formats
- **Error Handling**: Validation errors, authentication failures
- **User Information**: Profile data serialization, privacy protection

### **Computed Properties:**
- **Password Analysis**: Strength scoring, requirement breakdown
- **Token Claims**: User context, role extraction, expiration calculation
- **Verification Status**: Email/phone verification states

### **Utility Functions:**
- **Contact Method Detection**: Email vs phone identification
- **Profile Extraction**: Social provider data parsing
- **Security Scoring**: Password strength algorithms, risk assessment

### **Integration Support:**
- **Multi-Provider OAuth**: Google, Facebook, Apple authentication
- **Multi-Factor Auth**: OTP integration, verification workflows
- **Token Rotation**: Refresh token security, session management
- **Audit Trail**: Login tracking, verification logging

================================================================================================================================================
# Complete Class Overview for Announcement and Booking Schemas

## ANNOUNCEMENT SCHEMAS

### 📁 announcement_approval.py
| Class | Purpose |
|-------|---------|
| `ApprovalStatus` | Enum for approval states (pending, approved, rejected, not_required) |
| `ApprovalRequest` | Submit announcement for admin approval with justification |
| `ApprovalResponse` | Response after approval/rejection decision with feedback |
| `RejectionRequest` | Reject announcement with detailed reason and suggestions |
| `ApprovalWorkflow` | Complete approval workflow status and timeline |
| `SupervisorApprovalQueue` | Supervisor's view of their pending approvals |
| `PendingApprovalItem` | Lightweight item for approval queue lists |
| `BulkApproval` | Approve/reject multiple announcements at once |
| `ApprovalHistory` | Audit trail of approval actions and decisions |

### 📁 announcement_base.py
| Class | Purpose |
|-------|---------|
| `AnnouncementBase` | Base schema with common fields and validation rules |
| `AnnouncementCreate` | Schema for creating new announcements with delivery settings |
| `AnnouncementUpdate` | Schema for updating existing announcements (partial updates) |
| `AnnouncementPublish` | Schema for publishing draft announcements |
| `AnnouncementUnpublish` | Schema for unpublishing announcements with reason |

### 📁 announcement_delivery.py
| Class | Purpose |
|-------|---------|
| `DeliveryChannel` | Enum for delivery channels (email, sms, push, in_app) |
| `DeliveryStrategy` | Enum for delivery strategies (immediate, scheduled, batched) |
| `DeliveryState` | Enum for delivery states (pending, processing, completed, failed) |
| `DeliveryChannels` | Configure which delivery channels to use and priorities |
| `DeliveryConfig` | Complete delivery configuration with batching and retry settings |
| `DeliveryStatus` | Real-time delivery progress across all channels |
| `ChannelDeliveryStats` | Performance metrics for specific delivery channels |
| `FailedDelivery` | Failed delivery records for troubleshooting |
| `DeliveryReport` | Comprehensive delivery analytics and performance report |
| `BatchDelivery` | Track progress of batched delivery operations |
| `RetryDelivery` | Retry failed deliveries with specific parameters |
| `DeliveryPause` | Temporarily pause ongoing delivery processing |
| `DeliveryResume` | Resume paused delivery from where it stopped |

### 📁 announcement_filters.py
| Class | Purpose |
|-------|---------|
| `ExportFormat` | Enum for export formats (pdf, excel, csv, json) |
| `AnnouncementSortField` | Enum for sortable fields (created_at, title, priority, etc.) |
| `AnnouncementFilterParams` | Comprehensive filters for announcement lists |
| `SearchRequest` | Full-text search across announcements with advanced options |
| `ArchiveRequest` | Archive old announcements with criteria |
| `AnnouncementExportRequest` | Export announcements to files in various formats |
| `BulkDeleteRequest` | Permanently delete multiple announcements |
| `AnnouncementStatsRequest` | Generate analytics and statistics for announcements |

### 📁 announcement_response.py
| Class | Purpose |
|-------|---------|
| `AnnouncementResponse` | Standard response with basic announcement info |
| `AnnouncementDetail` | Detailed view with complete metadata and engagement |
| `AnnouncementListItem` | Lightweight schema for list views and tables |
| `AnnouncementList` | Paginated list with summary statistics |
| `StudentAnnouncementView` | Student-optimized view with read status |
| `AnnouncementSummary` | Minimal summary for notifications and previews |

---

## BOOKING SCHEMAS

### 📁 booking_approval.py
| Class | Purpose |
|-------|---------|
| `BookingApprovalRequest` | Submit booking for approval with room assignment |
| `ApprovalResponse` | Confirmation after booking approval with next steps |
| `RejectionRequest` | Reject booking with reason and alternatives |
| `BulkApprovalRequest` | Approve multiple bookings in batch operation |
| `ApprovalSettings` | Configure auto-approval rules and policies per hostel |

### 📁 booking_assignment.py
| Class | Purpose |
|-------|---------|
| `RoomAssignment` | Record of room assignment to a booking |
| `BedAssignment` | Record of specific bed assignment within room |
| `AssignmentRequest` | Manually assign specific room/bed to booking |
| `BulkAssignmentRequest` | Assign rooms to multiple bookings at once |
| `SingleAssignment` | Individual assignment within bulk operation |
| `AssignmentResponse` | Result feedback after assignment operation |
| `ReassignmentRequest` | Move booking to different room/bed with reason |

### 📁 booking_base.py
| Class | Purpose |
|-------|---------|
| `BookingBase` | Base schema with core booking fields and validation |
| `BookingCreate` | Create new booking with guest info and preferences |
| `BookingUpdate` | Update existing booking (admin-modifiable fields only) |

### 📁 booking_calendar.py
| Class | Purpose |
|-------|---------|
| `BookingEvent` | Individual booking event for calendar display |
| `DayBookings` | All bookings and events for a specific day |
| `CalendarView` | Monthly calendar view with booking events |
| `CalendarEvent` | Generic calendar event (bookings, maintenance, etc.) |
| `AvailabilityCalendar` | Room availability tracking for a month |
| `DayAvailability` | Bed availability snapshot for specific day |
| `BookingInfo` | Basic booking info for availability calendar |

### 📁 booking_cancellation.py
| Class | Purpose |
|-------|---------|
| `CancellationRequest` | Cancel booking with reason and refund preference |
| `CancellationResponse` | Confirmation with refund details after cancellation |
| `RefundCalculation` | Transparent breakdown of refund amount calculation |
| `CancellationPolicy` | Hostel-specific cancellation and refund policies |
| `CancellationCharge` | Tiered cancellation charges based on timing |
| `BulkCancellation` | Cancel multiple bookings in one operation |

### 📁 booking_conversion.py
| Class | Purpose |
|-------|---------|
| `ConvertToStudentRequest` | Convert confirmed booking to active student profile |
| `ConversionResponse` | Confirmation with student profile details |
| `ConversionChecklist` | Pre-conversion validation checklist |
| `ChecklistItem` | Individual requirement for conversion |
| `BulkConversion` | Convert multiple bookings to students in batch |
| `ConversionRollback` | Emergency rollback of student conversion |

### 📁 booking_filters.py
| Class | Purpose |
|-------|---------|
| `BookingFilterParams` | Comprehensive filters for booking lists |
| `BookingSearchRequest` | Full-text search across booking fields |
| `BookingSortOptions` | Define sorting criteria for booking results |
| `BookingExportRequest` | Export booking data in multiple formats |
| `BookingAnalyticsRequest` | Generate booking analytics and reports |

### 📁 booking_modification.py
| Class | Purpose |
|-------|---------|
| `ModificationRequest` | General request to modify booking aspects |
| `ModificationResponse` | Result with pricing impact after modification |
| `DateChangeRequest` | Specific request to change check-in date |
| `DurationChangeRequest` | Specific request to change stay duration |
| `RoomTypeChangeRequest` | Specific request to change room type |
| `ModificationApproval` | Admin approval/rejection of modification |

### 📁 booking_request.py
| Class | Purpose |
|-------|---------|
| `GuestInformation` | Complete guest details for bookings |
| `BookingRequest` | Full booking request with all preferences |
| `BookingInquiry` | Simple inquiry without commitment |
| `QuickBookingRequest` | Fast-track booking with minimal info |

### 📁 booking_response.py
| Class | Purpose |
|-------|---------|
| `BookingResponse` | Standard booking response with core info |
| `BookingDetail` | Complete booking info with all metadata |
| `BookingListItem` | Optimized schema for listing multiple bookings |
| `BookingConfirmation` | Confirmation sent to guest after booking |

### 📁 booking_waitlist.py
| Class | Purpose |
|-------|---------|
| `WaitlistRequest` | Add visitor to waitlist when rooms unavailable |
| `WaitlistResponse` | Confirmation with position and timeline |
| `WaitlistStatusInfo` | Current waitlist status for visitor |
| `WaitlistNotification` | Notify when room becomes available |
| `WaitlistConversion` | Convert waitlist entry to actual booking |
| `WaitlistCancellation` | Remove entry from waitlist |
| `WaitlistManagement` | Admin view of all waitlist entries |
| `WaitlistEntry` | Individual waitlist entry details |

---

## KEY VALIDATION FUNCTIONS

### Common Validation Methods:
- `validate_check_in_date()` - Ensures dates are not in past
- `validate_rent_amount()` - Validates pricing within reasonable ranges  
- `quantize_decimal_fields()` - Ensures 2-decimal precision for money
- `validate_phone_number()` - Normalizes and validates phone formats
- `clean_text_fields()` - Strips whitespace and handles empty strings
- `validate_date_ranges()` - Ensures end dates are after start dates

### Computed Properties:
- `@computed_field` methods calculate derived values like:
  - `read_percentage` - Engagement metrics
  - `days_until_check_in` - Time calculations
  - `balance_amount` - Financial calculations
  - `occupancy_rate` - Capacity utilization

This structure provides a complete booking lifecycle from inquiry through check-in conversion, and a comprehensive announcement system with multi-channel delivery and engagement tracking.

================================================================================================================================================

# Complete Class Overview for Common Schemas

## 📁 common/base.py
| Class | Purpose |
|-------|---------|
| `BaseSchema` | Base Pydantic model with common configuration for all schemas |
| `TimestampMixin` | Adds `created_at` and `updated_at` timestamp fields |
| `SoftDeleteMixin` | Adds `deleted_at` and `is_deleted` fields for soft delete functionality |
| `UUIDMixin` | Adds UUID `id` field as primary key |
| `BaseDBSchema` | Combines BaseSchema + UUIDMixin + TimestampMixin for database entities |
| `BaseCreateSchema` | Base class for creation/input schemas |
| `BaseUpdateSchema` | Base class for update/patch schemas |
| `BaseResponseSchema` | Base class for API response schemas |
| `BaseFilterSchema` | Base class for query filter parameters |

## 📁 common/enums.py
| Enum Class | Purpose | Values |
|------------|---------|--------|
| `UserRole` | User access levels | super_admin, hostel_admin, supervisor, student, visitor |
| `Gender` | Gender identification | male, female, other |
| `HostelType` | Hostel accommodation types | boys, girls, co_ed |
| `HostelStatus` | Hostel operational status | active, inactive, under_maintenance, closed |
| `RoomType` | Room occupancy types | single, double, triple, four_sharing, dormitory |
| `RoomStatus` | Room availability status | active, inactive, maintenance, reserved |
| `BedStatus` | Individual bed status | available, occupied, reserved, maintenance |
| `BookingStatus` | Booking lifecycle states | pending, approved, rejected, cancelled, expired, confirmed, checked_in, completed |
| `BookingSource` | Booking origin channels | website, mobile_app, referral, walk_in, agent, other |
| `PaymentStatus` | Payment processing states | pending, processing, completed, failed, refunded, partially_refunded |
| `PaymentMethod` | Payment modes | cash, upi, card, net_banking, cheque, bank_transfer, payment_gateway |
| `PaymentType` | Payment categories | rent, security_deposit, mess_charges, electricity, water, maintenance, booking_advance, other |
| `FeeType` | Fee frequency | monthly, quarterly, half_yearly, yearly |
| `ComplaintCategory` | Complaint classifications | room_maintenance, plumbing, electrical, cleanliness, mess_food_quality, security, noise, internet, staff_behavior, other |
| `ComplaintStatus` | Complaint resolution states | open, assigned, in_progress, on_hold, resolved, closed, reopened, rejected |
| `Priority` | Urgency levels | low, medium, high, urgent, critical |
| `AttendanceStatus` | Student presence states | present, absent, late, on_leave, half_day |
| `AttendanceMode` | Attendance tracking methods | manual, biometric, qr_code, mobile_app |
| `LeaveType` | Leave categories | casual, sick, emergency, vacation, other |
| `LeaveStatus` | Leave approval states | pending, approved, rejected, cancelled |
| `MaintenanceCategory` | Maintenance work types | electrical, plumbing, carpentry, cleaning, appliance_repair, structural, painting, other |
| `MaintenanceStatus` | Maintenance workflow states | pending, approved, assigned, in_progress, on_hold, completed, rejected, cancelled |
| `MaintenanceIssueType` | Maintenance urgency types | routine, preventive, emergency, breakdown |
| `MaintenanceRecurrence` | Preventive maintenance schedules | none, weekly, monthly, quarterly, half_yearly, yearly |
| `NotificationType` | Notification delivery channels | email, sms, push |
| `NotificationStatus` | Notification delivery states | queued, processing, sent, failed, cancelled |
| `SubscriptionPlan` | Service tier levels | free, basic, standard, premium, enterprise |
| `SubscriptionStatus` | Subscription states | trial, active, past_due, cancelled, expired |
| `BillingCycle` | Billing frequencies | monthly, yearly |
| `StudentStatus` | Student lifecycle states | active, inactive, notice_period, alumni, suspended |
| `SupervisorStatus` | Staff employment states | active, on_leave, suspended, terminated |
| `EmploymentType` | Employment categories | full_time, part_time, contract |
| `AnnouncementCategory` | Announcement types | general, urgent, maintenance, event, rule_change, fee_related, security, other |
| `TargetAudience` | Announcement targeting | all, students_only, specific_rooms, specific_floors, individual |
| `MealType` | Meal categories | breakfast, lunch, snacks, dinner |
| `DietaryPreference` | Food preferences | vegetarian, non_vegetarian, vegan, jain |
| `IDProofType` | Identity document types | aadhaar, passport, driving_license, voter_id, pan_card |
| `PermissionLevel` | Access control levels | full_access, limited_access, view_only |
| `ReferralStatus` | Referral lifecycle states | pending, registered, booking_made, completed, expired, cancelled |
| `RewardStatus` | Reward payment states | pending, approved, paid, cancelled |
| `ReviewStatus` | Review moderation states | pending, approved, rejected, flagged |
| `VoteType` | Review helpfulness votes | helpful, not_helpful |
| `DeviceType` | Push notification devices | ios, android, web |
| `SearchSource` | Search result origins | search_results, direct_link, featured, comparison, referral |
| `InquiryStatus` | Lead qualification states | new, contacted, interested, not_interested, converted |
| `InquirySource` | Inquiry origin channels | website, mobile_app, referral, social_media, other |
| `WaitlistStatus` | Waitlist progression states | waiting, notified, converted, expired, cancelled |
| `OTPType` | One-time password purposes | email_verification, phone_verification, login, password_reset |
| `AuditActionCategory` | Audit log categories | authentication, authorization, user_management, hostel_management, booking, payment, complaint, attendance, maintenance, announcement, student_management, supervisor_management, configuration, other |
| `ChargeType` | Utility billing methods | included, actual, fixed_monthly |

## 📁 common/filters.py
| Class | Purpose |
|-------|---------|
| `DateRangeFilter` | Filter by start/end date range with validation |
| `DateTimeRangeFilter` | Filter by start/end datetime range with validation |
| `TimeRangeFilter` | Filter by start/end time range |
| `PriceRangeFilter` | Filter by minimum/maximum price range |
| `SearchFilter` | Generic text search query filter |
| `SortOptions` | Define sort field and order (asc/desc) |
| `StatusFilter` | Filter by status values (include/exclude lists) |
| `NumericRangeFilter` | Generic min/max numeric value filter |
| `LocationFilter` | Geographic location-based filtering (lat/lng/radius/city/state/pincode) |
| `MultiSelectFilter` | Multi-select with include/exclude options |
| `BooleanFilter` | True/false/null filter |
| `TextSearchFilter` | Full-text search with field targeting, fuzzy search, and boost weights |

## 📁 common/mixins.py
| Class | Purpose |
|-------|---------|
| `AddressMixin` | Standard address fields (line1, line2, city, state, pincode, country) |
| `ContactMixin` | Contact information fields (phone, alternate phone, email) |
| `LocationMixin` | Geographic coordinates (latitude, longitude) |
| `MediaMixin` | Media URL collections (images, videos, documents) |
| `EmergencyContactMixin` | Emergency contact details (name, phone, relation) |
| `AuditMixin` | Audit trail fields (created_by, updated_by) |
| `ApprovalMixin` | Approval workflow fields (approved_by, approved_at, rejection_reason) |
| `SEOMixin` | Search engine optimization fields (meta_title, meta_description, meta_keywords) |

## 📁 common/pagination.py
| Class | Purpose |
|-------|---------|
| `PaginationParams` | Page-based pagination parameters (page, page_size) |
| `PaginationMeta` | Page-based pagination metadata (totals, has_next/previous) |
| `PaginatedResponse<T>` | Generic paginated response wrapper with items and metadata |
| `CursorPaginationParams` | Cursor-based pagination for infinite scroll (cursor, limit) |
| `CursorPaginationMeta` | Cursor pagination metadata (next_cursor, has_more) |
| `CursorPaginatedResponse<T>` | Generic cursor-based response wrapper |

## 📁 common/response.py
| Class | Purpose |
|-------|---------|
| `SuccessResponse<T>` | Standard success response wrapper with message and data |
| `ErrorDetail` | Individual error information (field, message, code, location) |
| `ErrorResponse` | Standard error response with message and detailed errors |
| `MessageResponse` | Simple message-only response |
| `BulkOperationResponse` | Response for batch operations (total, successful, failed counts) |
| `ValidationErrorResponse` | Specific validation error response (422) |
| `NotFoundResponse` | Resource not found error response (404) |
| `UnauthorizedResponse` | Authentication error response (401) |
| `ForbiddenResponse` | Authorization error response (403) |
| `ConflictResponse` | Resource conflict error response (409) |
| `RateLimitResponse` | Rate limit exceeded response (429) |

---

## Key Functions in Classes

### Validation Functions:
- **Date Validators**: Ensure dates are valid, not in past, end > start
- **Range Validators**: Ensure min ≤ max for numeric/price ranges  
- **Phone Validators**: Normalize and validate phone number formats
- **Text Validators**: Strip whitespace, handle empty strings

### Computed Properties:
- **Pagination**: Calculate offset, limit from page/page_size
- **Date Calculations**: Days until, time remaining calculations
- **Status Checks**: is_active, has_next, has_previous flags

### Class Methods:
- **create()**: Factory methods for creating response instances
- **normalize()**: Data normalization and cleaning
- **validate_*()**: Custom validation logic for complex rules

### Generic Types:
- **T TypeVar**: Used in generic response classes for type safety
- **Generic[T]**: Enables type-safe pagination and responses

This common module provides the foundation for consistent data validation, response formatting, and shared functionality across the entire hostel management system.

================================================================================================================================================

### Combined Content from Folder: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint ###



# ===== Folder: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint =====

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\complaint_analytics.py ---
"""
Complaint analytics and reporting schemas.

Provides comprehensive analytics, metrics, and insights
for complaint management performance.
"""

from datetime import date as Date
from decimal import Decimal
from typing import Annotated, Dict, List, Union

from pydantic import ConfigDict, Field, field_validator, model_validator

from app.schemas.common.base import BaseSchema

__all__ = [
    "ComplaintAnalytics",
    "ResolutionMetrics",
    "CategoryAnalysis",
    "CategoryMetrics",
    "ComplaintTrendPoint",
    "StaffPerformance",
    "ComplaintHeatmap",
    "RoomComplaintCount",
]


class ResolutionMetrics(BaseSchema):
    """
    Detailed complaint resolution performance metrics.
    
    Tracks resolution efficiency and quality indicators.
    """
    model_config = ConfigDict(from_attributes=True)

    total_resolved: int = Field(..., ge=0, description="Total resolved count")

    # Time metrics (in hours)
    # Note: Pydantic v2 requires Decimal constraints in Annotated for optional fields
    average_resolution_time_hours: Annotated[
        Decimal,
        Field(ge=Decimal("0"), description="Average resolution time (hours)")
    ]
    median_resolution_time_hours: Annotated[
        Decimal,
        Field(ge=Decimal("0"), description="Median resolution time (hours)")
    ]
    fastest_resolution_hours: Annotated[
        Decimal,
        Field(ge=Decimal("0"), description="Fastest resolution time (hours)")
    ]
    slowest_resolution_hours: Annotated[
        Decimal,
        Field(ge=Decimal("0"), description="Slowest resolution time (hours)")
    ]

    # Performance rates
    resolution_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="% of complaints resolved"
        )
    ]
    same_day_resolution_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="% resolved within 24 hours"
        )
    ]

    # Escalation metrics
    escalation_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="% of complaints escalated"
        )
    ]

    # Quality metrics
    reopen_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="% of resolved complaints reopened"
        )
    ]


class CategoryMetrics(BaseSchema):
    """
    Metrics for a single complaint category.
    
    Provides detailed performance data per category.
    """
    model_config = ConfigDict(from_attributes=True)

    category: str = Field(..., description="Category name")
    total_complaints: int = Field(..., ge=0, description="Total complaints")
    open_complaints: int = Field(..., ge=0, description="Open complaints")
    resolved_complaints: int = Field(..., ge=0, description="Resolved complaints")

    average_resolution_time_hours: Annotated[
        Decimal,
        Field(ge=Decimal("0"), description="Average resolution time (hours)")
    ]
    resolution_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="Resolution rate percentage"
        )
    ]

    percentage_of_total: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="% of total complaints"
        )
    ]


class CategoryAnalysis(BaseSchema):
    """
    Category-wise complaint analysis.
    
    Identifies problem areas and trends by category.
    """
    model_config = ConfigDict(from_attributes=True)

    categories: List[CategoryMetrics] = Field(
        default_factory=list,
        description="Metrics for each category",
    )

    most_common_category: str = Field(
        ...,
        description="Category with most complaints",
    )
    most_problematic_category: str = Field(
        ...,
        description="Category with longest avg resolution time",
    )


class ComplaintTrendPoint(BaseSchema):
    """
    Time-series data point for complaint trends.
    
    Represents complaint metrics for a specific period.
    """
    model_config = ConfigDict(from_attributes=True)

    period: str = Field(
        ...,
        description="Time period (Date, week, or month)",
        examples=["2024-01-15", "2024-W03", "2024-01"],
    )
    total_complaints: int = Field(..., ge=0, description="Total complaints")
    open_complaints: int = Field(..., ge=0, description="Open complaints")
    resolved_complaints: int = Field(..., ge=0, description="Resolved complaints")

    # Priority breakdown
    urgent_count: int = Field(..., ge=0, description="Urgent priority count")
    high_count: int = Field(..., ge=0, description="High priority count")
    medium_count: int = Field(..., ge=0, description="Medium priority count")
    low_count: int = Field(..., ge=0, description="Low priority count")


class StaffPerformance(BaseSchema):
    """
    Individual staff member complaint resolution performance.
    
    Tracks productivity and quality metrics per staff member.
    """
    model_config = ConfigDict(from_attributes=True)

    staff_id: str = Field(..., description="Staff member user ID")
    staff_name: str = Field(..., description="Staff member name")
    staff_role: str = Field(..., description="Staff member role")

    complaints_assigned: int = Field(
        ...,
        ge=0,
        description="Total complaints assigned",
    )
    complaints_resolved: int = Field(
        ...,
        ge=0,
        description="Total complaints resolved",
    )

    average_resolution_time_hours: Annotated[
        Decimal,
        Field(ge=Decimal("0"), description="Average resolution time (hours)")
    ]
    resolution_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="Resolution rate percentage"
        )
    ]

    average_rating: Union[Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("5"),
            description="Average feedback rating (1-5)"
        )
    ], None] = None


class RoomComplaintCount(BaseSchema):
    """
    Complaint count and analysis for specific room.
    
    Helps identify problematic rooms.
    """
    model_config = ConfigDict(from_attributes=True)

    room_id: str = Field(..., description="Room identifier")
    room_number: str = Field(..., description="Room number")
    complaint_count: int = Field(..., ge=0, description="Total complaints")

    most_common_category: str = Field(
        ...,
        description="Most frequent complaint category",
    )


class ComplaintHeatmap(BaseSchema):
    """
    Complaint heatmap for pattern analysis.
    
    Identifies temporal and spatial complaint patterns.
    """
    model_config = ConfigDict(from_attributes=True)

    hostel_id: str = Field(..., description="Hostel identifier")

    # Temporal patterns
    complaints_by_hour: Dict[int, int] = Field(
        default_factory=dict,
        description="Complaint count by hour of day (0-23)",
    )
    complaints_by_day: Dict[str, int] = Field(
        default_factory=dict,
        description="Complaint count by day of week",
    )

    # Spatial patterns
    complaints_by_room: List[RoomComplaintCount] = Field(
        default_factory=list,
        description="Complaint count by room",
    )
    complaints_by_floor: Dict[int, int] = Field(
        default_factory=dict,
        description="Complaint count by floor number",
    )

    @field_validator("complaints_by_hour")
    @classmethod
    def validate_hour_keys(cls, v: Dict[int, int]) -> Dict[int, int]:
        """Validate hour keys are in valid range (0-23)."""
        for hour in v.keys():
            if not 0 <= hour <= 23:
                raise ValueError(f"Invalid hour: {hour}. Must be 0-23")
        return v


class ComplaintAnalytics(BaseSchema):
    """
    Comprehensive complaint analytics dashboard.
    
    Provides holistic view of complaint management performance.
    """
    model_config = ConfigDict(from_attributes=True)

    hostel_id: Union[str, None] = Field(
        default=None,
        description="Hostel ID (None for system-wide analytics)",
    )
    period_start: Date = Field(..., description="Analytics period start")
    period_end: Date = Field(..., description="Analytics period end")

    # Summary counts
    total_complaints: int = Field(..., ge=0, description="Total complaints")
    open_complaints: int = Field(..., ge=0, description="Open complaints")
    resolved_complaints: int = Field(..., ge=0, description="Resolved complaints")
    closed_complaints: int = Field(..., ge=0, description="Closed complaints")

    # Detailed metrics
    resolution_metrics: ResolutionMetrics = Field(
        ...,
        description="Resolution performance metrics",
    )

    category_analysis: CategoryAnalysis = Field(
        ...,
        description="Category-wise breakdown",
    )

    priority_distribution: Dict[str, int] = Field(
        default_factory=dict,
        description="Distribution by priority level",
    )

    complaint_trend: List[ComplaintTrendPoint] = Field(
        default_factory=list,
        description="Time-series trend data",
    )

    # SLA metrics
    sla_compliance_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="SLA compliance percentage"
        )
    ]
    sla_breached_count: int = Field(
        ...,
        ge=0,
        description="SLA breached complaint count",
    )

    # Staff performance
    top_resolvers: List[StaffPerformance] = Field(
        default_factory=list,
        max_length=10,
        description="Top 10 complaint resolvers",
    )

    @model_validator(mode="after")
    def validate_period_range(self):
        """Validate analytics period is logical."""
        if self.period_end < self.period_start:
            raise ValueError("period_end must be >= period_start")
        return self

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\complaint_assignment.py ---
"""
Complaint assignment and reassignment schemas.

Handles complaint assignment to staff members, reassignments,
bulk operations, and unassignment flows.
"""

from datetime import datetime, timezone
from typing import List, Union

from pydantic import ConfigDict, Field, field_validator, model_validator

from app.schemas.common.base import BaseCreateSchema, BaseSchema

__all__ = [
    "AssignmentRequest",
    "AssignmentResponse",
    "ReassignmentRequest",
    "BulkAssignment",
    "UnassignRequest",
    "AssignmentHistory",
]


class AssignmentRequest(BaseCreateSchema):
    """
    Request to assign complaint to a staff member.
    
    Supports optional estimated resolution time and notes
    for assignment context.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier to assign",
    )
    assigned_to: str = Field(
        ...,
        description="User ID of assignee (supervisor/staff)",
    )

    estimated_resolution_time: Union[datetime, None] = Field(
        default=None,
        description="Estimated resolution timestamp",
    )

    assignment_notes: Union[str, None] = Field(
        default=None,
        max_length=500,
        description="Assignment context or instructions",
    )

    @field_validator("assignment_notes")
    @classmethod
    def validate_notes(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize assignment notes."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v

    @field_validator("estimated_resolution_time")
    @classmethod
    def validate_estimated_time(cls, v: Union[datetime, None]) -> Union[datetime, None]:
        """Ensure estimated resolution time is in the future."""
        if v is not None:
            now = datetime.now(timezone.utc)
            # Handle timezone-naive datetime
            if v.tzinfo is None:
                v = v.replace(tzinfo=timezone.utc)
            if v <= now:
                raise ValueError(
                    "Estimated resolution time must be in the future"
                )
        return v


class AssignmentResponse(BaseSchema):
    """
    Response after successful complaint assignment.
    
    Provides confirmation details and assignment metadata.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(..., description="Assigned complaint ID")
    complaint_number: str = Field(..., description="Complaint reference number")

    assigned_to: str = Field(..., description="Assignee user ID")
    assigned_to_name: str = Field(..., description="Assignee name")
    assigned_by: str = Field(..., description="User who performed assignment")
    assigned_by_name: str = Field(..., description="Assigner name")

    assigned_at: datetime = Field(..., description="Assignment timestamp")

    message: str = Field(
        ...,
        description="Confirmation message",
        examples=["Complaint assigned successfully"],
    )


class ReassignmentRequest(BaseCreateSchema):
    """
    Request to reassign complaint to different staff member.
    
    Requires reason for reassignment to maintain audit trail.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier to reassign",
    )
    new_assigned_to: str = Field(
        ...,
        description="New assignee user ID",
    )

    reassignment_reason: str = Field(
        ...,
        min_length=10,
        max_length=500,
        description="Reason for reassignment (mandatory)",
    )

    notify_previous_assignee: bool = Field(
        default=True,
        description="Send notification to previous assignee",
    )

    @field_validator("reassignment_reason")
    @classmethod
    def validate_reason(cls, v: str) -> str:
        """Validate reassignment reason."""
        v = v.strip()
        if not v:
            raise ValueError("Reassignment reason cannot be empty")
        
        word_count = len(v.split())
        if word_count < 3:
            raise ValueError(
                "Reassignment reason must be at least 3 words"
            )
        
        return v


class BulkAssignment(BaseCreateSchema):
    """
    Bulk assignment of multiple complaints to one assignee.
    
    Useful for distributing workload efficiently.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_ids: List[str] = Field(
        ...,
        min_length=1,
        max_length=50,
        description="List of complaint IDs to assign (max 50)",
    )
    assigned_to: str = Field(
        ...,
        description="User ID of assignee for all complaints",
    )

    assignment_notes: Union[str, None] = Field(
        default=None,
        max_length=500,
        description="Common assignment notes",
    )

    @field_validator("complaint_ids")
    @classmethod
    def validate_complaint_ids_unique(cls, v: List[str]) -> List[str]:
        """Ensure complaint IDs are unique."""
        if len(v) != len(set(v)):
            raise ValueError("Complaint IDs must be unique")
        
        if len(v) > 50:
            raise ValueError("Cannot assign more than 50 complaints at once")
        
        return v

    @field_validator("assignment_notes")
    @classmethod
    def validate_notes(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize assignment notes."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v


class UnassignRequest(BaseCreateSchema):
    """
    Request to unassign complaint from current assignee.
    
    Requires reason for accountability.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier to unassign",
    )
    reason: str = Field(
        ...,
        min_length=10,
        max_length=500,
        description="Reason for unassignment",
    )

    @field_validator("reason")
    @classmethod
    def validate_reason(cls, v: str) -> str:
        """Validate unassignment reason."""
        v = v.strip()
        if not v:
            raise ValueError("Unassignment reason cannot be empty")
        
        word_count = len(v.split())
        if word_count < 3:
            raise ValueError(
                "Unassignment reason must be at least 3 words"
            )
        
        return v


class AssignmentHistory(BaseSchema):
    """
    Assignment history entry for audit trail.
    
    Tracks all assignment changes for a complaint.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(..., description="Complaint ID")
    
    assigned_to: str = Field(..., description="Assignee user ID")
    assigned_to_name: str = Field(..., description="Assignee name")
    
    assigned_by: str = Field(..., description="Assigner user ID")
    assigned_by_name: str = Field(..., description="Assigner name")
    
    assigned_at: datetime = Field(..., description="Assignment timestamp")
    unassigned_at: Union[datetime, None] = Field(
        default=None,
        description="Unassignment timestamp",
    )
    
    reason: Union[str, None] = Field(
        default=None,
        description="Assignment/reassignment reason",
    )
    
    duration_hours: Union[int, None] = Field(
        default=None,
        ge=0,
        description="Duration assigned (hours)",
    )

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\complaint_base.py ---
"""
Core complaint schemas with enhanced validation and type safety.

This module provides base schemas for complaint creation, updates, and status management
with comprehensive field validation and business rule enforcement.
"""

from typing import List, Union

from pydantic import ConfigDict, Field, HttpUrl, field_validator, model_validator

from app.schemas.common.base import BaseCreateSchema, BaseSchema, BaseUpdateSchema
from app.schemas.common.enums import ComplaintCategory, ComplaintStatus, Priority

__all__ = [
    "ComplaintBase",
    "ComplaintCreate",
    "ComplaintUpdate",
    "ComplaintStatusUpdate",
]


class ComplaintBase(BaseSchema):
    """
    Base complaint schema with core fields and validation.
    
    This schema defines the fundamental structure of a complaint including
    identification, categorization, priority, and location details.
    """
    model_config = ConfigDict(from_attributes=True)

    hostel_id: str = Field(
        ...,
        description="Hostel identifier where complaint originated",
    )
    raised_by: str = Field(
        ...,
        description="User ID who raised the complaint",
    )
    student_id: Union[str, None] = Field(
        default=None,
        description="Student ID if complaint raised by a student",
    )

    # Complaint content
    title: str = Field(
        ...,
        min_length=5,
        max_length=255,
        description="Brief complaint title/summary",
    )
    description: str = Field(
        ...,
        min_length=20,
        max_length=2000,
        description="Detailed complaint description",
    )

    # Classification
    category: ComplaintCategory = Field(
        ...,
        description="Primary complaint category",
    )
    sub_category: Union[str, None] = Field(
        default=None,
        max_length=100,
        description="Optional sub-category for finer classification",
    )

    # Priority
    priority: Priority = Field(
        default=Priority.MEDIUM,
        description="Complaint priority level (defaults to medium)",
    )

    # Location details
    room_id: Union[str, None] = Field(
        default=None,
        description="Room identifier if complaint is room-specific",
    )
    location_details: Union[str, None] = Field(
        default=None,
        max_length=500,
        description="Detailed location information within hostel",
    )

    # Attachments
    attachments: List[HttpUrl] = Field(
        default_factory=list,
        max_length=10,
        description="URLs of supporting documents/photos (max 10)",
    )

    @field_validator("title")
    @classmethod
    def validate_title(cls, v: str) -> str:
        """
        Validate and normalize complaint title.
        
        Ensures title is meaningful and properly formatted.
        """
        v = v.strip()
        if not v:
            raise ValueError("Title cannot be empty or whitespace only")
        if v.isdigit():
            raise ValueError("Title cannot consist of only numbers")
        return v

    @field_validator("description")
    @classmethod
    def validate_description(cls, v: str) -> str:
        """
        Validate and normalize complaint description.
        
        Ensures description provides sufficient detail.
        """
        v = v.strip()
        if not v:
            raise ValueError("Description cannot be empty or whitespace only")
        
        # Check for minimum word count (at least 5 words)
        word_count = len(v.split())
        if word_count < 5:
            raise ValueError(
                "Description must contain at least 5 words for clarity"
            )
        
        return v

    @field_validator("sub_category")
    @classmethod
    def validate_sub_category(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize sub-category if provided."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v

    @field_validator("location_details")
    @classmethod
    def validate_location_details(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize location details if provided."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v

    @field_validator("attachments")
    @classmethod
    def validate_attachments_limit(cls, v: List[HttpUrl]) -> List[HttpUrl]:
        """Ensure attachment count doesn't exceed limit."""
        if len(v) > 10:
            raise ValueError("Maximum 10 attachments allowed per complaint")
        return v

    @model_validator(mode="after")
    def validate_location_consistency(self):
        """
        Validate location-related fields are consistent.
        
        If room_id is provided, location_details should also be provided
        for better context.
        """
        if self.room_id and not self.location_details:
            # This is a soft validation - log warning but don't fail
            pass
        
        return self


class ComplaintCreate(ComplaintBase, BaseCreateSchema):
    """
    Schema for creating a new complaint.
    
    Inherits all validation from ComplaintBase and adds any
    create-specific validation if needed.
    """
    model_config = ConfigDict(from_attributes=True)

    @model_validator(mode="after")
    def validate_create_specific_rules(self):
        """
        Enforce creation-specific business rules.
        
        Additional validation that only applies during complaint creation.
        """
        # Ensure high/urgent priority complaints have location details
        if self.priority in [Priority.HIGH, Priority.URGENT, Priority.CRITICAL]:
            if not self.location_details and not self.room_id:
                raise ValueError(
                    f"High priority complaints ({self.priority.value}) "
                    "must include location details or room ID"
                )
        
        return self


class ComplaintUpdate(BaseUpdateSchema):
    """
    Schema for updating existing complaint.
    
    All fields are optional to support partial updates.
    Includes validation to ensure meaningful updates.
    """
    model_config = ConfigDict(from_attributes=True)

    title: Union[str, None] = Field(
        default=None,
        min_length=5,
        max_length=255,
        description="Updated complaint title",
    )
    description: Union[str, None] = Field(
        default=None,
        min_length=20,
        max_length=2000,
        description="Updated complaint description",
    )
    category: Union[ComplaintCategory, None] = Field(
        default=None,
        description="Updated complaint category",
    )
    sub_category: Union[str, None] = Field(
        default=None,
        max_length=100,
        description="Updated sub-category",
    )
    priority: Union[Priority, None] = Field(
        default=None,
        description="Updated priority level",
    )
    location_details: Union[str, None] = Field(
        default=None,
        max_length=500,
        description="Updated location details",
    )
    attachments: Union[List[HttpUrl], None] = Field(
        default=None,
        max_length=10,
        description="Updated attachments list",
    )
    status: Union[ComplaintStatus, None] = Field(
        default=None,
        description="Updated complaint status",
    )

    @field_validator("title")
    @classmethod
    def validate_title(cls, v: Union[str, None]) -> Union[str, None]:
        """Validate title if provided."""
        if v is not None:
            v = v.strip()
            if not v:
                raise ValueError("Title cannot be empty or whitespace only")
            if v.isdigit():
                raise ValueError("Title cannot consist of only numbers")
        return v

    @field_validator("description")
    @classmethod
    def validate_description(cls, v: Union[str, None]) -> Union[str, None]:
        """Validate description if provided."""
        if v is not None:
            v = v.strip()
            if not v:
                raise ValueError("Description cannot be empty or whitespace only")
            
            word_count = len(v.split())
            if word_count < 5:
                raise ValueError(
                    "Description must contain at least 5 words for clarity"
                )
        return v

    @field_validator("attachments")
    @classmethod
    def validate_attachments_limit(cls, v: Union[List[HttpUrl], None]) -> Union[List[HttpUrl], None]:
        """Ensure attachment count doesn't exceed limit."""
        if v is not None and len(v) > 10:
            raise ValueError("Maximum 10 attachments allowed per complaint")
        return v

    @model_validator(mode="after")
    def validate_has_updates(self):
        """
        Ensure at least one field is being updated.
        
        Prevents empty update requests.
        """
        update_fields = {
            k: v for k, v in self.model_dump(exclude_unset=True).items()
            if v is not None
        }
        
        if not update_fields:
            raise ValueError("At least one field must be provided for update")
        
        return self


class ComplaintStatusUpdate(BaseUpdateSchema):
    """
    Dedicated schema for complaint status updates.
    
    Provides focused status change functionality with
    mandatory change notes for audit trail.
    """
    model_config = ConfigDict(from_attributes=True)

    status: ComplaintStatus = Field(
        ...,
        description="New complaint status",
    )
    notes: Union[str, None] = Field(
        default=None,
        max_length=500,
        description="Reason or notes for status change",
    )

    @field_validator("notes")
    @classmethod
    def validate_notes(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize status change notes."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v

    @model_validator(mode="after")
    def validate_status_change_requirements(self):
        """
        Enforce business rules for status changes.
        
        Certain status transitions require mandatory notes.
        """
        # Statuses that require explanatory notes
        statuses_requiring_notes = {
            ComplaintStatus.REJECTED,
            ComplaintStatus.ON_HOLD,
            ComplaintStatus.CLOSED,
            ComplaintStatus.REOPENED,
        }
        
        if self.status in statuses_requiring_notes and not self.notes:
            raise ValueError(
                f"Status change to '{self.status.value}' requires explanatory notes"
            )
        
        return self

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\complaint_comments.py ---
"""
Complaint discussion and comments schemas.

Handles internal notes and public comments on complaints
with support for attachments and mentions.
"""

from datetime import datetime
from typing import List, Union

from pydantic import ConfigDict, Field, HttpUrl, field_validator

from app.schemas.common.base import BaseCreateSchema, BaseResponseSchema, BaseSchema

__all__ = [
    "CommentCreate",
    "CommentResponse",
    "CommentList",
    "CommentUpdate",
    "CommentDelete",
    "MentionNotification",
]


class CommentCreate(BaseCreateSchema):
    """
    Create comment on complaint.
    
    Supports both public comments and internal notes
    with optional attachments.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier to comment on",
    )

    comment_text: str = Field(
        ...,
        min_length=5,
        max_length=1000,
        description="Comment text content",
    )

    is_internal: bool = Field(
        default=False,
        description="Internal note (staff only) vs public comment",
    )

    attachments: List[HttpUrl] = Field(
        default_factory=list,
        max_length=5,
        description="Comment attachments (max 5)",
    )

    @field_validator("comment_text")
    @classmethod
    def validate_comment_text(cls, v: str) -> str:
        """Validate comment text quality."""
        v = v.strip()
        if not v:
            raise ValueError("Comment text cannot be empty")
        
        # Ensure meaningful content
        if len(v) < 5:
            raise ValueError("Comment must be at least 5 characters")
        
        return v

    @field_validator("attachments")
    @classmethod
    def validate_attachments_limit(cls, v: List[HttpUrl]) -> List[HttpUrl]:
        """Ensure attachment count doesn't exceed limit."""
        if len(v) > 5:
            raise ValueError("Maximum 5 attachments allowed per comment")
        return v


class CommentResponse(BaseResponseSchema):
    """
    Comment response with author information.
    
    Includes metadata about comment author and timing.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(..., description="Associated complaint ID")

    commented_by: str = Field(..., description="Commenter user ID")
    commented_by_name: str = Field(..., description="Commenter name")
    commented_by_role: str = Field(..., description="Commenter role")

    comment_text: str = Field(..., description="Comment content")
    is_internal: bool = Field(..., description="Internal note flag")

    attachments: List[str] = Field(
        default_factory=list,
        description="Attachment URLs",
    )

    created_at: datetime = Field(..., description="Creation timestamp")
    updated_at: datetime = Field(..., description="Last update timestamp")

    is_edited: bool = Field(
        default=False,
        description="Whether comment was edited",
    )


class CommentList(BaseSchema):
    """
    List of comments for a complaint.
    
    Provides summary statistics and comment thread.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(..., description="Complaint ID")
    complaint_number: str = Field(..., description="Complaint reference number")

    total_comments: int = Field(..., ge=0, description="Total comment count")
    public_comments: int = Field(..., ge=0, description="Public comment count")
    internal_notes: int = Field(..., ge=0, description="Internal note count")

    comments: List[CommentResponse] = Field(
        default_factory=list,
        description="List of comments (sorted by creation time)",
    )


class CommentUpdate(BaseCreateSchema):
    """
    Update existing comment.
    
    Allows modification of comment text only.
    """
    model_config = ConfigDict(from_attributes=True)

    comment_id: str = Field(
        ...,
        description="Comment identifier to update",
    )
    comment_text: str = Field(
        ...,
        min_length=5,
        max_length=1000,
        description="Updated comment text",
    )

    @field_validator("comment_text")
    @classmethod
    def validate_comment_text(cls, v: str) -> str:
        """Validate comment text quality."""
        v = v.strip()
        if not v:
            raise ValueError("Comment text cannot be empty")
        
        if len(v) < 5:
            raise ValueError("Comment must be at least 5 characters")
        
        return v


class CommentDelete(BaseCreateSchema):
    """
    Delete comment request.
    
    Optional reason for deletion audit trail.
    """
    model_config = ConfigDict(from_attributes=True)

    comment_id: str = Field(
        ...,
        description="Comment identifier to delete",
    )
    reason: Union[str, None] = Field(
        default=None,
        max_length=200,
        description="Deletion reason (optional)",
    )

    @field_validator("reason")
    @classmethod
    def validate_reason(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize deletion reason if provided."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v


class MentionNotification(BaseSchema):
    """
    Notification when user is mentioned in comment.
    
    Supports @mention functionality in comments.
    """
    model_config = ConfigDict(from_attributes=True)

    comment_id: str = Field(..., description="Comment ID with mention")
    complaint_id: str = Field(..., description="Associated complaint ID")
    complaint_number: str = Field(..., description="Complaint reference number")

    mentioned_by: str = Field(..., description="User who mentioned")
    mentioned_by_name: str = Field(..., description="Mentioner name")

    comment_excerpt: str = Field(
        ...,
        max_length=200,
        description="Comment excerpt (first 200 chars)",
    )

    comment_url: str = Field(
        ...,
        description="Direct URL to comment",
    )

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\complaint_escalation.py ---
"""
Complaint escalation schemas with comprehensive tracking.

Handles complaint escalation workflow, auto-escalation rules,
and escalation history management.
"""

from datetime import datetime
from typing import List, Union

from pydantic import ConfigDict, Field, field_validator, model_validator

from app.schemas.common.base import BaseCreateSchema, BaseResponseSchema, BaseSchema

__all__ = [
    "EscalationRequest",
    "EscalationResponse",
    "EscalationHistory",
    "EscalationEntry",
    "AutoEscalationRule",
]


class EscalationRequest(BaseCreateSchema):
    """
    Request to escalate complaint to higher authority.
    
    Requires detailed reason and supports priority increase
    and urgency flags.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier to escalate",
    )
    escalate_to: str = Field(
        ...,
        description="User ID to escalate to (admin/supervisor)",
    )

    escalation_reason: str = Field(
        ...,
        min_length=20,
        max_length=500,
        description="Detailed escalation reason",
    )

    increase_priority: bool = Field(
        default=True,
        description="Automatically increase priority level",
    )

    is_urgent: bool = Field(
        default=False,
        description="Mark as urgent escalation",
    )

    @field_validator("escalation_reason")
    @classmethod
    def validate_escalation_reason(cls, v: str) -> str:
        """Validate escalation reason quality."""
        v = v.strip()
        if not v:
            raise ValueError("Escalation reason cannot be empty")
        
        word_count = len(v.split())
        if word_count < 5:
            raise ValueError(
                "Escalation reason must contain at least 5 words "
                "for proper documentation"
            )
        
        return v


class EscalationResponse(BaseSchema):
    """
    Response after successful escalation.
    
    Provides confirmation and updated complaint details.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(..., description="Escalated complaint ID")
    complaint_number: str = Field(..., description="Complaint reference number")

    escalated: bool = Field(..., description="Escalation confirmation flag")
    escalated_to: str = Field(..., description="Escalated to user ID")
    escalated_to_name: str = Field(..., description="Escalated to name")
    escalated_by: str = Field(..., description="Escalator user ID")
    escalated_by_name: str = Field(..., description="Escalator name")
    escalated_at: datetime = Field(..., description="Escalation timestamp")

    new_priority: str = Field(
        ...,
        description="Updated priority level after escalation",
    )

    message: str = Field(
        ...,
        description="Confirmation message",
        examples=["Complaint escalated successfully"],
    )


class EscalationEntry(BaseResponseSchema):
    """
    Individual escalation entry in history.
    
    Tracks single escalation event with complete metadata.
    """
    model_config = ConfigDict(from_attributes=True)

    escalated_to: str = Field(..., description="Escalated to user ID")
    escalated_to_name: str = Field(..., description="Escalated to name")
    escalated_by: str = Field(..., description="Escalator user ID")
    escalated_by_name: str = Field(..., description="Escalator name")
    escalated_at: datetime = Field(..., description="Escalation timestamp")

    reason: str = Field(..., description="Escalation reason")

    # State before/after
    status_before: str = Field(..., description="Status before escalation")
    priority_before: str = Field(..., description="Priority before escalation")
    priority_after: str = Field(..., description="Priority after escalation")

    # Response tracking
    response_time_hours: Union[int, None] = Field(
        default=None,
        ge=0,
        description="Time taken to respond (hours)",
    )
    resolved_after_escalation: bool = Field(
        ...,
        description="Whether resolved after this escalation",
    )


class EscalationHistory(BaseSchema):
    """
    Complete escalation history for a complaint.
    
    Provides audit trail of all escalations.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(..., description="Complaint ID")
    complaint_number: str = Field(..., description="Complaint reference number")

    escalations: List[EscalationEntry] = Field(
        default_factory=list,
        description="List of escalation entries",
    )
    total_escalations: int = Field(
        ...,
        ge=0,
        description="Total escalation count",
    )


class AutoEscalationRule(BaseSchema):
    """
    Auto-escalation rule configuration.
    
    Defines automatic escalation triggers based on time
    and SLA conditions.
    """
    model_config = ConfigDict(from_attributes=True)

    hostel_id: str = Field(
        ...,
        description="Hostel identifier for rule scope",
    )

    # Trigger conditions
    escalate_after_hours: int = Field(
        default=24,
        ge=1,
        le=168,  # Max 1 week
        description="Hours before auto-escalation (default 24)",
    )
    escalate_on_sla_breach: bool = Field(
        default=True,
        description="Auto-escalate on SLA breach",
    )

    # Priority-specific rules
    urgent_escalation_hours: int = Field(
        default=4,
        ge=1,
        le=24,
        description="Escalation threshold for urgent complaints (hours)",
    )
    high_escalation_hours: int = Field(
        default=12,
        ge=1,
        le=48,
        description="Escalation threshold for high priority (hours)",
    )
    medium_escalation_hours: int = Field(
        default=24,
        ge=1,
        le=72,
        description="Escalation threshold for medium priority (hours)",
    )

    # Escalation chain
    first_escalation_to: str = Field(
        ...,
        description="First level escalation target user ID",
    )
    second_escalation_to: Union[str, None] = Field(
        default=None,
        description="Second level escalation target (if first unresolved)",
    )

    is_active: bool = Field(
        default=True,
        description="Rule active status",
    )

    @model_validator(mode="after")
    def validate_escalation_thresholds(self):
        """
        Validate escalation time thresholds are logical.
        
        Ensures urgent < high < medium.
        """
        if not (
            self.urgent_escalation_hours
            < self.high_escalation_hours
            < self.medium_escalation_hours
        ):
            raise ValueError(
                "Escalation thresholds must follow: "
                "urgent < high < medium"
            )
        
        return self

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\complaint_feedback.py ---
"""
Complaint feedback and satisfaction schemas.

Handles student feedback collection, ratings, and
feedback analytics for service improvement.
"""

from datetime import datetime
from datetime import date as Date
from decimal import Decimal
from typing import Annotated, Dict, List, Union

from pydantic import ConfigDict, Field, field_validator

from app.schemas.common.base import BaseCreateSchema, BaseResponseSchema, BaseSchema

__all__ = [
    "FeedbackRequest",
    "FeedbackResponse",
    "FeedbackSummary",
    "FeedbackAnalysis",
    "RatingTrendPoint",
]


class FeedbackRequest(BaseCreateSchema):
    """
    Submit feedback on resolved complaint.
    
    Collects rating, detailed feedback, and satisfaction metrics.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier to provide feedback for",
    )

    rating: int = Field(
        ...,
        ge=1,
        le=5,
        description="Overall rating (1-5 stars)",
    )

    feedback: Union[str, None] = Field(
        default=None,
        max_length=1000,
        description="Detailed feedback comments",
    )

    # Satisfaction questions
    issue_resolved_satisfactorily: bool = Field(
        ...,
        description="Was the issue resolved to your satisfaction?",
    )
    response_time_satisfactory: bool = Field(
        ...,
        description="Was the response time acceptable?",
    )
    staff_helpful: bool = Field(
        ...,
        description="Was the staff helpful and professional?",
    )

    would_recommend: Union[bool, None] = Field(
        default=None,
        description="Would you recommend this complaint system?",
    )

    @field_validator("feedback")
    @classmethod
    def validate_feedback(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize feedback text if provided."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v

    @field_validator("rating")
    @classmethod
    def validate_rating_for_poor_scores(cls, v: int) -> int:
        """
        Encourage feedback text for low ratings.
        
        Note: This is advisory validation, not enforced.
        """
        # Could log warning if rating <= 2 and no feedback
        # but not enforcing to avoid friction
        return v


class FeedbackResponse(BaseResponseSchema):
    """
    Feedback submission response.
    
    Confirms feedback receipt and provides summary.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(..., description="Complaint ID")
    complaint_number: str = Field(..., description="Complaint reference number")

    rating: int = Field(..., description="Submitted rating")
    feedback: Union[str, None] = Field(default=None, description="Submitted feedback")

    submitted_by: str = Field(..., description="Feedback submitter user ID")
    submitted_at: datetime = Field(..., description="Submission timestamp")

    message: str = Field(
        ...,
        description="Confirmation message",
        examples=["Thank you for your feedback!"],
    )


class FeedbackSummary(BaseSchema):
    """
    Feedback summary for hostel or supervisor.
    
    Provides aggregate feedback metrics and insights.
    """
    model_config = ConfigDict(from_attributes=True)

    entity_id: str = Field(
        ...,
        description="Entity identifier (hostel or supervisor)",
    )
    entity_type: str = Field(
        ...,
        pattern=r"^(hostel|supervisor)$",
        description="Entity type: hostel or supervisor",
    )

    # Time period
    period_start: Date = Field(..., description="Summary period start Date")
    period_end: Date = Field(..., description="Summary period end Date")

    # Overall statistics
    total_feedbacks: int = Field(..., ge=0, description="Total feedback count")
    average_rating: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("5"),
            description="Average rating (0-5)"
        )
    ]

    # Rating distribution
    rating_5_count: int = Field(..., ge=0, description="5-star rating count")
    rating_4_count: int = Field(..., ge=0, description="4-star rating count")
    rating_3_count: int = Field(..., ge=0, description="3-star rating count")
    rating_2_count: int = Field(..., ge=0, description="2-star rating count")
    rating_1_count: int = Field(..., ge=0, description="1-star rating count")

    # Satisfaction metrics (percentages)
    resolution_satisfaction_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="% satisfied with issue resolution"
        )
    ]
    response_time_satisfaction_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="% satisfied with response time"
        )
    ]
    staff_helpfulness_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="% who found staff helpful"
        )
    ]

    # Recommendation
    recommendation_rate: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="% who would recommend the system"
        )
    ]

    # Sentiment analysis
    positive_feedback_count: int = Field(
        ...,
        ge=0,
        description="Positive feedback count",
    )
    negative_feedback_count: int = Field(
        ...,
        ge=0,
        description="Negative feedback count",
    )
    common_themes: List[str] = Field(
        default_factory=list,
        description="Common themes from feedback analysis",
    )


class RatingTrendPoint(BaseSchema):
    """
    Data point for rating trend analysis.
    
    Represents rating metrics for a specific time period.
    """
    model_config = ConfigDict(from_attributes=True)

    period: str = Field(
        ...,
        description="Time period (Date, week, or month)",
        examples=["2024-01", "Week 1", "2024-01-15"],
    )
    average_rating: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("5"),
            description="Average rating for period"
        )
    ]
    feedback_count: int = Field(
        ...,
        ge=0,
        description="Number of feedbacks in period",
    )


class FeedbackAnalysis(BaseSchema):
    """
    Detailed feedback analysis with trends.
    
    Provides deep insights into feedback patterns.
    """
    model_config = ConfigDict(from_attributes=True)

    hostel_id: str = Field(..., description="Hostel identifier")
    period_start: Date = Field(..., description="Analysis period start")
    period_end: Date = Field(..., description="Analysis period end")

    # Trend data
    rating_trend: List[RatingTrendPoint] = Field(
        default_factory=list,
        description="Rating trend over time",
    )

    # Category analysis
    feedback_by_category: Dict[str, Decimal] = Field(
        default_factory=dict,
        description="Average rating by complaint category",
    )

    # Priority analysis
    feedback_by_priority: Dict[str, Decimal] = Field(
        default_factory=dict,
        description="Average rating by priority level",
    )

    # Response time impact
    avg_rating_quick_response: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("5"),
            description="Average rating for quick responses"
        )
    ]
    avg_rating_slow_response: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("5"),
            description="Average rating for slow responses"
        )
    ]

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\complaint_filters.py ---
"""
Complaint filtering and search schemas.

Provides comprehensive filtering, searching, and sorting
capabilities for complaint queries.
"""
from datetime import date as Date
from typing import List, Union

from pydantic import ConfigDict, Field, field_validator, model_validator

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import ComplaintCategory, ComplaintStatus, Priority

__all__ = [
    "ComplaintFilterParams",
    "ComplaintSearchRequest",
    "ComplaintSortOptions",
    "ComplaintExportRequest",
]


class ComplaintFilterParams(BaseFilterSchema):
    """
    Comprehensive complaint filter parameters.
    
    Supports filtering by multiple dimensions for flexible queries.
    """
    model_config = ConfigDict(from_attributes=True)

    # Text search
    search: Union[str, None] = Field(
        default=None,
        min_length=1,
        max_length=255,
        description="Search in title, description, complaint number",
    )

    # Hostel filters
    hostel_id: Union[str, None] = Field(
        default=None,
        description="Filter by single hostel",
    )
    hostel_ids: Union[List[str], None] = Field(
        default=None,
        max_length=50,
        description="Filter by multiple hostels (max 50)",
    )

    # User filters
    raised_by: Union[str, None] = Field(
        default=None,
        description="Filter by complainant user ID",
    )
    student_id: Union[str, None] = Field(
        default=None,
        description="Filter by student ID",
    )

    # Assignment filters
    assigned_to: Union[str, None] = Field(
        default=None,
        description="Filter by assigned staff member",
    )
    unassigned_only: Union[bool, None] = Field(
        default=None,
        description="Show only unassigned complaints",
    )

    # Category filters
    category: Union[ComplaintCategory, None] = Field(
        default=None,
        description="Filter by single category",
    )
    categories: Union[List[ComplaintCategory], None] = Field(
        default=None,
        max_length=20,
        description="Filter by multiple categories",
    )

    # Priority filters
    priority: Union[Priority, None] = Field(
        default=None,
        description="Filter by single priority",
    )
    priorities: Union[List[Priority], None] = Field(
        default=None,
        max_length=10,
        description="Filter by multiple priorities",
    )

    # Status filters
    status: Union[ComplaintStatus, None] = Field(
        default=None,
        description="Filter by single status",
    )
    statuses: Union[List[ComplaintStatus], None] = Field(
        default=None,
        max_length=10,
        description="Filter by multiple statuses",
    )

    # Date range filters
    opened_date_from: Union[Date, None] = Field(
        default=None,
        description="Opened Date range start (inclusive)",
    )
    opened_date_to: Union[Date, None] = Field(
        default=None,
        description="Opened Date range end (inclusive)",
    )
    resolved_date_from: Union[Date, None] = Field(
        default=None,
        description="Resolved Date range start",
    )
    resolved_date_to: Union[Date, None] = Field(
        default=None,
        description="Resolved Date range end",
    )

    # Special filters
    sla_breached_only: Union[bool, None] = Field(
        default=None,
        description="Show only SLA breached complaints",
    )
    escalated_only: Union[bool, None] = Field(
        default=None,
        description="Show only escalated complaints",
    )

    # Location filters
    room_id: Union[str, None] = Field(
        default=None,
        description="Filter by specific room",
    )

    # Age filters
    age_hours_min: Union[int, None] = Field(
        default=None,
        ge=0,
        description="Minimum complaint age in hours",
    )
    age_hours_max: Union[int, None] = Field(
        default=None,
        ge=0,
        description="Maximum complaint age in hours",
    )

    @field_validator("search")
    @classmethod
    def validate_search(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize search query."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v

    @field_validator("hostel_ids", "categories", "priorities", "statuses")
    @classmethod
    def validate_list_length(cls, v: Union[List, None]) -> Union[List, None]:
        """Ensure filter lists don't exceed reasonable limits."""
        if v is not None and len(v) > 50:
            raise ValueError("Too many items in filter list (max 50)")
        return v

    @model_validator(mode="after")
    def validate_date_and_age_ranges(self):
        """Validate Date and age ranges are logical."""
        # Validate opened Date range
        if self.opened_date_to is not None and self.opened_date_from is not None:
            if self.opened_date_to < self.opened_date_from:
                raise ValueError("opened_date_to must be >= opened_date_from")
        
        # Validate resolved Date range
        if self.resolved_date_to is not None and self.resolved_date_from is not None:
            if self.resolved_date_to < self.resolved_date_from:
                raise ValueError("resolved_date_to must be >= resolved_date_from")
        
        # Validate age range
        if self.age_hours_max is not None and self.age_hours_min is not None:
            if self.age_hours_max < self.age_hours_min:
                raise ValueError("age_hours_max must be >= age_hours_min")
        
        return self


class ComplaintSearchRequest(BaseFilterSchema):
    """
    Full-text search request for complaints.
    
    Supports configurable search fields and filters.
    """
    model_config = ConfigDict(from_attributes=True)

    query: str = Field(
        ...,
        min_length=1,
        max_length=500,
        description="Search query string",
    )
    hostel_id: Union[str, None] = Field(
        default=None,
        description="Limit search to specific hostel",
    )

    # Search scope configuration
    search_in_title: bool = Field(
        default=True,
        description="Include title in search",
    )
    search_in_description: bool = Field(
        default=True,
        description="Include description in search",
    )
    search_in_number: bool = Field(
        default=True,
        description="Include complaint number in search",
    )

    # Optional filters
    status: Union[ComplaintStatus, None] = Field(
        default=None,
        description="Filter by status",
    )
    priority: Union[Priority, None] = Field(
        default=None,
        description="Filter by priority",
    )

    # Pagination
    page: int = Field(
        default=1,
        ge=1,
        description="Page number",
    )
    page_size: int = Field(
        default=20,
        ge=1,
        le=100,
        description="Results per page (1-100)",
    )

    @field_validator("query")
    @classmethod
    def validate_query(cls, v: str) -> str:
        """Normalize search query."""
        v = v.strip()
        if not v:
            raise ValueError("Search query cannot be empty")
        return v


class ComplaintSortOptions(BaseFilterSchema):
    """
    Sorting options for complaint queries.
    
    Defines available sort fields and order.
    """
    model_config = ConfigDict(from_attributes=True)

    sort_by: str = Field(
        default="opened_at",
        pattern=r"^(opened_at|priority|status|category|age|updated_at|resolved_at)$",
        description="Field to sort by",
    )
    sort_order: str = Field(
        default="desc",
        pattern=r"^(asc|desc)$",
        description="Sort order: ascending or descending",
    )

    @field_validator("sort_by", "sort_order")
    @classmethod
    def normalize_sort_params(cls, v: str) -> str:
        """Normalize sort parameters to lowercase."""
        return v.lower().strip()


class ComplaintExportRequest(BaseFilterSchema):
    """
    Export complaints to various formats.
    
    Supports CSV, Excel, and PDF exports with configurable fields.
    """
    model_config = ConfigDict(from_attributes=True)

    hostel_id: Union[str, None] = Field(
        default=None,
        description="Limit export to specific hostel",
    )
    filters: Union[ComplaintFilterParams, None] = Field(
        default=None,
        description="Apply filters to export",
    )

    format: str = Field(
        default="csv",
        pattern=r"^(csv|excel|pdf)$",
        description="Export format: csv, excel, or pdf",
    )

    # Export options
    include_comments: bool = Field(
        default=False,
        description="Include comments in export",
    )
    include_resolution_details: bool = Field(
        default=True,
        description="Include resolution details",
    )
    include_feedback: bool = Field(
        default=True,
        description="Include student feedback",
    )

    @field_validator("format")
    @classmethod
    def normalize_format(cls, v: str) -> str:
        """Normalize export format to lowercase."""
        return v.lower().strip()

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\complaint_resolution.py ---
"""
Complaint resolution and closure schemas.

Handles complaint resolution workflow including marking as resolved,
reopening, and final closure with comprehensive validation.
"""

from datetime import datetime
from datetime import date as Date
from typing import List, Union

from pydantic import ConfigDict, Field, HttpUrl, field_validator, model_validator

from app.schemas.common.base import BaseCreateSchema, BaseSchema

__all__ = [
    "ResolutionRequest",
    "ResolutionResponse",
    "ResolutionUpdate",
    "ReopenRequest",
    "CloseRequest",
]


class ResolutionRequest(BaseCreateSchema):
    """
    Request to mark complaint as resolved.
    
    Requires detailed resolution notes and supports
    optional proof attachments and follow-up scheduling.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier to resolve",
    )

    resolution_notes: str = Field(
        ...,
        min_length=20,
        max_length=2000,
        description="Detailed resolution description",
    )

    resolution_attachments: List[HttpUrl] = Field(
        default_factory=list,
        max_length=10,
        description="Proof of resolution (photos/documents)",
    )

    actual_resolution_time: Union[datetime, None] = Field(
        default=None,
        description="Actual time resolution was completed",
    )

    # Follow-up tracking
    follow_up_required: bool = Field(
        default=False,
        description="Whether follow-up check is needed",
    )
    follow_up_date: Union[Date, None] = Field(
        default=None,
        description="Scheduled follow-up Date",
    )
    follow_up_notes: Union[str, None] = Field(
        default=None,
        max_length=500,
        description="Follow-up instructions",
    )

    @field_validator("resolution_notes")
    @classmethod
    def validate_resolution_notes(cls, v: str) -> str:
        """Validate resolution notes quality."""
        v = v.strip()
        if not v:
            raise ValueError("Resolution notes cannot be empty")
        
        word_count = len(v.split())
        if word_count < 10:
            raise ValueError(
                "Resolution notes must contain at least 10 words "
                "for proper documentation"
            )
        
        return v

    @field_validator("resolution_attachments")
    @classmethod
    def validate_attachments_limit(cls, v: List[HttpUrl]) -> List[HttpUrl]:
        """Ensure attachment count doesn't exceed limit."""
        if len(v) > 10:
            raise ValueError(
                "Maximum 10 resolution attachments allowed"
            )
        return v

    @field_validator("follow_up_date")
    @classmethod
    def validate_follow_up_date(cls, v: Union[Date, None]) -> Union[Date, None]:
        """Ensure follow-up Date is in the future."""
        if v is not None and v <= Date.today():
            raise ValueError(
                "Follow-up Date must be in the future"
            )
        return v

    @model_validator(mode="after")
    def validate_follow_up_consistency(self):
        """
        Validate follow-up fields are consistent.
        
        If follow_up_required is True, follow_up_date must be provided.
        """
        if self.follow_up_required and not self.follow_up_date:
            raise ValueError(
                "Follow-up Date is required when follow-up is marked as needed"
            )
        
        return self


class ResolutionResponse(BaseSchema):
    """
    Response after successful complaint resolution.
    
    Provides confirmation and resolution metrics.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(..., description="Resolved complaint ID")
    complaint_number: str = Field(..., description="Complaint reference number")

    resolved: bool = Field(..., description="Resolution confirmation flag")
    resolved_at: datetime = Field(..., description="Resolution timestamp")
    resolved_by: str = Field(..., description="Resolver user ID")
    resolved_by_name: str = Field(..., description="Resolver name")

    resolution_notes: str = Field(..., description="Resolution description")

    # Performance metrics
    time_to_resolve_hours: int = Field(
        ...,
        ge=0,
        description="Total resolution time in hours",
    )
    sla_met: bool = Field(
        ...,
        description="Whether SLA was met for this resolution",
    )

    message: str = Field(
        ...,
        description="Confirmation message",
        examples=["Complaint resolved successfully"],
    )


class ResolutionUpdate(BaseCreateSchema):
    """
    Update resolution details for already resolved complaint.
    
    Allows modification of resolution notes and attachments.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier",
    )

    resolution_notes: Union[str, None] = Field(
        default=None,
        min_length=20,
        max_length=2000,
        description="Updated resolution notes",
    )
    resolution_attachments: Union[List[HttpUrl], None] = Field(
        default=None,
        max_length=10,
        description="Updated resolution attachments",
    )
    follow_up_notes: Union[str, None] = Field(
        default=None,
        max_length=500,
        description="Updated follow-up notes",
    )

    @field_validator("resolution_notes")
    @classmethod
    def validate_resolution_notes(cls, v: Union[str, None]) -> Union[str, None]:
        """Validate resolution notes if provided."""
        if v is not None:
            v = v.strip()
            if not v:
                raise ValueError("Resolution notes cannot be empty")
            
            word_count = len(v.split())
            if word_count < 10:
                raise ValueError(
                    "Resolution notes must contain at least 10 words"
                )
        
        return v

    @field_validator("resolution_attachments")
    @classmethod
    def validate_attachments_limit(
        cls,
        v: Union[List[HttpUrl], None]
    ) -> Union[List[HttpUrl], None]:
        """Ensure attachment count doesn't exceed limit."""
        if v is not None and len(v) > 10:
            raise ValueError(
                "Maximum 10 resolution attachments allowed"
            )
        return v

    @model_validator(mode="after")
    def validate_has_updates(self):
        """Ensure at least one field is being updated."""
        update_fields = {
            k: v for k, v in self.model_dump(exclude_unset=True).items()
            if v is not None and k != "complaint_id"
        }
        
        if not update_fields:
            raise ValueError(
                "At least one field must be provided for update"
            )
        
        return self


class ReopenRequest(BaseCreateSchema):
    """
    Request to reopen a resolved/closed complaint.
    
    Requires detailed reason and supports additional information.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier to reopen",
    )

    reopen_reason: str = Field(
        ...,
        min_length=20,
        max_length=500,
        description="Detailed reason for reopening",
    )

    additional_issues: Union[str, None] = Field(
        default=None,
        max_length=1000,
        description="Additional issues discovered",
    )
    new_attachments: List[HttpUrl] = Field(
        default_factory=list,
        max_length=10,
        description="New supporting attachments",
    )

    @field_validator("reopen_reason")
    @classmethod
    def validate_reopen_reason(cls, v: str) -> str:
        """Validate reopen reason quality."""
        v = v.strip()
        if not v:
            raise ValueError("Reopen reason cannot be empty")
        
        word_count = len(v.split())
        if word_count < 5:
            raise ValueError(
                "Reopen reason must contain at least 5 words "
                "for proper documentation"
            )
        
        return v

    @field_validator("additional_issues")
    @classmethod
    def validate_additional_issues(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize additional issues if provided."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v

    @field_validator("new_attachments")
    @classmethod
    def validate_attachments_limit(cls, v: List[HttpUrl]) -> List[HttpUrl]:
        """Ensure attachment count doesn't exceed limit."""
        if len(v) > 10:
            raise ValueError(
                "Maximum 10 new attachments allowed"
            )
        return v


class CloseRequest(BaseCreateSchema):
    """
    Request to close complaint (final state).
    
    Optional closure notes and student confirmation.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_id: str = Field(
        ...,
        description="Complaint identifier to close",
    )

    closure_notes: Union[str, None] = Field(
        default=None,
        max_length=500,
        description="Final closure notes",
    )

    student_confirmed: bool = Field(
        default=False,
        description="Student confirmed resolution satisfaction",
    )

    @field_validator("closure_notes")
    @classmethod
    def validate_closure_notes(cls, v: Union[str, None]) -> Union[str, None]:
        """Normalize closure notes if provided."""
        if v is not None:
            v = v.strip()
            if not v:
                return None
        return v

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\complaint_response.py ---
"""
Complaint response schemas for API outputs.

Provides comprehensive response models for different complaint views:
- Summary responses for list views
- Detailed responses for single complaint views
- Dashboard summary statistics
"""

from datetime import datetime
from decimal import Decimal
from typing import Annotated, Dict, List, Union

from pydantic import ConfigDict, Field, computed_field

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import ComplaintCategory, ComplaintStatus, Priority

__all__ = [
    "ComplaintResponse",
    "ComplaintDetail",
    "ComplaintListItem",
    "ComplaintSummary",
    "ComplaintStats",
]


class ComplaintResponse(BaseResponseSchema):
    """
    Standard complaint response with essential fields.
    
    Used for list views and general complaint information.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_number: str = Field(
        ...,
        description="Unique complaint reference number",
    )
    hostel_id: str = Field(
        ...,
        description="Associated hostel identifier",
    )
    hostel_name: str = Field(
        ...,
        description="Associated hostel name for display",
    )

    # Complainant information
    raised_by: str = Field(
        ...,
        description="User ID who raised the complaint",
    )
    raised_by_name: str = Field(
        ...,
        description="Display name of complainant",
    )
    student_id: Union[str, None] = Field(
        default=None,
        description="Student ID if applicable",
    )

    # Core complaint fields
    title: str = Field(
        ...,
        description="Complaint title",
    )
    category: ComplaintCategory = Field(
        ...,
        description="Complaint category",
    )
    priority: Priority = Field(
        ...,
        description="Priority level",
    )
    status: ComplaintStatus = Field(
        ...,
        description="Current status",
    )

    # Assignment
    assigned_to: Union[str, None] = Field(
        default=None,
        description="Assigned staff member ID",
    )
    assigned_to_name: Union[str, None] = Field(
        default=None,
        description="Assigned staff member name",
    )

    # Timestamps
    opened_at: datetime = Field(
        ...,
        description="Complaint creation timestamp",
    )
    resolved_at: Union[datetime, None] = Field(
        default=None,
        description="Resolution timestamp",
    )

    # Metrics
    sla_breach: bool = Field(
        ...,
        description="Whether complaint has breached SLA",
    )
    age_hours: int = Field(
        ...,
        ge=0,
        description="Age of complaint in hours",
    )

    @computed_field  # type: ignore[misc]
    @property
    def is_overdue(self) -> bool:
        """Determine if complaint is overdue based on priority and age."""
        # Define SLA thresholds in hours by priority
        sla_thresholds = {
            Priority.CRITICAL: 2,
            Priority.URGENT: 4,
            Priority.HIGH: 12,
            Priority.MEDIUM: 24,
            Priority.LOW: 48,
        }
        
        threshold = sla_thresholds.get(self.priority, 24)
        return self.age_hours > threshold and self.status not in [
            ComplaintStatus.RESOLVED,
            ComplaintStatus.CLOSED,
        ]


class ComplaintDetail(BaseResponseSchema):
    """
    Comprehensive complaint details with full information.
    
    Used for single complaint view with complete audit trail
    and relationship information.
    """
    model_config = ConfigDict(from_attributes=True)

    complaint_number: str = Field(
        ...,
        description="Unique complaint reference number",
    )

    # Hostel information
    hostel_id: str = Field(..., description="Hostel identifier")
    hostel_name: str = Field(..., description="Hostel name")

    # Complainant information (detailed)
    raised_by: str = Field(..., description="User ID of complainant")
    raised_by_name: str = Field(..., description="Complainant name")
    raised_by_email: str = Field(..., description="Complainant email")
    raised_by_phone: str = Field(..., description="Complainant phone")

    student_id: Union[str, None] = Field(default=None, description="Student ID")
    student_name: Union[str, None] = Field(default=None, description="Student name")
    room_number: Union[str, None] = Field(default=None, description="Room number")

    # Complaint content
    title: str = Field(..., description="Complaint title")
    description: str = Field(..., description="Detailed description")
    category: ComplaintCategory = Field(..., description="Category")
    sub_category: Union[str, None] = Field(default=None, description="Sub-category")
    priority: Priority = Field(..., description="Priority level")

    # Location
    room_id: Union[str, None] = Field(default=None, description="Room ID")
    location_details: Union[str, None] = Field(default=None, description="Location details")

    # Media
    attachments: List[str] = Field(
        default_factory=list,
        description="Attachment URLs",
    )

    # Assignment history
    assigned_to: Union[str, None] = Field(default=None, description="Current assignee ID")
    assigned_to_name: Union[str, None] = Field(default=None, description="Current assignee name")
    assigned_by: Union[str, None] = Field(default=None, description="Assigned by user ID")
    assigned_by_name: Union[str, None] = Field(default=None, description="Assigned by name")
    assigned_at: Union[datetime, None] = Field(default=None, description="Assignment timestamp")
    reassigned_count: int = Field(
        default=0,
        ge=0,
        description="Number of times complaint was reassigned",
    )

    # Status workflow
    status: ComplaintStatus = Field(..., description="Current status")
    opened_at: datetime = Field(..., description="Creation timestamp")
    in_progress_at: Union[datetime, None] = Field(
        default=None,
        description="When complaint moved to in-progress",
    )
    resolved_at: Union[datetime, None] = Field(
        default=None,
        description="Resolution timestamp",
    )
    closed_at: Union[datetime, None] = Field(default=None, description="Closure timestamp")
    closed_by: Union[str, None] = Field(default=None, description="User who closed complaint")
    closed_by_name: Union[str, None] = Field(default=None, description="Closer name")

    # Resolution details
    resolution_notes: Union[str, None] = Field(
        default=None,
        description="Resolution description",
    )
    resolution_attachments: List[str] = Field(
        default_factory=list,
        description="Resolution proof URLs",
    )
    estimated_resolution_time: Union[datetime, None] = Field(
        default=None,
        description="Estimated resolution time",
    )
    actual_resolution_time: Union[datetime, None] = Field(
        default=None,
        description="Actual resolution time",
    )

    # Feedback
    student_feedback: Union[str, None] = Field(default=None, description="Student feedback")
    student_rating: Union[int, None] = Field(
        default=None,
        ge=1,
        le=5,
        description="Student rating (1-5)",
    )
    feedback_submitted_at: Union[datetime, None] = Field(
        default=None,
        description="Feedback submission timestamp",
    )

    # SLA tracking
    sla_breach: bool = Field(..., description="SLA breach status")
    sla_breach_reason: Union[str, None] = Field(
        default=None,
        description="Reason for SLA breach",
    )

    # Escalation
    escalated: bool = Field(default=False, description="Escalation status")
    escalated_to: Union[str, None] = Field(default=None, description="Escalated to user ID")
    escalated_to_name: Union[str, None] = Field(default=None, description="Escalated to name")
    escalated_at: Union[datetime, None] = Field(default=None, description="Escalation timestamp")
    escalation_reason: Union[str, None] = Field(default=None, description="Escalation reason")

    # Admin override
    overridden_by_admin: bool = Field(
        default=False,
        description="Admin override flag",
    )
    override_admin_id: Union[str, None] = Field(default=None, description="Override admin ID")
    override_timestamp: Union[datetime, None] = Field(
        default=None,
        description="Override timestamp",
    )
    override_reason: Union[str, None] = Field(default=None, description="Override reason")

    # Engagement metrics
    total_comments: int = Field(
        default=0,
        ge=0,
        description="Total comment count",
    )

    # Time metrics
    age_hours: int = Field(..., ge=0, description="Complaint age in hours")
    time_to_resolve_hours: Union[int, None] = Field(
        default=None,
        ge=0,
        description="Time taken to resolve (hours)",
    )

    @computed_field  # type: ignore[misc]
    @property
    def is_active(self) -> bool:
        """Check if complaint is in an active state."""
        active_statuses = {
            ComplaintStatus.OPEN,
            ComplaintStatus.ASSIGNED,
            ComplaintStatus.IN_PROGRESS,
            ComplaintStatus.REOPENED,
        }
        return self.status in active_statuses

    @computed_field  # type: ignore[misc]
    @property
    def resolution_efficiency(self) -> Union[str, None]:
        """
        Calculate resolution efficiency rating.
        
        Returns:
            Efficiency rating: 'excellent', 'good', 'average', 'poor', or None
        """
        if not self.time_to_resolve_hours:
            return None
        
        # Define efficiency thresholds based on priority
        thresholds = {
            Priority.CRITICAL: {"excellent": 1, "good": 2, "average": 4},
            Priority.URGENT: {"excellent": 2, "good": 4, "average": 8},
            Priority.HIGH: {"excellent": 6, "good": 12, "average": 24},
            Priority.MEDIUM: {"excellent": 12, "good": 24, "average": 48},
            Priority.LOW: {"excellent": 24, "good": 48, "average": 72},
        }
        
        threshold = thresholds.get(self.priority, thresholds[Priority.MEDIUM])
        hours = self.time_to_resolve_hours
        
        if hours <= threshold["excellent"]:
            return "excellent"
        elif hours <= threshold["good"]:
            return "good"
        elif hours <= threshold["average"]:
            return "average"
        else:
            return "poor"


class ComplaintListItem(BaseSchema):
    """
    Lightweight complaint item for list views.
    
    Optimized for performance with minimal fields
    for table/grid displays.
    """
    model_config = ConfigDict(from_attributes=True)

    id: str = Field(..., description="Complaint ID")
    complaint_number: str = Field(..., description="Reference number")
    title: str = Field(..., description="Complaint title")

    category: str = Field(..., description="Category name")
    priority: str = Field(..., description="Priority level")
    status: ComplaintStatus = Field(..., description="Current status")

    raised_by_name: str = Field(..., description="Complainant name")
    room_number: Union[str, None] = Field(default=None, description="Room number")

    assigned_to_name: Union[str, None] = Field(default=None, description="Assignee name")

    opened_at: datetime = Field(..., description="Creation timestamp")
    age_hours: int = Field(..., ge=0, description="Age in hours")

    sla_breach: bool = Field(..., description="SLA breach status")

    @computed_field  # type: ignore[misc]
    @property
    def status_color(self) -> str:
        """
        Get status color code for UI display.
        
        Returns:
            Color code string for status badge
        """
        color_map = {
            ComplaintStatus.OPEN: "red",
            ComplaintStatus.ASSIGNED: "orange",
            ComplaintStatus.IN_PROGRESS: "blue",
            ComplaintStatus.ON_HOLD: "yellow",
            ComplaintStatus.RESOLVED: "green",
            ComplaintStatus.CLOSED: "gray",
            ComplaintStatus.REOPENED: "purple",
        }
        return color_map.get(self.status, "gray")

    @computed_field  # type: ignore[misc]
    @property
    def priority_weight(self) -> int:
        """
        Get numeric priority weight for sorting.
        
        Returns:
            Integer weight (higher = more urgent)
        """
        weight_map = {
            "critical": 5,
            "urgent": 4,
            "high": 3,
            "medium": 2,
            "low": 1,
        }
        return weight_map.get(self.priority.lower(), 2)


class ComplaintSummary(BaseSchema):
    """
    Complaint statistics summary for dashboard.
    
    Provides aggregate metrics for a hostel or supervisor.
    """
    model_config = ConfigDict(from_attributes=True)

    hostel_id: str = Field(..., description="Hostel identifier")

    total_complaints: int = Field(..., ge=0, description="Total complaint count")
    open_complaints: int = Field(..., ge=0, description="Open complaints")
    in_progress_complaints: int = Field(..., ge=0, description="In-progress complaints")
    resolved_complaints: int = Field(..., ge=0, description="Resolved complaints")

    high_priority_count: int = Field(..., ge=0, description="High priority count")
    urgent_priority_count: int = Field(..., ge=0, description="Urgent priority count")

    sla_breached_count: int = Field(..., ge=0, description="SLA breached count")

    average_resolution_time_hours: Annotated[
        Decimal,
        Field(ge=Decimal("0"), description="Average resolution time in hours")
    ]

    @computed_field  # type: ignore[misc]
    @property
    def resolution_rate(self) -> float:
        """
        Calculate complaint resolution rate percentage.
        
        Returns:
            Resolution rate as percentage (0-100)
        """
        if self.total_complaints == 0:
            return 0.0
        return round(
            (self.resolved_complaints / self.total_complaints) * 100,
            2
        )

    @computed_field  # type: ignore[misc]
    @property
    def sla_compliance_rate(self) -> float:
        """
        Calculate SLA compliance rate percentage.
        
        Returns:
            SLA compliance rate as percentage (0-100)
        """
        if self.total_complaints == 0:
            return 100.0
        
        compliant = self.total_complaints - self.sla_breached_count
        return round((compliant / self.total_complaints) * 100, 2)


class ComplaintStats(BaseSchema):
    """
    Extended complaint statistics with breakdown details.
    
    Provides comprehensive analytics for reporting.
    """
    model_config = ConfigDict(from_attributes=True)

    total: int = Field(..., ge=0, description="Total complaints")
    
    # Status breakdown
    by_status: Dict[str, int] = Field(
        default_factory=dict,
        description="Complaint count by status",
    )
    
    # Priority breakdown
    by_priority: Dict[str, int] = Field(
        default_factory=dict,
        description="Complaint count by priority",
    )
    
    # Category breakdown
    by_category: Dict[str, int] = Field(
        default_factory=dict,
        description="Complaint count by category",
    )
    
    # Time-based metrics
    avg_resolution_hours: Union[Annotated[
        Decimal,
        Field(ge=Decimal("0"), description="Average resolution time")
    ], None] = None
    median_resolution_hours: Union[Annotated[
        Decimal,
        Field(ge=Decimal("0"), description="Median resolution time")
    ], None] = None
    
    # Performance indicators
    sla_compliance_percentage: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="SLA compliance percentage"
        )
    ]
    resolution_percentage: Annotated[
        Decimal,
        Field(
            ge=Decimal("0"),
            le=Decimal("100"),
            description="Resolution percentage"
        )
    ]

# --- File: D:\Last Github Push\Last\Hostel-Main\app\schemas\complaint\__init__.py ---
"""
Complaint schemas package.

Comprehensive complaint management schemas including creation, updates,
assignments, resolution, escalation, feedback, and analytics.

Example:
    from app.schemas.complaint import ComplaintCreate, ComplaintDetail
"""

from app.schemas.complaint.complaint_analytics import (
    CategoryAnalysis,
    CategoryMetrics,
    ComplaintAnalytics,
    ComplaintHeatmap,
    ComplaintTrendPoint,
    ResolutionMetrics,
    RoomComplaintCount,
    StaffPerformance,
)
from app.schemas.complaint.complaint_assignment import (
    AssignmentHistory,
    AssignmentRequest,
    AssignmentResponse,
    BulkAssignment,
    ReassignmentRequest,
    UnassignRequest,
)
from app.schemas.complaint.complaint_base import (
    ComplaintBase,
    ComplaintCreate,
    ComplaintStatusUpdate,
    ComplaintUpdate,
)
from app.schemas.complaint.complaint_comments import (
    CommentCreate,
    CommentDelete,
    CommentList,
    CommentResponse,
    CommentUpdate,
    MentionNotification,
)
from app.schemas.complaint.complaint_escalation import (
    AutoEscalationRule,
    EscalationEntry,
    EscalationHistory,
    EscalationRequest,
    EscalationResponse,
)
from app.schemas.complaint.complaint_feedback import (
    FeedbackAnalysis,
    FeedbackRequest,
    FeedbackResponse,
    FeedbackSummary,
    RatingTrendPoint,
)
from app.schemas.complaint.complaint_filters import (
    ComplaintExportRequest,
    ComplaintFilterParams,
    ComplaintSearchRequest,
    ComplaintSortOptions,
)
from app.schemas.complaint.complaint_resolution import (
    CloseRequest,
    ReopenRequest,
    ResolutionRequest,
    ResolutionResponse,
    ResolutionUpdate,
)
from app.schemas.complaint.complaint_response import (
    ComplaintDetail,
    ComplaintListItem,
    ComplaintResponse,
    ComplaintStats,
    ComplaintSummary,
)

__all__ = [
    # Base schemas
    "ComplaintBase",
    "ComplaintCreate",
    "ComplaintUpdate",
    "ComplaintStatusUpdate",
    # Response schemas
    "ComplaintResponse",
    "ComplaintDetail",
    "ComplaintListItem",
    "ComplaintSummary",
    "ComplaintStats",
    # Assignment schemas
    "AssignmentRequest",
    "AssignmentResponse",
    "ReassignmentRequest",
    "BulkAssignment",
    "UnassignRequest",
    "AssignmentHistory",
    # Resolution schemas
    "ResolutionRequest",
    "ResolutionResponse",
    "ResolutionUpdate",
    "ReopenRequest",
    "CloseRequest",
    # Escalation schemas
    "EscalationRequest",
    "EscalationResponse",
    "EscalationHistory",
    "EscalationEntry",
    "AutoEscalationRule",
    # Feedback schemas
    "FeedbackRequest",
    "FeedbackResponse",
    "FeedbackSummary",
    "FeedbackAnalysis",
    "RatingTrendPoint",
    # Comment schemas
    "CommentCreate",
    "CommentResponse",
    "CommentList",
    "CommentUpdate",
    "CommentDelete",
    "MentionNotification",
    # Filter schemas
    "ComplaintFilterParams",
    "ComplaintSearchRequest",
    "ComplaintSortOptions",
    "ComplaintExportRequest",
    # Analytics schemas
    "ComplaintAnalytics",
    "ResolutionMetrics",
    "CategoryAnalysis",
    "CategoryMetrics",
    "ComplaintTrendPoint",
    "StaffPerformance",
    "ComplaintHeatmap",
    "RoomComplaintCount",
]


================================================================================================================================================

# Complete Class Overview for Fee Structure Schemas

## 📁 fee_base.py
| Class | Purpose |
|-------|---------|
| `FeeStructureBase` | Base schema with core pricing fields, validation rules, and business logic |
| `FeeStructureCreate` | Create new fee structure with overlap validation and creation-specific rules |
| `FeeStructureUpdate` | Update existing fee structure with partial field updates and consistency checks |

## 📁 fee_config.py
| Class | Purpose |
|-------|---------|
| `ChargesBreakdown` | Detailed itemization of all fee components with totals and calculations |
| `FeeConfiguration` | Complete fee configuration for hostel/room with calculated breakdowns |
| `DiscountConfiguration` | Define various types of discounts with validity periods and conditions |
| `FeeComparison` | Compare pricing across different room types with recommendations |

## 📁 fee_response.py
| Class | Purpose |
|-------|---------|
| `FeeStructureResponse` | Standard API response with core fee structure information |
| `FeeDetail` | Detailed fee information optimized for UI display with pre-computed totals |
| `FeeStructureList` | Organized list of fee structures with summary statistics |
| `FeeHistoryItem` | Individual historical fee structure entry with change tracking |
| `FeeHistory` | Complete fee change history with statistics and trends |
| `FeeCalculation` | Detailed fee calculation for specific booking with payment schedule |

---

## Key Validation Functions

### FeeStructureBase Validators:
- `validate_amount()` - Ensures rent is within reasonable range (₹500-₹100,000), quantizes to 2 decimals
- `validate_and_quantize_amounts()` - Quantizes security deposit and mess charges to 2 decimal places
- `validate_mess_charges()` - Validates mess charges don't exceed ₹10,000 maximum
- `validate_effective_from()` - Allows backdated structures but warns if > 365 days old
- `validate_fee_structure()` - Comprehensive validation of all fee structure constraints

### FeeConfiguration Validators:
- `quantize_required_decimals()` - Ensures 2-decimal precision for required monetary fields
- `quantize_optional_decimals()` - Quantizes optional decimal fields (utility amounts)

### DiscountConfiguration Validators:
- `normalize_string_fields()` - Converts discount_type and applies_to to lowercase
- `validate_discount_name()` - Ensures discount name is at least 3 characters
- `quantize_optional_decimals()` - Quantizes percentage and amount fields

---

## Computed Properties

### FeeStructureBase:
- `@computed_field is_currently_effective` - Checks if fee structure is within effective date range
- `@computed_field days_until_effective` - Calculates days until structure becomes effective
- `@computed_field days_remaining` - Calculates days until structure expires
- `@computed_field monthly_total_minimum` - Calculates minimum monthly cost including utilities

### FeeStructureResponse:
- `@computed_field total_monthly_minimum` - Minimum monthly total with all fixed charges
- `@computed_field is_currently_effective` - Current effectiveness status
- `@computed_field status_display` - User-friendly status (Active/Inactive/Scheduled/Expired)
- `@computed_field has_variable_charges` - Indicates if utilities are billed on actual usage

### ChargesBreakdown:
- `@computed_field subtotal` - Sum of all base charges before discount
- `@computed_field total_after_discount` - Total after applying discounts
- `@computed_field grand_total` - Final total including tax
- `@computed_field total_upfront_payment` - Security deposit + first month charges

### FeeCalculation:
- `@computed_field average_monthly_cost` - Average monthly cost excluding refundable deposit
- `@computed_field total_savings` - Total discount amount
- `@computed_field savings_percentage` - Savings as percentage of original amount

---

## Business Rules Enforced

### Security Deposit Constraints:
- Maximum 3x base monthly rent
- Prevents unreasonable security deposit amounts

### Utility Billing Logic:
- **FIXED_MONTHLY**: Requires fixed amount, clears when changed to other types
- **ACTUAL**: Variable billing based on usage
- **INCLUDED**: No separate charges, included in base rent

### Mess Configuration Rules:
- If `includes_mess = true`: mess_charges_monthly must be 0
- If `includes_mess = false`: separate mess charges apply

### Date Range Validation:
- `effective_to` must be after `effective_from`
- Maximum validity period: 1825 days (~5 years)
- Prevents overlapping fee structures for same hostel/room type

### Discount Rules:
- **Percentage**: 0-100% discount on applicable charges
- **Fixed Amount**: Specific rupee amount discount
- **Waiver**: Complete waiver of specific charges
- Validity periods with active/inactive status

### Amount Thresholds:
- **Minimum Rent**: ₹500
- **Maximum Rent**: ₹100,000
- **Maximum Mess**: ₹10,000
- All monetary values quantized to 2 decimal places

---

## Model Validator Rules

### FeeStructureBase:
- **Security Deposit Ratio**: Must not exceed 3x base rent
- **Utility Consistency**: Fixed amounts required only when charge type is FIXED_MONTHLY
- **Mess Logic**: Charges must be 0 when mess is included in base rent
- **Date Validation**: End date after start date, reasonable validity period

### FeeStructureUpdate:
- **Partial Update Logic**: Validates field consistency in partial updates
- **Utility Changes**: Requires amounts when changing to FIXED_MONTHLY billing

### DiscountConfiguration:
- **Type Validation**: Ensures percentage/amount provided based on discount type
- **Date Consistency**: Valid_to after valid_from when both provided

---

## Field Validators by Type

### Monetary Fields:
All monetary fields use `quantize(Decimal("0.01"))` to ensure 2-decimal precision:
- Base amounts (rent, deposits, charges)
- Optional amounts (utility fixed charges)
- Calculated totals and breakdowns

### String Fields:
- **Normalization**: Trim whitespace, convert to appropriate case
- **Length Validation**: Minimum/maximum character limits
- **Pattern Matching**: Enum-like validation for specific values

### Date Fields:
- **Past Date Warnings**: Log warnings for very old dates (> 365 days)
- **Future Date Requirements**: Ensure validity periods make sense
- **Range Validation**: End dates after start dates

This fee structure system provides comprehensive pricing management with flexible billing options, detailed breakdowns, historical tracking, and robust validation to ensure data integrity and business rule compliance.

================================================================================================================================================
# Complete Class Overview for File Management Schemas

## 📁 document_upload.py
| Class | Purpose |
|-------|---------|
| `DocumentUploadInitRequest` | Initialize document upload with type classification and processing options |
| `DocumentUploadInitResponse` | Document-specific upload response with processing time estimates |
| `DocumentValidationResult` | Backend validation result with checks, scores, and extracted metadata |
| `DocumentInfo` | Comprehensive document information with verification status and OCR results |
| `DocumentList` | Organized list of documents with summary statistics and filtering |
| `DocumentVerificationRequest` | Admin/supervisor verification request with approval/rejection |
| `DocumentVerificationResponse` | Confirmation response after document verification |
| `DocumentOCRResult` | OCR extraction results with structured data and confidence scores |
| `DocumentExpiryAlert` | Expiry alerts and notifications for time-sensitive documents |

## 📁 file_filters.py
| Class | Purpose |
|-------|---------|
| `FileFilterParams` | Comprehensive filtering by ownership, type, size, dates, and security status |
| `FileSearchRequest` | Full-text search across filenames, tags, metadata, and OCR text |
| `FileSortOptions` | Define sorting criteria and order for file results |
| `DocumentFilterParams` | Document-specific filters for verification status and expiry tracking |
| `ImageFilterParams` | Image-specific filters for dimensions, format, and processing status |

## 📁 file_response.py
| Class | Purpose |
|-------|---------|
| `FileMetadata` | Comprehensive technical and business metadata for files |
| `FileInfo` | Complete file record with URLs, ownership, security status, and audit info |
| `FileURL` | Temporary signed URLs with expiration and access control |
| `FileListResponse` | Paginated file listings with summary statistics |
| `FileStats` | Storage usage statistics and quota tracking by entity |
| `FileAccessLog` | Audit trail for file access with geo-location and user tracking |

## 📁 file_upload.py
| Class | Purpose |
|-------|---------|
| `FileUploadInitRequest` | Initialize upload with comprehensive validation and access control |
| `FileUploadInitResponse` | Pre-signed URLs and upload instructions for direct-to-storage |
| `FileUploadCompleteRequest` | Notify completion with integrity verification (checksums/ETags) |
| `FileUploadCompleteResponse` | Confirmation with access URLs and processing status |
| `MultipartUploadInitRequest` | Initialize chunked uploads for large files (5MB+) |
| `MultipartUploadPart` | Individual part URLs for multipart upload sessions |
| `MultipartUploadCompleteRequest` | Combine uploaded parts into final file |

## 📁 image_upload.py
| Class | Purpose |
|-------|---------|
| `ImageUploadInitRequest` | Image upload with processing options (variants, optimization, watermarks) |
| `ImageUploadInitResponse` | Image-specific response with variant generation plans |
| `ImageVariant` | Generated resized/optimized versions with dimensions and quality info |
| `ImageProcessingResult` | Complete processing results with optimization metrics |
| `ImageProcessingOptions` | Advanced processing configuration for variants and quality |
| `ImageMetadata` | Extended metadata including EXIF data and camera information |

---

## Key Validation Functions

### File Security & Safety:
- `validate_filename()` - Prevents path traversal attacks, blocks dangerous characters
- `validate_content_type()` - Validates MIME types against allowed formats
- `validate_folder()` - Prevents directory traversal in folder paths
- `validate_tags()` - Normalizes tags, removes duplicates, enforces limits

### Size & Format Validation:
- `validate_size_for_type()` - Enforces type-specific size limits (images: 20MB, videos: 100MB, PDFs: 25MB)
- `validate_image_filename()` - Ensures image files have valid extensions
- `validate_svg_restrictions()` - Special handling for SVG files (no variants/optimization)

### Document-Specific Validation:
- `validate_document_filename()` - Document format validation for PDFs and images
- `validate_expiry_date()` - Ensures document expiry dates are in the future
- `validate_dates_consistency()` - Issue date must be before expiry date

### Upload Integrity:
- `validate_hash()` - Validates checksums and ETags for integrity verification
- `validate_parts()` - Validates multipart upload part information

---

## Computed Properties

### File Metadata:
- `@computed_field size_mb` - File size in megabytes
- `@computed_field is_image/is_video/is_audio/is_document` - Type classification
- `@computed_field age_days` - File age since upload
- `@computed_field is_recent` - Uploaded within 7 days

### Document Management:
- `@computed_field is_expired` - Document past expiry date
- `@computed_field days_until_expiry` - Days remaining until expiry
- `@computed_field is_expiring_soon` - Expires within 30 days
- `@computed_field urgency_level` - Expiry urgency (critical/high/medium/low)

### Image Processing:
- `@computed_field aspect_ratio` - Image aspect ratio calculation
- `@computed_field megapixels` - Image resolution in megapixels
- `@computed_field orientation` - Landscape/portrait/square classification
- `@computed_field total_variants` - Count of generated image variants

### Storage & Access:
- `@computed_field storage_used_percentage` - Quota usage percentage
- `@computed_field is_near_quota` - Storage usage > 80%
- `@computed_field time_until_expiry_minutes` - Minutes until URL expires

---

## Security Features

### Upload Security:
- **Filename Sanitization**: Blocks path traversal attempts, dangerous characters
- **Content-Type Validation**: Prevents mime-type spoofing attacks
- **Size Limits**: Type-specific maximum file sizes to prevent abuse
- **Virus Scanning**: Automatic malware detection for uploaded files

### Access Control:
- **Public/Private Classification**: Granular access control
- **Signed URLs**: Temporary access with expiration
- **Audit Logging**: Complete access tracking with IP and user agent
- **Geographic Tracking**: Location-based access monitoring

### Document Verification:
- **Multi-stage Validation**: Upload → Processing → Verification workflow
- **OCR Verification**: Text extraction with confidence scoring
- **Admin Approval**: Manual verification for sensitive documents
- **Expiry Monitoring**: Proactive alerts for expiring documents

---

## Processing Workflows

### Image Processing Pipeline:
1. **Upload Validation** → Size, format, security checks
2. **Variant Generation** → Thumbnail, small, medium, large sizes
3. **Optimization** → Compression, format conversion (WebP)
4. **Metadata Extraction** → EXIF data, dimensions, color space
5. **Watermarking** → Optional branding/protection

### Document Processing Pipeline:
1. **Classification** → Auto-detect document type and subtype
2. **OCR Extraction** → Text recognition and structured data extraction
3. **Validation** → Format verification and content analysis
4. **Verification Workflow** → Admin review and approval
5. **Expiry Monitoring** → Automated alerts for time-sensitive docs

### File Upload Workflow:
1. **Initialize** → Generate pre-signed URLs and validate request
2. **Direct Upload** → Client uploads directly to storage (S3/GCS/Azure)
3. **Complete** → Verify integrity and trigger post-processing
4. **Process** → Virus scanning, optimization, metadata extraction
5. **Finalize** → Generate access URLs and update database

---

## Business Rules Enforced

### File Size Limits:
- **Images**: 20 MB maximum
- **Videos**: 100 MB maximum  
- **Documents**: 25 MB maximum
- **Audio**: 50 MB maximum
- **Multipart Threshold**: 5 MB minimum for chunked uploads

### Document Expiry Management:
- **Alert Thresholds**: 30 days (medium), 7 days (high), expired (critical)
- **Verification Requirements**: Admin approval for ID proofs, certificates
- **OCR Confidence**: Minimum thresholds for auto-extraction acceptance

### Image Variant Rules:
- **Thumbnail**: 150px max dimension, 70% quality
- **Small**: 320px max, 75% quality
- **Medium**: 640px max, 80% quality  
- **Large**: 1280px max, 85% quality
- **SVG Exceptions**: No variants or optimization for vector graphics

### Storage Quotas:
- **Warning Threshold**: 80% of quota
- **Type-based Limits**: Different quotas by user type/plan
- **Cleanup Policies**: Automatic removal of old temporary files

This file management system provides enterprise-grade file handling with security, optimization, and comprehensive audit capabilities for a hostel management platform.


================================================================================================================================================

# Complete Hostel Schema Classes Breakdown

## 1. `hostel_admin.py` - Admin Management Classes

### **HostelAdminView**
- **Purpose**: Complete hostel dashboard view for administrators
- **Use**: Display comprehensive hostel metrics, statistics, and operational data
- **Contains**: Status, capacity stats, student counts, financial data, pending items, subscription info, performance metrics

### **HostelSettings** 
- **Purpose**: Configuration settings for hostel operations
- **Use**: Manage operational rules, booking policies, payment settings, notifications
- **Contains**: Visibility, booking automation, payment terms, attendance tracking, mess settings, security timings

### **HostelVisibilityUpdate**
- **Purpose**: Update hostel public visibility settings
- **Use**: Control hostel appearance in listings and search results
- **Contains**: Public visibility, featured status, verification status

### **HostelCapacityUpdate**
- **Purpose**: Update hostel capacity information
- **Use**: Admin-only operation to modify room and bed counts
- **Contains**: Total rooms, total beds
- **Validation**: `validate_beds_vs_rooms()` - ensures beds count is reasonable vs rooms

### **HostelStatusUpdate**
- **Purpose**: Update hostel operational status
- **Use**: Change hostel status with tracking and reasoning
- **Contains**: Status, active flag, reason, effective date
- **Validation**: `validate_reason_required()` - requires reason for deactivation/maintenance

---

## 2. `hostel_analytics.py` - Analytics & Reporting Classes

### **OccupancyDataPoint**
- **Purpose**: Single occupancy measurement at a point in time
- **Use**: Build occupancy trends and historical data
- **Contains**: Date, occupancy rate, occupied beds, total beds

### **OccupancyAnalytics**
- **Purpose**: Comprehensive occupancy analysis
- **Use**: Track occupancy metrics, trends, and predictions
- **Contains**: Current/average/peak occupancy, bed counts, trends, predictions

### **RevenueDataPoint**
- **Purpose**: Single revenue measurement for a specific date
- **Use**: Build revenue trends and historical analysis
- **Contains**: Date, total revenue, collected amount, pending amount

### **RevenueAnalytics**
- **Purpose**: Comprehensive financial analysis
- **Use**: Track revenue, collections, growth metrics
- **Contains**: Revenue breakdown, collection rates, trends, comparisons

### **BookingDataPoint**
- **Purpose**: Single booking metrics measurement
- **Use**: Track booking patterns over time
- **Contains**: Date, total bookings, approved, rejected counts

### **BookingAnalytics**
- **Purpose**: Booking conversion and performance analysis
- **Use**: Track booking success rates, sources, trends
- **Contains**: Booking counts by status, conversion rates, sources, trends

### **ComplaintAnalytics**
- **Purpose**: Complaint management metrics
- **Use**: Track complaint resolution performance
- **Contains**: Complaint counts by status/category, resolution times, SLA compliance

### **RatingDataPoint**
- **Purpose**: Rating metrics for a specific period
- **Use**: Track rating trends over time
- **Contains**: Month, average rating, review count

### **ReviewAnalytics**
- **Purpose**: Review and rating analysis
- **Use**: Track customer satisfaction and feedback
- **Contains**: Rating distribution, aspect ratings, sentiment analysis

### **HostelAnalytics**
- **Purpose**: Master analytics dashboard
- **Use**: Aggregate all analytics for comprehensive reporting
- **Contains**: All analytics types for a hostel over a period

### **RoomTypeOccupancy**
- **Purpose**: Occupancy breakdown by room type
- **Use**: Analyze performance of different room categories
- **Contains**: Room type, bed counts, occupancy percentage

### **HostelOccupancyStats**
- **Purpose**: Detailed occupancy statistics with projections
- **Use**: Advanced occupancy analysis and forecasting
- **Contains**: Current status, room type breakdown, historical data, projections

### **MonthlyRevenue**
- **Purpose**: Revenue breakdown for a single month
- **Use**: Monthly financial reporting
- **Contains**: Revenue, collections, pending amounts, student metrics

### **HostelRevenueStats**
- **Purpose**: Comprehensive financial statistics
- **Use**: Advanced financial analysis and profitability tracking
- **Contains**: Revenue/expense breakdown, profit margins, growth metrics

### **AnalyticsRequest**
- **Purpose**: Parameters for generating analytics
- **Use**: Configure analytics generation with specific criteria
- **Contains**: Hostel ID, date range, prediction settings, granularity
- **Validation**: `validate_date_range()` - ensures reasonable date range (max 2 years)

---

## 3. `hostel_base.py` - Core Hostel Classes

### **HostelBase**
- **Purpose**: Base hostel schema with common fields
- **Use**: Foundation for all hostel-related schemas
- **Contains**: Basic info, contact, address, pricing, amenities, policies, location
- **Validations**:
  - `validate_slug()` - ensures URL-friendly format
  - `validate_name()` - normalizes hostel name
  - `validate_and_clean_lists()` - cleans amenities/facilities lists
  - `validate_landmarks()` - validates landmark structure
  - `validate_currency()` - normalizes currency codes
  - `validate_check_times()` - ensures check-in before check-out

### **HostelCreate**
- **Purpose**: Schema for creating new hostels
- **Use**: Enforce required fields during hostel creation
- **Contains**: All required fields for hostel registration

### **HostelUpdate**
- **Purpose**: Schema for updating hostel information
- **Use**: Partial updates with optional fields
- **Contains**: All updatable fields as optional
- **Validations**: Same validators as HostelBase but handles None values

### **HostelMediaUpdate**
- **Purpose**: Update hostel visual content
- **Use**: Manage images, videos, virtual tours
- **Contains**: Cover image, gallery, virtual tour, video URLs
- **Validation**: `validate_gallery_images()` - limits to 20 images, removes duplicates

### **HostelSEOUpdate**
- **Purpose**: Update SEO metadata
- **Use**: Search engine optimization management
- **Contains**: Meta tags, Open Graph data
- **Validation**: `validate_keywords()` - cleans and limits keywords to 10

---

## 4. `hostel_comparison.py` - Comparison Classes

### **HostelComparisonRequest**
- **Purpose**: Request to compare multiple hostels
- **Use**: Initiate side-by-side hostel comparison
- **Contains**: 2-4 hostel IDs for comparison
- **Validation**: `validate_unique_ids()` - ensures unique hostel IDs

### **RoomTypeComparison**
- **Purpose**: Room-specific information for comparison
- **Use**: Compare room types across hostels
- **Contains**: Room type, pricing, availability, amenities

### **ComparisonItem**
- **Purpose**: Individual hostel data in comparison
- **Use**: Complete hostel information formatted for comparison
- **Contains**: All comparable hostel attributes (location, pricing, amenities, etc.)

### **PriceComparison**
- **Purpose**: Price statistics across compared hostels
- **Use**: Financial comparison summary
- **Contains**: Lowest/highest/average prices, price difference percentage

### **AmenityComparison**
- **Purpose**: Amenity analysis across hostels
- **Use**: Feature comparison and unique selling points
- **Contains**: Common amenities, unique features per hostel

### **ComparisonSummary**
- **Purpose**: Comparison insights and recommendations
- **Use**: Provide quick decision-making insights
- **Contains**: Best options for budget, rating, location, amenities, availability

### **ComparisonResult**
- **Purpose**: Complete comparison output
- **Use**: Aggregate all comparison data
- **Contains**: Hostels, criteria, summary, generation timestamp

---

## 5. `hostel_filter.py` - Filtering Classes

### **HostelFilterParams**
- **Purpose**: Comprehensive filtering options for hostel queries
- **Use**: Filter hostel listings by various criteria
- **Contains**: Search text, location, type, status, price range, rating, amenities
- **Validation**: `validate_price_range()` - ensures max price >= min price

### **HostelSortOptions**
- **Purpose**: Sorting configuration for hostel lists
- **Use**: Define sort criteria and order
- **Contains**: Sort field, sort direction
- **Validation**: `normalize_sort_order()` - normalizes to lowercase

### **AdvancedFilters**
- **Purpose**: Additional filtering for complex queries
- **Use**: Advanced search and admin filtering
- **Contains**: Date ranges, occupancy, revenue, room counts
- **Validations**:
  - `validate_date_range()` - ensures end date after start date
  - `validate_occupancy_range()` - ensures max >= min occupancy

### **BulkFilterParams**
- **Purpose**: Filter parameters for bulk operations
- **Use**: Select hostels for bulk actions
- **Contains**: Explicit hostel IDs or filter criteria
- **Validation**: `validate_unique_ids()` - ensures unique IDs

---

## 6. `hostel_public.py` - Public-Facing Classes

### **PublicHostelCard**
- **Purpose**: Hostel summary for listing/search results
- **Use**: Display hostels in search results and listings
- **Contains**: Essential info for browsing (name, price, rating, availability)

### **PublicRoomType**
- **Purpose**: Room information for public display
- **Use**: Show room options to potential customers
- **Contains**: Room type, pricing options, availability, amenities, images

### **PublicHostelProfile**
- **Purpose**: Complete public hostel information
- **Use**: Hostel detail pages for visitors
- **Contains**: Comprehensive hostel data for decision-making

### **PublicHostelList**
- **Purpose**: Paginated list of hostels with metadata
- **Use**: Search result pages and listing pages
- **Contains**: Hostel cards, pagination info, applied filters

---

## 7. `hostel_response.py` - API Response Classes

### **HostelResponse**
- **Purpose**: Standard hostel response for API operations
- **Use**: Basic hostel information in API responses
- **Contains**: Essential hostel data for API clients

### **HostelDetail**
- **Purpose**: Comprehensive hostel information response
- **Use**: Detailed hostel views in applications
- **Contains**: Complete hostel data including policies, media, SEO

### **HostelListItem**
- **Purpose**: Minimal hostel info for efficient list rendering
- **Use**: Performance-optimized list views
- **Contains**: Essential data for list display

### **HostelStats**
- **Purpose**: Key metrics summary for a hostel
- **Use**: Dashboard widgets and summary views
- **Contains**: Occupancy, revenue, student, complaint, booking, review metrics

---

## 8. `hostel_search.py` - Search Classes

### **HostelSearchRequest**
- **Purpose**: Comprehensive search request with filtering
- **Use**: Handle complex search queries with multiple criteria
- **Contains**: Text search, location filters, price range, amenities, sorting
- **Validations**:
  - `validate_location_search()` - ensures complete location data for radius search
  - `validate_price_range()` - ensures max price >= min price

### **FacetItem**
- **Purpose**: Filter option with result count
- **Use**: Build dynamic filter interfaces
- **Contains**: Value, label, result count

### **PriceRangeFacet**
- **Purpose**: Price range filter option
- **Use**: Price-based filtering in search
- **Contains**: Price range bounds, label, count

### **RatingFacet**
- **Purpose**: Rating-based filter option
- **Use**: Rating-based filtering in search
- **Contains**: Minimum rating, label, count

### **SearchFacets**
- **Purpose**: Available filter options with counts
- **Use**: Dynamic search interface generation
- **Contains**: All available facets (cities, types, prices, amenities, ratings)

### **HostelSearchResponse**
- **Purpose**: Complete search results with metadata
- **Use**: Search result pages with filtering options
- **Contains**: Results, pagination, applied filters, available facets

### **HostelSearchFilters**
- **Purpose**: Advanced boolean filters for search
- **Use**: Detailed facility-based filtering
- **Contains**: Gender preference, facility flags (WiFi, AC, gym, etc.), security features
- **Validation**: `validate_check_in_date()` - ensures check-in date not in past

---

## Summary of Key Functions/Validators:

1. **Data Validation**: Ensure data integrity and business rules
2. **Normalization**: Clean and standardize data formats
3. **Range Validation**: Ensure logical ranges for prices, dates, occupancy
4. **Business Logic**: Enforce hostel management business rules
5. **Search Optimization**: Support efficient querying and filtering
6. **API Structure**: Provide consistent response formats
7. **Security**: Separate public and admin data appropriately

Each class serves a specific role in the hostel management ecosystem, from basic CRUD operations to advanced analytics and search functionality.


================================================================================================================================================

# Complete Inquiry Schema Classes Breakdown

## 1. `inquiry_base.py` - Core Inquiry Classes

### **InquiryBase**
- **Purpose**: Foundation schema for visitor inquiries about hostels
- **Use**: Base template for all inquiry-related operations
- **Contains**: Hostel ID, visitor contact info, preferences, check-in dates, stay duration, room preferences, message, inquiry source, status
- **Key Functions**:
  - `validate_visitor_name()` - ensures name format and no numbers
  - `validate_and_normalize_phone()` - cleans phone number formatting
  - `validate_check_in_date()` - warns about unrealistic dates
  - `clean_message()` - trims and validates message length
- **Computed Properties**:
  - `has_date_preference` - checks if check-in date specified
  - `has_duration_preference` - checks if stay duration specified  
  - `has_room_preference` - checks if room type specified
  - `is_detailed_inquiry` - checks if all preferences provided

### **InquiryCreate**
- **Purpose**: Schema for creating new visitor inquiries
- **Use**: Handle new inquiry submissions from website/app
- **Contains**: All InquiryBase fields with enforced NEW status
- **Key Functions**:
  - `validate_initial_status()` - forces status to NEW for new inquiries

### **InquiryUpdate**
- **Purpose**: Schema for updating existing inquiries
- **Use**: Admin updates to inquiry details or visitor corrections
- **Contains**: Optional versions of all inquiry fields
- **Key Functions**:
  - `validate_visitor_name()` - validates name if provided
  - `validate_phone()` - normalizes phone if provided
  - `clean_message()` - cleans message if provided

---

## 2. `inquiry_filters.py` - Filtering & Search Classes

### **InquiryFilterParams**
- **Purpose**: Comprehensive filtering options for inquiry queries
- **Use**: Filter inquiry lists by status, dates, hostel, source, assignment
- **Contains**: Search text, hostel filters, status filters, date ranges, room type, assignment status, urgency flags
- **Key Functions**:
  - `validate_created_date_range()` - ensures end date after start date
  - `validate_check_in_date_range()` - validates check-in date range

### **InquirySearchRequest**
- **Purpose**: Full-text search across inquiry fields with pagination
- **Use**: Search for specific inquiries by visitor name, email, phone, message
- **Contains**: Search query, hostel filter, searchable fields flags, status filter, pagination
- **Key Functions**:
  - `validate_query()` - ensures search query is not empty

### **InquirySortOptions**
- **Purpose**: Define sorting criteria for inquiry lists
- **Use**: Sort inquiries by creation date, visitor name, status, check-in date
- **Contains**: Sort field, sort direction (asc/desc)
- **Key Functions**:
  - `normalize_sort_fields()` - converts to lowercase

### **InquiryExportRequest**
- **Purpose**: Configure inquiry data export
- **Use**: Export inquiry data to CSV/Excel/PDF with custom fields
- **Contains**: Hostel filter, export format, field inclusion flags, filter criteria
- **Key Functions**:
  - `normalize_format()` - converts format to lowercase

---

## 3. `inquiry_response.py` - API Response Classes

### **InquiryResponse**
- **Purpose**: Standard inquiry response for API operations
- **Use**: Basic inquiry information in API responses
- **Contains**: Core inquiry data with hostel name, visitor info, preferences, status, timestamps
- **Computed Properties**:
  - `age_days` - calculates inquiry age in days
  - `is_new` - checks if inquiry is less than 24 hours old
  - `is_stale` - checks if older than 7 days without contact
  - `urgency_level` - returns "high", "medium", or "low" urgency

### **InquiryDetail**
- **Purpose**: Complete inquiry information for detail views
- **Use**: Comprehensive inquiry data including contact history and assignment info
- **Contains**: All inquiry data plus contact tracking, assignment info, internal notes, timestamps
- **Computed Properties**:
  - `age_days` - inquiry age calculation
  - `has_been_contacted` - checks if visitor was contacted
  - `is_assigned` - checks if inquiry assigned to someone
  - `response_time_hours` - calculates response time if contacted
  - `days_since_contact` - days since last contact

### **InquiryListItem**
- **Purpose**: Optimized inquiry data for list views
- **Use**: Efficient rendering of inquiry lists with essential info only
- **Contains**: ID, hostel name, visitor info, preferences, status, urgency flags
- **Computed Properties**:
  - `age_days` - inquiry age
  - `status_badge_color` - color code for UI status badges

### **InquiryStats**
- **Purpose**: Inquiry analytics and performance metrics
- **Use**: Dashboard statistics and conversion tracking
- **Contains**: Volume metrics, response times, conversion rates, source breakdown
- **Computed Properties**:
  - `pending_action_count` - count of inquiries needing attention
  - `response_rate` - percentage of inquiries contacted

---

## 4. `inquiry_status.py` - Status Management Classes

### **InquiryStatusUpdate**
- **Purpose**: Update inquiry status with tracking and notes
- **Use**: Track inquiry progress through lifecycle (new → contacted → interested → converted)
- **Contains**: Inquiry ID, new status, notes, admin who updated
- **Key Functions**:
  - `clean_notes()` - cleans notes field
  - `validate_status_transition()` - ensures logical status progression

### **InquiryAssignment**
- **Purpose**: Assign inquiries to team members for follow-up
- **Use**: Distribute workload among admins/staff
- **Contains**: Inquiry ID, assigned admin, assignment notes, follow-up due date
- **Key Functions**:
  - `clean_notes()` - validates assignment notes
  - `validate_follow_up_due()` - ensures due date not in past

### **InquiryFollowUp**
- **Purpose**: Record follow-up interactions with visitors
- **Use**: Track all contact attempts and outcomes
- **Contains**: Inquiry ID, contact method, outcome, detailed notes, next follow-up date
- **Key Functions**:
  - `validate_notes()` - ensures meaningful notes (min 10 chars)
  - `validate_next_follow_up()` - validates next follow-up date

### **InquiryTimelineEntry**
- **Purpose**: Timeline event in inquiry history
- **Use**: Audit trail of all inquiry activities
- **Contains**: Event type, status, timestamp, admin info, notes, metadata
- **No Validators**: Pure data schema for timeline display

### **InquiryConversion**
- **Purpose**: Record inquiry conversion to booking
- **Use**: Link successful inquiries to resulting bookings
- **Contains**: Inquiry ID, booking ID, converting admin, conversion notes
- **Key Functions**:
  - `clean_notes()` - cleans conversion notes

### **BulkInquiryStatusUpdate**
- **Purpose**: Update multiple inquiries simultaneously
- **Use**: Batch operations for efficiency (marking multiple as not interested, etc.)
- **Contains**: List of inquiry IDs, new status, notes, admin performing update
- **Key Functions**:
  - `validate_inquiry_ids()` - validates ID list (max 100, removes duplicates)
  - `clean_notes()` - cleans notes field

---

## Summary of Key Functions by Category:

### **Data Validation Functions:**
1. **Name Validation**: Ensures visitor names are realistic (no numbers, minimum length)
2. **Phone Normalization**: Cleans phone number formatting
3. **Date Validation**: Prevents unrealistic dates, ensures logical ranges
4. **Message Cleaning**: Trims whitespace, enforces length limits
5. **Status Transition**: Validates logical inquiry status progression

### **Computed Properties:**
1. **Age Calculations**: Track how long inquiries have been open
2. **Urgency Detection**: Automatically flag inquiries needing immediate attention
3. **Preference Tracking**: Identify detailed vs basic inquiries
4. **Contact Status**: Track communication progress
5. **Performance Metrics**: Calculate response times and conversion rates

### **Business Logic Functions:**
1. **Assignment Management**: Distribute inquiries among team members
2. **Follow-up Tracking**: Ensure consistent visitor communication
3. **Timeline Management**: Maintain complete audit trail
4. **Bulk Operations**: Enable efficient batch processing
5. **Export Configuration**: Customize data exports for reporting

### **Search & Filter Functions:**
1. **Multi-field Search**: Search across names, emails, phones, messages
2. **Status Filtering**: Filter by inquiry status and urgency
3. **Date Range Filtering**: Filter by creation dates and check-in preferences
4. **Assignment Filtering**: Filter by assigned admins
5. **Source Tracking**: Filter by inquiry origin (website, phone, walk-in)

Each class serves a specific role in managing the complete inquiry lifecycle from initial visitor interest through conversion to booking, with comprehensive tracking, validation, and reporting capabilities.


================================================================================================================================================

# Complete Leave Schema Classes Breakdown

## 1. `leave_application.py` - Student Application Classes

### **LeaveApplicationRequest**
- **Purpose**: Student-initiated leave application with comprehensive validation
- **Use**: Handle new leave requests from students with automatic calculations
- **Contains**: Student ID, hostel ID, leave type, date range, reason, contact info, emergency contacts, supporting documents, destination address
- **Key Functions**:
  - `validate_from_date()` - allows applications 30 days in advance or 7 days backdated
  - `validate_reason()` - ensures meaningful reason (min 10 chars, no placeholder text)
  - `normalize_phone()` - cleans phone number formatting
  - `validate_destination()` - normalizes destination address
  - `validate_leave_application()` - comprehensive business logic validation
- **Business Rules**:
  - Duration limits by leave type (casual: 30 days, sick: 60 days, emergency: 15 days, vacation: 90 days)
  - Medical certificate required for sick leave > 3 days
  - Supporting documentation required for leave > 15 days
  - Contact info required for leave > 7 days
  - Emergency contact required for leave > 15 days

### **LeaveCancellationRequest**
- **Purpose**: Student request to cancel existing leave applications
- **Use**: Allow students to cancel pending or approved leaves with justification
- **Contains**: Leave ID, student ID, cancellation reason, immediate return flag, actual return date
- **Key Functions**:
  - `validate_reason()` - ensures meaningful cancellation reason
  - `validate_cancellation()` - validates consistency between immediate return and actual return date
- **Business Rules**:
  - Actual return date cannot be in future for cancellations
  - Actual return date cannot be more than 30 days in past

---

## 2. `leave_approval.py` - Approval Workflow Classes

### **LeaveApprovalRequest**
- **Purpose**: Admin/supervisor leave approval or rejection with audit trail
- **Use**: Handle approval decisions with proper validation and tracking
- **Contains**: Leave ID, approver ID, approve/reject flag, notes, rejection reason, conditions, notification flags
- **Key Functions**:
  - `validate_text_fields()` - normalizes approval notes and conditions
  - `validate_approval_decision()` - ensures rejection reason provided when rejecting
- **Business Rules**:
  - Rejection requires detailed reason (min 10 chars)
  - Conditions only set when approving
  - Cannot set rejection reason when approving

### **LeaveApprovalAction**
- **Purpose**: Alternative approval workflow with explicit status actions
- **Use**: Complex approval workflows with multiple action types
- **Contains**: Leave ID, approver ID, action type, comments, requested changes, escalation info, conditions
- **Key Functions**:
  - `validate_comments()` - ensures meaningful comments (min 10 chars)
  - `validate_action_requirements()` - validates action-specific required fields
- **Action Types**: approve, reject, request_changes, escalate
- **Business Rules**:
  - 'request_changes' requires requested_changes field
  - 'escalate' requires escalate_to field
  - Conditions only valid for approval actions

### **LeaveApprovalResponse**
- **Purpose**: Complete approval decision response with all metadata
- **Use**: Provide comprehensive information about approval decisions
- **Contains**: Leave info, student details, approval/rejection details, timestamps, notification info
- **Key Functions**:
  - `validate_response_consistency()` - ensures approval/rejection fields match status
- **Business Rules**:
  - APPROVED status requires approval details, no rejection details
  - REJECTED status requires rejection details and reason, no approval details

---

## 3. `leave_balance.py` - Balance Management Classes

### **LeaveBalance**
- **Purpose**: Track leave allocation, usage, and remaining balance for specific leave type
- **Use**: Monitor leave quota consumption and availability
- **Contains**: Leave type, annual allocation, used days, pending days, remaining days, carry forward, max consecutive days
- **Key Functions**:
  - `validate_remaining_days()` - ensures remaining = allocated + carry_forward - used - pending
- **Computed Properties**:
  - `usage_percentage` - calculates usage percentage
  - `is_exhausted` - checks if balance is zero
  - `utilization_status` - returns status: "critical", "high", "moderate", "low", "minimal"

### **LeaveBalanceSummary**
- **Purpose**: Comprehensive leave balance across all leave types for a student
- **Use**: Student dashboard showing complete leave status for academic period
- **Contains**: Student info, hostel info, academic year dates, balance breakdown, overall statistics
- **Key Functions**:
  - `validate_academic_year()` - ensures end date after start date
- **Computed Properties**:
  - `overall_usage_percentage` - usage across all leave types
  - `days_until_year_end` - remaining days in academic year
  - `has_pending_applications` - checks for pending applications

### **LeaveQuota**
- **Purpose**: Leave policy configuration for hostel/institution
- **Use**: Define leave entitlements and rules per leave type
- **Contains**: Hostel ID, leave type, quotas (annual/semester/monthly), limits, notice requirements, carry forward rules
- **Key Functions**:
  - `validate_carry_forward()` - validates carry forward settings only when enabled
- **Configuration Options**:
  - Maximum consecutive days
  - Minimum notice period
  - Document requirements
  - Carry forward policies

### **LeaveUsageDetail**
- **Purpose**: Granular leave usage record for reporting and analytics
- **Use**: Track individual leave consumption for analysis
- **Contains**: Student ID, leave ID, dates, total days, application timing, approval timing, document status
- **Computed Properties**:
  - `approval_turnaround_days` - calculates approval processing time

---

## 4. `leave_base.py` - Foundation Classes

### **LeaveBase**
- **Purpose**: Foundation schema with core leave attributes and validation
- **Use**: Base template for all leave-related operations
- **Contains**: Student ID, hostel ID, leave type, date range, total days, reason, contact info, supporting documents
- **Key Functions**:
  - `validate_from_date()` - prevents dates more than 30 days past or 1 year future
  - `validate_reason()` - ensures meaningful reasons (min 10 chars, character diversity)
  - `normalize_phone()` - cleans phone number formatting
  - `validate_leave_dates()` - ensures date consistency and calculates total days
  - `validate_document_requirement()` - enforces document requirements
- **Business Rules**:
  - Duration limits by leave type
  - Automatic document requirements based on type/duration

### **LeaveCreate**
- **Purpose**: Create new leave applications with auto-calculations
- **Use**: Handle new leave submissions with smart defaults
- **Contains**: All LeaveBase fields with optional total_days (auto-calculated)
- **Key Functions**:
  - `calculate_total_days()` - auto-calculates duration from date range

### **LeaveUpdate**
- **Purpose**: Partial updates to existing leave applications
- **Use**: Modify leave details before approval (typically)
- **Contains**: Optional versions of all leave fields including status
- **Key Functions**:
  - `validate_reason()` - validates updated reason if provided
  - `normalize_phone()` - normalizes updated phone numbers
  - `validate_date_consistency()` - ensures date logic when both dates updated

---

## 5. `leave_response.py` - API Response Classes

### **LeaveResponse**
- **Purpose**: Standard leave response for API operations
- **Use**: Lightweight response for list views and basic queries
- **Contains**: Essential leave info with student/hostel names, dates, status, basic reason
- **Computed Properties**:
  - `status_display` - human-readable status
  - `leave_type_display` - human-readable leave type
  - `is_active` - checks if leave is currently active
  - `days_remaining` - remaining days for active leave

### **LeaveDetail**
- **Purpose**: Comprehensive leave information with complete workflow history
- **Use**: Detail views showing full leave lifecycle and metadata
- **Contains**: Complete leave data, student details, approval/rejection history, cancellation info, timestamps
- **Computed Properties**:
  - `is_active` - currently active status
  - `is_upcoming` - approved but future leave
  - `is_past` - completed leave
  - `can_be_cancelled` - whether student can cancel

### **LeaveListItem**
- **Purpose**: Minimal leave data for efficient list rendering
- **Use**: Optimized for pagination and list views
- **Contains**: ID, student info, room number, basic leave details, status
- **Computed Properties**:
  - `status_badge_color` - UI color codes for status badges
  - `is_urgent` - pending leaves starting soon (≤2 days)

### **LeaveSummary**
- **Purpose**: Aggregated leave statistics for reporting and dashboards
- **Use**: Analytics and summary reporting
- **Contains**: Period info, counts by status/type, day statistics, active leaves
- **Computed Properties**:
  - `approval_rate` - percentage of approved vs total decided applications

---

## Summary of Key Functions by Category:

### **Date Validation Functions:**
1. **Date Range Validation**: Ensures logical start/end date relationships
2. **Business Date Rules**: Prevents unrealistic application dates (too far past/future)
3. **Duration Calculation**: Auto-calculates total days from date ranges
4. **Academic Period Validation**: Ensures academic year date consistency

### **Business Logic Validators:**
1. **Duration Limits**: Enforces maximum days by leave type
2. **Document Requirements**: Auto-requires documents based on type/duration
3. **Contact Requirements**: Requires contact info for longer leaves
4. **Balance Calculations**: Validates remaining = allocated - used - pending
5. **Approval Consistency**: Ensures approval/rejection fields match status

### **Data Normalization Functions:**
1. **Phone Normalization**: Removes formatting characters from phone numbers
2. **Text Cleaning**: Trims whitespace and validates meaningful content
3. **Reason Validation**: Prevents placeholder text and ensures detail
4. **Address Normalization**: Cleans destination addresses

### **Computed Properties:**
1. **Status Indicators**: Active, upcoming, past, urgent flags
2. **Usage Metrics**: Percentage calculations and utilization status
3. **Time Calculations**: Age, remaining days, turnaround times
4. **UI Helpers**: Badge colors, display names, formatting

### **Workflow Management:**
1. **Approval Actions**: Handle approve/reject/escalate workflows
2. **Cancellation Logic**: Validate cancellation requests and timing
3. **Status Transitions**: Ensure logical status progression
4. **Assignment Tracking**: Track who performed which actions

### **Reporting & Analytics:**
1. **Balance Tracking**: Monitor quota usage across leave types
2. **Usage Analytics**: Track patterns and compliance
3. **Performance Metrics**: Approval times, conversion rates
4. **Summary Statistics**: Aggregate data for dashboards

Each class serves specific roles in the complete leave management lifecycle from application through approval to balance tracking and reporting, with comprehensive validation ensuring data integrity and business rule compliance.

================================================================================================================================================

# Complete Maintenance Schema Classes Overview

## 1. `maintenance_analytics.py` - Analytics & Insights

### Classes:

**`TrendPoint`**
- **Purpose**: Single data point for trend analysis over time periods
- **Use**: Track request counts, completion rates, average completion days for specific time periods

**`CostTrendPoint`** 
- **Purpose**: Cost-specific trend data for time periods
- **Use**: Monitor cost trends, budget utilization, variance analysis over time

**`CategoryBreakdown`**
- **Purpose**: Detailed metrics breakdown by maintenance category
- **Use**: Analyze performance by category (electrical, plumbing, etc.) - costs, completion rates, quality

**`VendorPerformance`**
- **Purpose**: Comprehensive vendor performance tracking
- **Use**: Evaluate vendor efficiency, cost competitiveness, quality ratings, timeliness

**`PerformanceMetrics`**
- **Purpose**: Overall maintenance operation performance indicators
- **Use**: Dashboard KPIs - completion rates, cost variance, quality metrics, response times

**`ProductivityMetrics`**
- **Purpose**: Staff/team productivity measurement
- **Use**: Track individual/team performance - jobs per day, utilization rates, quality scores

**`MaintenanceAnalytics`**
- **Purpose**: Comprehensive analytics dashboard aggregating all metrics
- **Use**: Executive reporting, insights generation, trend identification, recommendations

## 2. `maintenance_approval.py` - Approval Workflow

### Classes:

**`ApprovalRequest`**
- **Purpose**: Submit maintenance work for approval when cost/policy thresholds exceeded
- **Use**: Request admin approval for high-cost repairs, vendor selection, emergency work

**`ApprovalResponse`**
- **Purpose**: Decision response to approval requests
- **Use**: Approve/reject requests with conditions, amounts, reasons, alternative suggestions

**`ThresholdConfig`**
- **Purpose**: Configure approval thresholds for different authorization levels
- **Use**: Set cost limits for auto-approval, supervisor approval, admin approval requirements

**`ApprovalWorkflow`**
- **Purpose**: Track current approval process status
- **Use**: Monitor pending approvals, escalations, deadlines, approval levels required

**`RejectionRequest`**
- **Purpose**: Detailed rejection with guidance for resubmission
- **Use**: Reject requests with specific reasons, alternatives, cost reduction suggestions

## 3. `maintenance_assignment.py` - Task Assignment

### Classes:

**`TaskAssignment`**
- **Purpose**: Assign maintenance tasks to internal staff
- **Use**: Allocate work to technicians, set deadlines, provide instructions and required tools

**`VendorAssignment`**
- **Purpose**: Assign work to external vendors/contractors
- **Use**: Outsource work with quotes, contracts, payment terms, warranty details

**`AssignmentUpdate`**
- **Purpose**: Modify existing assignments (reassign, change deadlines)
- **Use**: Handle staff unavailability, deadline changes, priority adjustments

**`BulkAssignment`**
- **Purpose**: Assign multiple requests to same person efficiently
- **Use**: Batch assign similar issues, distribute workload, bulk operations

**`AssignmentEntry`**
- **Purpose**: Individual assignment record in history
- **Use**: Track single assignment with completion status, performance metrics

**`AssignmentHistory`**
- **Purpose**: Complete assignment timeline for audit trail
- **Use**: Track reassignments, completion rates, performance analysis

## 4. `maintenance_base.py` - Core Foundation

### Classes:

**`MaintenanceBase`**
- **Purpose**: Core maintenance request attributes and validation
- **Use**: Base schema with common fields - hostel, category, priority, location, photos

**`MaintenanceCreate`**
- **Purpose**: Create new maintenance requests with context
- **Use**: Submit new issues with preferred completion dates, notification preferences

**`MaintenanceUpdate`**
- **Purpose**: Update existing requests partially
- **Use**: Modify request details, status, costs, timelines during processing

**`MaintenanceStatusUpdate`**
- **Purpose**: Simple status transitions with audit trail
- **Use**: Change request status with notes, notifications, tracking

## 5. `maintenance_completion.py` - Completion & Quality

### Classes:

**`MaterialItem`**
- **Purpose**: Individual materials used in maintenance work
- **Use**: Track material consumption, costs, suppliers, warranties for billing/inventory

**`CompletionRequest`**
- **Purpose**: Mark maintenance work as completed with full details
- **Use**: Submit completion with work notes, costs, materials, photos, warranty info

**`ChecklistItem`**
- **Purpose**: Individual quality check item
- **Use**: Define specific checks for quality inspection with pass/fail status

**`QualityCheck`**
- **Purpose**: Quality inspection of completed work
- **Use**: Verify work quality, identify defects, require rework, customer acceptance

**`CompletionResponse`**
- **Purpose**: Summary response after completion submission
- **Use**: Confirm completion status, cost variance, quality check results

**`CompletionCertificate`**
- **Purpose**: Formal work completion certificate
- **Use**: Document completed work with parties, costs, warranties, digital signatures

## 6. `maintenance_cost.py` - Cost Management

### Classes:

**`CostTracking`**
- **Purpose**: Track estimated vs actual costs with variance analysis
- **Use**: Monitor budget compliance, cost overruns, breakdown by components

**`CategoryBudget`**
- **Purpose**: Budget allocation for specific maintenance categories
- **Use**: Track spending by category, utilization rates, remaining budgets

**`BudgetAllocation`**
- **Purpose**: Overall hostel maintenance budget management
- **Use**: Fiscal year budgeting, category allocation, forecasting, burn rates

**`MonthlyExpense`**
- **Purpose**: Monthly expense aggregation
- **Use**: Monthly spending reports, budget variance tracking, trend analysis

**`ExpenseItem`**
- **Purpose**: Individual expense entry for reports
- **Use**: Line item in expense reports with variance, vendor, completion details

**`ExpenseReport`**
- **Purpose**: Comprehensive expense analysis and reporting
- **Use**: Generate detailed expense reports by period, category, vendor

**`InvoiceLineItem`**
- **Purpose**: Individual line item in vendor invoices
- **Use**: Track invoice details, quantities, pricing, tax calculations

**`VendorInvoice`**
- **Purpose**: Complete vendor invoice with payment terms
- **Use**: Process vendor bills, track payment terms, validate calculations

**`CostAnalysis`**
- **Purpose**: Cost trends and efficiency analysis
- **Use**: Identify cost drivers, efficiency opportunities, benchmarking

## 7. `maintenance_filters.py` - Querying & Export

### Classes:

**`MaintenanceFilterParams`**
- **Purpose**: Comprehensive filtering for maintenance queries
- **Use**: Multi-dimensional search by status, category, date, cost, assignee, etc.

**`SearchRequest`**
- **Purpose**: Full-text search with field targeting
- **Use**: Search in titles, descriptions, notes with fuzzy matching, pagination

**`AdvancedFilterParams`**
- **Purpose**: Advanced filtering with analytics and performance criteria
- **Use**: Complex queries for reporting, analytics, performance analysis

**`MaintenanceExportRequest`**
- **Purpose**: Export maintenance data in various formats
- **Use**: Generate CSV, Excel, PDF reports with custom fields and formatting

## 8. `maintenance_request.py` - Request Submission

### Classes:

**`MaintenanceRequest`**
- **Purpose**: Simple maintenance request submission by residents
- **Use**: Students/residents submit basic issues with photos, preferred timing

**`RequestSubmission`**
- **Purpose**: Detailed supervisor-level request submission
- **Use**: Supervisors submit complex requests with cost estimates, vendor preferences

**`EmergencyRequest`**
- **Purpose**: Critical emergency maintenance with safety protocols
- **Use**: Handle fire, flood, safety hazards with evacuation tracking, authority notification

## 9. `maintenance_response.py` - API Responses

### Classes:

**`MaintenanceResponse`**
- **Purpose**: Standard lightweight response for list views
- **Use**: API responses for maintenance lists, basic request information

**`MaintenanceDetail`**
- **Purpose**: Complete detailed maintenance information
- **Use**: Full request details including workflow, costs, assignments, quality checks

**`RequestListItem`**
- **Purpose**: Minimal list item for efficient rendering
- **Use**: Optimized for pagination, status badges, quick overview

**`MaintenanceSummary`**
- **Purpose**: Aggregated statistics for dashboard
- **Use**: Hostel-level KPIs, request counts by status/priority, performance metrics

## 10. `maintenance_schedule.py` - Preventive Maintenance

### Classes:

**`ScheduleChecklistItem`**
- **Purpose**: Individual task in preventive maintenance checklist
- **Use**: Define specific checks/tasks with timing, criticality, instructions

**`PreventiveSchedule`**
- **Purpose**: Recurring maintenance schedule definition
- **Use**: Setup preventive maintenance with recurrence, assignments, cost estimates

**`ScheduleCreate`**
- **Purpose**: Create new preventive maintenance schedules
- **Use**: Define recurring tasks with checklists, notifications, auto-creation rules

**`RecurrenceConfig`**
- **Purpose**: Advanced recurrence pattern configuration
- **Use**: Complex scheduling with custom intervals, holiday/weekend handling

**`ChecklistResult`**
- **Purpose**: Result of individual checklist item execution
- **Use**: Record completion status, findings, issues, actions taken

**`ScheduleExecution`**
- **Purpose**: Execute/complete scheduled preventive maintenance
- **Use**: Record execution with results, costs, materials, next occurrence scheduling

**`ScheduleUpdate`**
- **Purpose**: Modify existing schedules
- **Use**: Update recurrence, costs, assignments, activation status

**`ExecutionHistoryItem`**
- **Purpose**: Single execution record in schedule history
- **Use**: Track individual executions with performance metrics, delays

**`ScheduleHistory`**
- **Purpose**: Complete execution history and statistics
- **Use**: Analyze schedule performance, completion rates, cost trends, quality metrics

---

## Summary by Functional Area:

- **Core Operations**: 4 base classes for CRUD operations
- **Request Management**: 3 classes for different request types
- **Assignment & Workflow**: 6 classes for task allocation and tracking
- **Approval Process**: 5 classes for approval workflow management
- **Completion & Quality**: 6 classes for work completion and quality control
- **Cost Management**: 9 classes for comprehensive cost tracking and budgeting
- **Preventive Maintenance**: 9 classes for scheduled maintenance management
- **Analytics & Reporting**: 7 classes for insights and performance analysis
- **Data Access**: 4 classes for filtering, searching, and exporting
- **API Responses**: 4 classes for different response formats

**Total: 57 classes** providing complete maintenance management functionality.


================================================================================================================================================
# Complete Mess Schema Classes Overview

## 1. `meal_items.py` - Menu Items & Dietary Management

### Classes:

**`MenuItem`**
- **Purpose**: Individual menu item with complete dietary and allergen information
- **Use**: Define food items with vegetarian/vegan/jain flags, allergen warnings, spice levels, nutritional details

**`MealItems`**
- **Purpose**: Collection of menu items grouped by meal type
- **Use**: Organize breakfast/lunch/dinner items with serving times for specific meals

**`DietaryOptions`**
- **Purpose**: Hostel-level dietary preferences configuration
- **Use**: Configure available dietary menus (veg/non-veg/vegan), allergen display, customization settings

**`AllergenInfo`**
- **Purpose**: Detailed allergen information for specific menu items
- **Use**: Track allergen presence levels (contains/trace/may contain), severity, detailed warnings

**`NutritionalInfo`**
- **Purpose**: Comprehensive nutritional data for menu items
- **Use**: Store calories, macros, micros, vitamins, serving sizes, ingredients for health-conscious meal planning

**`ItemCategory`**
- **Purpose**: Categorization of menu items for organization
- **Use**: Group related items (main course, side dish, dessert) for easier menu planning and display

**`ItemMasterList`**
- **Purpose**: Central repository of all available menu items for a hostel
- **Use**: Maintain master catalog of items across categories for menu planning and consistency

## 2. `menu_approval.py` - Approval Workflow Management

### Classes:

**`MenuApprovalRequest`**
- **Purpose**: Submit menu for approval when cost/policy thresholds exceeded
- **Use**: Request admin approval for special menus, high-cost meals, special procurement needs

**`MenuApprovalResponse`**
- **Purpose**: Approval decision response with conditions and feedback
- **Use**: Approve/reject menus with budget approval, conditions, suggestions for resubmission

**`ApprovalWorkflow`**
- **Purpose**: Track current approval process status and timeline
- **Use**: Monitor pending approvals, deadlines, workflow stages, escalations

**`BulkApproval`**
- **Purpose**: Approve or reject multiple menus simultaneously
- **Use**: Efficient approval of routine menus, weekly plans, similar menu types

**`ApprovalAttempt`**
- **Purpose**: Individual approval submission record
- **Use**: Track single submission in approval workflow with feedback and decisions

**`ApprovalHistory`**
- **Purpose**: Complete approval history for audit trail
- **Use**: Maintain chronological record of all approval attempts, decisions, and revisions

## 3. `menu_duplication.py` - Menu Replication & Bulk Creation

### Classes:

**`DuplicateMenuRequest`**
- **Purpose**: Duplicate existing menu to another date with modifications
- **Use**: Copy successful menus to future dates, selective meal copying, auto-publishing

**`BulkMenuCreate`**
- **Purpose**: Create multiple menus using templates or patterns
- **Use**: Generate menus for date ranges using weekly patterns, daily rotation, templates

**`DuplicateResponse`**
- **Purpose**: Summary of duplication operation results
- **Use**: Report success rates, skipped dates, errors encountered during bulk operations

**`CrossHostelDuplication`**
- **Purpose**: Replicate menus across multiple hostels
- **Use**: Share successful menus between hostels with dietary adaptations and customizations

**`MenuCloneConfig`**
- **Purpose**: Configuration rules for menu cloning operations
- **Use**: Define how menus should be adapted during duplication (cost adjustments, seasonal items)

## 4. `menu_feedback.py` - Rating & Quality Management

### Classes:

**`FeedbackRequest`**
- **Purpose**: Submit student feedback and ratings for menus
- **Use**: Collect multi-dimensional ratings (taste, quantity, quality, hygiene), comments, liked/disliked items

**`FeedbackResponse`**
- **Purpose**: Confirmation of feedback submission with context
- **Use**: Acknowledge feedback receipt, display submission details, track helpful votes

**`ItemRating`**
- **Purpose**: Aggregated ratings for specific menu items
- **Use**: Track item-level popularity, sentiment analysis, like/dislike ratios for menu optimization

**`RatingsSummary`**
- **Purpose**: Comprehensive ratings statistics for menus
- **Use**: Dashboard metrics, meal-wise ratings, distribution analysis, recommendation percentages

**`SentimentAnalysis`**
- **Purpose**: Text sentiment analysis of feedback comments
- **Use**: Analyze comment sentiment, extract common themes, identify positive/negative keywords

**`QualityMetrics`**
- **Purpose**: Menu quality trends and comparative analysis
- **Use**: Track quality improvements, identify best/worst performers, day-wise analysis, satisfaction rates

**`FeedbackAnalysis`**
- **Purpose**: Comprehensive feedback analysis with actionable insights
- **Use**: Generate recommendations for menu improvements, identify items to keep/remove/improve

## 5. `menu_planning.py` - Advance Planning & Templates

### Classes:

**`DailyMenuPlan`**
- **Purpose**: Structure for single day's complete menu
- **Use**: Define all meals for one day with special occasion handling, planning notes

**`MenuPlanRequest`**
- **Purpose**: Request comprehensive menu planning for date ranges
- **Use**: Initiate automated menu planning with variety constraints, dietary requirements, budget limits

**`WeeklyPlan`**
- **Purpose**: Complete 7-day menu plan structure
- **Use**: Plan entire weeks with day-wise menus, cost estimation, variety management

**`SpecialDayMenu`**
- **Purpose**: Enhanced menu for special occasions within monthly plans
- **Use**: Plan festival/celebration menus with special budgets, guest expectations, themes

**`MonthlyPlan`**
- **Purpose**: Comprehensive monthly menu organization
- **Use**: Coordinate weekly plans and special occasions for entire month with budget tracking

**`SpecialMenu`**
- **Purpose**: Detailed special occasion menu configuration
- **Use**: Plan festivals, celebrations with enhanced items, decorations, serving styles, notifications

**`MenuTemplate`**
- **Purpose**: Reusable menu patterns for recurring use
- **Use**: Store successful menu patterns by season/occasion for future application and efficiency

**`MenuSuggestion`**
- **Purpose**: AI/system generated intelligent menu recommendations
- **Use**: Provide data-driven menu suggestions based on ratings, season, nutrition, cost optimization

## 6. `mess_menu_base.py` - Core Foundation

### Classes:

**`MessMenuBase`**
- **Purpose**: Core menu attributes and validation logic
- **Use**: Base schema with common fields (meals, timings, dietary options), date/time validation

**`MessMenuCreate`**
- **Purpose**: Create new menus with creator tracking
- **Use**: Submit new menus with auto-publish options, notification settings, completeness validation

**`MessMenuUpdate`**
- **Purpose**: Update existing menus with partial fields
- **Use**: Modify draft menus before publication, selective meal updates, timing adjustments

## 7. `mess_menu_response.py` - API Response Formats

### Classes:

**`MenuResponse`**
- **Purpose**: Standard lightweight menu response
- **Use**: List views, basic API responses with essential menu information and computed totals

**`MenuDetail`**
- **Purpose**: Comprehensive menu information with metadata
- **Use**: Detailed menu views with management info, approval status, feedback statistics

**`DailyMenuSummary`**
- **Purpose**: Compact single day menu representation
- **Use**: Calendar views, weekly/monthly displays with top items and ratings

**`WeeklyMenu`**
- **Purpose**: Complete week view with all daily menus
- **Use**: Weekly planning displays, completion tracking, special days counting

**`MonthlyMenu`**
- **Purpose**: Monthly calendar view with statistics
- **Use**: Month overview with completion rates, publication status, rating analytics

**`TodayMenu`**
- **Purpose**: Student-friendly current day menu
- **Use**: Student portal display with timings, dietary info, feedback options, next meal indication

**`MenuListItem`**
- **Purpose**: Minimal menu item for efficient list rendering
- **Use**: Management lists, pagination, status badges, quick overview with computed properties

---

## Summary by Functional Area:

- **Core Operations**: 3 base classes for menu CRUD operations
- **Item Management**: 7 classes for menu items, dietary options, nutrition, allergens
- **Planning & Templates**: 8 classes for advance planning, weekly/monthly organization
- **Approval Workflow**: 6 classes for approval process management and tracking
- **Feedback & Quality**: 7 classes for rating collection and quality analysis  
- **Bulk Operations**: 5 classes for duplication, bulk creation, cross-hostel sharing
- **API Responses**: 7 classes for different response formats and views

**Total: 43 classes** providing complete mess/cafeteria management functionality including menu planning, approval workflows, quality tracking, and student engagement features.

================================================================================================================================================
# Complete Notification Schema Classes Breakdown

## 1. **notification_base.py** - Core Foundation Classes

### Classes:
- **`NotificationBase`** - Base schema for all notifications
  - *Purpose*: Common fields for recipient info, content, priority, scheduling
  - *Functions*: Validation for email/phone formats, scheduling, subject requirements

- **`NotificationCreate`** - Create new notifications
  - *Purpose*: Schema for POST requests to create notifications
  - *Functions*: Inherits base validation + metadata size validation

- **`NotificationUpdate`** - Update existing notifications
  - *Purpose*: Limited updates (scheduling, priority, status only)
  - *Functions*: Prevents content changes, validates future scheduling

- **`MarkAsRead`** - Mark single notification as read
  - *Purpose*: Track when users read notifications
  - *Functions*: Links notification to user with timestamp

- **`BulkMarkAsRead`** - Mark multiple notifications as read
  - *Purpose*: Bulk read operations (max 100 notifications)
  - *Functions*: Validates unique IDs, single timestamp for all

- **`NotificationDelete`** - Delete notifications
  - *Purpose*: Soft/hard delete with audit trail
  - *Functions*: Tracks deletion reason and user

---

## 2. **notification_response.py** - API Response Classes

### Classes:
- **`NotificationResponse`** - Standard notification response
  - *Purpose*: Basic notification data for API responses
  - *Functions*: Computed properties for sent/pending status

- **`NotificationDetail`** - Detailed notification view
  - *Purpose*: Full notification info including tracking & metadata
  - *Functions*: Read status, retry logic, delivery duration calculation

- **`NotificationListItem`** - Compact list view item
  - *Purpose*: Optimized for notification lists/feeds
  - *Functions*: Message preview, urgency check, UI-friendly data

- **`NotificationList`** - Paginated notification list
  - *Purpose*: Container for user's notifications with summary
  - *Functions*: Unread count calculation, read percentage

- **`UnreadCount`** - Unread notification breakdown
  - *Purpose*: Badge counts by type and priority
  - *Functions*: Granular unread tracking for UI badges

- **`NotificationSummary`** - User notification analytics
  - *Purpose*: Aggregate statistics and engagement metrics
  - *Functions*: Read percentage, recent activity detection

---

## 3. **notification_template.py** - Template Management Classes

### Classes:
- **`TemplateCreate`** - Create new templates
  - *Purpose*: Define reusable notification templates with variables
  - *Functions*: Variable validation, template code naming, content validation

- **`TemplateUpdate`** - Update existing templates
  - *Purpose*: Modify templates (code immutable after creation)
  - *Functions*: Partial updates for content, variables, metadata

- **`TemplateResponse`** - Template details with stats
  - *Purpose*: Full template info including usage statistics
  - *Functions*: Usage tracking, audit trail

- **`VariableMapping`** - Template variable binding
  - *Purpose*: Map variable names to values for rendering
  - *Functions*: Variable value validation

- **`TemplatePreview`** - Preview rendered template
  - *Purpose*: Test templates before deployment
  - *Functions*: Preview with variable substitution

- **`TemplatePreviewResponse`** - Rendered preview result
  - *Purpose*: Show rendered content + validation results
  - *Functions*: Character counting, missing variable detection

- **`TemplateList`** - Template collection
  - *Purpose*: List templates with summary statistics
  - *Functions*: Template categorization and counting

- **`TemplateCategory`** - Group templates by category
  - *Purpose*: Organize templates for UI navigation
  - *Functions*: Category-based template grouping

- **`TemplateCopyRequest`** - Copy existing templates
  - *Purpose*: Create new templates from existing ones
  - *Functions*: Template duplication with new identifiers

---

## 4. **email_notification.py** - Email-Specific Classes

### Classes:
- **`EmailAttachment`** - Email file attachments
  - *Purpose*: Manage email attachments with size limits
  - *Functions*: File validation, size checking (25MB total limit)

- **`EmailRequest`** - Send email notification
  - *Purpose*: Comprehensive email sending with CC/BCC, attachments
  - *Functions*: Template/content validation, attachment size limits, scheduling

- **`EmailConfig`** - Email service configuration
  - *Purpose*: Configure email providers (SendGrid, SES, SMTP, etc.)
  - *Functions*: Provider-specific validation, rate limiting settings

- **`EmailTracking`** - Email delivery & engagement tracking
  - *Purpose*: Track email lifecycle from send to engagement
  - *Functions*: Open/click tracking, bounce handling, spam reporting

- **`EmailTemplate`** - Email-specific templates
  - *Purpose*: Email templates with styling and branding
  - *Functions*: HTML/text body management, header/footer customization

- **`BulkEmailRequest`** - Bulk email sending
  - *Purpose*: Send emails to multiple recipients (max 1000)
  - *Functions*: Batch processing, per-recipient variables, rate limiting

- **`EmailStats`** - Email campaign analytics
  - *Purpose*: Comprehensive email performance metrics
  - *Functions*: Delivery rates, engagement analytics, spam tracking

- **`EmailSchedule`** - Schedule emails
  - *Purpose*: Future email delivery with recurrence
  - *Functions*: Timezone handling, recurring email patterns

---

## 5. **sms_notification.py** - SMS-Specific Classes

### Classes:
- **`SMSRequest`** - Send SMS notification
  - *Purpose*: SMS sending with template support and DLT compliance
  - *Functions*: Phone validation, character counting, segment estimation

- **`SMSConfig`** - SMS service configuration
  - *Purpose*: Configure SMS providers (Twilio, AWS SNS, MSG91, etc.)
  - *Functions*: Provider credentials, rate limits, DLT settings, cost tracking

- **`DeliveryStatus`** - SMS delivery tracking
  - *Purpose*: Track SMS delivery status and provider responses
  - *Functions*: Status tracking, cost calculation, segment counting

- **`SMSTemplate`** - SMS-specific templates
  - *Purpose*: SMS templates with character/segment optimization
  - *Functions*: Character analysis, DLT compliance, segment estimation

- **`BulkSMSRequest`** - Bulk SMS sending
  - *Purpose*: Send SMS to multiple recipients (max 10,000)
  - *Functions*: Batch processing, rate limiting, cost estimation

- **`SMSStats`** - SMS campaign analytics
  - *Purpose*: SMS performance metrics and cost analysis
  - *Functions*: Delivery rates, cost tracking, segment analysis

- **`SMSQuota`** - SMS usage tracking
  - *Purpose*: Track SMS usage against quotas
  - *Functions*: Hourly/daily/monthly quota monitoring

---

## 6. **push_notification.py** - Push Notification Classes

### Classes:
- **`PushAction`** - Action buttons for notifications
  - *Purpose*: Define clickable actions in push notifications
  - *Functions*: Action URL handling, icon management

- **`PushRequest`** - Send push notification
  - *Purpose*: Cross-platform push notifications (iOS/Android/Web)
  - *Functions*: Rich content, custom data, badge management, scheduling

- **`PushConfig`** - Push service configuration
  - *Purpose*: Configure FCM (Firebase) and APNs (Apple) services
  - *Functions*: Platform-specific settings, certificate management

- **`DeviceToken`** - Registered device information
  - *Purpose*: Track user devices for push delivery
  - *Functions*: Device lifecycle, badge tracking, platform detection

- **`DeviceRegistration`** - Register new devices
  - *Purpose*: Add devices to push notification system
  - *Functions*: Device token validation, user association

- **`DeviceUnregistration`** - Remove devices
  - *Purpose*: Stop sending notifications to devices
  - *Functions*: Clean device registry, audit trail

- **`PushTemplate`** - Push notification templates
  - *Purpose*: Reusable push notification structures
  - *Functions*: Platform-specific defaults, action templates

- **`PushDeliveryStatus`** - Push delivery tracking
  - *Purpose*: Track push notification delivery and engagement
  - *Functions*: Platform-specific status, click tracking

- **`PushStats`** - Push campaign analytics
  - *Purpose*: Push notification performance by platform
  - *Functions*: Platform breakdown, engagement metrics

- **`BulkPushRequest`** - Bulk push notifications
  - *Purpose*: Send push to multiple users/devices (max 100,000)
  - *Functions*: Massive scale delivery, segmentation, batching

---

## 7. **notification_queue.py** - Queue Management Classes

### Classes:
- **`QueueStatus`** - Real-time queue overview
  - *Purpose*: Monitor queue state across channels and priorities
  - *Functions*: Queue utilization calculation, health indicators

- **`QueuedNotification`** - Individual queued item
  - *Purpose*: Represent notification waiting for processing
  - *Functions*: Queue position tracking, retry logic, age calculation

- **`BatchProcessing`** - Bulk operation progress
  - *Purpose*: Track bulk notification send progress
  - *Functions*: Progress calculation, throughput monitoring, ETA estimation

- **`QueueStats`** - Historical queue metrics
  - *Purpose*: Performance analytics and optimization data
  - *Functions*: Success rates, throughput analysis, worker utilization

- **`QueueHealth`** - System health monitoring
  - *Purpose*: Monitor queue system health and performance
  - *Functions*: Health scoring, issue detection, recommendations

- **`QueuePriority`** - Priority-based processing
  - *Purpose*: Configure and monitor priority-based queue processing
  - *Functions*: SLA tracking, priority weighting, performance by priority

---

## 8. **notification_preferences.py** - User Preference Classes

### Classes:
- **`FrequencySettings`** - Notification timing preferences
  - *Purpose*: Control when and how often notifications are sent
  - *Functions*: Batching, digest scheduling, immediate delivery control

- **`QuietHours`** - Do not disturb settings
  - *Purpose*: Define periods when notifications should not be sent
  - *Functions*: Time range validation, timezone handling, urgent exceptions

- **`EmailPreferences`** - Email-specific preferences
  - *Purpose*: Fine-grained control over email notifications
  - *Functions*: Category filtering, digest settings, format preferences

- **`SMSPreferences`** - SMS-specific preferences
  - *Purpose*: Control SMS delivery with cost considerations
  - *Functions*: Priority filtering, daily limits, category selection

- **`PushPreferences`** - Push notification preferences
  - *Purpose*: Control mobile/web push behavior
  - *Functions*: Sound/vibration, badge, preview, lock screen settings

- **`ChannelPreferences`** - Aggregated channel settings
  - *Purpose*: Container for all channel-specific preferences
  - *Functions*: Unified preference management

- **`UserPreferences`** - Master user settings
  - *Purpose*: Complete user notification configuration
  - *Functions*: Global toggles, language/timezone, category controls

- **`PreferenceUpdate`** - Update user preferences
  - *Purpose*: Partial preference updates
  - *Functions*: Selective preference modification

- **`UnsubscribeRequest`** - Opt-out management
  - *Purpose*: Handle unsubscribe requests with tokens
  - *Functions*: Secure unsubscribe, category-specific opt-outs

---

## 9. **notification_routing.py** - Routing & Escalation Classes

### Classes:
- **`RoutingCondition`** - Rule matching criteria
  - *Purpose*: Define when routing rules should apply
  - *Functions*: Event matching, priority filtering, time-based rules

- **`RoutingRule`** - Individual routing configuration
  - *Purpose*: Define how notifications should be routed
  - *Functions*: Recipient selection, channel assignment, template mapping

- **`RoutingConfig`** - Complete hostel routing setup
  - *Purpose*: Master routing configuration for a hostel
  - *Functions*: Rule prioritization, default routing, escalation settings

- **`EscalationLevel`** - Single escalation step
  - *Purpose*: Define one level in escalation chain
  - *Functions*: Timing rules, recipient assignment, channel selection

- **`HierarchicalRouting`** - Multi-level notification routing
  - *Purpose*: Primary/secondary/tertiary routing with fallbacks
  - *Functions*: Hierarchy management, timing configuration

- **`EscalationRouting`** - Active escalation tracking
  - *Purpose*: Track escalation state for specific notifications
  - *Functions*: Escalation progression, auto-escalation, resolution tracking

- **`NotificationRoute`** - Final routing decision
  - *Purpose*: Determined route for a notification
  - *Functions*: Route documentation, escalation path assignment

---

## Key Design Patterns Used:

1. **Inheritance**: Base classes provide common functionality
2. **Composition**: Complex objects built from simpler components  
3. **Validation**: Extensive field validation and cross-field validation
4. **Computed Properties**: Dynamic calculations for derived fields
5. **Template Pattern**: Reusable templates with variable substitution
6. **Strategy Pattern**: Multiple providers for each channel
7. **Observer Pattern**: Tracking and status updates
8. **Builder Pattern**: Complex request building with validation

This architecture provides a comprehensive, scalable notification system with clear separation of concerns and extensive validation.

================================================================================================================================================
# Complete Payment Schema Classes Breakdown

## 1. **payment_base.py** - Core Foundation Classes

### Classes:
- **`PaymentBase`** - Base schema for all payments
  - *Purpose*: Common payment fields (type, amount, currency, method)
  - *Functions*: Amount validation, currency normalization, decimal formatting

- **`PaymentCreate`** - Create new payments
  - *Purpose*: Schema for POST requests to create payments
  - *Functions*: Amount validation, currency validation, entity reference validation

- **`PaymentUpdate`** - Update existing payments
  - *Purpose*: Limited payment updates (status, timestamps, gateway response)
  - *Functions*: Failure reason validation, prevents modification of core payment data

---

## 2. **payment_filters.py** - Search & Filter Classes

### Classes:
- **`PaymentFilterParams`** - Advanced payment filtering
  - *Purpose*: Filter payments by date, amount, status, entities
  - *Functions*: Date range validation, amount range validation, pagination

- **`PaymentSearchRequest`** - Text-based payment search
  - *Purpose*: Search across payment fields with filters
  - *Functions*: Query validation, search field validation, combined filtering

- **`PaymentSortOptions`** - Payment result sorting
  - *Purpose*: Define sorting criteria for payment lists
  - *Functions*: Primary/secondary sort validation, prevents duplicate sort fields

- **`PaymentReportRequest`** - Generate payment reports
  - *Purpose*: Request payment reports for specific periods/criteria
  - *Functions*: Period validation, report size limits, grouping options

- **`PaymentExportRequest`** - Export payment data
  - *Purpose*: Export payments in various formats (CSV, Excel, PDF, JSON)
  - *Functions*: Field validation, export format handling, record limits

- **`PaymentAnalyticsRequest`** - Analytics request
  - *Purpose*: Request detailed payment analytics and insights
  - *Functions*: Analysis period validation, granularity settings, trend analysis

### Enums:
- **`PaymentSortField`** - Available sort fields
- **`SortOrder`** - Sort direction (ASC/DESC)
- **`ExportFormat`** - Export format options

---

## 3. **payment_gateway.py** - Gateway Integration Classes

### Classes:
- **`GatewayRequest`** - Payment gateway initiation
  - *Purpose*: Data sent to payment gateway to start transaction
  - *Functions*: Amount validation, currency normalization, customer data validation

- **`GatewayResponse`** - Gateway initiation response
  - *Purpose*: Response from gateway after payment initiation
  - *Functions*: Checkout URL handling, SDK options, error tracking

- **`GatewayWebhook`** - Webhook payload processing
  - *Purpose*: Handle webhook notifications from payment gateway
  - *Functions*: Event processing, signature verification, status mapping

- **`GatewayCallback`** - Payment callback handling
  - *Purpose*: Handle return URLs after payment completion
  - *Functions*: Status verification, signature validation, parameter extraction

- **`GatewayRefundRequest`** - Gateway refund initiation
  - *Purpose*: Request refunds through payment gateway
  - *Functions*: Refund amount validation, partial/full refund logic, reason validation

- **`GatewayRefundResponse`** - Gateway refund response
  - *Purpose*: Response from gateway after refund initiation
  - *Functions*: Refund tracking, completion estimates, error handling

- **`GatewayVerification`** - Payment verification
  - *Purpose*: Verify payment status directly with gateway
  - *Functions*: Verification logic, discrepancy detection, status reconciliation

---

## 4. **payment_ledger.py** - Accounting & Ledger Classes

### Classes:
- **`LedgerEntry`** - Individual ledger entry
  - *Purpose*: Single transaction entry in payment ledger
  - *Functions*: Debit/credit detection, balance calculation, amount formatting

- **`TransactionItem`** - Transaction for statements
  - *Purpose*: Simplified transaction view for account statements
  - *Functions*: Transaction type detection, running balance tracking

- **`AccountStatement`** - Complete account statement
  - *Purpose*: Formal account statement for students
  - *Functions*: Net movement calculation, transaction counting, period summary

- **`LedgerSummary`** - Account summary overview
  - *Purpose*: High-level account status and totals
  - *Functions*: Balance status calculation, payment ratio analysis, activity tracking

- **`TransactionHistory`** - Paginated transaction list
  - *Purpose*: Historical transaction view with pagination
  - *Functions*: Page calculation, transaction filtering

- **`BalanceAdjustment`** - Manual balance adjustments
  - *Purpose*: Manually adjust account balances
  - *Functions*: Adjustment validation, reason enforcement, approval tracking

- **`WriteOff`** - Write off uncollectible amounts
  - *Purpose*: Write off bad debts and uncollectible amounts
  - *Functions*: Write-off limit validation, approval level verification, documentation

---

## 5. **payment_refund.py** - Refund Management Classes

### Classes:
- **`RefundRequest`** - Request payment refund
  - *Purpose*: Initiate refund requests for payments
  - *Functions*: Refund amount validation, reason validation

- **`RefundStatus`** - Current refund status
  - *Purpose*: Track refund progression through stages
  - *Functions*: Processing time calculation, status checks

- **`RefundResponse`** - Complete refund information
  - *Purpose*: Detailed refund data for API responses
  - *Functions*: Remaining amount calculation, refund percentage, partial/full detection

- **`RefundApproval`** - Approve/reject refunds
  - *Purpose*: Administrator approval workflow for refunds
  - *Functions*: Approval validation, processing options

- **`RefundListItem`** - Compact refund summary
  - *Purpose*: Optimized for displaying refund lists
  - *Functions*: Status display formatting, user-friendly labels

- **`RefundList`** - Paginated refund listing
  - *Purpose*: Paginated list of refunds with metadata
  - *Functions*: Pagination logic, next/previous page detection

---

## 6. **payment_reminder.py** - Reminder System Classes

### Classes:
- **`ReminderConfig`** - Reminder configuration
  - *Purpose*: Configure when and how payment reminders are sent
  - *Functions*: Timing validation, channel validation, escalation settings

- **`ReminderLog`** - Reminder execution log
  - *Purpose*: Track when reminders were sent and their outcomes
  - *Functions*: Channel tracking, engagement metrics, type display formatting

- **`SendReminderRequest`** - Manual reminder trigger
  - *Purpose*: Manually trigger sending of payment reminders
  - *Functions*: Channel validation, payment ID validation, period filtering

- **`ReminderBatch`** - Batch reminder execution
  - *Purpose*: Track bulk reminder sending operations
  - *Functions*: Success rate calculation, duration tracking, error summarization

- **`ReminderStats`** - Reminder analytics
  - *Purpose*: Analytics and effectiveness metrics for reminders
  - *Functions*: Success rates, engagement rates, effectiveness calculation

---

## 7. **payment_request.py** - Payment Initiation Classes

### Classes:
- **`PaymentRequest`** - Online payment initiation
  - *Purpose*: Initiate online payments through payment gateways
  - *Functions*: Amount validation, payment method validation, entity reference validation

- **`PaymentInitiation`** - Gateway initiation response
  - *Purpose*: Information needed to complete payment on client side
  - *Functions*: Checkout URL handling, expiry tracking, gateway options

- **`ManualPaymentRequest`** - Record offline payments
  - *Purpose*: Record cash, cheque, and bank transfer payments
  - *Functions*: Payment method validation, cheque details validation, collection date validation

- **`SinglePaymentRecord`** - Individual payment in bulk
  - *Purpose*: Single payment record within bulk operations
  - *Functions*: Amount validation, basic payment validation

- **`BulkPaymentRequest`** - Record multiple payments
  - *Purpose*: Batch recording of offline payments
  - *Functions*: Payment list validation, duplicate detection, collection validation

---

## 8. **payment_response.py** - API Response Classes

### Classes:
- **`PaymentResponse`** - Standard payment response
  - *Purpose*: Basic payment information for API responses
  - *Functions*: Amount display formatting, status badge coloring, overdue detection

- **`PaymentDetail`** - Detailed payment information
  - *Purpose*: Complete payment details including gateway data
  - *Functions*: Net amount calculation, refund status detection, days overdue calculation

- **`PaymentReceipt`** - Formal payment receipt
  - *Purpose*: Receipt generation for printing/download
  - *Functions*: Receipt ID formatting, tax details, amount in words

- **`PaymentListItem`** - Compact payment summary
  - *Purpose*: Optimized for payment list displays
  - *Functions*: Status display formatting, user-friendly labels

- **`PaymentSummary`** - Payment overview for entities
  - *Purpose*: Aggregate payment information for students/hostels
  - *Functions*: Health score calculation, completion rate analysis

- **`PaymentAnalytics`** - Payment analytics data
  - *Purpose*: Comprehensive analytics for reporting
  - *Functions*: Revenue calculation, failure rate analysis, efficiency metrics

---

## 9. **payment_schedule.py** - Recurring Payment Classes

### Classes:
- **`PaymentSchedule`** - Recurring payment schedule
  - *Purpose*: Represent recurring payment schedules for students
  - *Functions*: Indefinite schedule detection, days calculation, overdue detection

- **`ScheduleCreate`** - Create payment schedule
  - *Purpose*: Set up new recurring payment schedules
  - *Functions*: Amount validation, date range validation, due date validation

- **`ScheduleUpdate`** - Update payment schedule
  - *Purpose*: Modify existing schedule parameters
  - *Functions*: Amount validation, date validation

- **`ScheduleGeneration`** - Generate scheduled payments
  - *Purpose*: Trigger generation of scheduled payments for period
  - *Functions*: Period validation, generation limit enforcement

- **`ScheduledPaymentGenerated`** - Generation results
  - *Purpose*: Results of scheduled payment generation
  - *Functions*: Success rate calculation, processing statistics

- **`BulkScheduleCreate`** - Create multiple schedules
  - *Purpose*: Batch creation of payment schedules for multiple students
  - *Functions*: Student ID validation, amount validation, date validation

- **`ScheduleSuspension`** - Temporarily suspend schedule
  - *Purpose*: Pause schedules for specific periods (vacations, etc.)
  - *Functions*: Suspension period validation, reason validation

---

## Key Design Patterns Used:

1. **Request/Response Pattern**: Separate schemas for input and output
2. **Validation Layers**: Field-level and model-level validation
3. **Computed Properties**: Dynamic calculations for derived fields
4. **Status Tracking**: Comprehensive status management across workflows
5. **Audit Trail**: Creation/update tracking with user information
6. **Pagination**: Built-in pagination support for list responses
7. **Bulk Operations**: Batch processing with validation and limits
8. **Gateway Abstraction**: Provider-agnostic payment processing
9. **Financial Integrity**: Decimal precision, amount validation, reconciliation
10. **Workflow Management**: Multi-step processes with state tracking

This architecture provides a comprehensive payment management system with:
- **Multi-gateway support** for payment processing
- **Complete financial tracking** with ledger entries
- **Automated scheduling** for recurring payments
- **Robust refund management** with approval workflows
- **Advanced analytics** and reporting capabilities
- **Comprehensive audit trails** for compliance
- **Flexible reminder system** for payment collection

================================================================================================================================================

# Complete Referral Schema Classes Breakdown

## 1. **referral_base.py** - Core Foundation Classes

### Classes:
- **`ReferralBase`** - Base referral record schema
  - *Purpose*: Tracks single referral from one user to another with status and rewards
  - *Functions*: Referral code validation, phone normalization, decimal precision, referee info validation, conversion data consistency

- **`ReferralCreate`** - Create new referral records
  - *Purpose*: Schema for creating new referral entries
  - *Functions*: Auto-generate referral codes, inherit base validation, referrer personalization

- **`ReferralUpdate`** - Update existing referrals
  - *Purpose*: Modify referral status, conversion info, reward status
  - *Functions*: Limited field updates, status progression tracking

- **`ReferralConversion`** - Convert referral to booking
  - *Purpose*: Mark referral as converted when booking is completed
  - *Functions*: Conversion validation, decimal formatting, future date prevention

---

## 2. **referral_code.py** - Code Generation & Validation Classes

### Classes:
- **`ReferralCodeGenerate`** - Generate unique referral codes
  - *Purpose*: Create personalized referral codes for users to share
  - *Functions*: Prefix validation, expiration validation, customization options

- **`ReferralCodeResponse`** - Generated code details
  - *Purpose*: Return code metadata including share URLs and QR codes
  - *Functions*: Share URL generation, usage tracking, expiration monitoring

- **`CodeValidationRequest`** - Validate referral codes
  - *Purpose*: Check if a referral code is valid when someone tries to use it
  - *Functions*: Code normalization, context tracking

- **`CodeValidationResponse`** - Validation result details
  - *Purpose*: Provide validation outcome with program and reward details
  - *Functions*: Error handling, reward information display, usage statistics

- **`ReferralCodeStats`** - Code performance analytics
  - *Purpose*: Track code usage, conversions, and effectiveness
  - *Functions*: Conversion rate calculation, reward tracking, performance metrics

---

## 3. **referral_program_base.py** - Program Definition Classes

### Classes:
- **`ReferralProgramBase`** - Core program configuration
  - *Purpose*: Define referral program structure, rules, and reward system
  - *Functions*: Program validation, currency validation, reward amount validation, eligibility criteria validation, validity period checks

- **`ProgramCreate`** - Create new referral programs
  - *Purpose*: Set up new referral programs with complete configuration
  - *Functions*: Auto-generate program codes, comprehensive program setup validation

- **`ProgramUpdate`** - Update existing programs
  - *Purpose*: Modify program parameters and settings
  - *Functions*: Partial updates, field validation, at least one field requirement

### Enums:
- **`ProgramType`** - Program category constants (student_referral, visitor_referral, affiliate, corporate)
- **`RewardType`** - Reward mechanism types (cash, discount, voucher, free_month, points)

---

## 4. **referral_program_response.py** - Program Response Classes

### Classes:
- **`ProgramResponse`** - Complete program details
  - *Purpose*: Full program information with basic statistics
  - *Functions*: Expiration detection, upcoming status, conversion rate calculation, days remaining

- **`ProgramList`** - Paginated program listing
  - *Purpose*: Display multiple programs with summary statistics
  - *Functions*: Pagination logic, program count breakdown, navigation helpers

- **`ProgramStats`** - Detailed program analytics
  - *Purpose*: Comprehensive performance metrics for programs
  - *Functions*: ROI calculation, average reward per conversion, user engagement tracking

- **`ProgramAnalytics`** - Advanced trend analysis
  - *Purpose*: Predictive metrics and trend analysis
  - *Functions*: Trend tracking, comparative metrics, performance indicators, quality metrics

- **`ProgramPerformance`** - Performance comparison
  - *Purpose*: Compare programs or track performance over time
  - *Functions*: Multi-program comparison, ranking analysis, insights generation

---

## 5. **referral_response.py** - Referral Response Classes

### Classes:
- **`ReferralResponse`** - Standard referral response
  - *Purpose*: Basic referral information for API responses
  - *Functions*: Conversion detection, total reward calculation, time tracking

- **`ReferralDetail`** - Comprehensive referral information
  - *Purpose*: Complete referral details including history and tracking
  - *Functions*: Conversion time calculation, reward value aggregation, payment status checking

- **`ReferralStats`** - User performance statistics
  - *Purpose*: Individual user's referral performance and earnings
  - *Functions*: Success rate calculation, average reward calculation, ranking metrics

- **`ReferralLeaderboard`** - Top performers ranking
  - *Purpose*: Rank users by referral performance
  - *Functions*: Leaderboard generation, period filtering

- **`LeaderboardEntry`** - Individual leaderboard position
  - *Purpose*: Single user entry in performance rankings
  - *Functions*: Ranking display, badge assignment, performance metrics

- **`ReferralTimeline`** - Activity chronology
  - *Purpose*: Chronological view of referral events and milestones
  - *Functions*: Event sequencing, timeline generation

- **`TimelineEvent`** - Single timeline event
  - *Purpose*: Individual event in referral lifecycle
  - *Functions*: Event data management, actor tracking

- **`ReferralAnalytics`** - Advanced analytics
  - *Purpose*: Comprehensive insights and performance analysis
  - *Functions*: Effective conversion rate calculation, trend analysis, ROI metrics

---

## 6. **referral_rewards.py** - Reward Management Classes

### Classes:
- **`RewardConfig`** - Global reward settings
  - *Purpose*: Define payout rules, thresholds, fees, and payment methods
  - *Functions*: Payout method validation, fee calculation, frequency limits

- **`RewardTracking`** - User reward balance tracking
  - *Purpose*: Track total rewards earned, paid, and pending across all programs
  - *Functions*: Balance calculation, decimal validation, payout eligibility

- **`RewardCalculation`** - Reward amount calculation
  - *Purpose*: Calculate exact reward amounts with bonuses and deductions
  - *Functions*: Eligibility checking, bonus calculation, deduction handling, net amount calculation

- **`PayoutRequest`** - Initiate reward withdrawal
  - *Purpose*: User requests to withdraw accumulated rewards
  - *Functions*: Amount validation, payout method validation, detail verification

- **`PayoutRequestResponse`** - Payout status tracking
  - *Purpose*: Track payout request through approval and processing stages
  - *Functions*: Status tracking, fee calculation, completion estimation

- **`PayoutHistory`** - Historical payout records
  - *Purpose*: Complete history of user's reward payouts
  - *Functions*: Transaction history, amount aggregation

- **`RewardSummary`** - Aggregate reward reporting
  - *Purpose*: Summary statistics for rewards over time periods
  - *Functions*: Period analysis, breakdown by status/program, average calculations

---

## Key Design Patterns Used:

1. **Referral Lifecycle Management**: Complete tracking from code generation to reward payout
2. **Program-Based Organization**: All referrals linked to specific programs with rules
3. **Multi-Stakeholder Rewards**: Separate tracking for referrer and referee rewards
4. **Status Progression**: Clear status workflows with validation
5. **Performance Analytics**: Comprehensive metrics and leaderboards
6. **Flexible Reward Systems**: Support for multiple reward types and calculations
7. **Payout Management**: Complete withdrawal workflow with approvals
8. **Code Generation**: Unique, shareable codes with tracking
9. **Eligibility Validation**: Rule-based reward eligibility checking
10. **Timeline Tracking**: Complete audit trail of referral activities

This architecture provides a comprehensive referral management system with:
- **Program Management** for creating and configuring referral campaigns
- **Code Generation** for unique, trackable referral links
- **Conversion Tracking** from initial referral to completed booking
- **Reward Calculation** with flexible rules and eligibility criteria
- **Payout Management** with approval workflows and multiple payment methods
- **Performance Analytics** including leaderboards and trend analysis
- **Complete Audit Trail** with timeline tracking and status history

The system supports multiple referral program types (student, visitor, affiliate, corporate) with different reward structures and is designed for scale with proper validation and security measures.


================================================================================================================================================

# Complete Review Schema Classes Breakdown

## 1. review_base.py

### **DetailedRatings**
- **Purpose**: Structure for aspect-based ratings (cleanliness, food, staff, etc.)
- **Use**: Base component for comprehensive review feedback
- **Fields**: Individual ratings for different hostel aspects (1-5 scale)

### **ReviewBase** 
- **Purpose**: Foundation schema with core review fields
- **Use**: Base class for review creation/updates
- **Functions**: 
  - `round_rating_to_half()` - Rounds ratings to 0.5 increments
  - `validate_title()` - Validates review title format
  - `validate_review_text()` - Validates review content
  - `validate_photos()` - Validates photo URLs
  - `validate_rating_consistency()` - Ensures overall rating aligns with detailed ratings

### **ReviewCreate**
- **Purpose**: Schema for new review submission
- **Use**: API endpoint for creating reviews
- **Functions**:
  - `validate_recommendation_consistency()` - Checks if recommendation aligns with rating
- **Extends**: ReviewBase + BaseCreateSchema

### **ReviewUpdate**
- **Purpose**: Schema for editing existing reviews
- **Use**: API endpoint for review updates (with time limits)
- **Functions**: Same validation as ReviewCreate but for partial updates
- **Extends**: BaseUpdateSchema

---

## 2. review_response.py

### **HostelResponseDetail**
- **Purpose**: Structure for hostel's reply to reviews
- **Use**: Display management responses to customer feedback
- **Fields**: Response text, responder info, timestamps, edit history

### **ReviewResponse**
- **Purpose**: Basic review data for list views
- **Use**: Lightweight review display in lists/cards
- **Functions**:
  - `helpfulness_ratio` - Calculates helpful vote percentage

### **ReviewDetail**
- **Purpose**: Complete review information
- **Use**: Full review page display
- **Functions**:
  - `total_votes` - Total helpfulness votes
  - `average_detailed_rating` - Average of all aspect ratings
- **Fields**: All review data + engagement metrics + hostel responses

### **ReviewListItem**
- **Purpose**: Optimized review data for paginated lists
- **Use**: Efficient list rendering
- **Functions**:
  - `days_ago` - Days since review was posted

### **ReviewSummary**
- **Purpose**: Aggregated review statistics for a hostel
- **Use**: Hostel overview pages
- **Functions**:
  - `positive_review_percentage` - Percentage of 4-5 star reviews
  - `rating_quality_score` - Qualitative rating description (excellent/good/poor)

---

## 3. review_submission.py

### **DetailedRatingsInput**
- **Purpose**: Input structure for aspect ratings during submission
- **Use**: Review submission form
- **Functions**:
  - `average_rating` - Calculates average of all provided ratings

### **ReviewSubmissionRequest**
- **Purpose**: Complete review submission payload
- **Use**: Primary review creation endpoint
- **Functions**:
  - `round_to_half()` - Rounds ratings
  - `validate_title()` - Title validation
  - `validate_review_text()` - Content validation
  - `must_agree()` - Ensures guidelines agreement
  - `validate_feedback_items()` - Validates pros/cons lists
  - `validate_dates()` - Check-in/out date validation
  - `validate_rating_consistency()` - Rating alignment check

### **VerifiedReview**
- **Purpose**: Marks reviews as verified stays
- **Use**: Trust indicators and verification tracking
- **Fields**: Verification method, confidence score, verification details

### **ReviewGuidelines**
- **Purpose**: Review writing guidelines and rules
- **Use**: Help users write better reviews
- **Fields**: Guidelines, prohibited content, tips, requirements

### **ReviewEligibility**
- **Purpose**: Checks if user can review a hostel
- **Use**: Pre-submission validation
- **Fields**: Stay verification, existing reviews, edit permissions

### **ReviewDraft**
- **Purpose**: Saved incomplete reviews
- **Use**: Allow users to save and continue later
- **Functions**:
  - `completion_percentage` - Estimates how complete the draft is
  - `is_expired` - Checks if draft has expired

---

## 4. review_moderation.py

### **ModerationRequest**
- **Purpose**: Request to moderate a review
- **Use**: Admin moderation actions
- **Functions**:
  - `normalize_action()` - Normalizes action strings
  - `validate_action_requirements()` - Ensures required fields for specific actions

### **FlagReview**
- **Purpose**: User-reported problematic review
- **Use**: Community-driven moderation
- **Functions**:
  - `normalize_flag_reason()` - Normalizes flag reasons

### **ModerationResponse**
- **Purpose**: Result of moderation action
- **Use**: Feedback after moderation
- **Fields**: Action taken, moderator info, notification status

### **PendingReview**
- **Purpose**: Review awaiting moderation
- **Use**: Moderation queue display
- **Fields**: Review content, AI scores, flagging info, priority indicators

### **ModerationQueue**
- **Purpose**: Overview of pending reviews
- **Use**: Moderation dashboard
- **Fields**: Queue statistics, pending items, wait times

### **ApprovalWorkflow**
- **Purpose**: Complete moderation lifecycle tracking
- **Use**: Review status tracking
- **Fields**: Workflow status, timeline, moderator info, auto-moderation data

### **BulkModeration**
- **Purpose**: Process multiple reviews at once
- **Use**: Efficient moderation operations
- **Functions**:
  - `validate_review_ids()` - Validates ID list and removes duplicates
  - `normalize_action()` - Normalizes action strings

### **ModerationStats**
- **Purpose**: Moderation performance metrics
- **Use**: Analytics and reporting
- **Functions**:
  - `validate_period()` - Ensures valid date range

---

## 5. review_voting.py

### **VoteRequest**
- **Purpose**: Submit helpful/not helpful vote
- **Use**: Review engagement endpoints
- **Fields**: Review ID, voter, vote type, optional feedback

### **VoteResponse**
- **Purpose**: Result of vote submission
- **Use**: Updated vote counts after voting
- **Functions**:
  - `total_votes` - Total votes on review
  - `helpfulness_percentage` - Percentage of helpful votes

### **HelpfulnessScore**
- **Purpose**: Sophisticated review ranking using Wilson score
- **Use**: Statistically sound review ordering
- **Functions**:
  - `calculate_wilson_score()` - Calculates Wilson confidence interval score

### **VoteHistoryItem**
- **Purpose**: Individual vote in user's history
- **Use**: Vote tracking
- **Functions**:
  - `days_ago` - Days since vote was cast

### **VoteHistory**
- **Purpose**: Complete user voting history
- **Use**: User engagement tracking
- **Functions**:
  - `helpful_vote_percentage` - User's helpful vote ratio
  - `voting_tendency` - Categorizes user as positive/balanced/critical

### **RemoveVote**
- **Purpose**: Remove previously cast vote
- **Use**: Allow users to change their mind
- **Fields**: Review ID, voter, optional reason

### **VotingStats**
- **Purpose**: Voting statistics for hostel reviews
- **Use**: Engagement analytics
- **Functions**:
  - `engagement_rate` - Percentage of reviews with votes
  - `overall_sentiment` - Categorizes voting sentiment

---

## 6. review_response_schema.py

### **HostelResponseCreate**
- **Purpose**: Create hostel response to review
- **Use**: Management reply endpoint
- **Functions**:
  - `validate_response_text()` - Validates response content and checks for placeholders

### **HostelResponseUpdate**
- **Purpose**: Edit existing hostel response
- **Use**: Response editing with history tracking
- **Functions**:
  - `validate_response_text()` - Content validation

### **OwnerResponse**
- **Purpose**: Complete hostel response display
- **Use**: Show management replies
- **Functions**:
  - `response_age_days` - Days since response was posted

### **ResponseGuidelines**
- **Purpose**: Guidelines for writing hostel responses
- **Use**: Help staff write professional responses
- **Fields**: Guidelines, best practices, templates info, length limits

### **ResponseStats**
- **Purpose**: Hostel response performance metrics
- **Use**: Response rate analytics
- **Functions**:
  - `negative_review_response_rate` - Response rate for 1-2 star reviews
  - `response_health` - Categorizes response performance

### **ResponseTemplate**
- **Purpose**: Pre-approved response templates
- **Use**: Quick professional responses
- **Functions**:
  - `normalize_category()` - Normalizes template categories

---

## 7. review_filters.py

### **ReviewFilterParams**
- **Purpose**: Comprehensive review filtering
- **Use**: Search and filter reviews
- **Functions**:
  - `validate_hostel_ids()` - Validates hostel ID lists
  - `validate_rating_range()` - Ensures valid rating ranges
  - `validate_date_range()` - Ensures valid date ranges

### **ReviewSearchRequest**
- **Purpose**: Full-text search in reviews
- **Use**: Review search functionality
- **Functions**:
  - `validate_query()` - Validates search query
  - `validate_search_scope()` - Ensures at least one search scope

### **ReviewSortOptions**
- **Purpose**: Review sorting strategies
- **Use**: Review list ordering
- **Functions**:
  - `normalize_sort_by()` - Normalizes sort options

### **ReviewExportRequest**
- **Purpose**: Export reviews to various formats
- **Use**: Data export functionality
- **Functions**:
  - `normalize_format()` - Normalizes export format
  - `validate_date_range()` - Validates export date range

---

## 8. review_analytics.py

### **MonthlyRating**
- **Purpose**: Monthly rating aggregation
- **Use**: Trend analysis
- **Functions**:
  - `round_to_half()` - Rounds ratings to 0.5

### **RatingDistribution**
- **Purpose**: Rating spread analysis (1-5 stars)
- **Use**: Rating breakdown visualization
- **Functions**:
  - `total_reviews` - Total review count
  - `recommendation_score` - Percentage of positive reviews

### **TrendAnalysis**
- **Purpose**: Rating trends over time
- **Use**: Performance tracking
- **Functions**:
  - `normalize_trend()` - Normalizes trend directions
  - `calculate_trend()` - Determines trend direction from ratings

### **SentimentAnalysis**
- **Purpose**: AI-powered sentiment analysis
- **Use**: Content analysis insights
- **Functions**:
  - `normalize_sentiment()` - Normalizes sentiment values
  - `total_analyzed` - Total reviews analyzed
  - `positive_percentage` - Percentage of positive sentiment

### **AspectAnalysis**
- **Purpose**: Analysis of specific aspects (cleanliness, food, etc.)
- **Use**: Granular performance insights
- **Functions**:
  - `validate_rating_keys()` - Validates rating distribution keys
  - `sentiment_ratio` - Positive to total mentions ratio

### **CompetitorComparison**
- **Purpose**: Benchmarking against competitors
- **Use**: Competitive analysis
- **Functions**:
  - `competitive_position` - Categorizes market position
  - `is_outperforming` - Checks if ahead of competition

### **ReviewAnalytics**
- **Purpose**: Comprehensive analytics aggregation
- **Use**: Complete analytics dashboard
- **Functions**:
  - `validate_aspect_ratings()` - Validates aspect rating ranges
  - `quality_score` - Composite quality score (0-100)
  - `health_indicator` - Overall review health status

---

## 9. __init__.py

### **Purpose**: Package initialization and exports
### **Use**: Centralized imports for the review schema package
### **Contents**: Imports and exports all classes from the review module files

---

## **Summary of Main Use Cases**

1. **Review Lifecycle**: Create → Submit → Moderate → Publish → Respond
2. **User Engagement**: Vote on helpfulness, save drafts, track history
3. **Management Tools**: Moderation queue, bulk actions, response templates
4. **Analytics**: Trends, sentiment analysis, competitive benchmarking
5. **Data Management**: Filtering, searching, exporting, verification

Each schema serves a specific part of this comprehensive review management system.


================================================================================================================================================

# Complete Room Schema Classes Breakdown

## 1. bed_base.py

### **BedBase**
- **Purpose**: Foundation schema for individual bed/berth management
- **Use**: Base class for bed operations within rooms
- **Functions**:
  - `validate_bed_number()` - Validates and normalizes bed identifiers
- **Fields**: Room ID, bed number, status

### **BedCreate** 
- **Purpose**: Schema for creating a single bed
- **Use**: Manual bed addition to rooms
- **Extends**: BedBase + BaseCreateSchema
- **Fields**: Required room ID, bed number

### **BedUpdate**
- **Purpose**: Schema for updating bed information  
- **Use**: Partial bed updates (status, notes, etc.)
- **Functions**:
  - `validate_bed_number()` - Bed number format validation
  - `sync_status_with_occupancy()` - Maintains backward compatibility between occupancy flag and status
- **Extends**: BaseUpdateSchema

### **BulkBedCreate**
- **Purpose**: Bulk bed creation with sequential numbering
- **Use**: Initial room setup or adding multiple beds
- **Functions**:
  - `validate_bed_prefix()` - Validates bed naming prefix
  - `validate_number_format()` - Validates format string for bed numbers
  - `generate_bed_numbers()` - Creates list of bed numbers based on configuration
- **Fields**: Room ID, bed count, prefix, numbering format

### **BedAssignmentRequest**
- **Purpose**: Assign bed to a student
- **Use**: Bed allocation with date tracking
- **Functions**:
  - `validate_occupied_from()` - Validates occupancy start date
  - `validate_date_range()` - Ensures checkout date is after check-in
- **Fields**: Bed ID, student ID, dates, booking reference

### **BedReleaseRequest**
- **Purpose**: Release/checkout bed from student
- **Use**: Bed vacation with documentation
- **Functions**:
  - `validate_release_date()` - Validates release date
- **Fields**: Bed ID, student ID, release date, reason, condition notes

### **BedSwapRequest**
- **Purpose**: Swap beds between students
- **Use**: Student bed exchanges
- **Functions**:
  - `validate_swap_date()` - Validates swap date timing
  - `validate_different_students_and_beds()` - Ensures different students and beds
- **Fields**: Student IDs, bed IDs, swap date, approval info

### **BulkBedStatusUpdate**
- **Purpose**: Update status of multiple beds simultaneously
- **Use**: Maintenance or availability batch updates
- **Functions**:
  - `validate_unique_bed_ids()` - Ensures unique bed ID list
  - `validate_status_change()` - Validates status change requirements
- **Fields**: Bed ID list, new status, reason

---

## 2. bed_response.py

### **BedResponse**
- **Purpose**: Standard bed response for API calls
- **Use**: Basic bed information display
- **Functions**:
  - `is_available` - Checks if bed is available for assignment
- **Fields**: Room ID, bed number, occupancy status, current student

### **BedAvailability**
- **Purpose**: Detailed bed availability for booking purposes
- **Use**: Booking systems and availability checks
- **Functions**:
  - `days_until_available` - Calculates days until bed becomes available
- **Fields**: Bed info, availability dates, current occupant, room pricing

### **BedAssignment**
- **Purpose**: Complete bed assignment details
- **Use**: Assignment tracking and management
- **Functions**:
  - `days_occupied` - Calculates days of current occupancy
  - `expected_duration_days` - Expected total duration
- **Fields**: Student info, assignment dates, pricing, booking reference

### **BedAssignmentHistory**
- **Purpose**: Individual assignment history record
- **Use**: Historical tracking of bed assignments
- **Functions**:
  - `duration_months` - Converts days to months for display
- **Fields**: Assignment details, dates, duration, rent information

### **BedHistory**
- **Purpose**: Complete bed occupancy timeline
- **Use**: Historical analysis and reporting
- **Functions**:
  - `utilization_rate` - Calculates percentage of time bed was occupied
- **Fields**: Assignment list, occupancy statistics, average stay duration

### **BedDetailedStatus**
- **Purpose**: Comprehensive bed status with maintenance info
- **Use**: Maintenance tracking and condition monitoring
- **Functions**:
  - `needs_maintenance` - Determines if bed requires maintenance
  - `current_occupancy_days` - Days of current occupancy
- **Fields**: Status, occupant info, maintenance records, condition ratings

---

## 3. room_availability.py

### **RoomAvailabilityRequest**
- **Purpose**: Request to check room availability
- **Use**: Availability inquiry with date validation
- **Functions**:
  - `validate_check_in_date()` - Validates check-in date range
  - `check_out_date` - Calculates checkout date based on duration
- **Fields**: Hostel ID, dates, duration, preferences, filters

### **AvailableRoom**
- **Purpose**: Available room details for booking
- **Use**: Booking results with comprehensive room info
- **Functions**:
  - `occupancy_rate` - Current room occupancy percentage
- **Fields**: Room specs, availability, pricing tiers, amenities

### **AvailabilityResponse**
- **Purpose**: Complete availability results
- **Use**: Availability search results with metadata
- **Functions**:
  - `total_rooms_available` - Count of available rooms
  - `price_range` - Min/max/average pricing across results
- **Fields**: Available rooms list, filters applied, total availability

### **BookingInfo**
- **Purpose**: Brief booking details for calendar view
- **Use**: Calendar display and booking overview
- **Fields**: Booking ID, student info, dates, bed assignment

### **DayAvailability**
- **Purpose**: Availability for a specific day
- **Use**: Day-level availability tracking
- **Functions**:
  - `occupancy_percentage` - Daily occupancy rate
- **Fields**: Date, bed counts, bookings list, special notes

### **AvailabilityCalendar**
- **Purpose**: Month-view availability calendar
- **Use**: Calendar-based availability display
- **Functions**:
  - `validate_month_format()` - Validates month format and range
  - `average_occupancy` - Monthly average occupancy
  - `fully_booked_days` - Count of days with no availability
- **Fields**: Room info, month, daily availability mapping

### **BulkAvailabilityRequest**
- **Purpose**: Check availability across multiple hostels
- **Use**: Batch availability checking for comparison
- **Functions**:
  - `validate_unique_hostel_ids()` - Ensures unique hostel list
  - `validate_check_in_date()` - Date validation
- **Fields**: Hostel ID list, dates, requirements

---

## 4. room_base.py

### **RoomBase**
- **Purpose**: Foundation schema with comprehensive room attributes
- **Use**: Base class for all room operations
- **Functions**:
  - `validate_room_number()` - Normalizes room number format
  - `validate_wing()` - Validates wing/block designation
  - `validate_and_clean_lists()` - Cleans amenities and furnishing lists
  - `validate_room_images()` - Validates image URL list
  - `validate_pricing_consistency()` - Ensures logical pricing tiers
  - `validate_room_type_beds()` - Checks bed count matches room type
- **Fields**: Location, capacity, pricing, specifications, amenities

### **RoomCreate**
- **Purpose**: Schema for creating new rooms
- **Use**: Room creation with required fields validation
- **Extends**: RoomBase + BaseCreateSchema
- **Fields**: All required room attributes

### **RoomUpdate**
- **Purpose**: Schema for updating room information
- **Use**: Partial room updates with validation
- **Functions**: Same validation as RoomBase but for optional fields
- **Extends**: BaseUpdateSchema

### **BulkRoomCreate**
- **Purpose**: Bulk room creation in single operation
- **Use**: Initial hostel setup or batch room creation
- **Functions**:
  - `validate_unique_room_numbers()` - Prevents duplicate room numbers
  - `validate_consistent_hostel()` - Ensures all rooms belong to same hostel
- **Fields**: Hostel ID, room list (max 100)

### **RoomPricingUpdate**
- **Purpose**: Dedicated room pricing updates
- **Use**: Price changes with consistency validation
- **Functions**:
  - `validate_pricing_logic()` - Ensures pricing consistency
  - `validate_effective_date()` - Validates pricing effective date
- **Fields**: Pricing tiers, effective date

### **RoomStatusUpdate**
- **Purpose**: Room operational status management
- **Use**: Status changes with maintenance tracking
- **Functions**:
  - `validate_maintenance_requirements()` - Ensures proper maintenance documentation
  - `validate_maintenance_dates()` - Validates maintenance date range
- **Fields**: Status, availability, maintenance details

### **RoomMediaUpdate**
- **Purpose**: Room media/image management
- **Use**: Photo and virtual tour updates
- **Functions**:
  - `validate_room_images()` - Validates image URLs
  - `validate_primary_image()` - Ensures primary image is in collection
  - `validate_virtual_tour_url()` - Validates tour URL format
- **Fields**: Image URLs, primary image, virtual tour

---

## 5. room_response.py

### **RoomResponse**
- **Purpose**: Standard room response for API calls
- **Use**: Basic room information display
- **Functions**:
  - `occupancy_percentage` - Current occupancy rate
- **Fields**: Basic room info, capacity, pricing, status

### **BedDetail**
- **Purpose**: Detailed bed information within room context
- **Use**: Room-level bed management
- **Fields**: Bed status, occupant info, maintenance dates

### **RoomDetail**
- **Purpose**: Comprehensive room information
- **Use**: Complete room display with all specifications
- **Functions**:
  - `occupancy_percentage` - Current occupancy rate
  - `is_fully_occupied` - Checks if room is at capacity
  - `discount_percentage_quarterly` - Quarterly pricing discount
  - `discount_percentage_yearly` - Yearly pricing discount
- **Fields**: Complete room specs, pricing, amenities, beds, media

### **RoomListItem**
- **Purpose**: Minimal room info for list views
- **Use**: Efficient list rendering and pagination
- **Functions**:
  - `occupancy_percentage` - Quick occupancy calculation
- **Fields**: Essential room details for lists

### **BedInfo**
- **Purpose**: Brief bed information for room overview
- **Use**: Quick bed status display
- **Fields**: Bed ID, number, status, occupant name

### **RoomWithBeds**
- **Purpose**: Room overview with bed-level details
- **Use**: Room management with bed breakdown
- **Functions**:
  - `occupancy_rate` - Room occupancy percentage
- **Fields**: Room basics with detailed bed list

### **RoomOccupancyStats**
- **Purpose**: Room occupancy statistics and metrics
- **Use**: Occupancy analytics and revenue tracking
- **Functions**:
  - `occupancy_percentage` - Current occupancy rate
  - `revenue_percentage` - Revenue realization rate
  - `lost_revenue` - Revenue lost due to vacancy
- **Fields**: Capacity metrics, revenue data, status

### **RoomFinancialSummary**
- **Purpose**: Detailed room financial metrics
- **Use**: Financial analysis and reporting
- **Functions**:
  - `collection_rate` - Payment collection percentage
  - `occupancy_rate` - Current occupancy rate
- **Fields**: Revenue breakdown, collections, projections, historical data

---

## 6. __init__.py

### **Purpose**: Package initialization and exports
### **Use**: Centralized imports for the room schema package
### **Contents**: Imports and exports all classes from room module files

---

## **Summary of Main Use Cases**

1. **Room Management**: Create → Update → Status Changes → Media Management
2. **Bed Operations**: Create → Assign → Release → Swap → Bulk Updates
3. **Availability**: Check → Calendar View → Bulk Requests → Booking Info
4. **Analytics**: Occupancy Stats → Financial Summary → Historical Analysis
5. **Responses**: List Views → Detail Views → Availability Results

### **Key Function Categories**

**Validation Functions:**
- Format validation (room numbers, URLs, dates)
- Business logic validation (pricing consistency, date ranges)
- Data consistency (occupancy alignment, maintenance requirements)

**Computed Properties:**
- Occupancy calculations
- Revenue metrics
- Discount percentages
- Utilization rates

**Utility Functions:**
- Data normalization
- List cleaning (removing duplicates, empty values)
- Date calculations
- Status checks

Each schema serves a specific part of the comprehensive room and bed management system, from basic CRUD operations to complex availability checking and financial analysis.

================================================================================================================================================
# Complete Search Schema Classes Breakdown

## 1. search_analytics.py

### **SearchTermStats**
- **Purpose**: Detailed statistics for a single search term
- **Use**: Track usage patterns and result quality for search optimization
- **Fields**: Term, search count, unique users, result quality metrics, engagement metrics, temporal data, trend indicators

### **SearchMetrics**
- **Purpose**: Aggregated search performance metrics
- **Use**: Overview of search system health and performance
- **Fields**: Volume metrics, quality metrics, performance metrics, engagement metrics

### **PopularSearchTerm**
- **Purpose**: Popular search term with ranking information
- **Use**: Display trending/popular searches to users
- **Fields**: Rank, term, search count, result count, change from previous period

### **TrendingSearch**
- **Purpose**: Trending search term (rapidly growing in popularity)
- **Use**: Identify emerging search patterns and user interests
- **Fields**: Term, current/previous counts, growth rate, velocity score

### **ZeroResultTerm**
- **Purpose**: Search term that consistently returns zero results
- **Use**: Critical for search optimization and content gap analysis
- **Fields**: Term, search count, unique users, timestamps, suggested alternatives

### **SearchAnalyticsRequest**
- **Purpose**: Request parameters for search analytics
- **Use**: Filter analytics by date range and other criteria
- **Functions**:
  - `validate_date_range()` - Validates date range is reasonable (max 365 days)
- **Fields**: Date range filter, minimum search count, limits for different analytics

### **SearchAnalytics**
- **Purpose**: Comprehensive search analytics response
- **Use**: Detailed insights into search behavior and performance
- **Functions**:
  - `has_quality_issues` - Checks if zero-result rate is high or response times slow
  - `engagement_score` - Calculates overall engagement score (0-100) based on CTR and quality
- **Fields**: Period info, metrics, top/trending searches, zero-result searches, breakdowns

---

## 2. search_autocomplete.py

### **SuggestionType (Enum)**
- **Purpose**: Type classification for autocomplete suggestions
- **Use**: Categorize and display suggestions appropriately
- **Values**: HOSTEL, CITY, AREA, LANDMARK, AMENITY, POPULAR_SEARCH

### **AutocompleteRequest**
- **Purpose**: Autocomplete request for search suggestions
- **Use**: Real-time typeahead functionality
- **Functions**:
  - `normalize_prefix()` - Normalizes search prefix (lowercase, trim)
  - `validate_type_lists()` - Removes duplicates from type filter lists
- **Fields**: Prefix, suggestion type filter, limit, user coordinates, include/exclude types

### **Suggestion**
- **Purpose**: Single autocomplete suggestion with rich metadata
- **Use**: Display formatted suggestions with context
- **Fields**: Value, label, type, score, result count, icon, thumbnail, metadata, highlighting

### **AutocompleteResponse**
- **Purpose**: Autocomplete response with grouped suggestions
- **Use**: Organized suggestion display for better UX
- **Functions**:
  - `create_grouped()` - Creates response with automatic grouping by suggestion type
- **Fields**: Suggestions list, grouped suggestions, metadata, popular searches

---

## 3. search_filters.py

### **PriceFilter**
- **Purpose**: Price range filter with validation
- **Use**: Filter search results by price range
- **Functions**:
  - `validate_price_range()` - Ensures min_price ≤ max_price
  - `is_active` - Checks if price filter is applied
- **Fields**: min_price, max_price (Decimal with precision constraints)

### **RatingFilter**
- **Purpose**: Rating range filter with validation
- **Use**: Filter by average rating (0-5 scale)
- **Functions**:
  - `validate_rating_range()` - Ensures min_rating ≤ max_rating
  - `is_active` - Checks if rating filter is applied
- **Fields**: min_rating, max_rating (0-5 scale)

### **AmenityFilter**
- **Purpose**: Amenity filter with AND/OR logic support
- **Use**: Filter by required, optional, or excluded amenities
- **Functions**:
  - `normalize_amenities()` - Normalizes amenity lists (lowercase, deduplicate)
  - `is_active` - Checks if amenity filter is applied
- **Fields**: required_amenities (AND logic), optional_amenities (OR logic), excluded_amenities

### **LocationFilter**
- **Purpose**: Location-based filter supporting text and proximity search
- **Use**: Filter by city/state/pincode or lat/lon + radius
- **Functions**:
  - `normalize_location()` - Normalizes location strings to title case
  - `validate_proximity_requirements()` - Ensures radius requires both lat/lon
  - `is_text_location` - Checks if text-based location filter is active
  - `is_proximity_location` - Checks if coordinate-based location filter is active
  - `is_active` - Checks if any location filter is active
- **Fields**: City, state, pincode, coordinates, radius

### **AvailabilityFilter**
- **Purpose**: Availability and booking requirement filters
- **Use**: Filter by bed availability and booking preferences
- **Functions**:
  - `validate_date_range()` - Validates check-in/out date logic
  - `is_active` - Checks if availability filter is applied
- **Fields**: Available beds requirements, dates, instant booking, verification status

### **SearchFilterSet**
- **Purpose**: Composite filter combining all filter types
- **Use**: Apply multiple filters together in single request
- **Functions**:
  - `active_filters` - Gets list of currently active filter names
  - `filter_count` - Counts number of active filters
  - `has_filters` - Checks if any filter is active
- **Fields**: All filter type instances, hostel types, room types

---

## 4. search_request.py

### **BasicSearchRequest**
- **Purpose**: Simple keyword-based search request
- **Use**: Quick searches with minimal parameters
- **Functions**:
  - `validate_and_normalize_query()` - Normalizes search query (trim, deduplicate spaces)
- **Fields**: Query string, result limit

### **AdvancedSearchRequest**
- **Purpose**: Advanced search with comprehensive filtering options
- **Use**: Complete search functionality with all available filters
- **Functions**:
  - `normalize_query()` - Normalizes search query
  - `normalize_location()` - Normalizes location strings
  - `normalize_amenities()` - Normalizes amenity lists
  - `validate_location_consistency()` - Validates location-related fields consistency
  - `has_location_filter` - Checks if any location filter is applied
  - `has_price_filter` - Checks if price filter is applied
  - `offset` - Calculates database query offset for pagination
- **Fields**: All search parameters (query, location, pricing, amenities, sorting, pagination)

### **NearbySearchRequest**
- **Purpose**: Proximity-based "near me" search request
- **Use**: Location-based discovery and nearby searches
- **Functions**:
  - `validate_price_range()` - Validates price range consistency
- **Fields**: Required coordinates, radius, optional filters, limit

### **SavedSearchCreate**
- **Purpose**: Create saved search for user
- **Use**: Save frequently used search criteria with optional alerts
- **Functions**:
  - `normalize_name()` - Normalizes search name
  - `validate_alert_settings()` - Validates alert configuration consistency
- **Fields**: Name, search criteria (serialized), alert settings

### **SavedSearchUpdate**
- **Purpose**: Update existing saved search configuration
- **Use**: Modify saved search parameters and alert settings
- **Functions**:
  - `normalize_name()` - Normalizes updated search name
- **Fields**: All updateable saved search fields (optional)

### **SavedSearchResponse**
- **Purpose**: Saved search response schema
- **Use**: Return saved search data to clients
- **Fields**: User ID, name, criteria, alert settings, execution metadata

### **SearchHistoryResponse**
- **Purpose**: Search history entry response
- **Use**: Track user search patterns and analytics
- **Fields**: User ID, query, criteria, result count, performance metrics, clicked results

---

## 5. search_response.py

### **SearchResultItem**
- **Purpose**: Individual search result with hostel data and search metadata
- **Use**: Display search results with relevance and availability info
- **Functions**:
  - `occupancy_rate` - Calculates current occupancy rate as percentage
  - `has_availability` - Checks if hostel has available beds
- **Fields**: Hostel info, pricing, ratings, availability, search metadata (relevance, distance)

### **SearchMetadata**
- **Purpose**: Search execution metadata and diagnostics
- **Use**: Provide insights into search performance and pagination
- **Functions**:
  - `has_next_page` - Checks if more pages are available
  - `has_previous_page` - Checks if previous pages exist
- **Fields**: Result counts, pagination info, performance metrics, applied filters

### **FacetBucket**
- **Purpose**: Single facet value with result count
- **Use**: Display available filter options in faceted search UI
- **Fields**: Value, label, count, selection status, metadata

### **SearchSuggestion**
- **Purpose**: Search query suggestion for result refinement
- **Use**: Help users refine searches when results are poor
- **Fields**: Suggestion type, text, reason, expected result count

### **FacetedSearchResponse**
- **Purpose**: Complete faceted search response with results and filters
- **Use**: Full-featured search results with filtering options
- **Functions**:
  - `is_empty` - Checks if search returned no results
  - `facet_names` - Gets list of available facet categories
- **Fields**: Results, metadata, facets (organized by category), suggestions

---

## 6. search_sort.py

### **SearchSortField (Enum)**
- **Purpose**: Type-safe sort field options for search results
- **Use**: Ensure valid sort criteria in search requests
- **Values**: RELEVANCE, PRICE_LOW_TO_HIGH, PRICE_HIGH_TO_LOW, RATING_HIGH_TO_LOW, DISTANCE_NEAR_TO_FAR, NEWEST_FIRST, POPULAR, AVAILABILITY

### **SearchSortOrder (Enum)**
- **Purpose**: Sort direction specification
- **Values**: ASCENDING, DESCENDING

### **SortCriteria**
- **Purpose**: Sort criteria with primary and secondary sort options
- **Use**: Flexible sorting with tie-breaking capabilities
- **Functions**:
  - `validate_sort_field()` - Validates sort field appropriateness
  - `effective_sort_order` - Gets effective sort order (some fields have implicit direction)
  - `to_db_sort()` - Converts to database sort parameters (field_name, direction)
- **Fields**: Primary sort field/order, optional secondary sort field/order

---

## 7. __init__.py

### **Purpose**: Package initialization and exports
### **Use**: Centralized imports for the search schema package
### **Contents**: Imports and exports all classes from search module files

---

## **Summary of Main Use Cases**

1. **Search Operations**: Basic → Advanced → Nearby → Saved Searches
2. **Result Processing**: Results → Metadata → Facets → Suggestions
3. **User Experience**: Autocomplete → Filtering → Sorting → Pagination
4. **Analytics**: Search tracking → Performance metrics → Popular terms → Zero-result analysis
5. **Personalization**: Saved searches → Alert preferences → Search history

### **Key Function Categories**

**Validation Functions:**
- Query normalization and sanitization
- Date range validation (check-in/out dates)
- Price range consistency (min ≤ max)
- Location requirements (radius needs coordinates)
- Filter combinations validation

**Computed Properties:**
- Filter activity status (is_active)
- Search metadata (pagination, result counts)
- Engagement metrics (scores, rates)
- Result quality indicators

**Utility Functions:**
- Data normalization (amenities, locations)
- Pagination calculations (offset)
- Sort criteria conversion to database format
- Grouped response creation

**Analytics Functions:**
- Trend analysis and growth calculations
- Quality issue detection
- Engagement score computation
- Search pattern identification

Each schema serves a specific part of the comprehensive search system, from basic keyword search to advanced analytics and user experience optimization. The system supports real-time autocomplete, faceted filtering, personalized saved searches, and detailed performance analytics.

================================================================================================================================================
# Complete Subscription Schema Classes Breakdown

## 1. commission.py

### **CommissionStatus (Enum)**
- **Purpose**: Commission payment status enumeration
- **Use**: Track commission payment lifecycle
- **Values**: PENDING, CALCULATED, INVOICED, PAID, WAIVED, DISPUTED

### **CommissionConfig**
- **Purpose**: Global/platform commission configuration
- **Use**: Define default commission rates and per-plan overrides
- **Functions**:
  - `validate_plan_commissions()` - Validates plan commission percentages (0-100%)
  - `validate_min_max_range()` - Ensures min ≤ default ≤ max commission rates
  - `get_commission_for_plan()` - Gets commission percentage for specific plan type
- **Fields**: Default/min/max percentages, per-plan commission mapping

### **BookingCommissionResponse**
- **Purpose**: Commission record for a specific booking
- **Use**: Track platform commission owed for individual bookings
- **Functions**:
  - `validate_payment_dates()` - Validates paid_date is set only when status is PAID
- **Fields**: Booking reference, amounts, percentages, payment status, dates

### **CommissionSummary**
- **Purpose**: Commission summary for platform or hostel
- **Use**: Aggregate commission data for reporting and reconciliation
- **Functions**:
  - `validate_scope_and_dates()` - Validates scope requirements and date ranges
  - `commission_collection_rate` - Calculates commission collection rate percentage
- **Fields**: Scope type, period, booking counts, commission totals

---

## 2. subscription_base.py

### **SubscriptionBase**
- **Purpose**: Foundation schema with core subscription fields
- **Use**: Base class for subscription operations
- **Functions**:
  - `validate_dates()` - Validates subscription date relationships
  - `normalize_reference()` - Normalizes subscription reference to uppercase
- **Fields**: Hostel/plan IDs, reference, billing cycle, amount, dates, auto-renewal, status

### **SubscriptionCreate**
- **Purpose**: Create new hostel subscription
- **Use**: Subscription creation with trial period support
- **Functions**:
  - `validate_create_dates()` - Validates all date relationships for creation
  - `normalize_reference()` - Normalizes subscription reference
- **Fields**: All base subscription fields plus trial_end_date
- **Extends**: BaseCreateSchema

### **SubscriptionUpdate**
- **Purpose**: Update existing subscription
- **Use**: Partial subscription updates (status, dates, renewal settings)
- **Functions**:
  - `validate_update_consistency()` - Validates update field consistency (cancelled/expired subscriptions can't auto-renew)
- **Fields**: Optional updates for status, dates, amount, billing cycle
- **Extends**: BaseUpdateSchema

---

## 3. subscription_billing.py

### **InvoiceStatus (Enum)**
- **Purpose**: Invoice status enumeration
- **Values**: DRAFT, ISSUED, SENT, PAID, PARTIALLY_PAID, OVERDUE, CANCELLED, REFUNDED

### **BillingCycleInfo**
- **Purpose**: Information about current billing cycle
- **Use**: Comprehensive view of current billing period
- **Functions**:
  - `validate_cycle_dates()` - Validates billing cycle date relationships
- **Fields**: Subscription info, cycle dates, amounts, renewal info, trial status

### **GenerateInvoiceRequest**
- **Purpose**: Request to generate invoice for subscription cycle
- **Use**: Invoice generation with optional overrides and discounts
- **Functions**:
  - `validate_discount()` - Validates discount amount requires reason
- **Fields**: Subscription ID, billing date, amount/date overrides, discount info

### **InvoiceInfo**
- **Purpose**: Generated invoice information
- **Use**: Complete invoice details including status and access URLs
- **Functions**:
  - `validate_invoice_dates_and_amounts()` - Validates date relationships and amount calculations
  - `is_overdue` - Checks if invoice is overdue based on current date
  - `is_fully_paid` - Checks if invoice is fully paid
- **Fields**: Invoice details, amounts, status, URLs, payment info

---

## 4. subscription_cancellation.py

### **CancellationRequest**
- **Purpose**: Request to cancel a subscription
- **Use**: Cancel subscriptions with reason tracking (immediate or end-of-term)
- **Functions**:
  - `validate_cancellation_reason()` - Validates reason contains at least 3 words
- **Fields**: Subscription/hostel IDs, reason, category, immediate flag, feedback

### **CancellationPreview**
- **Purpose**: Preview of cancellation impact
- **Use**: Show cancellation consequences before confirming
- **Fields**: Subscription info, effective dates, refund calculations, warnings, access impact

### **CancellationResponse**
- **Purpose**: Cancellation confirmation response
- **Use**: Confirm cancellation was processed with all relevant details
- **Functions**:
  - `validate_refund_fields()` - Validates refund fields consistency
- **Fields**: Cancellation confirmation, refund info, reactivation eligibility

---

## 5. subscription_plan_base.py

### **PlanFeatureConfig**
- **Purpose**: Configuration for a single plan feature
- **Use**: Structured feature definition with value and enablement
- **Fields**: Key, label, value, enabled status, description

### **SubscriptionPlanBase**
- **Purpose**: Foundation subscription plan schema
- **Use**: Define subscription plans with pricing, features, and limits
- **Functions**:
  - `validate_pricing()` - Validates yearly price ≤ 12x monthly price
  - `normalize_plan_name()` - Normalizes plan name to lowercase
  - `yearly_savings` - Calculates yearly savings vs monthly billing
  - `yearly_discount_percent` - Calculates yearly discount percentage
- **Fields**: Plan identification, pricing, features, limits, status, trial config

### **PlanCreate**
- **Purpose**: Create new subscription plan
- **Use**: Plan creation with feature validation
- **Functions**:
  - `validate_features()` - Validates feature dictionary structure
- **Extends**: SubscriptionPlanBase + BaseCreateSchema

### **PlanUpdate**
- **Purpose**: Update subscription plan
- **Use**: Partial plan updates with pricing validation
- **Functions**:
  - `validate_pricing_update()` - Validates pricing updates if both monthly/yearly provided
- **Fields**: All plan fields as optional updates
- **Extends**: BaseUpdateSchema

---

## 6. subscription_plan_response.py

### **PlanResponse**
- **Purpose**: Complete subscription plan response
- **Use**: Return all plan details with computed properties
- **Functions**:
  - `price_monthly_formatted` - Formats monthly price with currency
  - `price_yearly_formatted` - Formats yearly price with currency  
  - `yearly_savings` - Calculates yearly savings vs monthly
  - `yearly_discount_percent` - Calculates yearly discount percentage
  - `has_trial` - Checks if plan offers trial
  - `limits_display` - Formats limits for display (shows "Unlimited" for null values)
- **Extends**: BaseResponseSchema

### **PlanSummary**
- **Purpose**: Condensed plan summary for listings
- **Use**: Essential plan info for cards and lists
- **Fields**: Key plan details without full feature set

### **PlanFeatures**
- **Purpose**: Human-friendly plan feature matrix
- **Use**: Format features for comparison tables and feature lists
- **Functions**:
  - `from_plan_response()` - Creates PlanFeatures from PlanResponse with feature labels
- **Fields**: Plan info, formatted features, feature categories, highlights

### **PlanComparison**
- **Purpose**: Compare multiple plans side by side
- **Use**: Structured comparison matrix for displaying multiple plans
- **Functions**:
  - `create()` - Creates comparison from list of plans with feature matrix
- **Fields**: Plans list, feature matrix, display order, recommendations

---

## 7. subscription_response.py

### **SubscriptionResponse**
- **Purpose**: Complete hostel subscription response
- **Use**: Return all subscription details with plan and billing info
- **Functions**:
  - `days_until_expiry` - Calculates days until subscription expires
  - `days_until_billing` - Calculates days until next billing
  - `is_active` - Checks if subscription is currently active
  - `is_expiring_soon` - Checks if subscription expires within 7 days
  - `amount_formatted` - Formats amount with currency and cycle
- **Fields**: Hostel info, plan details, billing info, dates, status, trial info
- **Extends**: BaseResponseSchema

### **SubscriptionSummary**
- **Purpose**: Condensed subscription summary for listings
- **Use**: Essential subscription info for dashboards and list views
- **Fields**: Basic subscription details for efficient display

### **BillingHistoryItem**
- **Purpose**: Single billing event in history
- **Use**: Represent one billing transaction with details
- **Functions**:
  - `is_paid` - Checks if billing item is paid
- **Fields**: Transaction details, amounts, status, invoice info, period covered

### **BillingHistory**
- **Purpose**: Complete subscription billing history
- **Use**: Aggregate all billing events with summary statistics
- **Functions**:
  - `validate_totals()` - Validates total calculations consistency
  - `has_outstanding` - Checks if there's outstanding balance
  - `payment_rate` - Calculates payment collection rate percentage
- **Fields**: Billing items list, summary totals, pagination info

---

## 8. subscription_upgrade.py

### **PlanChangeType (Enum)**
- **Purpose**: Type of plan change classification
- **Values**: UPGRADE, DOWNGRADE, LATERAL (same tier, different billing)

### **PlanChangeRequest**
- **Purpose**: Request to change subscription plan
- **Use**: Handle upgrades/downgrades/billing cycle changes with proration
- **Functions**:
  - `validate_plan_change()` - Validates plan change request (different plans, future effective date)
- **Fields**: Current/new plan IDs, timing, proration options, reason tracking

### **PlanChangePreview**
- **Purpose**: Preview cost impact of plan change
- **Use**: Show detailed financial impact before confirming change
- **Functions**:
  - `is_upgrade` - Checks if this is an upgrade
  - `is_downgrade` - Checks if this is a downgrade
  - `monthly_difference` - Calculates monthly price difference
  - `savings_or_increase` - Formats savings/increase message
- **Fields**: Plan info, pricing, proration calculations, final amounts, warnings/benefits

### **PlanChangeConfirmation**
- **Purpose**: Confirmation of completed plan change
- **Use**: Returned after successful plan change processing
- **Fields**: Change details, financial impact, new dates/amounts, confirmation info

---

## 9. __init__.py

### **Purpose**: Package initialization and exports
### **Use**: Centralized imports for the subscription schema package
### **Contents**: Imports and exports all classes from subscription module files

---

## **Summary of Main Use Cases**

1. **Plan Management**: Create → Define Features → Set Pricing → Update → Compare
2. **Subscription Lifecycle**: Create → Activate → Bill → Renew/Cancel → Track
3. **Billing Operations**: Generate Invoices → Track Payments → Calculate Commission
4. **Plan Changes**: Preview → Validate → Apply Proration → Confirm → Update
5. **Analytics**: Billing History → Commission Tracking → Summary Reports

### **Key Function Categories**

**Validation Functions:**
- Date relationship validation (start/end dates, billing periods)
- Pricing consistency (yearly ≤ 12x monthly)
- Amount calculations (invoices, prorations, commissions)
- Plan change logic (different plans, future effective dates)
- Status transitions (cancelled subscriptions can't auto-renew)

**Computed Properties:**
- Financial calculations (savings, discounts, collection rates)
- Date calculations (days until expiry/billing, age calculations)
- Status indicators (is_active, is_overdue, has_trial)
- Formatted display values (currency formatting, limit displays)

**Business Logic Functions:**
- Commission calculation for different plan types
- Proration calculations for plan changes
- Feature formatting for plan comparisons
- Billing cycle management
- Trial period handling

**Utility Functions:**
- Data normalization (plan names, references)
- Feature matrix creation for comparisons
- Status and health checking
- Financial reconciliation

### **Core Business Workflows**

**Subscription Creation:**
1. Select Plan (PlanResponse/PlanComparison)
2. Create Subscription (SubscriptionCreate)
3. Setup Billing (BillingCycleInfo)
4. Track Commission (CommissionConfig)

**Billing Cycle:**
1. Generate Invoice (GenerateInvoiceRequest)
2. Process Payment (InvoiceInfo)
3. Calculate Commission (BookingCommissionResponse)
4. Update History (BillingHistory)

**Plan Changes:**
1. Request Change (PlanChangeRequest)
2. Preview Impact (PlanChangePreview)
3. Apply Change (PlanChangeConfirmation)
4. Update Billing (BillingCycleInfo)

**Cancellation:**
1. Preview Impact (CancellationPreview)
2. Submit Request (CancellationRequest)
3. Process Cancellation (CancellationResponse)
4. Handle Refunds/Credits

Each schema serves a specific part of the comprehensive subscription management system, supporting everything from plan definition and comparison to billing, upgrades, and cancellations with detailed financial tracking and commission management.

================================================================================================================================================
# Complete Clarity on Student Schema Classes

## **File: student_base.py**

### 1. **StudentBase**
- **Purpose**: Base schema containing all common student attributes
- **Use**: Parent class for student creation and updates, contains shared fields
- **Key Features**:
  - User, hostel, room, bed assignments
  - Guardian information (mandatory)
  - ID proof details
  - Institutional info (college/course)
  - Employment info (company/designation)
  - Check-in/checkout dates
  - Financial fields (security deposit, rent)
  - Meal preferences
  - Status tracking
- **Validators**:
  - `validate_guardian_name()` - Ensures proper name format
  - `normalize_guardian_phone()` - Cleans phone numbers
  - `normalize_guardian_email()` - Lowercase email
  - `validate_id_proof_number()` - Uppercase and trim
  - `validate_checkout_dates()` - Ensures date logic is correct
  - `validate_notice_period()` - Notice period date validation
  - `validate_room_bed_consistency()` - Bed requires room assignment

### 2. **StudentCreate**
- **Purpose**: Schema for creating new student records
- **Use**: When converting booking to student OR direct student registration
- **Key Fields**:
  - All fields from StudentBase
  - `booking_id` - Links to source booking (optional)
  - `initial_rent_paid` - First month payment status
- **Required Fields**: user_id, hostel_id, guardian_name, guardian_phone

### 3. **StudentUpdate**
- **Purpose**: Schema for updating existing student information
- **Use**: Partial updates to student record (all fields optional)
- **Key Features**:
  - Can update any student field
  - Same validators as StudentBase
  - Supports partial updates

### 4. **StudentCheckInRequest**
- **Purpose**: Complete check-in operation for a student
- **Use**: When student physically arrives and checks into hostel
- **Key Fields**:
  - `student_id` - Who is checking in
  - `check_in_date` - Actual check-in date
  - `room_id`, `bed_id` - Room assignment
  - Payment verification fields (deposit, rent)
  - `mess_advance_paid` - Mess payment
  - `id_proof_verified` - Document verification
  - `documents_collected` - All docs received
  - `check_in_notes` - Notes from check-in
- **Validators**:
  - `validate_check_in_date()` - Max 30 days past, max 7 days future
  - `validate_payment_references()` - Payment IDs required if paid

### 5. **StudentCheckOutRequest**
- **Purpose**: Complete checkout operation when student leaves
- **Use**: When student vacates hostel
- **Key Fields**:
  - `student_id`, `checkout_date`
  - `reason` - Why leaving
  - Financial clearance (dues, refunds, deductions)
  - Room condition (damages, charges)
  - Property return (key, ID card)
  - Department clearances (mess, library, maintenance)
  - `forwarding_address`
- **Validators**:
  - `validate_checkout_date()` - Max 90 days future
  - `validate_financial_consistency()` - Dues vs outstanding amount
  - `validate_clearance_requirements()` - Damage charges logic

### 6. **StudentRoomAssignment**
- **Purpose**: Assign or reassign room/bed to student
- **Use**: Initial assignment OR room change
- **Key Fields**:
  - `student_id`, `room_id`, `bed_id`
  - `assignment_date`
  - `reason` - Why assignment/change
  - `rent_adjustment` - If rent changes
  - `prorated_rent` - Calculate partial month
- **Validators**:
  - `validate_assignment_date()` - Max 7 days past

### 7. **StudentStatusUpdate**
- **Purpose**: Change student status (active, suspended, etc.)
- **Use**: Status transitions with documentation
- **Key Fields**:
  - `student_id`, `new_status`
  - `effective_date`
  - `reason` - Must provide reason (min 10 chars)
  - `notice_period_days` - For notice period status
  - `suspension_end_date` - For suspended status
  - `admin_notes`
- **Validators**:
  - `validate_status_specific_fields()` - Required fields per status
  - `validate_suspension_date()` - End after start

---

## **File: student_dashboard.py**

### 1. **StudentFinancialSummary**
- **Purpose**: Financial overview for dashboard
- **Use**: Display payment status at a glance
- **Key Fields**:
  - Rent amounts and due dates
  - Overdue and advance balances
  - Security deposit info
  - Mess charges
  - Payment status (current/due_soon/overdue)
- **Computed Properties**:
  - `total_outstanding` - Total owed
  - `net_balance` - Advance minus dues
  - `is_payment_urgent` - Alert flag

### 2. **AttendanceSummary**
- **Purpose**: Attendance statistics for dashboard
- **Use**: Show attendance performance
- **Key Fields**:
  - Current month stats (percentage, present, absent, leaves)
  - Last 30 days percentage
  - Overall percentage
  - Minimum required percentage
  - Status (good/warning/critical)
  - Leave balance
- **Computed Properties**:
  - `is_below_minimum` - Below threshold
  - `percentage_gap` - How far below

### 3. **StudentStats**
- **Purpose**: Quick statistics and metrics
- **Use**: Dashboard overview numbers
- **Key Fields**:
  - Days/months in hostel
  - Payment count and total paid
  - Complaint stats (raised, resolved, pending)
  - Attendance percentage
  - Mess meals consumed
- **Computed Properties**:
  - `complaint_resolution_rate` - Percentage resolved

### 4. **RecentPayment**
- **Purpose**: Single payment record for recent activity
- **Use**: Display in recent payments list
- **Key Fields**: payment_id, amount, type, date, status, receipt_url

### 5. **RecentComplaint**
- **Purpose**: Single complaint record for recent activity
- **Use**: Display in recent complaints list
- **Key Fields**: complaint_id, title, category, status, priority, dates
- **Computed Properties**:
  - `days_open` - How long complaint is open

### 6. **PendingLeave**
- **Purpose**: Pending leave application
- **Use**: Show leaves awaiting approval
- **Key Fields**: leave_id, type, dates, total_days, reason, status
- **Computed Properties**:
  - `is_upcoming` - Leave in future

### 7. **RecentAnnouncement**
- **Purpose**: Recent announcement item
- **Use**: Display hostel announcements
- **Key Fields**: announcement_id, title, content, category, priority, is_read
- **Computed Properties**:
  - `is_new` - Within 24 hours

### 8. **TodayMessMenu**
- **Purpose**: Daily mess menu
- **Use**: Show today's meals
- **Key Fields**: date, breakfast, lunch, snacks, dinner, is_special

### 9. **UpcomingEvent**
- **Purpose**: Upcoming hostel event
- **Use**: Display in events section
- **Key Fields**: event_id, title, description, date, time, location, is_registered
- **Computed Properties**:
  - `days_until_event` - Countdown

### 10. **StudentDashboard**
- **Purpose**: Complete dashboard aggregation
- **Use**: Main dashboard API response
- **Key Fields**:
  - Student basic info
  - Hostel/room info
  - All summaries (financial, attendance, stats)
  - Recent activity lists (payments, complaints, leaves)
  - Announcements and events
  - Today's menu
  - Notification counts
- **Computed Properties**:
  - `has_urgent_items` - Any urgent attention needed
  - `action_items_count` - Total items needing action

---

## **File: student_filters.py**

### 1. **StudentFilterParams**
- **Purpose**: Comprehensive filtering for student queries
- **Use**: Filter student lists by various criteria
- **Key Fields**:
  - Text search
  - Hostel filters (single or multiple)
  - Room filters (room_id, number, type, floor, wing)
  - Status filters (single or multiple statuses)
  - Date ranges (check-in, checkout)
  - Financial filters (overdue, advance, deposit status)
  - Meal filter (mess subscription)
  - Institution/company filters
  - Gender filter
- **Validators**:
  - `validate_unique_hostel_ids()` - No duplicates
  - `validate_unique_statuses()` - No duplicates

### 2. **StudentSearchRequest**
- **Purpose**: Full-text search across student data
- **Use**: Search functionality with field selection
- **Key Fields**:
  - `query` - Search term
  - `hostel_id` - Limit to hostel
  - Searchable field toggles (name, email, phone, room, institution, etc.)
  - Status filter
  - `only_active` - Active students only
  - Pagination

### 3. **StudentSortOptions**
- **Purpose**: Define sorting for student lists
- **Use**: Order results by field and direction
- **Key Fields**:
  - `sort_by` - Field name (name, email, room_number, check_in_date, etc.)
  - `sort_order` - asc/desc
- **Validators**:
  - `normalize_sort_order()` - Lowercase

### 4. **AdvancedStudentFilters**
- **Purpose**: Complex filtering options
- **Use**: Detailed queries beyond basic filters
- **Key Fields**:
  - Attendance range filters
  - Payment history pattern
  - Pending complaints flag
  - Stay duration range
  - Age range
  - Document verification status
- **Validators**:
  - `validate_attendance_range()` - Max >= min

### 5. **StudentExportRequest**
- **Purpose**: Configure data export
- **Use**: Export students to CSV/Excel/PDF
- **Key Fields**:
  - `hostel_id` - Export scope
  - `filters` - Apply filters
  - `format` - csv/excel/pdf
  - Field inclusion toggles (financial, attendance, guardian, etc.)
  - Include inactive/checkout students
- **Validators**:
  - `normalize_format()` - Lowercase

### 6. **StudentBulkActionRequest**
- **Purpose**: Perform bulk operations on multiple students
- **Use**: Batch actions (activate, deactivate, notify, export, etc.)
- **Key Fields**:
  - `student_ids` - List of student IDs (max 100)
  - `action` - Action type
  - Action-specific parameters (new_status, notification, rent, etc.)
  - `confirm_action` - Explicit confirmation
- **Validators**:
  - `validate_unique_ids()` - No duplicate IDs
  - `validate_action_parameters()` - Required params per action

---

## **File: student_profile.py**

### 1. **StudentProfileCreate**
- **Purpose**: Create student profile during onboarding
- **Use**: Extend user registration with student-specific data
- **Key Fields**:
  - Guardian information (required)
  - Institutional info (college/course)
  - Employment info (company/designation)
  - ID proof
  - Dietary preferences
- **Validators**:
  - Same text normalization as StudentBase
  - `validate_student_or_professional()` - Must have institution OR employment
- **Note**: At least one of institutional or employment info required

### 2. **StudentProfileUpdate**
- **Purpose**: Update student profile
- **Use**: Partial profile updates (all fields optional)
- **Key Fields**: Same as StudentProfileCreate but all optional
- **Validators**: Same normalization validators

### 3. **DocumentInfo**
- **Purpose**: Represent a single uploaded document
- **Use**: Document metadata and verification tracking
- **Key Fields**:
  - Document ID, type, name, URL
  - File size, MIME type
  - Upload info (who, when)
  - Verification info (verified, by whom, when, notes)
  - Expiry date (for IDs)

### 4. **StudentDocuments**
- **Purpose**: Collection of all student documents
- **Use**: List all documents for a student
- **Key Fields**:
  - Student ID and name
  - Documents list
  - Counts (total, verified, pending)

### 5. **DocumentUploadRequest**
- **Purpose**: Register uploaded document in system
- **Use**: After file upload to storage, register in DB
- **Key Fields**:
  - Student ID
  - Document type, name, URL
  - File size, MIME type
  - Expiry date
  - Notes
- **Validators**:
  - `validate_mime_type()` - Only allowed types (pdf, jpeg, png, webp)
  - `validate_expiry_date()` - Must be future
  - File size max 10MB

### 6. **DocumentVerificationRequest**
- **Purpose**: Verify or reject uploaded document
- **Use**: Admin document verification
- **Key Fields**:
  - Document ID
  - `verified` - true/false
  - Verification notes
  - Rejection reason (if rejected)
- **Validators**:
  - `validate_rejection_reason()` - Required if rejected

### 7. **StudentPreferences**
- **Purpose**: Student-specific preferences
- **Use**: Manage meal, notification, communication preferences
- **Key Fields**:
  - Meal preferences (subscription, dietary, allergies, meal plan)
  - Meal plan specifics (skip breakfast/lunch/dinner)
  - Notification preferences (email, SMS, push)
  - Notification types (payment, attendance, announcements, etc.)
  - Language and contact method preferences
- **Validators**:
  - `normalize_preferences()` - Lowercase values

### 8. **StudentPrivacySettings**
- **Purpose**: Control information visibility
- **Use**: Privacy controls for student profile
- **Key Fields**:
  - Profile visibility toggles (show to others, room, phone, email, institution)
  - Contact permissions (roommate, floormate, hostelmate)
  - Search visibility
  - Activity visibility (last seen, attendance)

### 9. **StudentBulkImport**
- **Purpose**: Import multiple students from file
- **Use**: Batch student registration from CSV/Excel
- **Key Fields**:
  - Hostel ID
  - File URL and type
  - `skip_duplicates`
  - `send_welcome_email`
  - `auto_generate_passwords`
  - `field_mapping` - Custom column mapping

---

## **File: student_response.py**

### 1. **StudentResponse**
- **Purpose**: Standard student response for APIs
- **Use**: General student data in API responses
- **Key Fields**:
  - User ID, hostel, room, bed info
  - Personal info (name, email, phone, image)
  - Guardian (name, phone)
  - Status and dates
  - Financial (rent, deposit)
  - Mess subscription
- **Computed Properties**:
  - `days_in_hostel` - Days stayed
  - `is_checked_in` - Currently checked in

### 2. **StudentDetail**
- **Purpose**: Comprehensive student information
- **Use**: Detailed view, full profile
- **Key Fields**:
  - All user information
  - Complete hostel/room assignment
  - Full identification details
  - Complete guardian info
  - Full institutional/employment info
  - All dates
  - Full financial info
  - Meal preferences
  - Status tracking
  - Additional documents
- **Computed Properties**:
  - `age` - From date of birth
  - `days_in_hostel` - Days stayed
  - `is_currently_resident` - Active resident check
  - `is_student` - Has institutional info
  - `is_working_professional` - Has employment info

### 3. **StudentProfile**
- **Purpose**: Public student profile
- **Use**: Limited info for peer viewing (privacy-aware)
- **Key Fields**:
  - ID, name, image
  - Hostel, room
  - Check-in date
  - Institution/company (optional based on privacy)
- **Computed Properties**:
  - `duration_in_hostel` - Human-readable duration (days/months/years)

### 4. **StudentListItem**
- **Purpose**: Optimized for list rendering
- **Use**: Student lists in admin panel, tables
- **Key Fields**:
  - Basic identifiers (ID, user ID, name, email, phone)
  - Room assignment
  - Status and check-in date
  - Financial (rent, payment status, overdue)
  - Created timestamp
- **Computed Properties**:
  - `days_in_hostel` - Days stayed

### 5. **StudentFinancialInfo**
- **Purpose**: Comprehensive financial details
- **Use**: Financial reports, payment management
- **Key Fields**:
  - Student ID and name
  - Rent details (amount, due day)
  - Security deposit details
  - Payment totals and dates
  - Outstanding and advance amounts
  - Mess charges
  - Other charges
- **Computed Properties**:
  - `payment_status` - overdue/advance/current
  - `total_outstanding` - Total owed
  - `net_balance` - Advance minus dues

### 6. **StudentContactInfo**
- **Purpose**: Complete contact information
- **Use**: Emergency contacts, communication
- **Key Fields**:
  - Student contact (email, phone, alternate phone)
  - Guardian contact (full details)
  - Emergency contact
  - Current address (hostel, room)
  - Forwarding address (if left)

### 7. **StudentDocumentInfo**
- **Purpose**: Document details and verification status
- **Use**: Document management, verification tracking
- **Key Fields**:
  - Student ID and name
  - ID proof details and verification
  - Institutional ID and verification
  - Company ID and verification
  - Additional documents
- **Computed Properties**:
  - `verification_status` - verified/pending/not_uploaded
  - `documents_complete` - All required docs uploaded

---

## **File: student_room_history.py**

### 1. **RoomHistoryItem**
- **Purpose**: Single room assignment period
- **Use**: Represent one period in student's room history
- **Key Fields**:
  - Hostel, room, bed details
  - Move-in and move-out dates
  - Duration
  - Rent and total paid
  - Transfer details (reason, type)
  - Audit (requested by, approved by, assigned at)
- **Computed Properties**:
  - `is_current` - Currently assigned
  - `duration_months` - Duration in months

### 2. **RoomHistoryResponse**
- **Purpose**: Complete room assignment history
- **Use**: Show all room changes for a student
- **Key Fields**:
  - Student ID and name
  - Current hostel and room
  - Room history list (chronological)
  - Statistics (total assignments, transfers)
- **Computed Properties**:
  - `has_changed_rooms` - More than 1 assignment

### 3. **RoomTransferRequest**
- **Purpose**: Request room transfer
- **Use**: Student or admin initiates room change
- **Key Fields**:
  - Student ID
  - Current and requested room/bed
  - Transfer date
  - Reason (detailed, min 10 chars)
  - Preferences (accept price difference, flexible on bed)
  - Priority (low/normal/high/urgent)
  - Supporting documents
- **Validators**:
  - `validate_transfer_date()` - Today to 90 days future
  - `validate_different_room()` - Can't be same room

### 4. **RoomTransferApproval**
- **Purpose**: Approve or reject transfer request
- **Use**: Admin processes transfer request
- **Key Fields**:
  - Transfer request ID
  - `approved` - true/false
  - New room and bed (if approved)
  - Transfer date (if approved)
  - Rejection reason (if rejected)
  - Financial implications (rent adjustment, charges)
  - Admin notes
- **Validators**:
  - `validate_approval_requirements()` - Required fields per decision
  - `validate_transfer_date()` - Valid date range

### 5. **RoomTransferStatus**
- **Purpose**: Current status of transfer request
- **Use**: Track transfer request progress
- **Key Fields**:
  - Request ID, student info
  - Current, requested, approved rooms
  - Dates (transfer, requested, processed)
  - Status (pending/approved/rejected/completed/cancelled)
  - Priority, reason
  - Processing details (who, when, notes)
  - Financial details
- **Computed Properties**:
  - `is_pending` - Still pending
  - `days_pending` - How long pending

### 6. **SingleTransfer**
- **Purpose**: One transfer in bulk operation
- **Use**: Building block for bulk transfers
- **Key Fields**:
  - Student ID
  - New room and bed
  - Reason (optional)

### 7. **BulkRoomTransfer**
- **Purpose**: Transfer multiple students simultaneously
- **Use**: Bulk operations like floor reorganization
- **Key Fields**:
  - List of transfers (max 50)
  - Common transfer date
  - Common reason
  - Options (skip errors, send notifications, prorated rent)
  - `confirm_bulk_transfer` - Explicit confirmation required
- **Validators**:
  - `validate_unique_students()` - Each student once only
  - `validate_transfer_date()` - Max 30 days future
  - `validate_confirmation()` - Must confirm

### 8. **RoomSwapRequest**
- **Purpose**: Mutual room exchange between two students
- **Use**: Two students want to swap rooms
- **Key Fields**:
  - Two student IDs
  - Swap date
  - Reason
  - Consent from both students (required)
  - Handle rent difference option
- **Validators**:
  - `validate_swap_date()` - Max 30 days future
  - `validate_different_students()` - Can't be same student
  - `validate_consent()` - Both must consent

---

## **Summary by Use Case**

| Use Case | Classes to Use |
|----------|----------------|
| **Create Student** | `StudentCreate`, `StudentProfileCreate` |
| **Update Student** | `StudentUpdate`, `StudentProfileUpdate` |
| **Check-in Process** | `StudentCheckInRequest` |
| **Checkout Process** | `StudentCheckOutRequest` |
| **Room Assignment** | `StudentRoomAssignment` |
| **Change Status** | `StudentStatusUpdate` |
| **Display Dashboard** | `StudentDashboard` + all summary classes |
| **List Students** | `StudentListItem`, `StudentFilterParams` |
| **Search Students** | `StudentSearchRequest` |
| **View Full Profile** | `StudentDetail` |
| **Public Profile** | `StudentProfile` |
| **Financial View** | `StudentFinancialInfo` |
| **Document Management** | `DocumentUploadRequest`, `DocumentVerificationRequest`, `StudentDocuments` |
| **Room Transfer** | `RoomTransferRequest`, `RoomTransferApproval`, `RoomTransferStatus` |
| **Room History** | `RoomHistoryResponse`, `RoomHistoryItem` |
| **Bulk Operations** | `StudentBulkActionRequest`, `BulkRoomTransfer` |
| **Room Swap** | `RoomSwapRequest` |
| **Export Data** | `StudentExportRequest` |
| **Preferences** | `StudentPreferences`, `StudentPrivacySettings` |



================================================================================================================================================

# Complete Clarity on User Schema Classes

## **File: user_base.py**

### 1. **UserBase**
- **Purpose**: Base schema containing core user attributes
- **Use**: Parent class for user creation and updates, contains shared fields
- **Key Fields**:
  - `email` - Unique email address (EmailStr)
  - `phone` - Phone number (E.164 format)
  - `full_name` - Full name (2-255 chars)
  - `user_role` - Role for authorization (enum)
  - `gender` - Gender (optional)
  - `date_of_birth` - DOB (optional)
  - `profile_image_url` - Profile picture URL (optional)
- **Validators**:
  - `normalize_email()` - Lowercase and trim whitespace
  - `normalize_phone()` - Remove spaces and dashes
  - `validate_full_name()` - Min 2 chars, not only numbers, remove excessive whitespace
  - `validate_age()` - Min 16 years old, max 100 years, not future date
  - `validate_image_url()` - Must start with http:// or https://

### 2. **UserCreate**
- **Purpose**: Create new user account with password
- **Use**: User registration, new account creation
- **Key Fields**:
  - All fields from UserBase
  - `password` - Password with strength requirements (8-128 chars)
- **Validators**:
  - `validate_password_strength()` - Min 8 chars, must have digit, uppercase, lowercase

### 3. **UserUpdate**
- **Purpose**: Update existing user profile
- **Use**: Partial updates to user data (all fields optional)
- **Key Fields**:
  - `email`, `phone`, `full_name` (all optional)
  - `gender`, `date_of_birth`, `profile_image_url` (optional)
  - `is_active` - Account active status (optional)
- **Validators**: Same as UserBase but handle None values

### 4. **UserAddressUpdate**
- **Purpose**: Update user address information separately
- **Use**: Update address without touching other user fields
- **Inherits**: AddressMixin
- **Key Fields** (all optional):
  - `address_line1` - Primary address (5-255 chars)
  - `address_line2` - Secondary address
  - `city` - City (2-100 chars)
  - `state` - State (2-100 chars)
  - `pincode` - 6-digit pincode
  - `country` - Country (2-100 chars)

### 5. **UserEmergencyContactUpdate**
- **Purpose**: Update emergency contact separately
- **Use**: Update emergency contact without touching other user fields
- **Inherits**: EmergencyContactMixin
- **Key Fields** (all optional):
  - `emergency_contact_name` - Contact person name
  - `emergency_contact_phone` - Contact phone number
  - `emergency_contact_relation` - Relation to user
- **Validators**:
  - `normalize_phone()` - Remove spaces/dashes

---

## **File: user_profile.py**

### 1. **ProfileUpdate**
- **Purpose**: Comprehensive profile update (personal + address)
- **Use**: Update user profile with personal and address information together
- **Key Fields** (all optional):
  - Personal: `full_name`, `gender`, `date_of_birth`
  - Address: `address_line1`, `address_line2`, `city`, `state`, `pincode`, `country`
- **Validators**:
  - `validate_full_name()` - Min 2 chars, not only numbers
  - `validate_age()` - Min 16 years, not future
  - `validate_text_fields()` - For city, state, country - not only numbers

### 2. **ProfileImageUpdate**
- **Purpose**: Update only profile image
- **Use**: Dedicated endpoint for profile picture updates
- **Key Fields**:
  - `profile_image_url` - Valid HTTP/HTTPS URL (required, HttpUrl type)

### 3. **ContactInfoUpdate**
- **Purpose**: Update contact and emergency contact information
- **Use**: Update all contact-related fields together
- **Key Fields** (all optional):
  - `phone` - User phone
  - `email` - User email
  - `emergency_contact_name` - Emergency contact name
  - `emergency_contact_phone` - Emergency contact phone
  - `emergency_contact_relation` - Relation (Father, Mother, etc.)
- **Validators**:
  - `normalize_phone()` - Remove spaces/dashes for both phone fields
  - `normalize_email()` - Lowercase and trim
  - `validate_text_fields()` - For name and relation - not only numbers

### 4. **NotificationPreferencesUpdate**
- **Purpose**: Granular control over notification settings
- **Use**: User customizes notification preferences
- **Key Fields**:
  - **Channel preferences** (booleans):
    - `email_notifications` - Enable email (default: true)
    - `sms_notifications` - Enable SMS (default: true)
    - `push_notifications` - Enable push (default: true)
  - **Notification types** (booleans):
    - `booking_notifications` - Booking updates (default: true)
    - `payment_notifications` - Payment updates (default: true)
    - `complaint_notifications` - Complaint updates (default: true)
    - `announcement_notifications` - Hostel announcements (default: true)
    - `maintenance_notifications` - Maintenance updates (default: true)
    - `marketing_notifications` - Marketing (default: false, opt-in)
  - **Advanced preferences**:
    - `digest_frequency` - immediate/daily/weekly/never (optional)
    - `quiet_hours_start` - HH:MM format (optional)
    - `quiet_hours_end` - HH:MM format (optional)
- **Validators**:
  - `normalize_digest_frequency()` - Lowercase

---

## **File: user_response.py**

### 1. **UserResponse**
- **Purpose**: Standard user response for general API responses
- **Use**: Return essential user info in APIs
- **Key Fields**:
  - `email`, `phone`, `full_name`, `user_role`
  - `is_active` - Account active status
  - `is_email_verified` - Email verification status
  - `is_phone_verified` - Phone verification status
  - `profile_image_url` - Profile picture (optional)
  - `last_login_at` - Last login timestamp (optional)

### 2. **UserDetail**
- **Purpose**: Comprehensive user information
- **Use**: Full user profile view, detailed responses
- **Key Fields**:
  - **Basic**: email, phone, full_name, user_role, gender, date_of_birth, profile_image_url
  - **Address**: address_line1, address_line2, city, state, country, pincode
  - **Emergency contact**: emergency_contact_name, emergency_contact_phone, emergency_contact_relation
  - **Account status**: is_active, is_email_verified, is_phone_verified
  - **Timestamps**: email_verified_at, phone_verified_at, last_login_at, last_password_change_at

### 3. **UserListItem**
- **Purpose**: Minimal user info for list views
- **Use**: User lists, search results, tables
- **Key Fields**:
  - `id` - User ID (UUID)
  - `email`, `full_name`, `user_role`
  - `is_active` - Active status
  - `profile_image_url` - Profile picture (optional)
  - `created_at` - Registration date
  - `last_login_at` - Last login (optional)

### 4. **UserProfile**
- **Purpose**: Public user profile (limited information)
- **Use**: Profile suitable for public display
- **Key Fields**:
  - `id` - User ID
  - `full_name` - Name
  - `profile_image_url` - Picture (optional)
  - `user_role` - Role
  - `member_since` - Registration date

### 5. **UserStats**
- **Purpose**: User activity and engagement statistics
- **Use**: Dashboard, analytics, user overview
- **Key Fields**:
  - `user_id` - User ID
  - **Bookings**: total_bookings, active_bookings, completed_bookings
  - **Payments**: total_payments, total_amount_paid
  - **Complaints**: total_complaints, resolved_complaints
  - **Ratings**: average_rating_given (0-5, optional)
  - **Activity**: account_age_days, last_activity_at

---

## **File: user_session.py**

### 1. **UserSession**
- **Purpose**: Database representation of user session
- **Use**: Persistent session storage in database
- **Key Fields**:
  - `user_id` - User associated with session
  - `device_info` - Device information dict (optional)
  - `ip_address` - IP address (optional)
  - `is_revoked` - Whether session is revoked
  - `expires_at` - Expiration timestamp
  - `last_activity` - Last activity timestamp

### 2. **SessionInfo**
- **Purpose**: Enhanced session information for frontend display
- **Use**: Show session details to users for management
- **Key Fields**:
  - `session_id` - Unique session ID
  - **Device details**:
    - `device_name` - e.g., "iPhone 13" (optional)
    - `device_type` - mobile/desktop/tablet (optional)
    - `browser` - Browser name and version (optional)
    - `os` - Operating system (optional)
  - **Location**:
    - `ip_address` - Masked IP (optional)
    - `location` - City, country (optional)
  - **Status**:
    - `is_current` - Current session flag
  - **Timestamps**:
    - `created_at` - Session creation
    - `last_activity` - Last activity
    - `expires_at` - Expiration time

### 3. **ActiveSessionsList**
- **Purpose**: List all active sessions for a user
- **Use**: Session management view, show all active sessions
- **Key Fields**:
  - `sessions` - List of SessionInfo objects
  - `total_sessions` - Total count
  - `current_session_id` - ID of current session (optional)

### 4. **RevokeSessionRequest**
- **Purpose**: Revoke a specific session
- **Use**: Terminate single session by ID (e.g., logout from specific device)
- **Key Fields**:
  - `session_id` - Session ID to revoke

### 5. **RevokeAllSessionsRequest**
- **Purpose**: Revoke all user sessions
- **Use**: Security feature - logout from all devices
- **Key Fields**:
  - `keep_current` - Keep current session active (default: true)
  - `reason` - Reason for revoking (optional, max 500 chars)

### 6. **CreateSessionRequest**
- **Purpose**: Create new session during login
- **Use**: Track session when user logs in
- **Key Fields**:
  - `user_id` - User logging in
  - `device_info` - Device information dict (optional)
  - `ip_address` - IP address (optional)
  - `user_agent` - User agent string (optional, max 500 chars)
  - `remember_me` - Extend session duration (default: false)
- **Validators**:
  - `validate_ip_address()` - Basic IP format validation

---

## **Summary by Use Case**

| Use Case | Classes to Use |
|----------|----------------|
| **Register User** | `UserCreate` |
| **Update Profile** | `UserUpdate`, `ProfileUpdate` |
| **Update Address Only** | `UserAddressUpdate` |
| **Update Emergency Contact** | `UserEmergencyContactUpdate` |
| **Update Profile Image** | `ProfileImageUpdate` |
| **Update Contact Info** | `ContactInfoUpdate` |
| **Update Notification Settings** | `NotificationPreferencesUpdate` |
| **Display User Info** | `UserResponse` |
| **Full User Profile** | `UserDetail` |
| **User Lists** | `UserListItem` |
| **Public Profile** | `UserProfile` |
| **User Statistics** | `UserStats` |
| **Login (Create Session)** | `CreateSessionRequest` |
| **View Active Sessions** | `ActiveSessionsList`, `SessionInfo` |
| **Logout Specific Device** | `RevokeSessionRequest` |
| **Logout All Devices** | `RevokeAllSessionsRequest` |
| **Session Tracking** | `UserSession` |

---

## **Key Differences from Student Schemas**

1. **Simpler Structure**: User schemas are more straightforward - basic CRUD + session management
2. **No Complex Operations**: Unlike students (check-in, checkout, room transfers), users have simple profile management
3. **Session Management**: Unique to users - tracks login sessions across devices
4. **Notification Preferences**: Granular notification control (not in student schemas)
5. **Public vs Private**: Clear separation between public profile and detailed information
6. **No Financial Complexity**: Users don't have rent, deposits, payments like students
7. **No Status Workflow**: No complex status transitions like students (active, notice period, suspended, etc.)

================================================================================================================================================

# Complete Supervisor Schemas Breakdown

## 1. `supervisor_activity.py` - Activity Logging & Audit

### Classes:

**`SupervisorActivityLog`** - Main activity log entry
- **Purpose**: Track all supervisor actions with metadata
- **Key Fields**: supervisor_id, action_type, action_category, entity details, performance metrics
- **Computed**: `action_display_name` - Human-readable action name

**`ActivityDetail`** - Detailed activity with change tracking  
- **Purpose**: Comprehensive activity record with before/after states
- **Key Fields**: old_values, new_values, impact_level, device_info
- **Computed**: `has_changes`, `change_summary` - Track what changed

**`ActivitySummary`** - High-level activity overview
- **Purpose**: Dashboard activity summary with insights
- **Key Fields**: actions_by_category, top_activities, activity_timeline
- **Computed**: `most_common_activity`, `activity_consistency` - Usage patterns

**`TopActivity`** - Frequent activity item
- **Purpose**: Represent most performed actions
- **Computed**: `frequency_description` - Categorize usage frequency

**`ActivityTimelinePoint`** - Time-based activity data point
- **Purpose**: Track activity volume over time periods
- **Computed**: `activity_level` - Categorize activity intensity

**`ActivityMetrics`** - Comprehensive activity analytics
- **Purpose**: Aggregated performance metrics for assessment
- **Computed**: `activity_score`, `productivity_level` - Performance scoring

**`ActivityFilterParams`** - Activity filtering parameters
- **Purpose**: Filter activity logs with comprehensive criteria
- **Validators**: Ensure filter consistency and validation

**`ActivityExportRequest`** - Export configuration
- **Purpose**: Configure activity data export with custom fields

---

## 2. `supervisor_assignment.py` - Assignment Management

### Classes:

**`SupervisorAssignment`** - Assignment response
- **Purpose**: Complete assignment information display
- **Computed**: `assignment_duration_months` - Calculate assignment length

**`AssignmentRequest`** - Create new assignment
- **Purpose**: Assign user as supervisor to hostel
- **Validators**: Validate join date within reasonable bounds

**`AssignmentUpdate`** - Update assignment details
- **Purpose**: Modify employment details and status
- **Validators**: Normalize employment type

**`RevokeAssignmentRequest`** - Revoke assignment
- **Purpose**: End assignment with handover support
- **Validators**: Ensure proper handover configuration

**`AssignmentTransfer`** - Transfer between hostels
- **Purpose**: Move supervisor to different hostel
- **Validators**: Ensure different hostels, permission handling

**`AssignmentSummary`** - Assignment overview
- **Purpose**: Reporting and dashboard summaries
- **Computed**: `active_percentage`, `needs_coverage` - Coverage analysis

---

## 3. `supervisor_base.py` - Core Supervisor Management

### Classes:

**`SupervisorValidationConstants`** - Validation rules
- **Purpose**: Centralized validation constants and limits

**`SupervisorBase`** - Base supervisor schema
- **Purpose**: Common fields for supervisor operations
- **Validators**: Normalize text fields, validate join dates

**`SupervisorCreate`** - Create new supervisor
- **Purpose**: Register user as supervisor with initial setup
- **Validators**: Permission structure validation

**`SupervisorUpdate`** - Update supervisor details
- **Purpose**: Partial updates of supervisor information
- **Validators**: Status consistency validation

**`SupervisorStatusUpdate`** - Status change management
- **Purpose**: Handle status transitions (termination, suspension, leave)
- **Validators**: Status-specific required fields, date range validation

**`SupervisorReassignment`** - Hostel reassignment
- **Purpose**: Transfer supervisor between hostels
- **Validators**: Different hostel validation, permission/salary adjustments

**`SupervisorTermination`** - Complete termination process
- **Purpose**: Handle full termination with clearances and settlements
- **Validators**: Termination requirements, clearance completeness

---

## 4. `supervisor_dashboard.py` - Real-time Dashboard

### Classes:

**`DashboardMetrics`** - Key performance indicators
- **Purpose**: Real-time metrics for dashboard display
- **Computed**: `overall_health_score`, `needs_attention` - Health assessment

**`TaskSummary`** - Pending tasks overview
- **Purpose**: Actionable task list with priorities
- **Computed**: `priority_score`, `workload_level` - Task management

**`RecentComplaintItem`** - Recent complaint display
- **Purpose**: Show recent complaints requiring attention
- **Computed**: `is_overdue`, `urgency_indicator` - Priority assessment

**`RecentMaintenanceItem`** - Recent maintenance display
- **Purpose**: Show recent maintenance requests
- **Computed**: `is_overdue`, `days_pending` - Status tracking

**`PendingLeaveItem`** - Leave approval item
- **Purpose**: Display pending leave applications
- **Computed**: `is_urgent`, `pending_days` - Urgency assessment

**`ScheduledMaintenanceItem`** - Today's maintenance
- **Purpose**: Show scheduled maintenance for today

**`ScheduledMeeting`** - Today's meetings
- **Purpose**: Show scheduled meetings

**`TodaySchedule`** - Daily schedule
- **Purpose**: Complete schedule for the day
- **Computed**: `total_scheduled_items`, `schedule_density` - Schedule analysis

**`DashboardAlert`** - Alert/notification
- **Purpose**: Show alerts requiring attention
- **Computed**: `is_expired`, `age_minutes` - Alert management

**`QuickAction`** - Quick action button
- **Purpose**: Represent actionable dashboard buttons

**`QuickActions`** - Quick actions collection
- **Purpose**: Group quick actions by category
- **Computed**: `actions_by_category` - Organize actions

**`PerformanceIndicators`** - Performance metrics
- **Purpose**: Key performance indicators for dashboard
- **Computed**: `overall_performance_score`, `performance_grade` - Performance scoring

**`SupervisorDashboard`** - Complete dashboard
- **Purpose**: Full dashboard with all components
- **Computed**: `critical_alerts_count`, `workload_summary`, `dashboard_health_status` - Dashboard insights

---

## 5. `supervisor_performance.py` - Performance Analytics

### Classes:

**`PerformanceMetrics`** - Comprehensive performance data
- **Purpose**: Detailed performance across all areas
- **Computed**: `efficiency_score`, `quality_score` - Performance calculation

**`ComplaintPerformance`** - Complaint handling metrics
- **Purpose**: Detailed complaint performance analysis
- **Computed**: `resolution_efficiency` - Efficiency categorization

**`AttendancePerformance`** - Attendance management metrics
- **Purpose**: Attendance tracking performance
- **Computed**: `attendance_consistency`, `leave_approval_rate` - Consistency analysis

**`MaintenancePerformance`** - Maintenance management metrics
- **Purpose**: Maintenance handling performance
- **Computed**: `completion_rate`, `budget_utilization` - Resource management

**`PerformanceTrendPoint`** - Trend analysis data point
- **Purpose**: Performance trends over time
- **Computed**: `trend_indicator` - Trend assessment

**`MetricComparison`** - Individual metric comparison
- **Purpose**: Compare supervisor metrics with peers
- **Computed**: `performance_vs_peers` - Peer comparison

**`PeerComparison`** - Peer performance comparison
- **Purpose**: Rank among peer supervisors
- **Computed**: `performance_tier` - Performance categorization

**`PeriodComparison`** - Period-over-period comparison
- **Purpose**: Compare with previous periods
- **Computed**: `overall_trend`, `improvement_summary` - Progress tracking

**`PerformanceGoal`** - Performance goal setting
- **Purpose**: Set measurable performance targets
- **Computed**: `duration_days` - Goal timeline

**`PerformanceGoalProgress`** - Goal progress tracking
- **Purpose**: Track progress toward goals
- **Computed**: `days_elapsed`, `time_progress_percentage`, `is_on_schedule`, `projected_completion_date` - Progress analysis

**`PerformanceReport`** - Comprehensive performance report
- **Purpose**: Complete performance assessment
- **Computed**: `report_summary` - Executive summary

**`PerformanceReview`** - Admin performance review
- **Purpose**: Formal performance review by admin
- **Computed**: `average_rating` - Review scoring

**`PerformanceReviewResponse`** - Review with acknowledgment
- **Purpose**: Review response with supervisor acknowledgment
- **Computed**: `performance_level` - Performance categorization

**`PerformanceInsights`** - AI-generated insights
- **Purpose**: Automated performance insights and recommendations
- **Computed**: `overall_assessment` - AI assessment

---

## 6. `supervisor_permissions.py` - Access Control

### Classes:

**`PermissionConstants`** - Permission constants
- **Purpose**: Centralized permission definitions and templates

**`SupervisorPermissions`** - Complete permission configuration
- **Purpose**: Granular permission control for all supervisor capabilities
- **Validators**: Permission dependencies, threshold consistency
- **Methods**: `get_permission_summary()` - Count permissions by category

**`PermissionUpdate`** - Update permissions
- **Purpose**: Modify supervisor permissions
- **Validators**: Permission key and value validation

**`PermissionCheckRequest`** - Check permission
- **Purpose**: Validate supervisor permission with context
- **Validators**: Permission key validation

**`PermissionCheckResponse`** - Permission check result
- **Purpose**: Detailed permission status with threshold info
- **Methods**: `get_detailed_message()` - Human-readable explanation

**`BulkPermissionUpdate`** - Batch permission update
- **Purpose**: Update permissions for multiple supervisors
- **Validators**: Unique IDs, permission validation

**`PermissionTemplate`** - Permission template
- **Purpose**: Predefined permission sets for different levels
- **Class Methods**: `get_system_templates()` - Get system templates

**`ApplyPermissionTemplate`** - Apply template
- **Purpose**: Apply permission template to supervisors
- **Validators**: Mode selection validation

**`PermissionAuditLog`** - Permission change audit
- **Purpose**: Track permission modifications for compliance
- **Computed**: `changes_count`, `change_summary` - Audit summary

---

## 7. `supervisor_profile.py` - Profile Management

### Classes:

**`SupervisorEmployment`** - Employment details
- **Purpose**: Detailed employment information
- **Computed**: `tenure_days`, `tenure_display`, `is_contract_employee`, `contract_status` - Employment analysis

**`PerformanceSummary`** - Performance overview
- **Purpose**: Performance summary for profile
- **Computed**: `overall_efficiency_score`, `performance_level` - Performance assessment

**`EmploymentHistory`** - Employment history entry
- **Purpose**: Track employment history across hostels
- **Computed**: `duration_days`, `is_current` - History analysis

**`SupervisorPreferences`** - Personal preferences
- **Purpose**: User preferences and settings

**`SupervisorProfile`** - Complete profile
- **Purpose**: Comprehensive supervisor profile
- **Computed**: `total_experience_days`, `experience_display`, `hostels_worked` - Experience tracking

**`SupervisorProfileUpdate`** - Profile updates
- **Purpose**: Update personal profile information
- **Validators**: Phone number normalization

---

## 8. `supervisor_response.py` - API Responses

### Classes:

**`SupervisorResponse`** - Standard API response
- **Purpose**: Essential supervisor information for general API responses
- **Computed**: `tenure_days`, `tenure_months`, `is_probation` - Basic calculations

**`SupervisorDetail`** - Detailed response
- **Purpose**: Comprehensive supervisor information
- **Computed**: `age`, `tenure_months`, `tenure_years`, `is_probation`, `can_work`, `suspension_days_remaining` - Detailed calculations

**`SupervisorListItem`** - List item response
- **Purpose**: Minimal information for efficient list rendering
- **Computed**: `tenure_months`, `display_status` - List optimizations

**`SupervisorSummary`** - Dashboard summary
- **Purpose**: Quick overview for dashboards
- **Computed**: `complaint_resolution_rate`, `activity_status` - Summary metrics

**`SupervisorEmploymentInfo`** - Employment details
- **Purpose**: Comprehensive employment information
- **Computed**: `tenure_days`, `tenure_display`, `is_contract_expiring_soon`, `contract_status` - Employment tracking

**`SupervisorStatistics`** - Performance statistics
- **Purpose**: Aggregated statistics for reporting
- **Computed**: `complaint_resolution_rate`, `maintenance_completion_rate`, `attendance_punctuality_rate`, `activity_rate`, `performance_grade` - Statistical analysis

---

## Key Patterns:

1. **Base Classes**: Provide common fields and validation
2. **Create Classes**: Handle new record creation with validation
3. **Update Classes**: Support partial updates with validation
4. **Response Classes**: Optimized for different API use cases
5. **Filter Classes**: Support complex querying and filtering
6. **Audit Classes**: Track changes and compliance
7. **Computed Properties**: Calculate derived values and insights
8. **Validators**: Ensure data consistency and business rules

================================================================================================================================================

# Complete Visitor Schemas Breakdown

## 1. `visitor_base.py` - Core Visitor Management

### Classes:

**`VisitorBase`** - Base visitor schema with preferences
- **Purpose**: Common fields for visitor operations including room preferences, budget, location, and notification settings
- **Key Fields**: user_id, preferred_room_type, budget_min/max, preferred_cities, preferred_amenities, favorite_hostel_ids, notification preferences
- **Validators**: `validate_budget_positive()`, `validate_budget_range()`, `validate_cities()`, `validate_amenities()`, `validate_favorites()`
- **Properties**: `has_budget_preference()`, `has_location_preference()`, `notification_enabled_count()`

**`VisitorCreate`** - Create new visitor profile
- **Purpose**: Register new visitor with initial preferences (all optional except user_id)
- **Inherits**: VisitorBase fields with creation-specific defaults

**`VisitorUpdate`** - Update visitor profile
- **Purpose**: Partial updates of visitor information (all fields optional)
- **Validators**: Same validation logic as base for provided fields

---

## 2. `visitor_dashboard.py` - Dashboard Components

### Classes:

**`SavedHostelItem`** - Individual saved hostel
- **Purpose**: Track saved hostels with price monitoring and metadata
- **Key Fields**: hostel details, pricing info, saved_at, notes, price tracking
- **Computed**: `has_availability`, `price_drop_amount`, `is_good_deal`

**`SavedHostels`** - Collection of saved hostels
- **Purpose**: Aggregate saved hostels with summary statistics
- **Computed**: `hostels_with_price_drops`, `hostels_with_availability`

**`BookingHistoryItem`** - Individual booking record
- **Purpose**: Display booking history with status and available actions
- **Key Fields**: booking details, dates, status, payment info, action flags
- **Computed**: `check_out_date`, `days_until_checkin`, `is_upcoming`

**`BookingHistory`** - Booking history summary
- **Purpose**: Aggregate booking statistics and history
- **Computed**: `cancellation_rate`, `completion_rate`

**`RecentSearch`** - Recent search tracking
- **Purpose**: Track visitor search patterns and behavior
- **Computed**: `filters_count`

**`RecentlyViewedHostel`** - Recently viewed hostel tracking
- **Purpose**: Track hostel viewing patterns for recommendations
- **Computed**: `is_highly_viewed` (viewed 3+ times)

**`RecommendedHostel`** - AI-generated recommendations
- **Purpose**: Provide personalized hostel recommendations
- **Key Fields**: hostel info, match_score, match_reasons
- **Computed**: `is_excellent_match` (score >= 80)

**`PriceDropAlert`** - Price reduction notifications
- **Purpose**: Alert visitors when saved hostel prices drop
- **Computed**: `savings_amount`

**`AvailabilityAlert`** - Availability notifications
- **Purpose**: Alert when previously full hostels become available

**`VisitorDashboard`** - Complete dashboard
- **Purpose**: Comprehensive dashboard with all visitor information
- **Computed**: `unread_alerts_count`, `has_activity`

---

## 3. `visitor_favorites.py` - Favorites Management

### Classes:

**`FavoriteRequest`** - Add/remove favorites
- **Purpose**: Request to add or remove hostel from favorites
- **Validators**: `validate_notes()` - clean and validate notes

**`FavoriteHostelItem`** - Detailed favorite hostel
- **Purpose**: Complete favorite hostel information with tracking
- **Key Fields**: hostel details, pricing tracking, rating info, favorite metadata, view tracking
- **Computed**: `price_savings`, `days_in_favorites`, `is_highly_rated`, `is_popular`, `is_frequently_viewed`

**`FavoritesList`** - Favorites collection
- **Purpose**: List all favorites with summary statistics
- **Computed**: `favorites_with_availability`, `favorites_with_price_drops`, `total_potential_savings`

**`FavoriteUpdate`** - Update favorite notes
- **Purpose**: Modify personal notes for saved hostels
- **Validators**: `validate_notes()` - ensure notes don't exceed limits

**`FavoritesExport`** - Export favorites
- **Purpose**: Export favorites list in various formats (PDF, CSV, JSON)
- **Validators**: `validate_format()` - ensure valid export format

**`FavoriteComparison`** - Compare favorites
- **Purpose**: Side-by-side comparison of 2-4 favorite hostels
- **Validators**: `validate_favorite_ids()` - ensure 2-4 unique favorites

---

## 4. `visitor_preferences.py` - Preference Management

### Classes:

**`VisitorPreferences`** - Complete preferences
- **Purpose**: Comprehensive visitor preferences including room type, budget, location, amenities, dietary requirements, move-in details, and notifications
- **Key Fields**: All preference categories with detailed settings
- **Validators**: `validate_budget_positive()`, `validate_budget_range()`, `validate_move_in_date()`, `normalize_location_list()`, `normalize_amenities_list()`, `validate_notification_settings()`

**`PreferenceUpdate`** - Update preferences
- **Purpose**: Partial preference updates (all fields optional)
- **Validators**: Same validation logic for provided fields

**`SearchPreferences`** - Saved search criteria
- **Purpose**: Save specific search criteria for recurring searches and notifications
- **Key Fields**: search_name, criteria (cities, room_types, price range, amenities), notification settings
- **Validators**: `validate_search_name()`, `validate_price_range()`, `validate_has_criteria()`

**`SavedSearch`** - Persisted saved search
- **Purpose**: Saved search with ID, statistics, and tracking
- **Key Fields**: search details, match statistics, timestamps
- **Validators**: `validate_criteria()` - ensure criteria not empty

---

## 5. `visitor_response.py` - API Response Schemas

### Classes:

**`VisitorResponse`** - Standard API response
- **Purpose**: Basic visitor information for general API responses
- **Key Fields**: user info, preferences, statistics, notification settings
- **Computed**: `has_active_notifications`, `budget_range_display`

**`VisitorProfile`** - Public profile
- **Purpose**: Minimal visitor information for public display (reviews, comments)
- **Key Fields**: id, name, profile image, member since date
- **Computed**: `display_name` (first name only), `membership_days`

**`VisitorDetail`** - Complete visitor information
- **Purpose**: Comprehensive profile with all preferences, activity statistics, and account info
- **Key Fields**: Complete user info, preferences, activity stats, review activity, account info
- **Computed**: `active_bookings`, `booking_completion_rate`, `is_active_user`, `engagement_score`

**`VisitorStats`** - Analytics and statistics
- **Purpose**: Comprehensive visitor behavior analytics and metrics
- **Key Fields**: search activity, engagement metrics, booking metrics, preference insights
- **Computed**: `inquiry_conversion_rate`, `average_views_per_search`, `engagement_level`

---

## Key Patterns:

1. **Base Classes**: Provide common fields and validation for visitor operations
2. **Create/Update Classes**: Handle new visitor creation and profile updates
3. **Response Classes**: Optimized for different API response needs (basic, detailed, public)
4. **Dashboard Classes**: Real-time dashboard components with computed insights
5. **Preference Classes**: Comprehensive preference management with validation
6. **Favorites Classes**: Wishlist management with tracking and comparison
7. **Computed Properties**: Calculate derived values like savings, rates, scores
8. **Validators**: Ensure data consistency, normalize inputs, validate business rules
9. **Statistics Classes**: Analytics and behavioral insights for personalization

## Functional Categories:

- **Profile Management**: Base schemas for visitor account management
- **Search & Discovery**: Preferences, saved searches, recommendations
- **Engagement Tracking**: View history, search patterns, engagement metrics
- **Favorites Management**: Wishlist functionality with price/availability tracking
- **Dashboard & Analytics**: Real-time insights and comprehensive statistics
- **Notifications**: Alert management for price drops and availability


================================================================================================================================================