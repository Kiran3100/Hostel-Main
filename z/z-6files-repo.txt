============================================================================================================================
# Admin Repositories - Complete Class Overview

## 1. `admin_hostel_assignment_repository.py`

### **AdminHostelAssignmentRepository**
**Purpose**: Manages admin assignments to multiple hostels with workload balancing and transfer workflows

**Key Functions**:
- `assign_admin_to_hostels()` - Assign admin to multiple hostels
- `assign_single_hostel()` - Assign admin to single hostel
- `get_admin_assignments()` - Get all assignments for an admin
- `get_hostel_assignments()` - Get all admins for a hostel
- `find_assignment()` - Find specific admin-hostel assignment
- `get_primary_assignment()` - Get admin's primary hostel
- `update_assignment()` - Update assignment details
- `revoke_assignment()` - Revoke/deactivate assignment
- `reactivate_assignment()` - Reactivate revoked assignment
- `set_primary_hostel()` - Set primary hostel for admin
- `transfer_responsibilities()` - Transfer hostels between admins
- `complete_handover()` - Complete transfer handover
- `balance_workload()` - Analyze and balance admin workloads
- `find_overloaded_admins()` - Find admins with too many hostels
- `get_coverage_gaps()` - Find hostels without admin coverage
- `recommend_assignments()` - Suggest admin assignments
- `track_assignment_history()` - Get assignment change history
- `get_assignment_statistics()` - Get assignment analytics
- `update_activity_metrics()` - Track admin activity in assignments

---

## 2. `admin_override_repository.py`

### **AdminOverrideRepository**
**Purpose**: Manages admin overrides of supervisor decisions with impact tracking and approval workflows

**Key Functions**:
- `create_override()` - Create new admin override record
- `find_by_entity()` - Find overrides for specific entity
- `find_by_admin()` - Find overrides by specific admin
- `find_by_supervisor()` - Find overrides of supervisor's actions
- `find_pending_approval()` - Find overrides needing approval
- `find_high_impact_overrides()` - Find high-impact overrides
- `create_approval_request()` - Create approval workflow
- `approve_override()` - Approve override request
- `reject_override()` - Reject override request
- `reverse_override()` - Reverse an override decision
- `update_impact_assessment()` - Update impact analysis
- `find_pattern_overrides()` - Analyze override patterns
- `get_override_statistics()` - Get override analytics

---

## 3. `admin_permissions_repository.py`

### **AdminPermissionsRepository**
**Purpose**: Manages granular permission control with role-based access and inheritance

**Key Functions**:
- `create_permission_set()` - Create permissions for admin
- `find_by_admin_and_hostel()` - Find specific permission set
- `get_all_permissions_for_admin()` - Get all permission sets for admin
- `get_effective_permissions()` - Calculate final permissions with inheritance
- `validate_permission_set()` - Validate permission configuration
- `find_permission_conflicts()` - Find conflicting permissions
- `create_template()` - Create reusable permission template
- `apply_template()` - Apply template to admin
- `get_templates_by_category()` - Get templates by category
- `get_permission_history()` - Get permission change history
- `track_permission_usage()` - Track permission usage analytics
- `get_permission_statistics()` - Get permission analytics
- `suggest_role_optimization()` - Suggest permission optimizations

---

## 4. `admin_user_repository.py`

### **AdminUserRepository**
**Purpose**: Manages admin users with security monitoring, session management, and hierarchy

**Key Functions**:
- `create_admin()` - Create new admin user
- `find_by_user_id()` - Find admin by base user ID
- `find_by_email()` - Find admin by email
- `find_by_employee_id()` - Find admin by employee ID
- `find_by_permissions()` - Find admins with specific permissions
- `find_multi_hostel_admins()` - Find admins managing multiple hostels
- `find_by_activity_level()` - Find admins by activity metrics
- `find_inactive_admins()` - Find inactive admin accounts
- `find_pending_approval()` - Find admins pending verification
- `find_expiring_access()` - Find admins with expiring assignments
- `get_admin_hierarchy()` - Get reporting hierarchy
- `get_team_statistics()` - Get team management stats
- `get_effective_permissions()` - Calculate effective permissions
- `validate_permission()` - Check specific permission
- `track_login()` - Track login with security monitoring
- `end_session()` - End admin session
- `get_active_sessions()` - Get active sessions
- `terminate_all_sessions()` - Force logout all sessions
- `suspend_admin()` - Suspend admin account
- `reactivate_admin()` - Reactivate suspended admin
- `terminate_admin()` - Permanently terminate admin
- `get_admin_statistics()` - Get admin analytics
- `get_admin_performance_metrics()` - Get performance metrics

---

## 5. `hostel_context_repository.py`

### **HostelContextRepository**
**Purpose**: Manages hostel context switching and session tracking for multi-hostel admins

**Key Functions**:
- `get_active_context()` - Get admin's current active context
- `set_active_context()` - Set/switch active hostel context
- `end_context()` - End active context session
- `update_activity()` - Update context activity metrics
- `refresh_context_stats()` - Refresh cached context statistics
- `get_context_with_stats()` - Get context with fresh stats
- `get_switch_history()` - Get context switch history
- `get_switch_analytics()` - Get switching pattern analytics
- `get_context_preferences()` - Get context preferences
- `update_context_preferences()` - Update context settings
- `save_ui_state()` - Save UI state for session restoration
- `cleanup_stale_contexts()` - Clean up inactive contexts
- `cleanup_old_snapshots()` - Delete old context snapshots
- `recommend_context_switch()` - Recommend context switches

---

## 6. `hostel_selector_repository.py`

### **HostelSelectorRepository**
**Purpose**: Manages hostel selection UI with recent access, favorites, and quick stats

**Key Functions**:
- `track_hostel_access()` - Track hostel access for recent list
- `get_recent_hostels()` - Get recently accessed hostels
- `cleanup_old_recent_entries()` - Clean up old recent entries
- `decay_access_counts()` - Decay time-based access counters
- `add_favorite()` - Add hostel to favorites
- `find_favorite()` - Find specific favorite
- `get_favorites()` - Get all favorites for admin
- `update_favorite()` - Update favorite settings
- `remove_favorite()` - Remove from favorites
- `reorder_favorites()` - Reorder favorite hostels
- `get_hostel_quick_stats()` - Get quick stats for hostel
- `refresh_quick_stats()` - Refresh hostel quick stats
- `bulk_refresh_stats()` - Refresh stats for multiple hostels
- `get_selector_cache()` - Get pre-computed selector cache
- `rebuild_selector_cache()` - Rebuild complete selector cache
- `invalidate_selector_cache()` - Force invalidate cache
- `get_selector_analytics()` - Get selector usage analytics

---

## 7. `multi_hostel_dashboard_repository.py`

### **MultiHostelDashboardRepository**
**Purpose**: Manages aggregated dashboard data and cross-hostel analytics

**Key Functions**:
- `get_dashboard()` - Get dashboard for admin and date
- `refresh_dashboard()` - Refresh dashboard with latest data
- `get_cross_hostel_metrics()` - Get cross-hostel comparisons
- `get_performance_rankings()` - Get hostel performance rankings
- `get_top_performers()` - Get top performing hostels
- `get_underperformers()` - Get underperforming hostels
- `get_admin_widgets()` - Get dashboard widgets
- `create_widget()` - Create new dashboard widget
- `update_widget()` - Update widget configuration
- `delete_widget()` - Delete dashboard widget
- `refresh_widget_data()` - Refresh widget data
- `create_snapshot()` - Create dashboard snapshot
- `get_snapshots()` - Get historical snapshots
- `cleanup_old_snapshots()` - Delete old snapshots
- `get_trend_data()` - Get trend data from snapshots
- `get_portfolio_summary()` - Get comprehensive portfolio summary

---

## 8. `__init__.py`

### **AdminRepositoryFactory**
**Purpose**: Factory for creating admin repository instances with dependency injection

**Key Functions**:
- `get_admin_user_repository()` - Get AdminUserRepository instance
- `get_admin_permissions_repository()` - Get AdminPermissionsRepository instance
- `get_admin_assignment_repository()` - Get AdminHostelAssignmentRepository instance
- `get_admin_override_repository()` - Get AdminOverrideRepository instance
- `get_hostel_context_repository()` - Get HostelContextRepository instance
- `get_hostel_selector_repository()` - Get HostelSelectorRepository instance
- `get_dashboard_repository()` - Get MultiHostelDashboardRepository instance
- `clear_cache()` - Clear all cached repository instances

---

## Summary

**Total Classes**: 8 main repository classes + 1 factory class

**Architecture Pattern**: Each repository follows the Repository pattern, extending `BaseRepository` for common CRUD operations while providing domain-specific business logic for admin management, permissions, assignments, context switching, and analytics.

**Key Features Across All Classes**:
- Comprehensive error handling with custom exceptions
- Audit trail and history tracking
- Performance optimization with caching
- Analytics and reporting capabilities
- Security monitoring and validation
- Multi-hostel support with workload balancing

============================================================================================================================


# Analytics Repository Classes Overview

## 1. **analytics_aggregate_repository.py**

### Class: `AnalyticsAggregateRepository`
**Purpose**: Cross-module data aggregation and unified reporting
**Models Used**: BookingKPI, ComplaintKPI, OccupancyKPI, FinancialReport, SupervisorKPI, PlatformMetrics, DashboardKPI, QuickStats

**Key Functions**:
- `get_unified_dashboard_metrics()` - Aggregate metrics from all modules
- `get_platform_wide_metrics()` - Platform-wide aggregated metrics
- `compare_hostels_performance()` - Compare performance across hostels
- `get_time_series_metrics()` - Time series data for metrics
- `export_analytics_report()` - Export comprehensive reports

---

## 2. **booking_analytics_repository.py**

### Class: `BookingAnalyticsRepository`
**Purpose**: Booking performance tracking and conversion analysis
**Models Used**: BookingKPI, BookingTrendPoint, BookingFunnelAnalytics, CancellationAnalytics, BookingSourceMetrics, BookingAnalyticsSummary

**Key Functions**:
- `create_booking_kpi()` - Create/update booking KPIs
- `add_trend_points()` - Track booking trends over time
- `create_funnel_analytics()` - Conversion funnel analysis
- `create_cancellation_analytics()` - Cancellation pattern tracking
- `create_source_metrics()` - Traffic source performance
- `forecast_booking_demand()` - Demand forecasting
- `get_conversion_optimization_insights()` - Optimization recommendations

---

## 3. **complaint_analytics_repository.py**

### Class: `ComplaintAnalyticsRepository`
**Purpose**: Service quality tracking and complaint management analytics
**Models Used**: ComplaintKPI, SLAMetrics, ComplaintTrendPoint, CategoryBreakdown, PriorityBreakdown, ComplaintDashboard

**Key Functions**:
- `create_complaint_kpi()` - Create/update complaint KPIs
- `create_sla_metrics()` - SLA compliance tracking
- `add_complaint_trend_points()` - Complaint trend analysis
- `create_category_breakdown()` - Complaint categorization analysis
- `create_priority_breakdown()` - Priority-based analysis
- `create_complaint_dashboard()` - Comprehensive dashboard
- `calculate_efficiency_score()` - Performance scoring
- `forecast_complaint_volume()` - Volume forecasting

---

## 4. **custom_reports_repository.py**

### Class: `CustomReportsRepository`
**Purpose**: Flexible report generation and management
**Models Used**: CustomReportDefinition, ReportSchedule, ReportExecutionHistory, CachedReportResult

**Key Functions**:
- `create_report_definition()` - Create custom reports
- `create_schedule()` - Schedule automated reports
- `create_execution_history()` - Track report executions
- `cache_report_result()` - Cache report results
- `get_cached_result()` - Retrieve cached results
- `get_due_schedules()` - Find reports due for execution
- `share_report()` - Report sharing functionality
- `search_reports()` - Search through reports

---

## 5. **dashboard_analytics_repository.py**

### Class: `DashboardAnalyticsRepository`
**Purpose**: Dashboard data management and KPI tracking
**Models Used**: DashboardKPI, TimeseriesMetric, DashboardWidget, AlertNotification, QuickStats, RoleSpecificDashboard

**Key Functions**:
- `create_or_update_kpi()` - Manage dashboard KPIs
- `add_timeseries_metric()` - Time series data collection
- `create_or_update_widget()` - Widget configuration
- `create_alert()` - Alert notifications
- `create_or_update_quick_stats()` - Quick stats snapshots
- `create_or_update_role_dashboard()` - Role-specific dashboards
- `calculate_metric_trend()` - Trend calculations

---

## 6. **financial_analytics_repository.py**

### Class: `FinancialAnalyticsRepository`
**Purpose**: Financial performance tracking and P&L management
**Models Used**: RevenueBreakdown, ExpenseBreakdown, FinancialRatios, ProfitAndLossStatement, CashflowPoint, CashflowSummary, BudgetComparison, TaxSummary, FinancialReport

**Key Functions**:
- `create_revenue_breakdown()` - Revenue analysis by source
- `create_expense_breakdown()` - Expense categorization
- `create_pnl_statement()` - Profit & Loss statements
- `create_cashflow_summary()` - Cashflow analysis
- `create_budget_comparison()` - Budget vs actual analysis
- `create_tax_summary()` - Tax calculations
- `create_financial_report()` - Comprehensive financial reports

---

## 7. **occupancy_analytics_repository.py**

### Class: `OccupancyAnalyticsRepository`
**Purpose**: Capacity management and occupancy optimization
**Models Used**: OccupancyKPI, OccupancyTrendPoint, OccupancyByRoomType, OccupancyByFloor, SeasonalPattern, ForecastPoint, ForecastData, OccupancyReport

**Key Functions**:
- `create_occupancy_kpi()` - Occupancy KPIs tracking
- `add_occupancy_trend_points()` - Trend analysis
- `create_room_type_occupancy()` - Room type analysis
- `create_floor_occupancy()` - Floor-wise analysis
- `identify_seasonal_patterns()` - Pattern recognition
- `generate_occupancy_forecast()` - Demand forecasting
- `create_occupancy_report()` - Comprehensive reports

---

## 8. **platform_analytics_repository.py**

### Class: `PlatformAnalyticsRepository`
**Purpose**: Multi-tenant platform oversight and growth tracking
**Models Used**: TenantMetrics, PlatformMetrics, MonthlyMetric, GrowthMetrics, ChurnAnalysis, SystemHealthMetrics, PlatformUsageAnalytics, RevenueMetrics

**Key Functions**:
- `create_tenant_metrics()` - Individual tenant performance
- `create_platform_metrics()` - Platform-wide metrics
- `create_growth_metrics()` - Growth tracking
- `create_churn_analysis()` - Churn prediction
- `create_system_health_metrics()` - System health monitoring
- `create_platform_usage_analytics()` - Usage analytics
- `create_revenue_metrics()` - Revenue tracking
- `get_at_risk_tenants()` - Risk identification

---

## 9. **supervisor_analytics_repository.py**

### Class: `SupervisorAnalyticsRepository`
**Purpose**: Staff performance tracking and team analytics
**Models Used**: SupervisorWorkload, SupervisorPerformanceRating, SupervisorKPI, SupervisorTrendPoint, SupervisorComparison, TeamAnalytics

**Key Functions**:
- `create_supervisor_kpi()` - Individual performance KPIs
- `create_supervisor_workload()` - Workload management
- `create_performance_rating()` - Performance ratings
- `add_supervisor_trend_points()` - Performance trends
- `create_supervisor_comparison()` - Comparative analysis
- `create_team_analytics()` - Team-level analytics

---

## 10. **visitor_analytics_repository.py**

### Class: `VisitorAnalyticsRepository`
**Purpose**: User acquisition funnel and behavior tracking
**Models Used**: VisitorFunnel, TrafficSourceMetrics, SearchBehavior, EngagementMetrics, VisitorBehaviorAnalytics, ConversionPathAnalysis, TrafficSourceAnalytics

**Key Functions**:
- `create_visitor_funnel()` - Acquisition funnel tracking
- `create_traffic_source_metrics()` - Traffic source performance
- `create_search_behavior()` - Search behavior analysis
- `create_engagement_metrics()` - User engagement tracking
- `create_visitor_behavior_analytics()` - Comprehensive behavior analysis
- `create_traffic_source_analytics()` - Traffic source analytics

---

## **Common Base Classes Used**:

### `BaseRepository`
**Purpose**: Base functionality for all repositories
**Functions**: Basic CRUD operations, database session management

### `QueryBuilder`
**Purpose**: Dynamic query construction
**Functions**: Flexible query building, filtering, sorting

### `PaginationManager`
**Purpose**: Handle paginated results
**Functions**: Page-based data retrieval, count calculations

### `CachingRepository`
**Purpose**: Result caching functionality
**Functions**: Cache storage, retrieval, invalidation

Each repository class focuses on a specific domain of analytics while providing comprehensive data management, calculation logic, and reporting capabilities for that domain.
============================================================================================================================
# Announcement Repository Classes Overview

## 1. **announcement_aggregate_repository.py**

### `AnnouncementAggregateRepository`
**Purpose:** Orchestrates complex workflows across multiple repositories
**Key Functions:**
- `create_complete_announcement()` - Creates announcement with targeting, scheduling, and approval in one transaction
- `process_approval_and_publish()` - Handles approval workflow and automatic publishing
- `initialize_delivery()` - Sets up multi-channel delivery for published announcements
- `process_scheduled_publications()` - Processes due scheduled announcements
- `process_recurring_announcements()` - Handles recurring announcement creation
- `generate_comprehensive_report()` - Creates detailed analytics reports
- `get_hostel_dashboard_metrics()` - Real-time dashboard data
- `cleanup_expired_announcements()` - Maintenance and cleanup operations

---

## 2. **announcement_approval_repository.py**

### `AnnouncementApprovalRepository`
**Purpose:** Manages approval workflows with SLA tracking and multi-level approvals
**Key Functions:**
- `create_approval_request()` - Creates approval requests for announcements
- `approve_announcement()` - Approves announcements with audit trail
- `reject_announcement()` - Rejects with reasons and suggestions
- `resubmit_for_approval()` - Handles resubmission after rejection
- `assign_to_approver()` - Manual approver assignment
- `escalate_approval()` - Escalates overdue approvals
- `auto_approve()` - Automatic approval based on rules
- `create_approval_rule()` - Creates auto-approval rules
- `check_sla_breaches()` - Monitors SLA compliance
- `get_approval_statistics()` - Approval performance metrics

---

## 3. **announcement_delivery_repository.py**

### `AnnouncementDeliveryRepository`
**Purpose:** Multi-channel delivery management with optimization and failover
**Key Functions:**
- `create_delivery()` - Creates individual delivery records
- `create_bulk_deliveries()` - Bulk delivery record creation
- `execute_delivery()` - Executes delivery through providers
- `mark_delivered()` - Marks delivery as successful
- `mark_failed()` - Handles delivery failures with retry logic
- `create_delivery_batch()` - Creates processing batches
- `process_batch()` - Processes delivery batches
- `get_optimal_channel()` - Determines best delivery channel
- `configure_delivery_channel()` - Sets up delivery providers
- `find_pending_deliveries()` - Gets deliveries ready for processing
- `get_delivery_statistics()` - Delivery performance metrics

---

## 4. **announcement_repository.py**

### `ActiveAnnouncementsSpec`
**Purpose:** Specification pattern for filtering active announcements
**Functions:**
- `is_satisfied_by()` - Checks if announcement meets criteria
- `to_sqlalchemy()` - Converts to SQLAlchemy filter

### `UrgentAnnouncementsSpec`
**Purpose:** Specification for urgent announcements
**Functions:**
- `to_sqlalchemy()` - SQL filter for urgent announcements

### `RequiresAcknowledgmentSpec`
**Purpose:** Specification for announcements requiring acknowledgment
**Functions:**
- `to_sqlalchemy()` - SQL filter for acknowledgment-required announcements

### `AnnouncementRepository`
**Purpose:** Core announcement CRUD operations and content management
**Key Functions:**
- `create_draft()` - Creates announcement drafts with versioning
- `create_from_template()` - Creates from existing templates
- `find_by_id_with_details()` - Gets announcement with all relations
- `find_by_hostel()` - Hostel-specific announcements with filtering
- `find_active_by_hostel()` - Active announcements only
- `find_urgent_announcements()` - Urgent announcements
- `find_requiring_acknowledgment()` - Acknowledgment-required announcements
- `search_announcements()` - Full-text search with ranking
- `update_content()` - Updates content with versioning
- `publish_announcement()` - Publishes or schedules announcements
- `archive_announcement()` - Archives old announcements
- `get_announcement_statistics()` - Comprehensive statistics
- `get_performance_metrics()` - Performance analysis

---

## 5. **announcement_scheduling_repository.py**

### `AnnouncementSchedulingRepository`
**Purpose:** Advanced scheduling with recurring patterns and queue management
**Key Functions:**
- `create_schedule()` - Creates one-time schedules
- `create_recurring_schedule()` - Creates recurring schedules
- `update_schedule()` - Updates scheduled announcements
- `cancel_schedule()` - Cancels scheduled announcements
- `create_recurring_announcement()` - Creates recurring templates
- `process_due_recurring_announcements()` - Processes due recurring items
- `get_pending_publications()` - Gets items ready for publishing
- `acquire_queue_lock()` - Distributed processing locks
- `complete_queue_item()` - Marks queue items as processed
- `record_execution()` - Records schedule execution
- `check_sla_breaches()` - Monitors scheduling SLAs
- `find_upcoming_schedules()` - Gets upcoming scheduled items

---

## 6. **announcement_targeting_repository.py**

### `AnnouncementTargetingRepository`
**Purpose:** Advanced audience targeting and segmentation
**Key Functions:**
- `build_audience_segment()` - Creates audience segments
- `build_multi_criteria_segment()` - Complex multi-criteria targeting
- `calculate_target_reach()` - Calculates audience reach
- `optimize_delivery_timing()` - Finds optimal delivery times
- `personalize_content()` - Generates personalized content
- `track_targeting_effectiveness()` - Measures targeting success
- `manage_audience_preferences()` - Handles user preferences
- `prevent_over_messaging()` - Prevents announcement fatigue
- `create_bulk_targeting_rule()` - Bulk targeting operations
- `process_bulk_targeting()` - Processes bulk rules
- `get_cached_audience()` - Manages audience caching
- `invalidate_audience_cache()` - Cache invalidation

---

## 7. **announcement_tracking_repository.py**

### `AnnouncementTrackingRepository`
**Purpose:** Comprehensive engagement tracking and analytics
**Key Functions:**
- `record_view()` - Records announcement views
- `update_reading_metrics()` - Updates reading behavior data
- `record_engagement_action()` - Records user interactions
- `mark_as_read()` - Creates read receipts
- `bulk_mark_as_read()` - Bulk read receipt creation
- `acknowledge_announcement()` - Handles acknowledgments
- `verify_acknowledgment()` - Verifies acknowledgment actions
- `calculate_engagement_metrics()` - Calculates comprehensive metrics
- `generate_reading_time_analytics()` - Reading time analysis
- `get_student_engagement_profile()` - Individual student profiles
- `get_announcement_timeline()` - Complete engagement timeline
- `compare_announcement_performance()` - Performance comparisons
- `identify_low_engagement_students()` - Finds disengaged students

---

## Summary

**Total Classes: 8**
- 1 Aggregate Orchestrator
- 6 Specialized Domain Repositories  
- 3 Specification Classes

**Core Purpose:** Each repository handles a specific domain within announcement management, from creation to delivery to analytics, following Domain-Driven Design principles with clear separation of concerns.
============================================================================================================================
# Attendance Repository Classes - Complete Overview

## 1. AttendanceRecordRepository
**File:** `attendance_record_repository.py`  
**Purpose:** Core CRUD operations for attendance records, bulk operations, and corrections management

### Functions:
**Core CRUD:**
- `create_attendance()` - Create new attendance record
- `update_attendance()` - Update existing attendance record  
- `get_by_id()` - Get record by ID
- `get_by_student_and_date()` - Get specific student's attendance for a date

**Bulk Operations:**
- `create_bulk_attendance()` - Create multiple records at once
- `update_bulk_attendance()` - Update multiple records at once
- `get_bulk_operation_logs()` - Get bulk operation history

**Query Operations:**
- `get_by_hostel_and_date()` - Get all hostel attendance for specific date
- `get_student_attendance_range()` - Get student attendance in date range
- `get_hostel_attendance_range()` - Get hostel attendance in date range with pagination
- `find_late_entries()` - Find late arrival records
- `find_absent_students()` - Find absent students for date
- `find_consecutive_absences()` - Find consecutive absence streaks
- `get_by_mode()` - Get records by marking mode (manual/auto/bulk)
- `get_corrected_records()` - Get all corrected records

**Statistics & Analytics:**
- `calculate_attendance_percentage()` - Calculate attendance percentage
- `get_attendance_summary()` - Get comprehensive attendance stats
- `get_hostel_daily_summary()` - Get daily summary for hostel
- `get_late_entry_statistics()` - Get late entry stats
- `count_unmarked_students()` - Count students without attendance

**Correction Management:**
- `create_correction()` - Create attendance correction record
- `get_correction_history()` - Get all corrections for a record

---

## 2. AttendancePolicyRepository
**File:** `attendance_policy_repository.py`  
**Purpose:** Manages attendance policies, violations, and exceptions

### Functions:
**Policy CRUD:**
- `create_policy()` - Create new attendance policy
- `update_policy()` - Update existing policy
- `get_by_id()` - Get policy by ID
- `get_by_hostel()` - Get policy for specific hostel
- `get_all_active_policies()` - Get all active policies
- `deactivate_policy()` - Deactivate policy

**Policy Validation:**
- `validate_attendance_percentage()` - Check if percentage meets requirements
- `check_consecutive_absence_violation()` - Check consecutive absence violations
- `check_late_entry_violation()` - Check late entry violations

**Violation Management:**
- `create_violation()` - Create policy violation record
- `get_violation_by_id()` - Get violation by ID
- `get_student_violations()` - Get all violations for student
- `get_policy_violations()` - Get violations for specific policy
- `update_violation()` - Update violation record
- `mark_violation_notified()` - Mark violation as notified
- `resolve_violation()` - Resolve violation
- `get_unresolved_violations()` - Get all unresolved violations

**Exception Management:**
- `create_exception()` - Create policy exception
- `get_exception_by_id()` - Get exception by ID
- `get_student_exceptions()` - Get exceptions for student
- `check_active_exception()` - Check if student has active exception
- `approve_exception()` - Approve exception request
- `revoke_exception()` - Revoke approved exception
- `get_expiring_exceptions()` - Get exceptions nearing expiry

**Statistics:**
- `get_violation_statistics()` - Get violation statistics
- `get_exception_statistics()` - Get exception statistics

---

## 3. AttendanceAlertRepository
**File:** `attendance_alert_repository.py`  
**Purpose:** Manages attendance alerts, notifications, and escalations

### Functions:
**Alert CRUD:**
- `create_alert()` - Create new alert
- `get_by_id()` - Get alert by ID
- `update_alert()` - Update alert

**Query Operations:**
- `get_student_alerts()` - Get alerts for specific student
- `get_hostel_alerts()` - Get alerts for hostel with pagination
- `get_critical_alerts()` - Get critical severity alerts
- `get_escalated_alerts()` - Get escalated alerts
- `get_unacknowledged_alerts()` - Get unacknowledged alerts
- `find_duplicate_alerts()` - Find duplicate alerts in time window

**Alert Actions:**
- `acknowledge_alert()` - Acknowledge alert
- `assign_alert()` - Assign alert to user
- `add_action_taken()` - Add action taken to alert
- `resolve_alert()` - Resolve alert
- `escalate_alert()` - Escalate alert to higher level

**Configuration Management:**
- `create_configuration()` - Create alert configuration for hostel
- `get_configuration_by_hostel()` - Get configuration for hostel
- `update_configuration()` - Update alert configuration

**Notification Management:**
- `create_notification()` - Create notification record
- `mark_notification_delivered()` - Mark notification as delivered
- `mark_notification_read()` - Mark notification as read
- `mark_notification_failed()` - Mark notification as failed
- `get_alert_notifications()` - Get all notifications for alert
- `get_failed_notifications()` - Get failed notifications for retry

**Statistics:**
- `get_alert_statistics()` - Get alert statistics
- `get_notification_statistics()` - Get notification statistics

---

## 4. AttendanceReportRepository
**File:** `attendance_report_repository.py`  
**Purpose:** Report generation, caching, summaries, and trend analysis

### Functions:
**Report CRUD:**
- `create_report()` - Create attendance report
- `get_by_id()` - Get report by ID (with view tracking)
- `get_by_cache_key()` - Get cached report by key
- `get_reports()` - Get reports with filters and pagination
- `delete_expired_cache()` - Delete expired cached reports
- `update_report_generation_time()` - Update generation time

**Summary Operations:**
- `create_summary()` - Create attendance summary
- `get_summary_by_id()` - Get summary by ID
- `get_student_summary()` - Get summary for student and period
- `get_student_summaries()` - Get all summaries for student
- `get_hostel_summaries()` - Get summaries for hostel in period
- `get_low_attendance_summaries()` - Get summaries with low attendance
- `update_summary()` - Update summary
- `recalculate_summary()` - Recalculate summary with new metrics

**Trend Operations:**
- `create_trend()` - Create attendance trend
- `get_trend_by_id()` - Get trend by ID
- `get_hostel_trends()` - Get trends for hostel
- `get_student_trends()` - Get trends for student
- `get_trend_by_period()` - Get trend for specific period
- `get_anomaly_trends()` - Get trends with detected anomalies
- `update_trend()` - Update trend

**Analytics & Statistics:**
- `get_hostel_overview()` - Get comprehensive hostel overview
- `get_comparative_analysis()` - Compare two periods
- `get_top_performers()` - Get top performing students
- `get_bottom_performers()` - Get bottom performing students

---

## 5. AttendanceAggregateRepository
**File:** `attendance_aggregate_repository.py`  
**Purpose:** Complex queries, analytics, and cross-entity operations

### Functions:
**Dashboard Analytics:**
- `get_hostel_dashboard_data()` - Get comprehensive hostel dashboard metrics
- `get_student_dashboard_data()` - Get comprehensive student dashboard metrics

**Attendance Patterns:**
- `analyze_weekly_pattern()` - Analyze attendance by day of week
- `detect_absence_patterns()` - Detect patterns in absences across hostel

**Comparative Analytics:**
- `compare_student_cohorts()` - Compare attendance across student groups
- `get_trend_comparison()` - Get trend comparison over multiple periods

**Risk Assessment:**
- `identify_at_risk_students()` - Identify students at risk of failing requirements

**Performance Metrics:**
- `get_performance_metrics()` - Get comprehensive performance metrics

**Forecasting:**
- `forecast_attendance()` - Forecast future attendance based on patterns

---

## Key Class Relationships:

1. **AttendanceRecordRepository** → Core data operations
2. **AttendancePolicyRepository** → Business rules and violations
3. **AttendanceAlertRepository** → Monitoring and notifications
4. **AttendanceReportRepository** → Reporting and analysis
5. **AttendanceAggregateRepository** → Advanced analytics and insights

Each class is focused on a specific domain within attendance management, providing clear separation of concerns and comprehensive functionality for their respective areas.
============================================================================================================================
# Audit Repository Classes - Complete Overview

## 1. **admin_override_log_repository.py**

### **AdminOverrideLogRepository**
**Purpose:** Tracks admin interventions and overrides with governance and accountability

**Key Functions:**
- `create_override_log()` - Log admin overrides with impact analysis
- `find_by_admin()` - Get overrides by admin user
- `find_by_supervisor()` - Get overrides of supervisor decisions  
- `find_pending_approval()` - Get overrides waiting for approval
- `approve_override()` - Approve pending overrides
- `reject_override()` - Reject pending overrides
- `get_override_statistics()` - Analytics on override patterns
- `get_supervisor_override_analysis()` - Analyze overrides of specific supervisor

---

## 2. **audit_aggregate_repository.py**

### **AuditAggregateRepository**
**Purpose:** Cross-functional audit analytics combining data from all audit sources

**Key Functions:**
- `get_dashboard_metrics()` - Overall audit dashboard metrics
- `get_activity_trends()` - Activity trends across all audit sources
- `get_user_comprehensive_activity()` - Complete user activity analysis
- `get_security_overview()` - Security events and monitoring
- `detect_suspicious_patterns()` - AI-powered suspicious activity detection
- `generate_compliance_report()` - Comprehensive compliance reporting
- `get_system_performance_metrics()` - System performance from audit data

---

## 3. **audit_log_repository.py**

### **AuditLogRepository**
**Purpose:** System-wide activity tracking and audit trail management

**Key Functions:**
- `create_audit_log()` - Create audit log entries
- `bulk_create_audit_logs()` - Batch create audit logs
- `find_by_user()` - Get audit logs by user
- `find_by_entity()` - Get logs for specific entities
- `find_by_hostel()` - Get logs by hostel
- `find_failed_actions()` - Get failed operations
- `find_sensitive_actions()` - Get sensitive data access
- `get_action_statistics()` - Action analytics and statistics
- `get_security_events()` - Security-related events
- `get_compliance_report()` - Compliance audit reports
- `archive_old_logs()` - Archive old audit data

---

## 4. **entity_change_log_repository.py**

### **EntityChangeLogRepository**
**Purpose:** Detailed field-level change tracking with granular history

**Key Functions:**
- `create_change_log()` - Log field-level changes
- `get_entity_history()` - Complete change history for entity
- `get_field_history()` - History of specific field changes
- `get_changes_by_user()` - Changes made by specific user
- `get_sensitive_changes()` - Sensitive/PII data changes
- `invalidate_change()` - Mark changes as rolled back
- `mark_reviewed()` - Mark changes as reviewed
- `get_change_statistics()` - Change analytics
- `detect_anomalies()` - Detect unusual change patterns

### **EntityChangeHistoryRepository**
**Purpose:** Entity state snapshots and version history

**Key Functions:**
- `create_snapshot()` - Create entity state snapshot
- `get_current_version()` - Get latest entity version
- `get_version_history()` - Get all versions of entity
- `get_version_at_time()` - Get entity state at specific time
- `compare_versions()` - Compare two entity versions

---

## 5. **supervisor_activity_log_repository.py**

### **SupervisorActivityLogRepository**
**Purpose:** Supervisor activity tracking with performance metrics and analytics

**Key Functions:**
- `create_activity_log()` - Log supervisor activities
- `find_by_supervisor()` - Get activities by supervisor
- `find_by_hostel()` - Get activities by hostel
- `find_by_student()` - Get activities related to student
- `find_requiring_follow_up()` - Get activities needing follow-up
- `get_supervisor_performance_metrics()` - Performance analytics
- `get_efficiency_analysis()` - Efficiency metrics analysis
- `compare_supervisor_performance()` - Compare supervisors
- `get_workload_distribution()` - Workload balance analysis
- `mark_follow_up_completed()` - Mark follow-ups as done

---

## **Class Usage Summary:**

| **Class** | **Primary Use** | **Key Domain** |
|-----------|----------------|----------------|
| `AdminOverrideLogRepository` | Admin intervention tracking | Governance & Accountability |
| `AuditAggregateRepository` | Cross-system analytics | Reporting & Analytics |
| `AuditLogRepository` | System-wide activity logs | Core Audit Trail |
| `EntityChangeLogRepository` | Field-level change tracking | Data Change History |
| `EntityChangeHistoryRepository` | Entity version snapshots | Version Control |
| `SupervisorActivityLogRepository` | Supervisor performance tracking | Performance Management |

**Overall System Purpose:** Comprehensive audit trail system with security monitoring, compliance reporting, performance analytics, and administrative accountability.
============================================================================================================================
# Authentication Repository Classes - Complete Overview

## 1. **auth_aggregate_repository.py**

### **AuthAggregateRepository**
- **Purpose**: Central coordinator for all authentication operations
- **Use**: Single entry point for complex authentication workflows
- **Key Functions**:
  - `authenticate_user()` - Complete login workflow
  - `logout_user()` - Complete logout workflow  
  - `logout_all_sessions()` - Logout from all devices
  - `refresh_authentication()` - Refresh JWT tokens
  - `send_otp()` - Send OTP via email/SMS
  - `verify_otp()` - Verify OTP codes
  - `initiate_password_reset()` - Start password reset
  - `complete_password_reset()` - Complete password reset
  - `link_social_account()` - Link OAuth accounts
  - `get_authentication_overview()` - User auth statistics
  - `get_security_dashboard()` - System security metrics
  - `cleanup_expired_data()` - Clean old data

---

## 2. **user_session_repository.py**

### **UserSessionRepository**
- **Purpose**: Manage user sessions with device tracking and security
- **Use**: Track user logins, devices, and session activity
- **Key Functions**:
  - `create_session()` - Create new user session
  - `find_by_session_id()` - Find session by ID
  - `find_active_sessions()` - Get all active sessions
  - `update_session_activity()` - Update last activity
  - `terminate_session()` - End single session
  - `terminate_all_user_sessions()` - End all user sessions
  - `find_suspicious_sessions()` - Find high-risk sessions
  - `detect_concurrent_locations()` - Detect multi-location logins
  - `find_sessions_by_device()` - Find device sessions
  - `is_trusted_device()` - Check device trust status
  - `get_user_devices()` - Get user's device list
  - `cleanup_expired_sessions()` - Clean old sessions

### **SessionTokenRepository**
- **Purpose**: Manage JWT access tokens
- **Use**: Handle short-lived access tokens (15 minutes)
- **Key Functions**:
  - `create_token()` - Create access token
  - `find_by_jti()` - Find by JWT ID
  - `is_token_valid()` - Check token validity
  - `revoke_token()` - Revoke single token
  - `revoke_session_tokens()` - Revoke all session tokens
  - `cleanup_expired_tokens()` - Clean old tokens

### **RefreshTokenRepository**
- **Purpose**: Manage JWT refresh tokens with rotation
- **Use**: Handle long-lived refresh tokens with security rotation
- **Key Functions**:
  - `create_token()` - Create refresh token
  - `find_by_jti()` - Find by JWT ID
  - `find_by_family_id()` - Find token family
  - `is_token_valid()` - Check token validity
  - `use_token()` - Mark token as used
  - `revoke_token_family()` - Revoke entire token family
  - `detect_token_reuse()` - Detect security breaches
  - `cleanup_expired_tokens()` - Clean old tokens

### **LoginAttemptRepository**
- **Purpose**: Track and analyze login attempts
- **Use**: Security monitoring and brute force detection
- **Key Functions**:
  - `record_attempt()` - Log login attempt
  - `count_recent_failures()` - Count failed attempts
  - `find_suspicious_attempts()` - Find high-risk attempts
  - `get_attempt_statistics()` - Get attempt analytics
  - `cleanup_old_attempts()` - Clean old attempts

---

## 3. **otp_token_repository.py**

### **OTPTokenRepository**
- **Purpose**: Manage OTP generation and validation
- **Use**: Handle one-time passwords for 2FA
- **Key Functions**:
  - `create_otp()` - Generate OTP token
  - `find_valid_otp()` - Find valid OTP
  - `verify_otp()` - Verify OTP code
  - `invalidate_previous_otps()` - Cancel old OTPs
  - `get_otp_statistics()` - OTP usage stats
  - `cleanup_expired_otps()` - Clean old OTPs

### **OTPTemplateRepository**
- **Purpose**: Manage OTP message templates
- **Use**: Handle email/SMS templates for OTP delivery
- **Key Functions**:
  - `find_template()` - Find template by type/channel
  - `create_template()` - Create new template
  - `get_all_templates()` - Get all templates

### **OTPDeliveryRepository**
- **Purpose**: Track OTP delivery status
- **Use**: Monitor OTP delivery success/failure
- **Key Functions**:
  - `create_delivery()` - Create delivery record
  - `mark_as_sent()` - Mark as sent
  - `mark_as_delivered()` - Mark as delivered
  - `mark_as_failed()` - Mark as failed
  - `get_delivery_statistics()` - Delivery analytics

### **OTPThrottlingRepository**
- **Purpose**: Prevent OTP abuse with rate limiting
- **Use**: Block excessive OTP requests
- **Key Functions**:
  - `check_rate_limit()` - Check if request allowed
  - `reset_throttling()` - Reset rate limits
  - `cleanup_old_records()` - Clean old records

---

## 4. **password_reset_repository.py**

### **PasswordResetRepository**
- **Purpose**: Manage password reset tokens
- **Use**: Handle secure password reset workflow
- **Key Functions**:
  - `create_reset_token()` - Generate reset token
  - `find_by_token()` - Find by token
  - `find_valid_token()` - Find valid token
  - `verify_and_use_token()` - Verify and consume token
  - `invalidate_user_tokens()` - Cancel user tokens
  - `get_reset_statistics()` - Reset analytics
  - `cleanup_expired_tokens()` - Clean old tokens

### **PasswordHistoryRepository**
- **Purpose**: Track password change history
- **Use**: Prevent password reuse and audit changes
- **Key Functions**:
  - `add_to_history()` - Add password to history
  - `get_user_history()` - Get password history
  - `check_password_reuse()` - Check if password was used
  - `get_password_age()` - Get current password age
  - `cleanup_old_history()` - Clean old history

### **PasswordPolicyRepository**
- **Purpose**: Manage password complexity policies
- **Use**: Enforce password strength rules
- **Key Functions**:
  - `create_policy()` - Create password policy
  - `get_active_policy()` - Get current policy
  - `validate_password()` - Validate against policy
  - `get_all_policies()` - Get all policies

### **PasswordAttemptRepository**
- **Purpose**: Track password-related attempts
- **Use**: Monitor password attacks and lockouts
- **Key Functions**:
  - `record_attempt()` - Record password attempt
  - `count_recent_failures()` - Count failed attempts
  - `should_lockout()` - Check lockout conditions
  - `reset_attempts()` - Reset attempt counter
  - `get_attempt_statistics()` - Attempt analytics
  - `cleanup_old_attempts()` - Clean old attempts

---

## 5. **social_auth_token_repository.py**

### **SocialAuthProviderRepository**
- **Purpose**: Manage OAuth provider configurations
- **Use**: Configure Google, Facebook, etc. OAuth settings
- **Key Functions**:
  - `create_provider()` - Add OAuth provider
  - `find_by_name()` - Find provider by name
  - `get_enabled_providers()` - Get active providers
  - `enable_provider()` - Enable provider
  - `disable_provider()` - Disable provider

### **SocialAuthTokenRepository**
- **Purpose**: Manage OAuth access/refresh tokens
- **Use**: Store and manage OAuth tokens from providers
- **Key Functions**:
  - `create_token()` - Store OAuth token
  - `find_by_user_and_provider()` - Find user's token
  - `find_user_tokens()` - Get all user tokens
  - `refresh_token()` - Refresh OAuth token
  - `revoke_token()` - Revoke OAuth token
  - `get_expired_tokens()` - Find expired tokens

### **SocialAuthProfileRepository**
- **Purpose**: Manage social profile data
- **Use**: Store user data from OAuth providers
- **Key Functions**:
  - `create_or_update_profile()` - Sync profile data
  - `find_by_user_and_provider()` - Find user profile
  - `find_by_provider_user_id()` - Find by provider ID
  - `find_user_profiles()` - Get all user profiles
  - `sync_profile()` - Update profile data
  - `get_profiles_needing_sync()` - Find stale profiles

### **SocialAuthLinkRepository**
- **Purpose**: Manage social account linking
- **Use**: Link/unlink social accounts to user accounts
- **Key Functions**:
  - `create_link()` - Link social account
  - `find_by_user_and_provider()` - Find link
  - `find_user_links()` - Get all user links
  - `unlink_account()` - Unlink social account
  - `relink_account()` - Relink account
  - `set_primary_link()` - Set primary auth method
  - `get_primary_link()` - Get primary link
  - `count_active_links()` - Count linked accounts
  - `get_link_statistics()` - Link analytics

---

## 6. **token_blacklist_repository.py**

### **BlacklistedTokenRepository**
- **Purpose**: Manage revoked/blacklisted tokens
- **Use**: Prevent use of compromised or revoked tokens
- **Key Functions**:
  - `blacklist_token()` - Add token to blacklist
  - `is_blacklisted()` - Check if token is blacklisted
  - `find_by_jti()` - Find blacklisted token
  - `find_user_blacklisted_tokens()` - Get user's blacklisted tokens
  - `bulk_blacklist_tokens()` - Blacklist multiple tokens
  - `cleanup_expired_tokens()` - Clean old blacklisted tokens
  - `get_blacklist_statistics()` - Blacklist analytics

### **TokenRevocationRepository**
- **Purpose**: Audit trail for token revocations
- **Use**: Track why and when tokens were revoked
- **Key Functions**:
  - `record_revocation()` - Log revocation event
  - `find_user_revocations()` - Get user revocation history
  - `find_forced_revocations()` - Get admin revocations
  - `get_revocation_statistics()` - Revocation analytics

### **SecurityEventRepository**
- **Purpose**: Track security events and threats
- **Use**: Monitor security incidents and generate alerts
- **Key Functions**:
  - `record_event()` - Log security event
  - `find_user_events()` - Get user security events
  - `find_high_risk_events()` - Find high-risk events
  - `find_critical_events()` - Find critical events
  - `find_events_by_ip()` - Get events by IP
  - `resolve_event()` - Mark event as resolved
  - `bulk_resolve_events()` - Resolve multiple events
  - `get_event_statistics()` - Security analytics
  - `get_threat_intelligence()` - Threat analysis
  - `cleanup_old_events()` - Clean old events

---

## **Summary by Function**

- **Session Management**: UserSessionRepository, SessionTokenRepository, RefreshTokenRepository
- **Authentication Security**: LoginAttemptRepository, PasswordAttemptRepository
- **Multi-Factor Auth**: OTPTokenRepository, OTPTemplateRepository, OTPDeliveryRepository, OTPThrottlingRepository
- **Password Management**: PasswordResetRepository, PasswordHistoryRepository, PasswordPolicyRepository
- **Social Auth**: SocialAuthProviderRepository, SocialAuthTokenRepository, SocialAuthProfileRepository, SocialAuthLinkRepository
- **Security Monitoring**: BlacklistedTokenRepository, TokenRevocationRepository, SecurityEventRepository
- **Orchestration**: AuthAggregateRepository
============================================================================================================================
# Complete Repository Classes Overview

## 1. **base_repository.py**

### **AuditContext**
- **Purpose**: Store audit information (user_id, ip_address, action, metadata)
- **Use**: Track who did what and when for audit trails

### **BaseRepository[ModelType]**
- **Purpose**: Abstract base repository with all CRUD operations
- **Functions**:
  - `create()`, `create_many()` - Create entities
  - `find_by_id()`, `get_by_id()` - Read single entity
  - `find_all()`, `find_by_criteria()` - Read multiple entities
  - `update()`, `update_many()` - Update entities
  - `delete()`, `soft_delete()`, `restore()` - Delete operations
  - `count()`, `exists()` - Counting operations
  - `find_by_hostel()` - Multi-tenant queries
  - Transaction management methods

---

## 2. **caching_repository.py**

### **CacheStrategy**
- **Purpose**: Enum for cache strategies
- **Values**: WRITE_THROUGH, WRITE_BEHIND, CACHE_ASIDE, REFRESH_AHEAD

### **CacheLevel**
- **Purpose**: Enum for cache levels
- **Values**: L1 (in-memory), L2 (Redis), L3 (database)

### **LRUCache**
- **Purpose**: In-memory LRU cache implementation
- **Functions**: `get()`, `set()`, `delete()`, `clear()`, `get_stats()`

### **CacheKeyGenerator**
- **Purpose**: Generate consistent cache keys
- **Functions**: 
  - `generate_entity_key()` - For single entities
  - `generate_query_key()` - For query results
  - `generate_list_key()` - For list queries
  - `hash_criteria()` - Hash filter criteria

### **CacheInvalidator**
- **Purpose**: Handle cache invalidation strategies
- **Functions**:
  - `invalidate_entity()` - Invalidate specific entity
  - `invalidate_pattern()` - Invalidate by pattern
  - `invalidate_table()` - Invalidate entire table

### **CachingRepository[ModelType]**
- **Purpose**: Wrap any repository with caching capabilities
- **Functions**: All BaseRepository methods + cache management

---

## 3. **filtering.py**

### **FilterOperator**
- **Purpose**: Enum for filter operations
- **Values**: EQUALS, NOT_EQUALS, GREATER_THAN, LIKE, IN, BETWEEN, etc.

### **FilterType**
- **Purpose**: Enum for value types
- **Values**: STRING, NUMBER, BOOLEAN, DATE, ARRAY, OBJECT

### **Filter**
- **Purpose**: Single filter condition
- **Functions**: `to_dict()`, `from_dict()`

### **FilterGroup**
- **Purpose**: Group filters with AND/OR logic
- **Functions**: `to_dict()`

### **FilterEngine**
- **Purpose**: Apply complex filters to queries
- **Functions**:
  - `apply_filters()` - Apply all filters
  - `full_text_search()` - Full-text search
  - `fuzzy_search()` - Fuzzy matching
  - `range_filter()` - Range filtering
  - `geospatial_filter()` - Location-based filtering

### **SearchQueryBuilder**
- **Purpose**: Builder for complex search queries
- **Functions**:
  - `add_filter()`, `add_text_search()`, `add_fuzzy_search()`
  - `add_geo_filter()`, `build()`

---

## 4. **pagination.py**

### **PaginationStrategy**
- **Purpose**: Enum for pagination types
- **Values**: OFFSET, CURSOR, KEYSET, HYBRID

### **PageInfo**
- **Purpose**: Pagination metadata
- **Properties**: current_page, total_items, has_next, has_previous, etc.

### **PaginatedResult[ModelType]**
- **Purpose**: Container for paginated results
- **Properties**: items (data), page_info (metadata)
- **Functions**: `to_dict()`

### **Cursor**
- **Purpose**: Cursor for cursor-based pagination
- **Functions**: `encode()`, `decode()`

### **PaginationManager[ModelType]**
- **Purpose**: Handle different pagination strategies
- **Functions**:
  - `paginate_offset()` - Traditional page-based
  - `paginate_cursor()` - Cursor-based for large datasets
  - `paginate_keyset()` - Keyset pagination
  - `paginate_hybrid()` - Automatic strategy selection

### **PageSizeOptimizer**
- **Purpose**: Optimize page size based on device/context
- **Functions**: `optimize()`

### **PaginationCache**
- **Purpose**: Cache paginated results
- **Functions**: `get()`, `set()`, `invalidate()`

---

## 5. **query_builder.py**

### **JoinType**
- **Purpose**: Enum for SQL join types
- **Values**: INNER, LEFT, RIGHT, OUTER

### **OrderDirection**
- **Purpose**: Enum for sort direction
- **Values**: ASC, DESC

### **QueryBuilder[ModelType]**
- **Purpose**: Fluent query builder for complex queries
- **Functions**:
  - **Filtering**: `where()`, `filter()`, `or_where()`, `where_like()`
  - **Joins**: `join()`, `left_join()`, `outer_join()`
  - **Eager Loading**: `with_eager()`, `with_subquery()`
  - **Ordering**: `order_by()`, `order_by_desc()`
  - **Grouping**: `group_by()`, `having()`
  - **Pagination**: `limit()`, `offset()`, `paginate()`
  - **Execution**: `all()`, `first()`, `one()`, `count()`

---

## 6. **repository_factory.py**

### **RepositoryRegistry**
- **Purpose**: Registry for repository classes
- **Functions**: `register()`, `get()`, `list_all()`

### **RepositoryFactory**
- **Purpose**: Create and manage repository instances
- **Functions**:
  - `create()` - Create repository instance
  - `create_by_name()` - Create by registered name
  - `get_or_create()` - Singleton pattern
  - `clear_cache()` - Clear repository caches
  - `get_statistics()` - Factory statistics

### **RepositoryDecorator**
- **Purpose**: Base class for repository decorators
- **Functions**: `_wrap_methods()`, `_before_call()`

### **PerformanceProfilingDecorator**
- **Purpose**: Add performance monitoring to repositories
- **Functions**: `get_statistics()` - Get execution metrics

### **TransactionDecorator**
- **Purpose**: Add automatic transaction management
- **Functions**: Wraps mutating operations in transactions

---

## 7. **specifications.py**

### **Specification[ModelType]**
- **Purpose**: Abstract base for business rule specifications
- **Functions**: `to_expression()`, `apply()`, `__and__()`, `__or__()`

### **AndSpecification**, **OrSpecification**, **NotSpecification**
- **Purpose**: Combine specifications with logical operators

### **Generic Specifications:**
- **FieldEqualsSpecification** - Field equals value
- **FieldInSpecification** - Field in list
- **FieldBetweenSpecification** - Field between values
- **FieldLikeSpecification** - Field matches pattern
- **DateRangeSpecification** - Date range filtering

### **Domain-Specific Specifications:**

#### **Student Specifications:**
- **ActiveStudentsSpecification** - Active enrolled students
- **StudentsEnrolledInPeriodSpecification** - Students enrolled in date range
- **StudentsWithOverdueDocumentsSpecification** - Students with expiring documents

#### **Booking Specifications:**
- **PendingBookingsSpecification** - Pending confirmations
- **ConfirmedBookingsSpecification** - Confirmed bookings
- **BookingsForDateRangeSpecification** - Bookings in date range
- **ExpiredBookingsSpecification** - Expired unconfirmed bookings

#### **Room & Bed Specifications:**
- **AvailableRoomsSpecification** - Available rooms for booking
- **AvailableBedsSpecification** - Available beds for assignment
- **RoomsRequiringMaintenanceSpecification** - Rooms needing maintenance

#### **Payment Specifications:**
- **OverduePaymentsSpecification** - Past due payments
- **PendingPaymentsSpecification** - Payments awaiting processing
- **PaymentsInDateRangeSpecification** - Payments in date range
- **FailedPaymentsSpecification** - Failed payments for retry

#### **Complaint Specifications:**
- **OpenComplaintsSpecification** - Open complaints
- **HighPriorityComplaintsSpecification** - High priority complaints
- **EscalatedComplaintsSpecification** - Escalated complaints
- **OverdueComplaintsSpecification** - Past SLA complaints

#### **Maintenance Specifications:**
- **PendingMaintenanceSpecification** - Pending maintenance requests
- **InProgressMaintenanceSpecification** - Active maintenance
- **OverdueMaintenanceSpecification** - Overdue maintenance
- **PreventiveMaintenanceSpecification** - Preventive maintenance due

#### **Attendance Specifications:**
- **PresentTodaySpecification** - Students present today
- **AbsentTodaySpecification** - Students absent today
- **LowAttendanceSpecification** - Students with low attendance

#### **Leave Specifications:**
- **PendingLeaveRequestsSpecification** - Leave requests awaiting approval
- **ApprovedLeaveSpecification** - Approved leave requests
- **ActiveLeaveSpecification** - Currently active leave

#### **Document Specifications:**
- **ExpiredDocumentsSpecification** - Expired documents
- **ExpiringDocumentsSpecification** - Documents expiring soon
- **UnverifiedDocumentsSpecification** - Documents pending verification

#### **Utility Specifications:**
- **SoftDeletedSpecification** - Soft-deleted entities
- **NotDeletedSpecification** - Non-deleted entities
- **ByHostelSpecification** - Multi-tenant filtering
- **ByUserSpecification** - User-specific entities

---

## **Usage Summary:**

1. **BaseRepository** - Core CRUD operations for any entity
2. **CachingRepository** - Add caching to any repository
3. **QueryBuilder** - Build complex queries fluently
4. **FilterEngine** - Apply advanced filtering
5. **PaginationManager** - Handle different pagination strategies
6. **RepositoryFactory** - Create and manage repository instances
7. **Specifications** - Encapsulate business rules as reusable components

Each class serves a specific purpose in creating a comprehensive, enterprise-grade repository layer with caching, filtering, pagination, and business rule management.
============================================================================================================================
# Complete Booking Repository Classes Overview

## 1. booking_aggregate_repository.py

### BookingAggregateRepository
**Purpose:** Complex analytics and dashboard data for booking management
**Key Functions:**
- `get_booking_funnel_metrics()` - Conversion rates through booking pipeline
- `get_hostel_performance_dashboard()` - Complete performance metrics
- `get_time_series_bookings()` - Historical booking trends
- `get_pending_actions_summary()` - Items requiring admin attention

---

## 2. booking_approval_repository.py

### BookingApprovalRepository
**Purpose:** Manage booking approval workflow and decisions
**Key Functions:**
- `create_approval_record()` - Create approval decision record
- `update_pricing()` - Update pricing in approval
- `set_payment_deadline()` - Set advance payment deadlines
- `find_pending_payment()` - Find bookings awaiting payment
- `get_approval_statistics()` - Approval workflow metrics

### ApprovalSettingsRepository
**Purpose:** Configure auto-approval rules and policies
**Key Functions:**
- `find_by_hostel()` - Get hostel's approval settings
- `create_or_update_settings()` - Configure approval rules
- `check_auto_approval_criteria()` - Validate if booking qualifies for auto-approval
- `find_hostels_with_auto_approval()` - List hostels using auto-approval

### RejectionRecordRepository
**Purpose:** Track booking rejections and alternative suggestions
**Key Functions:**
- `create_rejection_record()` - Record booking rejection
- `mark_notification_sent()` - Track rejection notifications
- `find_with_alternatives_suggested()` - Rejections with alternative options
- `get_rejection_statistics()` - Rejection analytics

---

## 3. booking_assignment_repository.py

### BookingAssignmentRepository
**Purpose:** Manage room and bed assignments for bookings
**Key Functions:**
- `create_assignment()` - Assign room/bed to booking
- `find_active_by_booking()` - Get current assignment
- `reassign_booking()` - Move booking to different room/bed
- `deactivate_assignment()` - Release assignment
- `find_available_beds_for_booking()` - Find suitable available beds
- `get_room_assignment_statistics()` - Room occupancy metrics

---

## 4. booking_calendar_repository.py

### BookingCalendarEventRepository
**Purpose:** Manage calendar events for booking timeline
**Key Functions:**
- `create_event_from_booking()` - Generate calendar events
- `find_events_for_date_range()` - Get events in date range
- `find_high_priority_events()` - Get urgent events
- `find_events_requiring_action()` - Events needing admin attention
- `mark_action_completed()` - Complete event actions

### DayAvailabilityRepository
**Purpose:** Track daily bed availability and occupancy
**Key Functions:**
- `find_or_create_for_date()` - Get/create daily availability record
- `calculate_and_update_availability()` - Compute bed availability
- `find_fully_booked_dates()` - Identify unavailable dates
- `get_occupancy_trend()` - Historical occupancy data

### CalendarBlockRepository
**Purpose:** Manage calendar blocking for maintenance/events
**Key Functions:**
- `create_block()` - Block dates for maintenance/events
- `find_active_blocks()` - Get current blocks
- `find_blocks_for_date_range()` - Check blocks in date range
- `mark_completed()` - Complete blocking period
- `get_block_statistics()` - Blocking analytics

---

## 5. booking_cancellation_repository.py

### BookingCancellationRepository
**Purpose:** Handle booking cancellations and refund processing
**Key Functions:**
- `create_cancellation()` - Process booking cancellation
- `calculate_refund_amount()` - Calculate refund based on policy
- `initiate_refund()` - Start refund process
- `complete_refund()` - Mark refund as completed
- `find_pending_refunds()` - Get pending refund requests
- `get_cancellation_statistics()` - Cancellation analytics

### CancellationPolicyRepository
**Purpose:** Manage cancellation policies and rules
**Key Functions:**
- `find_by_hostel()` - Get hostel cancellation policies
- `find_active_by_hostel()` - Get current active policy
- `create_or_update_policy()` - Set cancellation rules

### RefundTransactionRepository
**Purpose:** Track individual refund transactions
**Key Functions:**
- `create_refund_transaction()` - Record refund transaction
- `find_by_cancellation()` - Get refunds for cancellation
- `find_by_gateway_id()` - Find transaction by payment gateway ID

---

## 6. booking_conversion_repository.py

### BookingConversionRepository
**Purpose:** Convert guest bookings to permanent student records
**Key Functions:**
- `create_conversion()` - Start booking to student conversion
- `verify_documents()` - Verify uploaded documents
- `mark_payment_received()` - Record security deposit/rent payments
- `find_pending_conversions()` - Get conversions needing completion
- `get_conversion_statistics()` - Conversion analytics

### ConversionChecklistRepository
**Purpose:** Manage conversion requirement checklist
**Key Functions:**
- `create_checklist()` - Create conversion checklist
- `add_checklist_item()` - Add requirement to checklist
- `complete_checklist_item()` - Mark requirement as completed
- `get_incomplete_items()` - Get outstanding requirements

---

## 7. booking_guest_repository.py

### BookingGuestRepository
**Purpose:** Manage guest profile information and verification
**Key Functions:**
- `create_guest_info()` - Create guest profile
- `find_by_email()` - Search guests by email
- `search_guests()` - Multi-field guest search
- `verify_id_proof()` - Verify guest identification
- `find_incomplete_profiles()` - Get profiles missing information
- `find_minors()` - Identify underage guests

### GuestDocumentRepository
**Purpose:** Handle guest document uploads and verification
**Key Functions:**
- `add_document()` - Upload guest document
- `verify_document()` - Verify document authenticity
- `reject_document()` - Reject invalid document
- `find_unverified_documents()` - Get documents awaiting verification
- `find_expiring_documents()` - Get documents expiring soon

---

## 8. booking_modification_repository.py

### BookingModificationRepository
**Purpose:** Handle booking modification requests
**Key Functions:**
- `create_modification_request()` - Submit modification request
- `calculate_price_impact()` - Calculate price changes
- `approve_modification()` - Approve modification request
- `reject_modification()` - Reject modification request
- `apply_modification()` - Apply approved changes to booking
- `get_modification_statistics()` - Modification analytics

### ModificationApprovalRecordRepository
**Purpose:** Track modification approval decisions
**Key Functions:**
- `create_approval_record()` - Record approval/rejection decision
- `find_by_modification()` - Get approval record for modification

---

## 9. booking_repository.py

### BookingSearchCriteria
**Purpose:** Define search parameters for booking queries
**Properties:** All booking search filters (status, dates, amounts, etc.)

### BookingStatistics
**Purpose:** Structure for booking analytics data
**Properties:** Counts, rates, revenue metrics

### BookingRepository
**Purpose:** Main booking operations and lifecycle management
**Key Functions:**
- `search_bookings()` - Advanced booking search with filters
- `find_by_reference()` - Get booking by reference number
- `create_booking_request()` - Create new booking
- `approve_booking()` - Approve pending booking
- `reject_booking()` - Reject booking request
- `confirm_booking()` - Confirm after payment
- `cancel_booking()` - Cancel booking
- `check_availability()` - Check room availability
- `find_conflicting_bookings()` - Find booking conflicts
- `get_booking_statistics()` - Comprehensive booking analytics

---

## 10. booking_waitlist_repository.py

### BookingWaitlistRepository
**Purpose:** Manage waitlist for fully booked periods
**Key Functions:**
- `add_to_waitlist()` - Add visitor to waitlist
- `find_by_hostel_and_room_type()` - Get waitlist for specific room type
- `get_next_in_line()` - Get top priority waitlist entry
- `notify_availability()` - Notify when beds become available
- `convert_to_booking()` - Convert waitlist entry to booking
- `cancel_waitlist_entry()` - Remove from waitlist
- `expire_old_entries()` - Remove expired waitlist entries
- `get_waitlist_statistics()` - Waitlist analytics

### WaitlistNotificationRepository
**Purpose:** Track waitlist availability notifications
**Key Functions:**
- `find_by_waitlist()` - Get notifications for waitlist entry
- `record_response()` - Record visitor response to notification
- `find_pending_responses()` - Get notifications awaiting response
- `find_expiring_soon()` - Get notifications about to expire

---

## Summary by Business Function

**Core Booking Management:** BookingRepository, BookingAggregateRepository
**Approval Workflow:** BookingApprovalRepository, ApprovalSettingsRepository, RejectionRecordRepository  
**Room Management:** BookingAssignmentRepository
**Calendar & Availability:** BookingCalendarEventRepository, DayAvailabilityRepository, CalendarBlockRepository
**Cancellations:** BookingCancellationRepository, CancellationPolicyRepository, RefundTransactionRepository
**Guest Management:** BookingGuestRepository, GuestDocumentRepository
**Modifications:** BookingModificationRepository, ModificationApprovalRecordRepository  
**Student Conversion:** BookingConversionRepository, ConversionChecklistRepository
**Waitlist Management:** BookingWaitlistRepository, WaitlistNotificationRepository
============================================================================================================================
# Complete Clarity on Complaint Repository Classes

## Overview of All Repository Files and Their Classes

---

## 1. **complaint_aggregate_repository.py**

### Classes:
1. **`ComplaintAggregateRepository`**
   - **Purpose**: Complex multi-entity queries combining data from multiple complaint-related tables
   - **Use Case**: Dashboard summaries, executive reports, cross-entity analytics
   - **Key Functions**:
     - `get_dashboard_summary()` - Overall complaint metrics for dashboards
     - `get_complaint_details_with_relations()` - Complete complaint data with all relationships
     - `get_hostel_performance_comparison()` - Compare multiple hostels
     - `get_category_performance_trends()` - Category-wise performance analysis
     - `get_staff_workload_overview()` - Team workload distribution
     - `generate_executive_report()` - Comprehensive management reports

---

## 2. **complaint_analytics_repository.py**

### Classes:

1. **`ComplaintAnalyticSnapshotRepository`**
   - **Purpose**: Pre-computed analytics snapshots for historical tracking
   - **Use Case**: Performance dashboards, trend analysis, historical comparisons
   - **Key Functions**:
     - `create_snapshot()` - Store pre-calculated metrics
     - `generate_daily_snapshot()` - Daily automated metrics
     - `generate_weekly_snapshot()` - Weekly aggregations
     - `generate_monthly_snapshot()` - Monthly performance reports
     - `compare_periods()` - Period-over-period comparison
     - `find_latest_snapshot()` - Most recent metrics

2. **`ComplaintCategoryMetricRepository`**
   - **Purpose**: Category-specific performance metrics
   - **Use Case**: Track performance by complaint type (Maintenance, Cleanliness, etc.)
   - **Key Functions**:
     - `create_category_metric()` - Store category metrics
     - `find_by_category()` - Get metrics for specific category
     - Performance tracking per category

3. **`ComplaintStaffPerformanceRepository`**
   - **Purpose**: Staff member performance tracking
   - **Use Case**: Evaluate staff efficiency, identify top performers
   - **Key Functions**:
     - `create_performance_metric()` - Record staff metrics
     - `find_by_staff()` - Get individual staff performance
     - `get_top_performers()` - Identify best performers

---

## 3. **complaint_assignment_repository.py**

### Classes:

1. **`ComplaintAssignmentRepository`**
   - **Purpose**: Manage complaint assignments and workload distribution
   - **Use Case**: Assign complaints to staff, balance workload, track assignment history
   - **Key Functions**:
     - `create_assignment()` - Assign complaint to staff member
     - `complete_assignment()` - Mark assignment done
     - `find_by_complaint()` - Assignment history for a complaint
     - `find_current_assignment()` - Active assignment
     - `find_by_assignee()` - All assignments for a user
     - `get_user_workload()` - Calculate user's current workload
     - `get_team_workload_distribution()` - Team-wide workload view
     - `find_least_loaded_user()` - Auto-assignment optimization
     - `calculate_workload_score()` - Workload calculation algorithm
     - `get_assignment_performance()` - User assignment metrics
     - `suggest_optimal_assignee()` - AI-assisted assignment
     - `balance_workload()` - Workload rebalancing suggestions

---

## 4. **complaint_comment_repository.py**

### Classes:

1. **`ComplaintCommentRepository`**
   - **Purpose**: Manage comments, discussions, and internal notes
   - **Use Case**: Communication threads, staff collaboration, customer updates
   - **Key Functions**:
     - `create_comment()` - Add comment/reply
     - `update_comment()` - Edit with version tracking
     - `find_by_complaint()` - All comments for complaint
     - `find_root_comments()` - Top-level comments only
     - `find_replies()` - Threaded replies
     - `find_by_user()` - User's comment history
     - `find_with_mentions()` - Comments mentioning specific user
     - `find_internal_notes()` - Staff-only notes
     - `get_comment_thread()` - Complete discussion thread
     - `get_thread_summary()` - Thread statistics
     - `get_comment_statistics()` - Comment analytics
     - `get_user_comment_activity()` - User activity metrics
     - `search_comments()` - Advanced comment search

---

## 5. **complaint_escalation_repository.py**

### Classes:

1. **`ComplaintEscalationRepository`**
   - **Purpose**: Track and manage complaint escalations
   - **Use Case**: Escalate unresolved complaints, track escalation chains
   - **Key Functions**:
     - `create_escalation()` - Escalate complaint
     - `respond_to_escalation()` - Record escalation response
     - `mark_escalation_resolved()` - Close escalation
     - `find_by_complaint()` - Escalation history
     - `find_by_escalated_user()` - User's escalations
     - `find_pending_escalations()` - Unanswered escalations
     - `find_auto_escalations()` - Auto-triggered escalations
     - `find_by_level()` - Escalations at specific level
     - `get_escalation_statistics()` - Escalation metrics
     - `get_user_escalation_performance()` - User response metrics
     - `get_escalation_trends()` - Escalation patterns over time
     - `get_escalation_chain()` - Complete escalation path
     - `get_next_escalation_level()` - Calculate next level
     - `check_escalation_eligibility()` - Validation before escalation

2. **`AutoEscalationRuleRepository`**
   - **Purpose**: Manage automatic escalation rules
   - **Use Case**: Configure auto-escalation based on time/priority
   - **Key Functions**:
     - `create_rule()` - Define escalation rule
     - `find_active_rules()` - Get active rules
     - `find_by_hostel()` - Hostel-specific rules
     - `find_applicable_rule()` - Match rule to complaint
     - `get_escalation_targets()` - Get escalation recipients
     - `activate_rule()` / `deactivate_rule()` - Toggle rules
     - `update_escalation_targets()` - Change escalation chain
     - `update_thresholds()` - Modify time thresholds
     - `get_rule_effectiveness()` - Rule performance analysis

---

## 6. **complaint_feedback_repository.py**

### Classes:

1. **`ComplaintFeedbackRepository`**
   - **Purpose**: Collect and analyze customer satisfaction feedback
   - **Use Case**: Measure resolution quality, identify improvement areas
   - **Key Functions**:
     - `create_feedback()` - Submit customer feedback
     - `verify_feedback()` - Mark feedback as verified
     - `find_by_complaint()` - Get complaint feedback
     - `find_by_hostel()` - Hostel feedback collection
     - `find_by_sentiment()` - Filter by sentiment (positive/negative)
     - `find_requiring_follow_up()` - Low-rating feedback needing action
     - `get_satisfaction_metrics()` - Overall satisfaction scores
     - `get_detailed_ratings()` - Breakdown of rating categories
     - `get_feedback_trends()` - Satisfaction trends over time
     - `_calculate_sentiment()` - Sentiment analysis algorithm
     - `_check_follow_up_needed()` - Auto-flag low satisfaction

---

## 7. **complaint_repository.py** (CORE)

### Classes:

1. **`ComplaintRepository`**
   - **Purpose**: Primary complaint CRUD operations and lifecycle management
   - **Use Case**: Create, update, search, and manage all complaint operations
   - **Key Functions**:
     
     **CRUD Operations:**
     - `create_complaint()` - Register new complaint
     - `update_complaint()` - Modify complaint details
     - `find_by_id()` - Get by ID (inherited from BaseRepository)
     - `find_by_complaint_number()` - Get by unique number
     
     **Query Operations:**
     - `find_by_hostel()` - Hostel's complaints with filters
     - `find_by_student()` - Student's complaint history
     - `find_assigned_to_user()` - User's assigned complaints
     - `find_overdue_complaints()` - SLA breached complaints
     - `find_escalated_complaints()` - Escalated complaints
     - `find_by_room()` - Room-specific complaints
     - `search_complaints()` - Advanced multi-filter search
     
     **Status Management:**
     - `assign_complaint()` - Assign to staff member
     - `mark_in_progress()` - Start work on complaint
     - `mark_resolved()` - Mark as resolved
     - `reopen_complaint()` - Reopen resolved complaint
     - `close_complaint()` - Final closure
     
     **Escalation Management:**
     - `escalate_complaint()` - Escalate to higher level
     
     **SLA Management:**
     - `mark_sla_breach()` - Record SLA violation
     - `find_sla_at_risk()` - Complaints near SLA deadline
     
     **Analytics & Reporting:**
     - `get_complaint_statistics()` - Overall statistics
     - `get_average_resolution_time()` - Performance metric
     - `get_top_categories()` - Most common complaint types
     
     **Bulk Operations:**
     - `bulk_assign()` - Assign multiple complaints
     - `bulk_update_priority()` - Update multiple priorities
     
     **Helper Methods:**
     - `_generate_complaint_number()` - Unique ID generation
     - `_calculate_sla_due_date()` - SLA calculation
     - `_handle_status_change()` - Status transition logic
     - `_handle_priority_change()` - Priority change handling

---

## 8. **complaint_resolution_repository.py**

### Classes:

1. **`ComplaintResolutionRepository`**
   - **Purpose**: Document resolution details and quality control
   - **Use Case**: Track resolution process, quality assurance, follow-ups
   - **Key Functions**:
     - `create_resolution()` - Document complaint resolution
     - `perform_quality_check()` - QA verification
     - `complete_follow_up()` - Mark follow-up done
     - `reopen_resolution()` - Reopen if unsatisfactory
     - `find_by_complaint()` - Resolution history
     - `find_final_resolution()` - Current active resolution
     - `find_by_resolver()` - User's resolution history
     - `find_pending_follow_ups()` - Scheduled follow-ups
     - `find_pending_quality_checks()` - Resolutions needing QA
     - `find_by_quality_score()` - Filter by quality rating
     - `get_resolution_statistics()` - Resolution metrics
     - `get_resolver_performance()` - Individual performance
     - `get_quality_distribution()` - Quality score distribution
     - `get_resolution_trends()` - Resolution patterns over time
     - `_calculate_median_resolution_time()` - Statistical calculation
     - `_calculate_efficiency_rating()` - Performance rating algorithm

---

## Summary Table

| File | Classes | Primary Purpose |
|------|---------|-----------------|
| **complaint_aggregate_repository.py** | 1. ComplaintAggregateRepository | Multi-entity queries, dashboards, reports |
| **complaint_analytics_repository.py** | 1. ComplaintAnalyticSnapshotRepository<br>2. ComplaintCategoryMetricRepository<br>3. ComplaintStaffPerformanceRepository | Pre-computed analytics, trends, performance tracking |
| **complaint_assignment_repository.py** | 1. ComplaintAssignmentRepository | Assignment management, workload balancing |
| **complaint_comment_repository.py** | 1. ComplaintCommentRepository | Comments, discussions, internal notes |
| **complaint_escalation_repository.py** | 1. ComplaintEscalationRepository<br>2. AutoEscalationRuleRepository | Escalation tracking, auto-escalation rules |
| **complaint_feedback_repository.py** | 1. ComplaintFeedbackRepository | Customer satisfaction, feedback analysis |
| **complaint_repository.py** | 1. ComplaintRepository | **CORE**: All complaint CRUD and lifecycle |
| **complaint_resolution_repository.py** | 1. ComplaintResolutionRepository | Resolution documentation, quality control |

---

## Function Categories Across All Repositories

### 1. **CRUD Operations**
- Create, Read, Update, Delete basic operations
- Found in: All repositories (inherited from BaseRepository)

### 2. **Query Operations**
- Find by various filters (ID, status, date, user, etc.)
- Advanced search with multiple criteria
- Found in: All repositories

### 3. **Business Logic**
- Status transitions, assignments, escalations
- Workload calculations, sentiment analysis
- Found in: ComplaintRepository, ComplaintAssignmentRepository, ComplaintFeedbackRepository

### 4. **Analytics & Reporting**
- Statistics, trends, performance metrics
- Dashboards, comparisons, distributions
- Found in: All analytics repositories, aggregate repository

### 5. **Helper Methods**
- Internal calculations (private methods starting with `_`)
- Validation, formatting, score calculations
- Found in: All repositories

---

## Data Flow Between Classes

```
ComplaintRepository (CORE)
    ↓
    ├─→ ComplaintAssignmentRepository (who handles it)
    ├─→ ComplaintCommentRepository (discussions)
    ├─→ ComplaintEscalationRepository (if escalated)
    ├─→ ComplaintResolutionRepository (when resolved)
    └─→ ComplaintFeedbackRepository (customer feedback)
         ↓
ComplaintAnalyticSnapshotRepository (daily/weekly summaries)
ComplaintAggregateRepository (complex reports)
```

This is the complete structure of your complaint repository system!
============================================================================================================================
# Complete Clarity: Fee Structure Repository Classes and Functions

## 1. **charge_component_repository.py**

### Classes:

#### **ChargeComponentRepository**
- **Purpose**: Manages individual charge components (rent, deposit, mess, utilities, etc.) within fee structures
- **Key Functions**:
  - `create_charge_component()` - Create new charge component with validation
  - `update_charge_component()` - Update existing component
  - `delete_charge_component()` - Soft/hard delete component
  - `find_by_fee_structure()` - Get all components for a fee structure
  - `find_applicable_components()` - Find components for specific room types and dates
  - `find_taxable_components()` - Get all taxable components
  - `find_recurring_components()` - Get recurring charge components
  - `find_refundable_components()` - Get refundable components
  - `calculate_total_components()` - Calculate total of components with filters
  - `calculate_tax_breakdown()` - Get detailed tax breakdown
  - `get_component_breakdown()` - Get detailed breakdown of all components
  - `bulk_create_components()` - Create multiple components at once
  - `bulk_update_amounts()` - Update amounts for multiple components
  - `clone_components_to_structure()` - Copy components to another fee structure
  - `search_components()` - Search by name or description

#### **ChargeRuleRepository**
- **Purpose**: Manages business rules for charge components (discounts, surcharges, waivers, proration)
- **Key Functions**:
  - `create_charge_rule()` - Create new charge rule
  - `update_charge_rule()` - Update existing rule
  - `activate_rule()` - Activate a charge rule
  - `deactivate_rule()` - Deactivate a charge rule
  - `find_by_component()` - Get all rules for a component
  - `find_discount_rules()` - Get all discount rules
  - `find_surcharge_rules()` - Get all surcharge rules
  - `find_waiver_rules()` - Get all waiver rules
  - `find_proration_rules()` - Get all proration rules
  - `get_highest_priority_rules()` - Get top priority rules
  - `get_rule_statistics()` - Get statistics on rules
  - `bulk_activate_rules()` - Activate multiple rules
  - `bulk_update_priority()` - Update priorities for multiple rules

#### **DiscountConfigurationRepository**
- **Purpose**: Manages discount configurations with usage tracking and validation
- **Key Functions**:
  - `create_discount()` - Create new discount configuration
  - `update_discount()` - Update existing discount
  - `activate_discount()` - Activate a discount
  - `deactivate_discount()` - Deactivate a discount
  - `find_active_discounts()` - Get all active discounts with filters
  - `find_by_code()` - Find discount by code
  - `find_expiring_soon()` - Get discounts expiring soon
  - `find_by_hostel()` - Get discounts for a hostel
  - `find_nearly_exhausted()` - Get discounts near usage limit
  - `find_for_new_students()` - Get new student discounts
  - `increment_usage()` - Increase usage count
  - `decrement_usage()` - Decrease usage count
  - `validate_discount_applicability()` - Check if discount is applicable
  - `calculate_discount_amount()` - Calculate discount amount
  - `get_best_applicable_discount()` - Find best discount for criteria
  - `get_discount_analytics()` - Get comprehensive analytics
  - `expire_discounts()` - Auto-expire old discounts

---

## 2. **fee_structure_repository.py**

### Classes:

#### **FeeStructureRepository**
- **Purpose**: Manages main fee structures with versioning and approval workflows
- **Key Functions**:
  - `create_fee_structure()` - Create new fee structure with validation
  - `update_fee_structure()` - Update with versioning support
  - `find_by_hostel_and_room_type()` - Get fee structures by hostel and room
  - `get_current_fee_structure()` - Get currently effective fee structure
  - `find_by_date_range()` - Get structures effective in date range
  - `get_fee_structure_with_components()` - Load structure with all components
  - `find_pending_approval()` - Get structures awaiting approval
  - `get_version_history()` - Get all versions of a structure
  - `get_fee_summary_by_hostel()` - Get summary for a hostel
  - `get_pricing_comparison()` - Compare pricing across hostels
  - `calculate_average_pricing()` - Get average pricing statistics
  - `get_upcoming_changes()` - Get structures with future effective dates
  - `get_expiring_structures()` - Get structures expiring soon
  - `bulk_update_effective_dates()` - Update dates for multiple structures
  - `bulk_deactivate()` - Deactivate multiple structures

---

## 3. **fee_calculation_repository.py**

### Classes:

#### **FeeCalculationRepository**
- **Purpose**: Manages fee calculations, estimates, and actual calculations for bookings
- **Key Functions**:
  - `create_fee_calculation()` - Create new fee calculation
  - `find_by_student()` - Get all calculations for a student
  - `find_by_booking()` - Get calculations for a booking
  - `find_by_fee_structure()` - Get calculations using a fee structure
  - `get_latest_calculation()` - Get most recent calculation
  - `find_pending_approval()` - Get calculations awaiting approval
  - `find_approved_calculations()` - Get approved calculations
  - `find_prorated_calculations()` - Get prorated calculations
  - `get_calculation_with_details()` - Load calculation with all related data
  - `approve_calculation()` - Approve a calculation
  - `bulk_approve_calculations()` - Approve multiple calculations
  - `get_calculation_statistics()` - Get statistical summary
  - `get_revenue_projection()` - Calculate revenue projections
  - `get_discount_impact_analysis()` - Analyze discount impact
  - `get_calculation_trends()` - Get monthly trends

#### **FeeProjectionRepository**
- **Purpose**: Manages fee projections and forecasting for future periods
- **Key Functions**:
  - `create_projection()` - Create new fee projection
  - `find_by_fee_structure()` - Get projections for a structure
  - `get_latest_projection()` - Get most recent projection
  - `find_by_period()` - Get projections by period length
  - `get_projection_accuracy()` - Compare projections vs actuals

---

## 4. **fee_aggregate_repository.py**

### Classes:

#### **FeeAggregateRepository**
- **Purpose**: Provides aggregated queries and analytics across ALL fee structure entities
- **Key Functions**:
  - `get_hostel_fee_summary()` - Complete fee summary for a hostel
  - `get_pricing_analytics()` - Comprehensive pricing analytics
  - `get_component_analytics()` - Analytics on charge components
  - `get_discount_analytics()` - Comprehensive discount analytics
  - `get_revenue_summary()` - Revenue summary from calculations
  - `get_revenue_by_room_type()` - Revenue breakdown by room type
  - `get_monthly_revenue_trend()` - Monthly revenue trends
  - `compare_fee_structures()` - Compare multiple fee structures
  - `get_market_positioning()` - Analyze market positioning vs competitors

---

## Summary Table

| File | Class | Primary Purpose |
|------|-------|----------------|
| charge_component_repository.py | ChargeComponentRepository | Manage individual charges (rent, mess, utilities) |
| charge_component_repository.py | ChargeRuleRepository | Manage business rules (discounts, surcharges, waivers) |
| charge_component_repository.py | DiscountConfigurationRepository | Manage discount codes and configurations |
| fee_structure_repository.py | FeeStructureRepository | Manage main fee structures with versioning |
| fee_calculation_repository.py | FeeCalculationRepository | Calculate and manage fee estimates and actuals |
| fee_calculation_repository.py | FeeProjectionRepository | Forecast and project future fees |
| fee_aggregate_repository.py | FeeAggregateRepository | Cross-entity analytics and reporting |

---

## Data Flow

1. **FeeStructureRepository** creates the main fee structure
2. **ChargeComponentRepository** adds individual charges to the structure
3. **ChargeRuleRepository** adds business rules to components
4. **DiscountConfigurationRepository** manages available discounts
5. **FeeCalculationRepository** calculates actual fees using above data
6. **FeeProjectionRepository** projects future revenue
7. **FeeAggregateRepository** provides analytics across all entities
============================================================================================================================
# Complete File Management Repository Structure

## 1. **file_upload_repository.py**

### Classes:

1. **FileUploadRepository(BaseRepository[FileUpload])**
   - **Purpose**: Main repository for core file upload operations
   - **Key Functions**:
     - `create_file_upload()` - Create new file with quota checking
     - `find_by_file_id()` - Find file by unique ID
     - `find_by_storage_key()` - Find file by storage location
     - `find_by_checksum()` - Find duplicates by checksum
     - `search_files()` - Advanced search with pagination
     - `update_processing_status()` - Update file processing state
     - `update_virus_scan_status()` - Update virus scan results
     - `track_file_access()` - Track file access metrics
     - `create_upload_session()` - Create upload session for direct/multipart
     - `find_upload_session()` - Get upload session
     - `update_upload_session_status()` - Update session state
     - `cleanup_expired_sessions()` - Clean expired sessions
     - `create_validation_result()` - Store validation results
     - `get_validation_results()` - Get file validation history
     - `create_multipart_upload()` - Initialize multipart upload
     - `create_multipart_part()` - Create upload part
     - `update_multipart_part_status()` - Update part status
     - `complete_multipart_upload()` - Finalize multipart upload
     - `get_quota()` - Get owner's quota
     - `create_or_update_quota()` - Manage quota settings
     - `_check_quota()` - Validate quota before upload
     - `_update_quota_usage()` - Update quota usage
     - `get_quota_statistics()` - Get quota stats
     - `get_upload_statistics()` - Get upload stats
     - `get_storage_breakdown_by_category()` - Storage by category
     - `find_large_files()` - Find files above size threshold
     - `find_unused_files()` - Find inactive files

2. **QuotaExceededException(Exception)**
   - **Purpose**: Custom exception for quota violations
   - **Use**: Raised when upload would exceed quota limits

---

## 2. **image_upload_repository.py**

### Classes:

1. **ImageUploadRepository(BaseRepository[ImageUpload])**
   - **Purpose**: Repository for image-specific operations
   - **Key Functions**:
     - `create_image_upload()` - Create image record with processing config
     - `find_by_file_id()` - Find image by file ID
     - `search_images()` - Search images with criteria
     - `create_variant()` - Create image variant (thumbnail, etc.)
     - `get_variants()` - Get all image variants
     - `get_variant_by_name()` - Get specific variant
     - `mark_variants_generated()` - Mark variant generation complete
     - `queue_for_processing()` - Add to processing queue
     - `get_next_processing_job()` - Get next job for worker
     - `update_processing_progress()` - Update processing progress
     - `complete_processing()` - Mark processing complete/failed
     - `get_processing_queue_stats()` - Queue statistics
     - `create_optimization_result()` - Store optimization results
     - `get_optimization_result()` - Get optimization data
     - `get_optimization_statistics()` - Optimization stats
     - `create_metadata()` - Store EXIF/metadata
     - `get_metadata()` - Get image metadata
     - `search_by_location()` - Search by GPS coordinates
     - `get_image_statistics()` - Image upload stats
     - `get_format_distribution()` - Format breakdown
     - `find_images_needing_optimization()` - Find unoptimized images
     - `find_images_needing_variants()` - Find images without variants

---

## 3. **document_upload_repository.py**

### Classes:

1. **DocumentUploadRepository(BaseRepository[DocumentUpload])**
   - **Purpose**: Repository for document operations with OCR and verification
   - **Key Functions**:
     - `create_document_upload()` - Create document with validation
     - `find_by_document_id()` - Find by unique document ID
     - `find_by_reference_number()` - Find by reference number
     - `search_documents()` - Search documents with criteria
     - `get_student_documents()` - Get all student documents
     - `get_document_type()` - Get document type configuration
     - `get_all_document_types()` - Get all document types
     - `create_document_type()` - Create document type
     - `validate_document_requirements()` - Validate against type rules
     - `create_ocr_result()` - Store OCR results
     - `get_ocr_result()` - Get OCR data
     - `find_documents_pending_ocr()` - Find documents needing OCR
     - `update_ocr_status()` - Update OCR status
     - `create_validation_result()` - Store validation results
     - `get_validation_results()` - Get validation history
     - `create_verification()` - Create verification record
     - `get_verification_history()` - Get verification history
     - `find_documents_pending_verification()` - Find pending docs
     - `get_verification_statistics()` - Verification stats
     - `create_expiry_tracking()` - Track document expiry
     - `update_expiry_calculations()` - Update expiry calculations
     - `_recalculate_expiry_days()` - Recalculate expiry
     - `find_expiring_documents()` - Find expiring documents
     - `find_expired_documents()` - Find expired documents
     - `send_expiry_alerts()` - Send expiry notifications
     - `mark_document_renewed()` - Mark document as renewed
     - `get_document_statistics()` - Document stats
     - `get_document_type_distribution()` - Distribution by type
     - `get_expiry_summary()` - Expiry summary
     - `check_student_document_compliance()` - Check compliance

---

## 4. **file_metadata_repository.py**

### Classes:

1. **FileMetadataRepository(BaseRepository[FileTag])**
   - **Purpose**: Repository for metadata, tags, access control, versioning, analytics
   - **Key Functions**:
     
     **Tag Operations**:
     - `create_tag()` - Create file tag
     - `get_tag_by_name()` - Get tag by name
     - `get_or_create_tag()` - Get or create tag
     - `get_popular_tags()` - Most used tags
     - `increment_tag_usage()` - Increment tag count
     - `decrement_tag_usage()` - Decrement tag count
     - `search_tags()` - Search tags
     
     **Access Control Operations**:
     - `grant_access()` - Grant file access to user/role/group
     - `get_access()` - Get access record
     - `get_file_access_list()` - Get all access records
     - `check_access_permission()` - Check specific permission
     - `revoke_access()` - Revoke access
     - `cleanup_expired_access()` - Clean expired access
     
     **Version Operations**:
     - `create_version()` - Create new file version
     - `get_current_version()` - Get current version
     - `get_version_history()` - Get all versions
     - `get_version_by_number()` - Get specific version
     - `restore_version()` - Restore previous version
     
     **Analytics Operations**:
     - `get_or_create_analytics()` - Get/create analytics record
     - `increment_view_count()` - Increment view count
     - `increment_download_count()` - Increment download count
     - `calculate_popularity_scores()` - Calculate popularity
     - `reset_period_counters()` - Reset daily/weekly/monthly counters
     
     **Access Log Operations**:
     - `log_file_access()` - Log access event
     - `get_access_logs()` - Get access logs
     - `get_user_access_history()` - User's access history
     - `get_access_analytics()` - Access analytics summary
     
     **Favorite Operations**:
     - `add_favorite()` - Add to favorites
     - `get_favorite()` - Get favorite record
     - `get_user_favorites()` - Get user's favorites
     - `remove_favorite()` - Remove from favorites
     - `track_favorite_access()` - Track favorite access

---

## 5. **file_aggregate_repository.py**

### Classes:

1. **FileAggregateRepository(BaseRepository[FileUpload])**
   - **Purpose**: Cross-cutting aggregations and analytics across all file entities
   - **Key Functions**:
     
     **Dashboard Analytics**:
     - `get_dashboard_summary()` - Complete dashboard with all metrics
     - `get_storage_analytics()` - Storage analytics and breakdown
     - `get_quota_overview()` - Quota overview across owners
     
     **Trend Analysis**:
     - `get_upload_trends()` - Upload trends over time
     - `get_access_trends()` - Access trends over time
     
     **Top Files and Rankings**:
     - `get_most_popular_files()` - Most popular by access
     - `get_trending_files()` - Currently trending files
     - `get_largest_files()` - Largest files by size
     
     **Processing Overview**:
     - `get_processing_overview()` - Processing status across all types
     
     **Optimization Opportunities**:
     - `identify_optimization_opportunities()` - Find optimization candidates
     
     **Compliance and Alerts**:
     - `get_compliance_alerts()` - Compliance alerts and warnings
     
     **User Activity**:
     - `get_user_file_activity()` - User's file activity summary
     
     **Batch Operations**:
     - `cleanup_orphaned_records()` - Clean orphaned records
     - `archive_old_access_logs()` - Archive old logs

---

## Summary by Repository:

| Repository | Primary Focus | Key Entities |
|-----------|---------------|--------------|
| **FileUploadRepository** | Core file operations | FileUpload, UploadSession, FileValidation, MultipartUpload, FileQuota |
| **ImageUploadRepository** | Image processing | ImageUpload, ImageVariant, ImageProcessing, ImageOptimization, ImageMetadata |
| **DocumentUploadRepository** | Document management | DocumentUpload, DocumentType, DocumentOCR, DocumentVerification, DocumentExpiry |
| **FileMetadataRepository** | Metadata & access | FileTag, FileAccess, FileVersion, FileAnalytics, FileAccessLog, FileFavorite |
| **FileAggregateRepository** | Cross-entity analytics | Aggregates across all file entities |

---

## Function Categories:

### CRUD Operations:
- Create, Read, Update, Delete for each entity

### Search & Query:
- Advanced search with filtering
- Pagination support
- Sorting and ordering

### Status Management:
- Processing status tracking
- Workflow state transitions
- Queue management

### Analytics:
- Statistics generation
- Trend analysis
- Usage metrics

### Compliance:
- Quota enforcement
- Validation
- Expiry tracking
- Access control

### Batch Operations:
- Cleanup tasks
- Archival
- Bulk updates
============================================================================================================================
# Complete Hostel Repository Classes - Clarity Document

## 1. hostel_aggregate_repository.py

### Classes:
1. **HostelAggregateRepository(BaseRepository[Hostel])**
   - **Purpose**: Complex cross-model operations combining data from multiple hostel-related tables
   - **Key Functions**:
     - `get_hostel_with_complete_details()` - Load hostel with all related data (rooms, students, amenities, media, policies)
     - `get_hostel_dashboard_data()` - Comprehensive dashboard metrics (occupancy, revenue, complaints, trends)
     - `search_hostels()` - Advanced search with multiple criteria and analytics
     - `get_hostels_by_location()` - Geographic search with distance calculation
     - `get_hostel_comparison_data()` - Compare multiple hostels side-by-side
     - `update_hostel_metrics()` - Recalculate and update all hostel metrics
     - `bulk_update_metrics()` - Update metrics for multiple hostels
     - `get_hostel_performance_summary()` - Performance analysis over time periods

---

## 2. hostel_amenity_repository.py

### Classes:

1. **AvailableAmenitiesSpecification(Specification[HostelAmenity])**
   - **Purpose**: Filter amenities that are available and have capacity
   - **Key Functions**:
     - `is_satisfied_by()` - Check if amenity meets availability criteria
     - `to_sql_condition()` - Convert to SQL WHERE clause

2. **BookableAmenitiesSpecification(Specification[HostelAmenity])**
   - **Purpose**: Filter amenities that can be booked
   - **Key Functions**:
     - `is_satisfied_by()` - Check if amenity is bookable
     - `to_sql_condition()` - Convert to SQL WHERE clause

3. **HostelAmenityRepository(BaseRepository[HostelAmenity])**
   - **Purpose**: Manage hostel amenities (gym, laundry, wifi, etc.)
   - **Key Functions**:
     - `find_by_hostel()` - Get all amenities for a hostel
     - `find_by_category()` - Filter by category (basic, premium, recreational)
     - `find_bookable_amenities()` - Get amenities requiring booking
     - `check_availability_for_booking()` - Check if amenity is available for time slot
     - `get_amenity_schedule()` - Get booking schedule for amenity
     - `find_amenities_needing_maintenance()` - Identify amenities needing maintenance
     - `update_maintenance_status()` - Update maintenance records
     - `get_amenity_usage_stats()` - Usage analytics by category
     - `get_popular_amenities()` - Most used amenities

4. **AmenityCategoryRepository(BaseRepository[AmenityCategory])**
   - **Purpose**: Manage amenity categories (basic, premium, etc.)
   - **Key Functions**:
     - `find_active_categories()` - Get all active categories
     - `find_basic_categories()` - Get essential amenity categories

5. **AmenityBookingRepository(BaseRepository[AmenityBooking])**
   - **Purpose**: Manage amenity reservations/bookings
   - **Key Functions**:
     - `create_booking()` - Book an amenity for time slot
     - `find_student_bookings()` - Get student's booking history
     - `find_amenity_bookings()` - Get all bookings for an amenity
     - `confirm_booking()` - Approve pending booking
     - `cancel_booking()` - Cancel a booking

---

## 3. hostel_analytics_repository.py

### Classes:

1. **HostelAnalyticsRepository(BaseRepository[HostelAnalytic])**
   - **Purpose**: Track and generate hostel performance analytics
   - **Key Functions**:
     - `generate_monthly_analytics()` - Create monthly performance report
     - `generate_yearly_analytics()` - Aggregate yearly analytics
     - `get_performance_trends()` - Historical trend analysis
     - `get_comparative_analytics()` - Compare multiple hostels
     - `get_top_performing_hostels()` - Leaderboard by metrics
     - `calculate_performance_score()` - Overall performance rating
     - `generate_insights()` - AI-generated actionable insights

2. **OccupancyTrendRepository(BaseRepository[OccupancyTrend])**
   - **Purpose**: Track daily occupancy patterns
   - **Key Functions**:
     - `record_daily_occupancy()` - Log daily occupancy data
     - `get_occupancy_trends()` - Historical occupancy analysis
     - `get_peak_occupancy_days()` - Identify high-demand periods

3. **RevenueTrendRepository(BaseRepository[RevenueTrend])**
   - **Purpose**: Track revenue patterns and growth
   - **Key Functions**:
     - `record_daily_revenue()` - Log daily revenue data
     - `get_revenue_trends()` - Revenue analysis over time
     - `calculate_revenue_growth()` - Compare periods for growth rate

---

## 4. hostel_comparison_repository.py

### Classes:

1. **HostelComparisonRepository(BaseRepository[HostelComparison])**
   - **Purpose**: Competitive analysis and benchmarking
   - **Key Functions**:
     - `create_competitive_comparison()` - Compare hostel with competitors
     - `create_regional_comparison()` - Compare with nearby hostels
     - `find_active_comparisons()` - Get current comparison reports
     - `find_comparisons_by_type()` - Filter by comparison type

2. **BenchmarkDataRepository(BaseRepository[BenchmarkData])**
   - **Purpose**: Industry and regional benchmark data
   - **Key Functions**:
     - `create_industry_benchmark()` - Generate industry standards
     - `find_latest_benchmark()` - Get current benchmark data

3. **CompetitorAnalysisRepository(BaseRepository[CompetitorAnalysis])**
   - **Purpose**: Detailed individual competitor analysis
   - **Key Functions**:
     - `create_competitor_analysis()` - Analyze specific competitor
     - `find_competitor_analyses()` - Historical competitor tracking
     - `get_competitive_landscape()` - Overall competitive position

---

## 5. hostel_media_repository.py

### Classes:

1. **ActiveMediaSpecification(Specification[HostelMedia])**
   - **Purpose**: Filter active and approved media
   - **Key Functions**:
     - `is_satisfied_by()` - Check if media is active/approved
     - `to_sql_condition()` - Convert to SQL WHERE clause

2. **MediaByCategorySpecification(Specification[HostelMedia])**
   - **Purpose**: Filter media by category (gallery, rooms, amenities)
   - **Key Functions**:
     - `to_sql_condition()` - Category-based SQL filter

3. **HostelMediaRepository(BaseRepository[HostelMedia])**
   - **Purpose**: Manage hostel images, videos, documents
   - **Key Functions**:
     - `upload_media()` - Upload new media files
     - `find_by_hostel()` - Get hostel's media library
     - `find_gallery_images()` - Get approved gallery photos
     - `find_cover_images()` - Get primary/cover images
     - `approve_media()` - Moderate and approve uploads
     - `set_as_cover()` - Set primary display image
     - `reorder_media()` - Change display order
     - `increment_views()` - Track media views
     - `get_media_performance()` - Media engagement analytics
     - `search_media()` - Search by text query
     - `get_storage_usage()` - Storage statistics

4. **MediaCategoryRepository(BaseRepository[MediaCategory])**
   - **Purpose**: Manage media categories
   - **Key Functions**:
     - `find_active_categories()` - Get available categories
     - `validate_category_limits()` - Check upload limits

---

## 6. hostel_policy_repository.py

### Classes:

1. **ActivePoliciesSpecification(Specification[HostelPolicy])**
   - **Purpose**: Filter current active policies
   - **Key Functions**:
     - `is_satisfied_by()` - Check if policy is currently active
     - `to_sql_condition()` - Time-based SQL filter

2. **MandatoryPoliciesSpecification(Specification[HostelPolicy])**
   - **Purpose**: Filter policies requiring student acknowledgment
   - **Key Functions**:
     - `is_satisfied_by()` - Check if policy is mandatory
     - `to_sql_condition()` - Mandatory policy SQL filter

3. **HostelPolicyRepository(BaseRepository[HostelPolicy])**
   - **Purpose**: Manage hostel rules and policies
   - **Key Functions**:
     - `create_policy()` - Create new policy with versioning
     - `find_by_hostel()` - Get hostel's policies
     - `find_published_policies()` - Get student-visible policies
     - `find_mandatory_policies()` - Get policies requiring acknowledgment
     - `publish_policy()` - Make policy visible
     - `archive_policy()` - Deactivate old policy
     - `update_policy_version()` - Create new version
     - `increment_views()` - Track policy views
     - `get_policy_analytics()` - Engagement metrics
     - `get_compliance_report()` - Compliance statistics
     - `search_policies()` - Text search in policies

4. **PolicyAcknowledgmentRepository(BaseRepository[PolicyAcknowledgment])**
   - **Purpose**: Track student policy acknowledgments
   - **Key Functions**:
     - `acknowledge_policy()` - Record student acceptance
     - `find_student_acknowledgments()` - Get student's acknowledgment history
     - `get_acknowledgment_status()` - Compliance status for student

5. **PolicyViolationRepository(BaseRepository[PolicyViolation])**
   - **Purpose**: Track policy violations and disciplinary actions
   - **Key Functions**:
     - `report_violation()` - Record policy breach
     - `find_violations_by_student()` - Student violation history
     - `find_violations_by_hostel()` - Hostel violation records
     - `resolve_violation()` - Close violation case
     - `get_violation_statistics()` - Violation analytics

---

## 7. hostel_repository.py

### Classes:

1. **ActiveHostelsSpecification(Specification[Hostel])**
   - **Purpose**: Filter active operational hostels
   - **Key Functions**:
     - `is_satisfied_by()` - Check if hostel is active
     - `to_sql_condition()` - Active hostel SQL filter

2. **AvailableHostelsSpecification(Specification[Hostel])**
   - **Purpose**: Filter hostels with available beds
   - **Key Functions**:
     - `is_satisfied_by()` - Check bed availability
     - `to_sql_condition()` - Availability SQL filter

3. **LocationBasedSpecification(Specification[Hostel])**
   - **Purpose**: Geographic filtering (city, radius search)
   - **Key Functions**:
     - `to_sql_condition()` - Location-based SQL with Haversine formula

4. **PriceRangeSpecification(Specification[Hostel])**
   - **Purpose**: Filter by price range
   - **Key Functions**:
     - `to_sql_condition()` - Price range SQL filter

5. **HostelRepository(BaseRepository[Hostel])**
   - **Purpose**: Core hostel CRUD and business operations
   - **Key Functions**:
     - `create_hostel()` - Create new hostel with validation
     - `find_by_slug()` - Get hostel by URL slug
     - `update_capacity_stats()` - Recalculate occupancy metrics
     - `search_hostels()` - Advanced search with filters
     - `find_nearby_hostels()` - Geographic proximity search
     - `get_recommended_hostels()` - Personalized recommendations
     - `get_featured_hostels()` - Featured/promoted hostels
     - `get_occupancy_statistics()` - Platform-wide occupancy stats
     - `get_pricing_analysis()` - Market pricing analysis
     - `get_performance_metrics()` - Individual hostel performance
     - `bulk_update_occupancy()` - Batch capacity updates
     - `bulk_update_pricing()` - Batch price updates
     - `find_hostels_needing_attention()` - Identify problem hostels
     - `find_high_performing_hostels()` - Top performers
     - `get_cached_hostel_stats()` - Retrieve cached data
     - `cache_hostel_stats()` - Store in cache
     - `invalidate_hostel_cache()` - Clear cache

---

## 8. hostel_settings_repository.py

### Classes:

1. **HostelSettingsRepository(BaseRepository[HostelSettings])**
   - **Purpose**: Manage hostel operational configuration
   - **Key Functions**:
     - `get_by_hostel_id()` - Get settings for hostel
     - `create_default_settings()` - Initialize default configuration
     - `update_booking_settings()` - Configure booking rules
     - `update_payment_settings()` - Configure payment rules
     - `toggle_feature()` - Enable/disable features
     - `get_enabled_features()` - List active features
     - `update_custom_setting()` - Custom configuration
     - `get_payment_reminder_schedule()` - Payment reminder configuration
     - `update_security_settings()` - Visitor/security rules
     - `get_hostels_with_feature_enabled()` - Find hostels with feature
     - `validate_settings()` - Business rule validation
     - `copy_settings()` - Clone settings to another hostel
     - `get_settings_summary()` - Bulk settings overview

---

## Summary by File:

| File | Primary Classes | Main Purpose |
|------|----------------|--------------|
| **hostel_aggregate_repository.py** | 1 Repository | Cross-model operations, dashboards, comparisons |
| **hostel_amenity_repository.py** | 5 Classes (2 Specs + 3 Repos) | Amenity management, bookings, categories |
| **hostel_analytics_repository.py** | 3 Repositories | Performance analytics, trends, insights |
| **hostel_comparison_repository.py** | 3 Repositories | Competitive analysis, benchmarking |
| **hostel_media_repository.py** | 4 Classes (2 Specs + 2 Repos) | Media management, uploads, moderation |
| **hostel_policy_repository.py** | 5 Classes (2 Specs + 3 Repos) | Policy management, acknowledgments, violations |
| **hostel_repository.py** | 5 Classes (4 Specs + 1 Repo) | Core hostel CRUD, search, recommendations |
| **hostel_settings_repository.py** | 1 Repository | Operational configuration, feature flags |

**Total: 27 Classes across 8 files**
============================================================================================================================
# Inquiry Repository Structure - Complete Clarity

## File 1: `inquiry_repository.py`

### Class: `InquiryRepository(BaseRepository[Inquiry])`
**Purpose**: Main repository for all inquiry CRUD operations and business logic

#### Functions:

**CRUD Operations:**
1. `create_inquiry()` - Create new inquiry with validation and duplicate check
2. `update_inquiry_status()` - Update inquiry status with validation and tracking
3. `assign_inquiry()` - Assign inquiry to a team member

**Specialized Queries:**
4. `find_recent_duplicate()` - Check for duplicate inquiries from same visitor
5. `find_by_status()` - Get inquiries by status (NEW, ASSIGNED, etc.)
6. `find_new_inquiries()` - Get recent new inquiries within time window
7. `find_urgent_inquiries()` - Get high-priority/urgent inquiries
8. `find_stale_inquiries()` - Get inquiries without recent contact
9. `find_by_assigned_user()` - Get inquiries assigned to specific user
10. `find_needing_follow_up()` - Get inquiries where follow-up is due
11. `find_by_source()` - Get inquiries from specific source (website, phone, etc.)
12. `find_high_priority_inquiries()` - Get inquiries with high priority scores
13. `find_unconverted_with_preferences()` - Get unconverted inquiries matching room/date preferences
14. `search_inquiries()` - Search by visitor name, email, or phone

**Analytics:**
15. `get_inquiry_statistics()` - Overall inquiry stats (totals, breakdowns, conversion rate)
16. `get_conversion_funnel()` - Funnel analysis (inquiries → contacted → interested → converted)
17. `get_source_performance()` - Performance metrics by inquiry source
18. `get_daily_inquiry_trend()` - Daily inquiry counts over time period
19. `get_team_performance()` - Team member performance metrics

**Bulk Operations:**
20. `bulk_update_priority_scores()` - Recalculate priority scores for all active inquiries
21. `bulk_assign_inquiries()` - Assign multiple inquiries at once
22. `archive_old_inquiries()` - Archive old completed inquiries

**Helper Methods:**
23. `_validate_status_transition()` - Validate if status change is allowed
24. `_execute_query()` - Execute queries with error handling

---

## File 2: `inquiry_follow_up_repository.py`

### Class: `InquiryFollowUpRepository(BaseRepository[InquiryFollowUp])`
**Purpose**: Manage follow-up communications and track engagement

#### Functions:

**CRUD Operations:**
1. `create_follow_up()` - Create new follow-up record with auto-numbering
2. `record_email_engagement()` - Track email opens, clicks, responses

**Specialized Queries:**
3. `find_by_inquiry()` - Get all follow-ups for specific inquiry
4. `find_by_user()` - Get follow-ups performed by specific user
5. `find_recent_follow_ups()` - Get recent follow-ups within time window
6. `find_by_outcome()` - Get follow-ups by outcome (CONNECTED, NO_ANSWER, etc.)
7. `find_successful_follow_ups()` - Get successful follow-up attempts
8. `find_automated_follow_ups()` - Get automated follow-ups

**Analytics:**
9. `get_follow_up_statistics()` - Overall follow-up stats (total, success rate, etc.)
10. `get_method_performance()` - Performance by contact method (email, phone, SMS, WhatsApp)
11. `get_user_performance()` - Team member follow-up performance
12. `get_email_engagement_metrics()` - Email-specific metrics (open rate, click rate)

**Helper Methods:**
13. `_get_inquiry()` - Get inquiry by ID
14. `_update_inquiry_follow_up_tracking()` - Update inquiry's follow-up counters
15. `_execute_query()` - Execute queries with error handling

---

## File 3: `inquiry_aggregate_repository.py`

### Class: `InquiryAggregateRepository`
**Purpose**: Advanced analytics, reporting, and business intelligence

#### Functions:

**Main Analytics:**
1. `get_comprehensive_dashboard()` - Complete dashboard with all metrics
2. `get_lead_quality_analysis()` - Analyze lead quality and scoring effectiveness
3. `get_conversion_optimization_insights()` - Insights to improve conversion rates
4. `get_forecasting_data()` - Data for predicting future inquiries/conversions
5. `get_comparative_analysis()` - Compare performance across multiple hostels

**Dashboard Components (Private):**
6. `_get_overview_metrics()` - High-level KPIs (total, conversion rate, avg response time)
7. `_get_conversion_funnel()` - Conversion funnel with percentages
8. `_get_source_performance()` - Source comparison and rankings
9. `_get_follow_up_metrics()` - Follow-up effectiveness metrics
10. `_get_team_performance()` - Team member rankings
11. `_get_trend_data()` - Daily/weekly trend data
12. `_get_quality_metrics()` - Lead quality and completeness metrics

**Lead Quality Analysis (Private):**
13. `_get_priority_score_distribution()` - Distribution of high/medium/low priority leads
14. `_get_conversion_by_priority()` - Conversion rates by priority level
15. `_get_completeness_analysis()` - Impact of complete vs incomplete inquiries
16. `_get_source_quality_metrics()` - Quality scores by source

**Conversion Optimization (Private):**
17. `_identify_conversion_bottlenecks()` - Find where inquiries get stuck
18. `_analyze_time_to_conversion()` - Average time from inquiry to booking
19. `_analyze_drop_off_points()` - Where inquiries drop off
20. `_identify_best_practices()` - Characteristics of successful conversions

**Forecasting (Private):**
21. `_get_historical_trends()` - Monthly historical data
22. `_analyze_seasonal_patterns()` - Identify peak/low seasons
23. `_calculate_growth_metrics()` - Growth rate calculations
24. `_get_predictive_indicators()` - Current pipeline health

**Comparative Analysis (Private):**
25. `_get_hostel_comparison_metrics()` - Get metrics for one hostel
26. `_calculate_rankings()` - Rank hostels by various metrics
27. `_calculate_benchmarks()` - Calculate average/best benchmarks

---

## File 4: `__init__.py`

### Purpose: Package exports

**Exports:**
- `InquiryRepository`
- `InquiryFollowUpRepository`
- `InquiryAggregateRepository`

---

## Summary Table

| Repository | Main Purpose | Key Functions Count |
|------------|-------------|---------------------|
| `InquiryRepository` | Core inquiry management | 24 functions |
| `InquiryFollowUpRepository` | Follow-up tracking | 15 functions |
| `InquiryAggregateRepository` | Advanced analytics | 27 functions |

**Total: 3 Classes, 66 Functions**
============================================================================================================================
# Complete Integration Repositories Structure - Classes and Functions Overview

## 1. api_integration_repository.py

### Classes

#### **IntegrationStatus** (Enum)
- **Purpose**: Define possible states of API integrations
- **Values**: ACTIVE, INACTIVE, PENDING, FAILED, SUSPENDED

#### **IntegrationType** (Enum)
- **Purpose**: Categorize types of API integrations
- **Values**: PAYMENT_GATEWAY, SMS_PROVIDER, EMAIL_SERVICE, CLOUD_STORAGE, CALENDAR, ANALYTICS, CRM, ACCOUNTING, OTHER

#### **APIIntegrationRepository** (Main Repository)
- **Purpose**: Manage external API integrations, authentication, rate limiting, and health monitoring

##### Key Functions:
1. **create_integration()** - Register new API integration with credentials
2. **update_integration()** - Modify integration settings
3. **activate_integration()** - Enable integration after testing
4. **deactivate_integration()** - Disable integration
5. **perform_health_check()** - Check if integration is working
6. **get_integration_health_history()** - Historical health data
7. **get_unhealthy_integrations()** - List problematic integrations
8. **track_api_call()** - Log individual API requests
9. **get_usage_statistics()** - API usage metrics
10. **get_rate_limit_status()** - Check current rate limits
11. **register_webhook()** - Setup webhook listeners
12. **trigger_webhook()** - Execute webhook
13. **get_webhook_logs()** - Webhook execution history
14. **refresh_oauth_token()** - Renew OAuth credentials
15. **validate_api_key()** - Verify API key validity
16. **get_integration_analytics()** - Comprehensive analytics
17. **get_platform_integration_overview()** - Platform-wide stats

---

## 2. communication_repository.py

### Classes

#### **CommunicationChannel** (Enum)
- **Purpose**: Define available communication channels
- **Values**: EMAIL, SMS, WHATSAPP, PUSH_NOTIFICATION, IN_APP, VOICE_CALL

#### **CommunicationStatus** (Enum)
- **Purpose**: Track message delivery status
- **Values**: PENDING, QUEUED, SENT, DELIVERED, READ, FAILED, BOUNCED, SPAM

#### **CommunicationPriority** (Enum)
- **Purpose**: Set message urgency levels
- **Values**: LOW, MEDIUM, HIGH, URGENT

#### **CommunicationType** (Enum)
- **Purpose**: Categorize communication purpose
- **Values**: TRANSACTIONAL, MARKETING, NOTIFICATION, ALERT, REMINDER, ANNOUNCEMENT

#### **CommunicationRepository** (Main Repository)
- **Purpose**: Handle multi-channel messaging with delivery tracking and templates

##### Key Functions:
1. **send_message()** - Send message via any channel
2. **send_bulk_messages()** - Send to multiple recipients in batches
3. **send_templated_message()** - Use predefined template
4. **track_delivery_event()** - Update delivery status
5. **get_delivery_status()** - Check message status
6. **retry_failed_message()** - Resend failed messages
7. **create_template()** - Create message template
8. **update_template()** - Modify template with versioning
9. **get_template_by_id()** - Retrieve template
10. **get_template_versions()** - Template history
11. **update_recipient_preferences()** - Set user communication preferences
12. **opt_out_recipient()** - Unsubscribe user
13. **opt_in_recipient()** - Subscribe user
14. **check_recipient_preferences()** - Verify user preferences
15. **get_communication_analytics()** - Delivery and engagement metrics
16. **get_channel_performance()** - Compare channel effectiveness
17. **get_template_performance()** - Template success rates
18. **get_engagement_metrics()** - User interaction data
19. **schedule_message()** - Schedule future delivery
20. **get_scheduled_messages()** - List scheduled messages
21. **cancel_scheduled_message()** - Cancel pending message

---

## 3. third_party_repository.py

### Classes

#### **ThirdPartyProvider** (Enum)
- **Purpose**: Identify external service providers
- **Values**: STRIPE, RAZORPAY, PAYPAL, AWS_S3, GOOGLE_CLOUD, AZURE, TWILIO, SENDGRID, MAILCHIMP, GOOGLE_ANALYTICS, MIXPANEL, SEGMENT, SLACK, ZOOM, GOOGLE_CALENDAR, DROPBOX

#### **SyncDirection** (Enum)
- **Purpose**: Define data sync flow
- **Values**: INBOUND, OUTBOUND, BIDIRECTIONAL

#### **SyncStatus** (Enum)
- **Purpose**: Track sync operation status
- **Values**: PENDING, IN_PROGRESS, COMPLETED, FAILED, PARTIAL

#### **ThirdPartyRepository** (Main Repository)
- **Purpose**: Manage integrations with external services (payments, storage, analytics)

##### Key Functions:

**Provider Configuration:**
1. **configure_provider()** - Setup third-party service
2. **update_provider_config()** - Modify provider settings

**Data Synchronization:**
3. **sync_data()** - Synchronize data with provider
4. **schedule_sync()** - Setup recurring sync
5. **get_sync_history()** - Sync operation logs

**Payment Gateway:**
6. **process_payment()** - Execute payment transaction
7. **refund_payment()** - Process refund

**Cloud Storage:**
8. **upload_file()** - Upload to cloud storage
9. **download_file()** - Download from cloud storage
10. **delete_file()** - Remove file from storage

**Analytics Tracking:**
11. **track_event()** - Send event to analytics platform
12. **identify_user()** - Register user in analytics

**Webhook Management:**
13. **register_webhook_endpoint()** - Setup webhook with provider
14. **handle_webhook_event()** - Process incoming webhooks

**Monitoring:**
15. **check_provider_health()** - Test provider connection
16. **get_provider_metrics()** - Provider usage statistics

---

## 4. workflow_repository.py

### Classes

#### **WorkflowStatus** (Enum)
- **Purpose**: Track workflow execution state
- **Values**: DRAFT, ACTIVE, PAUSED, COMPLETED, FAILED, CANCELLED

#### **WorkflowTriggerType** (Enum)
- **Purpose**: Define how workflows start
- **Values**: MANUAL, SCHEDULED, EVENT_BASED, WEBHOOK, API_CALL

#### **TaskStatus** (Enum)
- **Purpose**: Track individual task state
- **Values**: PENDING, RUNNING, COMPLETED, FAILED, SKIPPED, WAITING

#### **TaskType** (Enum)
- **Purpose**: Categorize task actions
- **Values**: EMAIL, SMS, NOTIFICATION, API_CALL, DATA_SYNC, APPROVAL, CONDITION, DELAY, SCRIPT, WEBHOOK

#### **ApprovalStatus** (Enum)
- **Purpose**: Track approval decisions
- **Values**: PENDING, APPROVED, REJECTED, CANCELLED

#### **WorkflowRepository** (Main Repository)
- **Purpose**: Automate business processes with task orchestration and approvals

##### Key Functions:

**Workflow Definition:**
1. **create_workflow()** - Define new automated workflow
2. **update_workflow()** - Modify workflow with versioning
3. **activate_workflow()** - Enable workflow execution
4. **deactivate_workflow()** - Disable workflow

**Workflow Execution:**
5. **execute_workflow()** - Run workflow
6. **execute_task()** - Run individual task
7. **retry_failed_execution()** - Retry failed workflow
8. **cancel_execution()** - Stop running workflow

**Task Scheduling:**
9. **schedule_task()** - Setup recurring task
10. **get_pending_scheduled_tasks()** - List tasks to execute
11. **execute_scheduled_task()** - Run scheduled task

**Approval Workflows:**
12. **create_approval_request()** - Request approval
13. **submit_approval_response()** - Approve/reject
14. **get_pending_approvals()** - List user's pending approvals

**Conditional Logic:**
15. **evaluate_condition()** - Check if condition is met

**Analytics & Monitoring:**
16. **get_workflow_analytics()** - Execution statistics
17. **get_task_performance()** - Task success/failure rates
18. **get_execution_timeline()** - Step-by-step execution log
19. **get_workflow_bottlenecks()** - Identify slow tasks

---

## 5. integration_aggregate_repository.py

### Classes

#### **IntegrationAggregateRepository** (Main Repository)
- **Purpose**: Provide cross-integration analytics and insights

##### Key Functions:

**Dashboards:**
1. **get_integration_dashboard()** - Complete integration overview
2. **get_integration_usage_report()** - Usage across all integrations
3. **get_daily_usage_breakdown()** - Day-by-day usage

**Performance Analytics:**
4. **get_performance_metrics()** - Response times, success rates
5. **get_integration_sla_compliance()** - SLA adherence metrics

**Cost Analysis:**
6. **get_cost_analysis()** - Total integration costs
7. **get_cost_breakdown_by_integration()** - Cost per integration type
8. **forecast_costs()** - Predict future costs

**Health Monitoring:**
9. **get_integration_health_summary()** - Overall health status
10. **get_unhealthy_integrations()** - List problematic integrations
11. **get_integration_alerts()** - Active alerts

**Comparative Analysis:**
12. **compare_integration_performance()** - Compare multiple integrations
13. **benchmark_against_industry()** - Industry standard comparison

**Optimization:**
14. **get_optimization_recommendations()** - Improvement suggestions
15. **get_unused_integrations()** - Identify underutilized integrations

**Reporting:**
16. **generate_executive_summary()** - High-level monthly report
17. **export_integration_report()** - Export comprehensive report

---

## Summary of Repository Purposes

| Repository | Primary Purpose | Key Capability |
|------------|----------------|----------------|
| **APIIntegrationRepository** | External API management | Health monitoring, rate limiting, OAuth |
| **CommunicationRepository** | Multi-channel messaging | Email, SMS, templates, delivery tracking |
| **ThirdPartyRepository** | External services | Payments, storage, analytics, webhooks |
| **WorkflowRepository** | Process automation | Task orchestration, approvals, scheduling |
| **IntegrationAggregateRepository** | Cross-integration analytics | Dashboards, cost analysis, optimization |

---

## Design Pattern Used

All repositories follow the **Repository Pattern**:
- Separate data access logic from business logic
- Each repository focuses on one domain
- Placeholder implementations ready for actual database integration
- Consistent error handling and validation
- Audit trail support for all operations
============================================================================================================================
# Complete Leave Repository Layer - Classes and Functions Overview

## 1. leave_application_repository.py

### **Class: LeaveApplicationRepository**
**Purpose:** Manages all leave application CRUD operations, searching, filtering, and status workflows

**Key Functions:**
- `create_leave_application()` - Create new leave application with validation
- `update_leave_application()` - Update existing application
- `find_by_student()` - Get all applications for a student
- `find_by_hostel()` - Get applications for a hostel with filters
- `find_by_status()` - Find applications by status (pending/approved/rejected)
- `find_pending_approvals()` - Get pending approval requests
- `find_active_leaves()` - Get currently active leaves
- `find_upcoming_leaves()` - Get upcoming approved leaves
- `find_by_date_range()` - Find leaves in specific date range
- `find_overdue_returns()` - Find students who haven't returned
- `find_by_leave_type()` - Filter by leave type
- `approve_leave()` - Approve a leave application
- `reject_leave()` - Reject a leave application
- `cancel_leave()` - Cancel a leave application
- `confirm_return()` - Confirm student returned from leave
- `add_document()` - Add supporting documents
- `verify_document()` - Verify uploaded documents
- `get_documents()` - Get all documents for an application
- `add_emergency_contact()` - Add emergency contact info
- `get_emergency_contacts()` - Get emergency contacts
- `get_leave_statistics()` - Get comprehensive statistics
- `get_student_leave_summary()` - Get student's leave summary
- `get_approval_trends()` - Get approval trend analytics
- `advanced_search()` - Search with multiple filter criteria
- `check_overlapping_leaves()` - Validate no overlapping leaves
- `validate_leave_quota()` - Check against quota limits
- `bulk_approve_leaves()` - Approve multiple leaves at once
- `bulk_update_status()` - Update status for multiple applications

---

## 2. leave_approval_repository.py

### **Class: LeaveApprovalRepository**
**Purpose:** Manages approval decisions, multi-level workflows, and approval tracking

**Key Functions:**
- `create_approval()` - Record approval/rejection decision
- `create_auto_approval()` - Record automatic approval
- `find_by_leave()` - Get all approvals for a leave
- `find_by_approver()` - Get approvals by specific approver
- `find_pending_for_approver()` - Get pending items for approver
- `find_by_workflow()` - Get approvals in a workflow
- `get_final_approval()` - Get final decision for leave
- `get_approval_workflow()` - Get applicable workflow for application
- `get_next_approval_step()` - Get next step in workflow
- `check_workflow_complete()` - Check if all approvals done
- `can_auto_approve()` - Check if eligible for auto-approval
- `mark_student_notified()` - Mark student notification sent
- `mark_guardian_notified()` - Mark guardian notification sent
- `get_unnotified_approvals()` - Get approvals needing notification
- `get_approver_statistics()` - Get approver performance stats
- `get_approval_performance_metrics()` - Get overall performance metrics
- `get_workflow_analytics()` - Get workflow-specific analytics
- `get_sla_compliance()` - Get SLA compliance metrics
- `delegate_approval()` - Delegate approval to another user
- `escalate_approval()` - Escalate to higher authority
- `find_escalated_approvals()` - Get escalated approvals

### **Class: LeaveApprovalWorkflowRepository**
**Purpose:** Manages workflow configurations and approval steps

**Key Functions:**
- `create_workflow()` - Create new approval workflow
- `get_active_workflows()` - Get active workflows with filters
- `add_workflow_step()` - Add step to workflow
- `update_workflow_step()` - Update workflow step
- `get_workflow_steps()` - Get all steps in workflow
- `deactivate_workflow()` - Deactivate a workflow
- `create_policy_version()` - Create new policy version

---

## 3. leave_balance_repository.py

### **Class: LeaveBalanceRepository**
**Purpose:** Manages student leave balances, quotas, usage tracking, and carry forwards

**Key Functions:**
- `get_or_create_balance()` - Get existing or create new balance
- `get_student_balance()` - Get balance for student and leave type
- `get_all_student_balances()` - Get all balances for student
- `update_balance()` - Update balance with usage
- `recalculate_balance()` - Recalculate from usage records
- `get_quota()` - Get quota configuration for hostel
- `create_quota()` - Create new quota configuration
- `update_quota()` - Update quota settings
- `get_hostel_quotas()` - Get all quotas for hostel
- `record_usage()` - Record leave usage
- `get_usage_history()` - Get usage history for balance
- `process_carry_forward()` - Process year-end carry forward
- `get_carry_forward()` - Get carry forward record
- `expire_carry_forward()` - Mark carry forward as expired
- `find_expiring_carry_forwards()` - Find carry forwards expiring soon
- `create_adjustment()` - Create manual balance adjustment
- `approve_adjustment()` - Approve balance adjustment
- `get_adjustments()` - Get adjustment history
- `get_balance_analytics()` - Get balance analytics and stats
- `get_low_balance_students()` - Find students with low balance

---

## 4. leave_type_repository.py

### **Class: LeaveTypeRepository**
**Purpose:** Manages leave type configurations, policies, validations, and blackout dates

**Key Functions:**
- `get_leave_type_config()` - Get configuration for leave type
- `get_all_active_configs()` - Get all active configurations
- `create_leave_type_config()` - Create new configuration
- `update_leave_type_config()` - Update configuration
- `deactivate_config()` - Deactivate configuration
- `validate_leave_application()` - Validate application against rules
- `check_blackout_dates()` - Check for blackout date conflicts
- `create_blackout_date()` - Create blackout period
- `update_blackout_date()` - Update blackout period
- `get_blackout_dates()` - Get blackout dates for config
- `get_upcoming_blackout_dates()` - Get upcoming blackouts
- `deactivate_blackout_date()` - Deactivate blackout
- `create_policy()` - Create policy document
- `update_policy()` - Update policy document
- `get_policy()` - Get policy by code
- `get_active_policies()` - Get all active policies
- `create_policy_version()` - Create new policy version
- `get_policy_versions()` - Get all versions of policy
- `publish_policy()` - Publish policy
- `approve_policy()` - Approve policy
- `get_config_usage_statistics()` - Get usage stats for config
- `get_hostel_leave_type_summary()` - Get summary for hostel

### **Class: LeavePolicyRepository**
**Purpose:** Simplified direct access to policy documents

**Key Functions:**
- `find_by_code()` - Find policy by code and version

### **Class: LeaveBlackoutDateRepository**
**Purpose:** Simplified direct access to blackout dates

**Key Functions:**
- `find_active_blackouts()` - Find active blackouts for a date

---

## 5. leave_aggregate_repository.py

### **Class: LeaveAggregateRepository**
**Purpose:** Provides cross-entity analytics, dashboards, reporting, and insights

**Key Functions:**
- `get_hostel_dashboard()` - Get comprehensive hostel dashboard data
- `get_student_dashboard()` - Get student leave dashboard
- `get_leave_trends()` - Get leave application trends over time
- `get_seasonal_patterns()` - Analyze seasonal leave patterns
- `compare_leave_types()` - Compare performance across leave types
- `compare_hostels()` - Compare metrics across hostels
- `get_approval_performance()` - Get approval performance metrics
- `get_compliance_metrics()` - Get compliance and policy adherence
- `predict_leave_demand()` - Predict future leave demand
- `identify_high_risk_students()` - Find students at risk of exhausting balance
- `generate_comprehensive_report()` - Generate complete report

---

## Summary by Responsibility

| Repository | Primary Responsibility |
|------------|----------------------|
| **LeaveApplicationRepository** | Application lifecycle management (create, update, approve, reject, cancel) |
| **LeaveApprovalRepository** | Approval workflow and decision tracking |
| **LeaveApprovalWorkflowRepository** | Workflow configuration management |
| **LeaveBalanceRepository** | Balance, quota, and usage tracking |
| **LeaveTypeRepository** | Configuration, validation rules, and policies |
| **LeavePolicyRepository** | Policy document access |
| **LeaveBlackoutDateRepository** | Blackout date access |
| **LeaveAggregateRepository** | Cross-cutting analytics and reporting |

---

## Key Patterns Used

1. **Separation of Concerns** - Each repository handles specific domain
2. **Finder Methods** - Consistent `find_by_*` pattern for queries
3. **Pagination Support** - Most list methods support pagination
4. **Audit Tracking** - Operations accept `audit_context` for tracking
5. **Soft Deletes** - Filters for `deleted_at` in queries
6. **Validation** - Business rule validation before operations
7. **Analytics** - Statistical and trend analysis methods
8. **Bulk Operations** - Support for batch processing
============================================================================================================================
# Complete Maintenance Repository System - Class & Function Reference

## 1. maintenance_request_repository.py

### Classes:
- **MaintenanceRequestRepository(BaseRepository[MaintenanceRequest])**
  - Core repository for maintenance request operations

### Functions & Their Use:

#### CREATE Operations:
- `create_request()` - Create new maintenance request with auto-categorization
- `create_emergency_request()` - Create critical priority emergency request
- `create_preventive_request()` - Create preventive maintenance from schedule

#### READ Operations - Basic:
- `find_by_request_number()` - Find request by unique request number
- `find_by_hostel()` - Find requests for hostel with filters (status, category, priority)
- `find_by_assignee()` - Find requests assigned to specific user
- `find_by_room()` - Find maintenance requests for specific room

#### READ Operations - Advanced:
- `find_pending_requests()` - Find pending requests with age/priority filters
- `find_overdue_requests()` - Find requests past deadline
- `find_high_priority_unassigned()` - Find urgent unassigned requests
- `find_awaiting_approval()` - Find requests pending approval
- `find_in_progress()` - Find currently active requests
- `find_completed_in_period()` - Find completed requests in date range
- `find_recurring_issues()` - Identify patterns of recurring problems

#### UPDATE Operations:
- `update_status()` - Change request status with audit trail
- `assign_request()` - Assign request to user with deadline
- `update_cost_estimate()` - Update cost estimate and check approval needs
- `mark_started()` - Mark work as started
- `mark_completed()` - Mark work as completed with notes

#### ANALYTICS:
- `get_status_summary()` - Count of requests by status
- `get_category_distribution()` - Distribution by category
- `get_priority_distribution()` - Distribution by priority
- `calculate_average_completion_time()` - Average time to complete
- `calculate_cost_metrics()` - Cost statistics (total, avg, min, max)
- `get_assignee_workload()` - Workload distribution across staff

#### PREDICTIVE:
- `predict_completion_date()` - Predict completion based on history
- `identify_bottlenecks()` - Identify delays and bottlenecks

#### HELPERS:
- `_generate_request_number()` - Generate unique request number
- `_check_approval_requirement()` - Check if approval needed based on cost
- `_is_valid_status_transition()` - Validate status change is allowed
- `_create_status_history()` - Create audit trail entry

---

## 2. maintenance_assignment_repository.py

### Classes:
- **MaintenanceAssignmentRepository(BaseRepository[MaintenanceAssignment])**
  - Staff assignment management
- **VendorAssignmentRepository(BaseRepository[VendorAssignment])**
  - Vendor assignment management (separate concern)

### MaintenanceAssignmentRepository Functions:

#### CREATE:
- `create_assignment()` - Assign maintenance to staff member
- `create_vendor_assignment()` - Assign work to external vendor

#### READ - Staff:
- `find_by_assignee()` - Find assignments for staff member
- `find_by_request()` - Find all assignments for a request
- `find_active_by_request()` - Find current active assignment
- `find_overdue_assignments()` - Find assignments past deadline
- `find_upcoming_deadlines()` - Find assignments due soon

#### READ - Vendor:
- `find_vendor_assignments_by_vendor()` - Find vendor's assignments
- `find_vendor_assignment_by_request()` - Find vendor for specific request
- `find_overdue_vendor_assignments()` - Find overdue vendor work

#### UPDATE:
- `mark_started()` - Mark assignment work started
- `mark_completed()` - Mark assignment completed with quality rating
- `reassign()` - Reassign to different staff member
- `update_vendor_assignment_status()` - Update vendor work status

#### WORKLOAD OPTIMIZATION:
- `get_assignee_workload()` - Get current workload for staff
- `get_team_workload_distribution()` - Workload across all team members
- `suggest_optimal_assignee()` - AI-suggest best assignee based on workload

#### PERFORMANCE:
- `calculate_completion_rate()` - Calculate staff completion rate
- `calculate_average_time_variance()` - How accurate are time estimates
- `get_quality_metrics()` - Quality ratings for staff
- `calculate_on_time_completion_rate()` - On-time delivery rate
- `get_vendor_performance_summary()` - Vendor performance stats

#### HELPERS:
- `_generate_work_order_number()` - Generate unique work order number

---

## 3. maintenance_approval_repository.py

### Classes:
- **MaintenanceApprovalRepository(BaseRepository[MaintenanceApproval])**
  - Approval workflow management

### Functions:

#### CREATE:
- `create_approval_request()` - Create approval request for maintenance
- `create_threshold_config()` - Set approval thresholds for hostel

#### READ:
- `find_by_request()` - Find approval requests for maintenance
- `find_pending_approvals()` - Find pending approval requests
- `find_by_requester()` - Find approvals by requester
- `find_overdue_approvals()` - Find approvals pending too long
- `find_escalated_approvals()` - Find escalated approvals
- `get_threshold_config()` - Get approval threshold settings

#### UPDATE:
- `approve_request()` - Approve maintenance request
- `reject_request()` - Reject maintenance request
- `escalate_approval()` - Escalate to higher authority

#### ANALYTICS:
- `get_approval_statistics()` - Approval metrics (rate, time, cost)
- `get_approval_trends()` - Monthly approval trends
- `calculate_average_response_time()` - How fast approvals happen

#### WORKFLOW:
- `get_workflow_status()` - Get approval workflow status
- `update_workflow_deadline()` - Update approval deadline

#### HELPERS:
- `_determine_approval_level()` - Determine required approval level
- `_create_workflow_entry()` - Create workflow tracking
- `_update_workflow_status()` - Update workflow after decision

---

## 4. maintenance_completion_repository.py

### Classes:
- **MaintenanceCompletionRepository(BaseRepository[MaintenanceCompletion])**
  - Completion tracking and quality management

### Functions:

#### CREATE:
- `create_completion()` - Create completion record with costs
- `add_material()` - Add material used during maintenance
- `create_quality_check()` - Create quality inspection record
- `generate_certificate()` - Generate completion certificate

#### READ:
- `find_by_request()` - Find completion record for request
- `find_by_completer()` - Find completions by staff member
- `find_pending_quality_check()` - Find completions needing QC
- `find_requiring_follow_up()` - Find work needing follow-up
- `find_materials_by_completion()` - Find materials used
- `find_quality_checks_by_request()` - Find quality checks
- `find_certificate_by_number()` - Find certificate by number

#### UPDATE:
- `update_completion_costs()` - Update cost breakdown
- `add_warranty()` - Add warranty to completion

#### ANALYTICS:
- `get_completion_statistics()` - Completion stats (time, cost, quality)
- `get_material_usage_summary()` - Material usage analysis
- `get_quality_check_summary()` - Quality check pass rates
- `get_warranty_expiring_soon()` - Find expiring warranties

#### HELPERS:
- `_update_completion_costs()` - Recalculate costs from materials
- `_generate_certificate_number()` - Generate unique certificate number

---

## 5. maintenance_cost_repository.py

### Classes:
- **MaintenanceCostRepository(BaseRepository[MaintenanceCost])**
  - Cost tracking and budget management

### Functions:

#### CREATE:
- `create_cost_record()` - Create cost tracking record
- `create_budget_allocation()` - Create annual budget allocation
- `create_vendor_invoice()` - Create vendor invoice record

#### READ - Cost:
- `find_cost_by_request()` - Find cost record for request
- `find_over_budget_requests()` - Find requests exceeding budget
- `find_costs_by_budget_source()` - Find costs by funding source

#### READ - Budget:
- `get_active_budget()` - Get current active budget
- `get_budget_for_fiscal_year()` - Get specific year budget
- `get_category_budget()` - Get budget for category
- `get_all_category_budgets()` - Get all category budgets

#### READ - Invoices:
- `find_invoice_by_number()` - Find invoice by number
- `find_invoices_by_vendor()` - Find vendor invoices
- `find_overdue_invoices()` - Find unpaid overdue invoices
- `find_pending_invoices()` - Find invoices awaiting payment

#### UPDATE:
- `update_actual_cost()` - Update actual costs incurred
- `update_budget_utilization()` - Recalculate budget usage
- `mark_invoice_paid()` - Mark invoice as paid

#### ANALYTICS:
- `calculate_cost_variance_summary()` - Budget vs actual analysis
- `get_cost_breakdown_by_category()` - Category-wise cost breakdown
- `get_budget_utilization_by_category()` - Budget usage by category
- `calculate_monthly_spending_trend()` - Monthly spending trends
- `get_vendor_payment_summary()` - Vendor payment summary

#### HELPERS:
- `_create_category_budget()` - Create category budget entry

---

## 6. maintenance_schedule_repository.py

### Classes:
- **MaintenanceScheduleRepository(BaseRepository[MaintenanceSchedule])**
  - Preventive maintenance scheduling

### Functions:

#### CREATE:
- `create_schedule()` - Create preventive maintenance schedule
- `create_execution_record()` - Record schedule execution

#### READ - Schedules:
- `find_by_hostel()` - Find schedules for hostel
- `find_by_assignee()` - Find schedules assigned to user
- `find_by_schedule_code()` - Find schedule by code
- `find_due_schedules()` - Find schedules due now/soon
- `find_overdue_schedules()` - Find overdue schedules
- `find_upcoming_schedules()` - Find schedules in next N days

#### READ - Executions:
- `find_executions_by_schedule()` - Find execution history
- `find_executions_by_executor()` - Find executions by staff
- `find_incomplete_executions()` - Find incomplete executions
- `get_latest_execution()` - Get most recent execution

#### UPDATE:
- `update_next_due_date()` - Calculate next occurrence
- `mark_execution_completed()` - Mark execution complete
- `activate_schedule()` - Activate schedule
- `deactivate_schedule()` - Deactivate schedule
- `update_schedule_checklist()` - Update maintenance checklist

#### ANALYTICS:
- `get_schedule_statistics()` - Schedule performance stats
- `get_execution_performance()` - Execution performance metrics
- `get_recurrence_distribution()` - Distribution by frequency
- `get_category_distribution()` - Distribution by category
- `calculate_cost_trends()` - Cost trends over time
- `get_upcoming_maintenance_calendar()` - Calendar view of upcoming work

#### HELPERS:
- `_generate_schedule_code()` - Generate unique schedule code
- `_calculate_next_date()` - Calculate next occurrence date
- `_update_schedule_statistics()` - Update execution stats

---

## 7. maintenance_vendor_repository.py

### Classes:
- **MaintenanceVendorRepository(BaseRepository[MaintenanceVendor])**
  - Vendor management and performance tracking

### Functions:

#### CREATE:
- `create_vendor()` - Create vendor record
- `create_contract()` - Create vendor contract
- `create_performance_review()` - Create performance review

#### READ - Vendors:
- `find_by_vendor_code()` - Find vendor by code
- `find_by_service_category()` - Find vendors by service type
- `find_active_vendors()` - Find active vendors
- `find_recommended_vendors()` - Find top-rated vendors
- `find_by_performance_tier()` - Find vendors by tier (gold/silver/bronze)
- `find_vendors_with_expiring_insurance()` - Find insurance expiring

#### READ - Contracts:
- `find_contracts_by_vendor()` - Find vendor contracts
- `find_active_contracts()` - Find active contracts
- `find_expiring_contracts()` - Find contracts expiring soon
- `find_contract_by_number()` - Find contract by number

#### READ - Reviews:
- `find_reviews_by_vendor()` - Find performance reviews
- `get_latest_review()` - Get most recent review

#### UPDATE:
- `approve_vendor()` - Approve vendor for work
- `update_performance_metrics()` - Recalculate vendor metrics
- `blacklist_vendor()` - Blacklist poor-performing vendor

#### ANALYTICS:
- `get_vendor_summary()` - Comprehensive vendor summary
- `get_vendor_rankings()` - Top vendors by performance
- `calculate_performance_trends()` - Performance over time
- `get_category_performance()` - Compare vendors by category

#### HELPERS:
- `_generate_vendor_code()` - Generate unique vendor code

---

## 8. maintenance_analytics_repository.py

### Classes:
- **MaintenanceAnalyticsRepository(BaseRepository[MaintenanceAnalytic])**
  - Advanced analytics and reporting

### Functions:

#### CREATE:
- `create_analytics_record()` - Create analytics record for period
- `create_category_performance()` - Create category metrics

#### READ:
- `find_by_period()` - Find analytics for specific period
- `find_analytics_by_date_range()` - Find analytics in range
- `get_category_performance_for_period()` - Get category metrics

#### ANALYTICS GENERATION:
- `generate_daily_analytics()` - Generate daily analytics
- `generate_monthly_analytics()` - Generate monthly analytics
- `generate_quarterly_analytics()` - Generate quarterly analytics
- `generate_annual_analytics()` - Generate annual analytics

#### KPI CALCULATIONS:
- `calculate_kpis()` - Calculate all KPIs for period
- `calculate_mttr()` - Mean Time To Repair
- `calculate_mtbf()` - Mean Time Between Failures
- `calculate_first_time_fix_rate()` - First-time fix percentage

#### TREND ANALYSIS:
- `get_request_trends()` - Monthly request volume trends
- `get_cost_trends()` - Monthly cost trends
- `identify_seasonal_patterns()` - Seasonal maintenance patterns

#### PREDICTIVE:
- `forecast_maintenance_demand()` - Forecast future demand
- `predict_equipment_failure()` - Predict potential failures

#### BENCHMARKING:
- `benchmark_against_industry()` - Compare to industry standards

#### HELPERS:
- `_calculate_period_metrics()` - Calculate comprehensive metrics
- `_generate_category_metrics()` - Generate category-specific metrics
- `_calculate_category_metrics()` - Calculate category performance

---

## 9. maintenance_aggregate_repository.py

### Classes:
- **MaintenanceAggregateRepository**
  - Cross-cutting operations spanning multiple entities

### Functions:

#### DASHBOARD:
- `get_dashboard_summary()` - Real-time dashboard metrics
- `get_hostel_overview()` - Comprehensive hostel overview

#### RESOURCE OPTIMIZATION:
- `get_workload_distribution()` - Staff and vendor workload
- `optimize_resource_allocation()` - Resource optimization recommendations

#### FINANCIAL:
- `get_financial_summary()` - Consolidated financial summary

#### COMPARISON:
- `compare_periods()` - Compare two time periods

#### HELPERS:
- `_get_request_statistics()` - Get request stats for period
- `_get_cost_statistics()` - Get cost stats for period
- `_get_performance_metrics()` - Get performance metrics
- `_get_budget_status()` - Get budget status
- `_get_top_issues()` - Get recurring top issues

---

## Summary by Purpose:

### Data Management (CRUD):
- **MaintenanceRequestRepository** - Request lifecycle
- **MaintenanceAssignmentRepository** - Work assignments
- **MaintenanceCompletionRepository** - Work completion
- **MaintenanceVendorRepository** - Vendor management

### Workflow & Approval:
- **MaintenanceApprovalRepository** - Approval workflows

### Financial:
- **MaintenanceCostRepository** - Costs, budgets, invoices

### Scheduling:
- **MaintenanceScheduleRepository** - Preventive maintenance

### Reporting & Analytics:
- **MaintenanceAnalyticsRepository** - Analytics & KPIs
- **MaintenanceAggregateRepository** - Cross-cutting reports

This structure provides complete separation of concerns while enabling comprehensive maintenance management.
============================================================================================================================
# Complete Mess Repository Classes Overview

## 1. dietary_option_repository.py

### Classes:

1. **DietaryOptionRepository(BaseRepository[DietaryOption])**
   - **Purpose**: Manages hostel-level dietary menu configurations
   - **Key Functions**:
     - `get_by_hostel()` - Get dietary options for a hostel
     - `get_hostels_with_dietary_support()` - Find hostels offering specific diets
     - `get_customization_settings()` - Get meal customization settings
     - `update_allergen_settings()` - Update allergen management settings

2. **StudentDietaryPreferenceRepository(BaseRepository[StudentDietaryPreference])**
   - **Purpose**: Manages individual student dietary preferences
   - **Key Functions**:
     - `get_by_student()` - Get student's dietary preferences
     - `find_by_preference_type()` - Find students with specific preferences
     - `get_dietary_distribution()` - Get preference distribution in hostel
     - `find_students_with_allergens()` - Find students with allergen profiles
     - `get_students_on_diet_plans()` - Get students following diet plans

3. **AllergenProfileRepository(BaseRepository[AllergenProfile])**
   - **Purpose**: Manages student allergen profiles and safety information
   - **Key Functions**:
     - `get_by_preference()` - Get allergen profile by dietary preference
     - `find_severe_allergies()` - Find students with severe/life-threatening allergies
     - `get_students_with_epipen()` - Get students carrying EpiPens
     - `find_by_allergen()` - Find students allergic to specific allergen
     - `get_cross_contamination_sensitive()` - Get students requiring separate preparation

4. **DietaryRestrictionRepository(BaseRepository[DietaryRestriction])**
   - **Purpose**: Manages medical, religious, and personal dietary restrictions
   - **Key Functions**:
     - `find_by_preference()` - Get restrictions for a dietary preference
     - `find_by_type()` - Find restrictions by type and severity
     - `find_medical_restrictions()` - Find medically verified restrictions
     - `find_expiring_restrictions()` - Find restrictions expiring soon
     - `get_mandatory_restrictions()` - Get mandatory compliance restrictions

5. **MealCustomizationRepository(BaseRepository[MealCustomization])**
   - **Purpose**: Manages student meal customization requests
   - **Key Functions**:
     - `find_by_student()` - Find customizations for a student
     - `find_pending_approvals()` - Find customizations pending approval
     - `find_by_menu()` - Find customizations for a specific menu
     - `get_customization_statistics()` - Get customization statistics
     - `get_most_requested_items()` - Get frequently requested items

---

## 2. meal_item_repository.py

### Classes:

1. **MealItemRepository(BaseRepository[MealItem])**
   - **Purpose**: Manages meal items catalog
   - **Key Functions**:
     - `find_by_hostel()` - Get meal items for a hostel
     - `search_items()` - Advanced search with filters
     - `find_by_dietary_requirements()` - Find items matching dietary needs
     - `get_popular_items()` - Get popular items by rating/popularity
     - `get_seasonal_items()` - Get seasonal items for current month
     - `find_items_with_allergen()` - Find items containing allergens
     - `update_item_statistics()` - Update ratings and statistics

2. **RecipeRepository(BaseRepository[Recipe])**
   - **Purpose**: Manages recipes for meal items
   - **Key Functions**:
     - `find_by_meal_item()` - Get recipes for a meal item
     - `get_latest_version()` - Get latest active recipe version
     - `create_new_version()` - Create new recipe version
     - `find_by_difficulty()` - Find recipes by difficulty level
     - `find_by_preparation_time()` - Find quick recipes

3. **IngredientMasterRepository(BaseRepository[IngredientMaster])**
   - **Purpose**: Manages master ingredient database
   - **Key Functions**:
     - `find_by_category()` - Find ingredients by category
     - `search_ingredients()` - Search ingredients with filters
     - `get_seasonal_ingredients()` - Get seasonally available ingredients
     - `find_with_allergens()` - Find ingredients containing allergens

4. **ItemCategoryRepository(BaseRepository[ItemCategory])**
   - **Purpose**: Manages hierarchical item categories
   - **Key Functions**:
     - `get_root_categories()` - Get top-level categories
     - `get_subcategories()` - Get subcategories of a category
     - `get_category_tree()` - Get complete category hierarchy

5. **ItemAllergenRepository(BaseRepository[ItemAllergen])**
   - **Purpose**: Manages detailed allergen information for items
   - **Key Functions**:
     - `find_by_item()` - Get allergens for a meal item
     - `find_by_allergen_type()` - Find items with specific allergen
     - `find_cross_contamination_risks()` - Find items with contamination risk

6. **ItemPopularityRepository(BaseRepository[ItemPopularity])**
   - **Purpose**: Tracks item popularity metrics
   - **Key Functions**:
     - `get_by_item()` - Get popularity data for item
     - `get_top_rated_items()` - Get highest rated items
     - `get_most_popular_items()` - Get most popular by score
     - `get_trending_items()` - Get trending items (rising/declining)
     - `update_item_rating()` - Update with new rating
     - `record_serving()` - Record item being served

---

## 3. menu_approval_repository.py

### Classes:

1. **MenuApprovalRepository(BaseRepository[MenuApproval])**
   - **Purpose**: Manages menu approval workflow
   - **Key Functions**:
     - `get_by_menu()` - Get approval record for a menu
     - `get_pending_approvals()` - Get pending approval requests
     - `get_overdue_approvals()` - Get overdue approvals
     - `approve_menu()` - Approve a menu
     - `reject_menu()` - Reject a menu
     - `request_revision()` - Request menu revision
     - `escalate_approval()` - Escalate to higher authority
     - `get_approval_statistics()` - Get approval statistics

2. **MenuApprovalRequestRepository(BaseRepository[MenuApprovalRequest])**
   - **Purpose**: Manages approval request submissions
   - **Key Functions**:
     - `create_request()` - Create new approval request
     - `find_by_menu()` - Get approval requests for a menu
     - `find_by_status()` - Find requests by status

3. **ApprovalWorkflowRepository(BaseRepository[ApprovalWorkflow])**
   - **Purpose**: Tracks complete approval workflow state
   - **Key Functions**:
     - `get_by_menu()` - Get workflow for a menu
     - `get_active_workflows()` - Get active workflows
     - `advance_stage()` - Advance workflow to next stage

4. **ApprovalHistoryRepository(BaseRepository[ApprovalHistory])**
   - **Purpose**: Maintains approval audit trail
   - **Key Functions**:
     - `get_by_menu()` - Get approval history for menu
     - `record_submission()` - Record menu submission
     - `record_decision()` - Record approval decision

5. **ApprovalAttemptRepository(BaseRepository[ApprovalAttempt])**
   - **Purpose**: Tracks individual approval attempts
   - **Key Functions**:
     - `create_attempt()` - Create new approval attempt
     - `find_by_approval()` - Get all attempts for an approval

6. **ApprovalRuleRepository(BaseRepository[ApprovalRule])**
   - **Purpose**: Manages automated approval rules
   - **Key Functions**:
     - `get_active_rules()` - Get active approval rules
     - `check_auto_approval_eligibility()` - Check if menu qualifies for auto-approval
     - `record_rule_usage()` - Record rule usage for tracking

7. **BulkApprovalRepository(BaseRepository[BulkApproval])**
   - **Purpose**: Manages bulk approval operations
   - **Key Functions**:
     - `create_bulk_operation()` - Create new bulk operation
     - `update_operation_progress()` - Update bulk operation progress
     - `get_recent_operations()` - Get recent bulk operations

---

## 4. menu_feedback_repository.py

### Classes:

1. **MenuFeedbackRepository(BaseRepository[MenuFeedback])**
   - **Purpose**: Manages student feedback on menus
   - **Key Functions**:
     - `create_feedback()` - Create new menu feedback
     - `find_by_menu()` - Get feedback for a menu
     - `find_by_student()` - Get feedback from a student
     - `get_pending_moderation()` - Get feedback pending moderation
     - `moderate_feedback()` - Moderate feedback (approve/reject)
     - `add_response()` - Add management response
     - `get_featured_feedback()` - Get featured feedback
     - `get_average_ratings_by_aspect()` - Get average ratings for all aspects
     - `get_most_helpful_feedback()` - Get most helpful feedback

2. **ItemRatingRepository(BaseRepository[ItemRating])**
   - **Purpose**: Tracks aggregated ratings for individual items
   - **Key Functions**:
     - `get_by_item_name()` - Get rating for specific item
     - `get_top_rated_items()` - Get highest rated items
     - `get_most_popular_items()` - Get most popular items
     - `get_trending_items()` - Get trending items
     - `update_item_rating()` - Update item rating with like/dislike

3. **RatingsSummaryRepository(BaseRepository[RatingsSummary])**
   - **Purpose**: Provides aggregated rating summaries for menus
   - **Key Functions**:
     - `get_by_menu()` - Get ratings summary for menu
     - `calculate_summary()` - Calculate and store ratings summary
     - `get_hostel_summaries()` - Get all summaries for a hostel

4. **QualityMetricsRepository(BaseRepository[QualityMetrics])**
   - **Purpose**: Tracks quality metrics over time periods
   - **Key Functions**:
     - `calculate_metrics()` - Calculate quality metrics for period
     - `get_latest_metrics()` - Get latest quality metrics

5. **SentimentAnalysisRepository(BaseRepository[SentimentAnalysis])**
   - **Purpose**: Analyzes sentiment of feedback comments
   - **Key Functions**:
     - `get_by_menu()` - Get sentiment analysis for menu
     - `analyze_menu_sentiment()` - Analyze sentiment for menu feedback

6. **FeedbackAnalysisRepository(BaseRepository[FeedbackAnalysis])**
   - **Purpose**: Provides comprehensive feedback analysis and insights
   - **Key Functions**:
     - `generate_analysis()` - Generate comprehensive feedback analysis

7. **FeedbackCommentRepository(BaseRepository[FeedbackComment])**
   - **Purpose**: Manages threaded comments on feedback
   - **Key Functions**:
     - `create_comment()` - Create new comment on feedback
     - `get_feedback_comments()` - Get all comments for feedback

8. **FeedbackHelpfulnessRepository(BaseRepository[FeedbackHelpfulness])**
   - **Purpose**: Tracks helpfulness votes on feedback
   - **Key Functions**:
     - `vote()` - Record helpfulness vote
     - `get_vote()` - Get existing vote

---

## 5. menu_planning_repository.py

### Classes:

1. **MenuTemplateRepository(BaseRepository[MenuTemplate])**
   - **Purpose**: Manages reusable menu templates
   - **Key Functions**:
     - `find_by_hostel()` - Get templates for a hostel
     - `find_global_templates()` - Get global/shared templates
     - `find_by_type()` - Find templates by type
     - `find_seasonal_templates()` - Find seasonal templates
     - `get_most_used_templates()` - Get frequently used templates
     - `get_top_rated_templates()` - Get highest rated templates
     - `record_usage()` - Record template usage

2. **WeeklyMenuPlanRepository(BaseRepository[WeeklyMenuPlan])**
   - **Purpose**: Manages weekly menu plans
   - **Key Functions**:
     - `find_by_hostel()` - Get weekly plans for hostel
     - `get_by_week()` - Get plan for specific week
     - `get_current_week_plan()` - Get plan for current week
     - `create_from_template()` - Create weekly plan from template
     - `approve_plan()` - Approve weekly plan
     - `finalize_plan()` - Finalize plan for execution

3. **MonthlyMenuPlanRepository(BaseRepository[MonthlyMenuPlan])**
   - **Purpose**: Manages monthly menu plans
   - **Key Functions**:
     - `find_by_hostel()` - Get monthly plans for hostel
     - `get_by_month()` - Get plan for specific month
     - `get_current_month_plan()` - Get plan for current month
     - `get_with_details()` - Get plan with daily plans loaded

4. **DailyMenuPlanRepository(BaseRepository[DailyMenuPlan])**
   - **Purpose**: Manages individual daily plans
   - **Key Functions**:
     - `find_by_date()` - Get daily plan for specific date
     - `find_by_week()` - Get all daily plans for a week
     - `approve_daily_plan()` - Approve daily plan

5. **SpecialOccasionMenuRepository(BaseRepository[SpecialOccasionMenu])**
   - **Purpose**: Manages special occasion menus
   - **Key Functions**:
     - `find_by_hostel()` - Get special occasion menus
     - `find_upcoming_occasions()` - Get upcoming special occasions
     - `find_by_type()` - Find occasions by type

6. **MenuSuggestionRepository(BaseRepository[MenuSuggestion])**
   - **Purpose**: Manages AI-generated menu suggestions
   - **Key Functions**:
     - `find_by_hostel()` - Get suggestions for hostel
     - `get_top_suggestions()` - Get top-scored suggestions
     - `accept_suggestion()` - Accept a suggestion
     - `dismiss_suggestion()` - Dismiss a suggestion

7. **MenuPlanningRuleRepository(BaseRepository[MenuPlanningRule])**
   - **Purpose**: Manages automated planning rules
   - **Key Functions**:
     - `get_active_rules()` - Get active planning rules
     - `validate_menu_against_rules()` - Validate menu against rules

8. **SeasonalMenuRepository(BaseRepository[SeasonalMenu])**
   - **Purpose**: Manages season-specific menu configurations
   - **Key Functions**:
     - `get_by_hostel_and_season()` - Get seasonal configuration
     - `get_current_season_menu()` - Get menu for current season
     - `get_all_seasons()` - Get all seasonal configurations

---

## 6. mess_aggregate_repository.py

### Classes:

1. **MessAggregateRepository** (NOT extending BaseRepository)
   - **Purpose**: Provides high-level operations combining multiple repositories
   - **Key Functions**:
     - `get_hostel_dashboard_data()` - Get comprehensive dashboard data
     - `create_complete_menu()` - Create complete menu with all items
     - `get_student_recommended_menu()` - Get personalized menu for student
     - `get_menu_performance_analysis()` - Comprehensive performance analysis
     - `plan_weekly_menu()` - Plan complete week of menus
     - `get_dietary_compliance_report()` - Get dietary compliance report
     - `get_nutritional_summary()` - Get nutritional summary for menu

---

## 7. mess_menu_repository.py

### Classes:

1. **MessMenuRepository(BaseRepository[MessMenu])**
   - **Purpose**: Manages daily mess menus
   - **Key Functions**:
     - `find_by_hostel()` - Get menus for a hostel
     - `get_by_date()` - Get menu for specific date
     - `get_current_week_menus()` - Get menus for current week
     - `get_upcoming_menus()` - Get upcoming published menus
     - `create_menu()` - Create new menu
     - `update_menu()` - Update menu and create version
     - `publish_menu()` - Publish menu to students
     - `unpublish_menu()` - Unpublish menu
     - `find_special_menus()` - Get special occasion menus
     - `find_pending_approval()` - Get menus pending approval
     - `get_menu_statistics()` - Get menu statistics
     - `get_top_rated_menus()` - Get highest rated menus
     - `update_menu_rating()` - Update menu rating
     - `bulk_publish_menus()` - Bulk publish multiple menus

2. **MenuCycleRepository(BaseRepository[MenuCycle])**
   - **Purpose**: Manages recurring menu patterns
   - **Key Functions**:
     - `find_by_hostel()` - Get menu cycles for hostel
     - `get_active_cycle()` - Get active cycle for date
     - `find_by_type()` - Find cycles by type
     - `record_cycle_usage()` - Record cycle usage

3. **MenuVersionRepository(BaseRepository[MenuVersion])**
   - **Purpose**: Manages menu version history
   - **Key Functions**:
     - `find_by_menu()` - Get all versions for a menu
     - `get_latest_version()` - Get latest version
     - `create_version()` - Create new version snapshot
     - `compare_versions()` - Compare two versions

4. **MenuPublishingRepository(BaseRepository[MenuPublishing])**
   - **Purpose**: Manages menu publishing workflow
   - **Key Functions**:
     - `get_by_menu()` - Get publishing record for menu
     - `create_publishing_record()` - Create publishing record
     - `mark_as_published()` - Mark as published
     - `update_delivery_status()` - Update delivery statistics
     - `record_view()` - Record menu view
     - `get_scheduled_publications()` - Get scheduled publications

5. **MenuAvailabilityRepository(BaseRepository[MenuAvailability])**
   - **Purpose**: Tracks real-time menu availability
   - **Key Functions**:
     - `get_by_menu()` - Get availability record
     - `create_availability_record()` - Create tracking record
     - `mark_item_unavailable()` - Mark specific item unavailable
     - `mark_meal_unavailable()` - Mark entire meal unavailable
     - `restore_item_availability()` - Restore item availability
     - `start_meal_service()` - Mark meal service started
     - `end_meal_service()` - Mark meal service ended

---

## 8. nutritional_info_repository.py

### Classes:

1. **NutritionalInfoRepository(BaseRepository[NutritionalInfo])**
   - **Purpose**: Manages detailed nutritional information
   - **Key Functions**:
     - `get_by_meal_item()` - Get nutritional info for item
     - `find_high_protein_items()` - Find high-protein items
     - `find_low_calorie_items()` - Find low-calorie items
     - `find_by_macronutrient_range()` - Find items in macro ranges
     - `find_verified_nutritional_info()` - Find verified records
     - `calculate_meal_nutrition()` - Calculate total nutrition for meal

2. **NutrientProfileRepository(BaseRepository[NutrientProfile])**
   - **Purpose**: Manages calculated nutrient profiles
   - **Key Functions**:
     - `get_by_nutritional_info()` - Get profile by nutritional info
     - `find_nutrient_dense_items()` - Find nutrient-dense items
     - `find_by_nutrition_grade()` - Find items by grade
     - `find_for_weight_loss()` - Find items for weight loss
     - `find_for_muscle_gain()` - Find items for muscle gain
     - `find_heart_healthy_items()` - Find heart-healthy items

3. **DietaryValueRepository(BaseRepository[DietaryValue])**
   - **Purpose**: Manages diet-specific suitability
   - **Key Functions**:
     - `find_by_meal_item()` - Get all dietary values for item
     - `get_by_diet_type()` - Get value for specific diet
     - `find_compliant_items()` - Find items compliant with diet
     - `find_by_suitability()` - Find items by suitability rating
     - `find_keto_friendly_items()` - Find keto-friendly items

4. **NutritionalReportRepository(BaseRepository[NutritionalReport])**
   - **Purpose**: Manages aggregated nutritional reports
   - **Key Functions**:
     - `find_by_hostel()` - Get nutritional reports for hostel
     - `get_latest_report()` - Get latest report
     - `generate_daily_report()` - Generate daily nutritional report
     - `find_deficient_reports()` - Find reports with deficiencies

---

## Summary by Category:

### **Total Classes: 39**

**Dietary Management (5 classes):**
- DietaryOptionRepository
- StudentDietaryPreferenceRepository
- AllergenProfileRepository
- DietaryRestrictionRepository
- MealCustomizationRepository

**Meal Items (6 classes):**
- MealItemRepository
- RecipeRepository
- IngredientMasterRepository
- ItemCategoryRepository
- ItemAllergenRepository
- ItemPopularityRepository

**Approval Workflow (7 classes):**
- MenuApprovalRepository
- MenuApprovalRequestRepository
- ApprovalWorkflowRepository
- ApprovalHistoryRepository
- ApprovalAttemptRepository
- ApprovalRuleRepository
- BulkApprovalRepository

**Feedback & Ratings (8 classes):**
- MenuFeedbackRepository
- ItemRatingRepository
- RatingsSummaryRepository
- QualityMetricsRepository
- SentimentAnalysisRepository
- FeedbackAnalysisRepository
- FeedbackCommentRepository
- FeedbackHelpfulnessRepository

**Menu Planning (8 classes):**
- MenuTemplateRepository
- WeeklyMenuPlanRepository
- MonthlyMenuPlanRepository
- DailyMenuPlanRepository
- SpecialOccasionMenuRepository
- MenuSuggestionRepository
- MenuPlanningRuleRepository
- SeasonalMenuRepository

**Menu Operations (5 classes):**
- MessMenuRepository
- MenuCycleRepository
- MenuVersionRepository
- MenuPublishingRepository
- MenuAvailabilityRepository

**Nutritional Data (4 classes):**
- NutritionalInfoRepository
- NutrientProfileRepository
- DietaryValueRepository
- NutritionalReportRepository

**Aggregate Operations (1 class):**
- MessAggregateRepository
============================================================================================================================
# Complete Notification Repository Structure - Classes Overview

## 1. device_token_repository.py

### Classes:

1. **ActiveDeviceTokensSpec** (Specification)
   - **Purpose**: Filter query for active, valid device tokens
   - **Use**: Find devices ready to receive push notifications

2. **RecentlyUsedDevicesSpec** (Specification)
   - **Purpose**: Filter devices used within specified days
   - **Use**: Identify inactive devices for cleanup

3. **DeviceTokenRepository** (BaseRepository)
   - **Purpose**: Manage device tokens for push notifications
   - **Key Functions**:
     - `find_by_token()` - Find device by token string
     - `find_active_tokens_for_user()` - Get user's active devices
     - `register_or_update_token()` - Register new or update existing device
     - `deactivate_token()` - Disable a device token
     - `mark_token_invalid()` - Mark token as invalid from provider feedback
     - `update_badge_count()` - Update iOS badge count
     - `increment_badge_for_user()` - Increment badge for all user devices
     - `reset_badge_for_user()` - Reset badge to zero
     - `find_stale_tokens()` - Find unused tokens for cleanup
     - `cleanup_invalid_tokens()` - Remove invalid tokens
     - `get_device_statistics()` - Get device analytics

---

## 2. email_notification_repository.py

### Classes:

1. **HighEngagementEmailsSpec** (Specification)
   - **Purpose**: Filter emails with high open rates
   - **Use**: Find successful email campaigns

2. **BouncedEmailsSpec** (Specification)
   - **Purpose**: Filter bounced emails by type
   - **Use**: Identify problematic email addresses

3. **EmailNotificationRepository** (BaseRepository)
   - **Purpose**: Manage email notifications and track engagement
   - **Key Functions**:
     - `create_email_with_details()` - Create email with attachments
     - `find_by_notification_id()` - Find email by notification ID
     - `find_by_provider_message_id()` - Find by provider's ID
     - `track_email_open()` - Record email open event
     - `track_email_click()` - Record link click event
     - `track_email_bounce()` - Record bounce event
     - `track_spam_report()` - Record spam complaint
     - `get_engagement_analytics()` - Get open/click rates
     - `get_click_analytics()` - Get top clicked URLs
     - `get_delivery_performance()` - Get delivery trends
     - `add_attachment()` - Add attachment to email
     - `cleanup_bounced_emails()` - Remove hard bounces
     - `find_unengaged_recipients()` - Find low engagement users

---

## 3. notification_aggregate_repository.py

### Classes:

1. **NotificationAggregateRepository** (No inheritance - Aggregate)
   - **Purpose**: Cross-channel analytics and executive reporting
   - **Key Functions**:
     - `get_executive_dashboard()` - High-level metrics for management
     - `get_comprehensive_analytics()` - Detailed cross-channel analytics
     - `get_performance_benchmarks()` - Compare current vs previous periods
     - `get_user_segmentation_analytics()` - Segment users by engagement
     - `get_cost_analysis_report()` - SMS/Email/Push cost analysis
     - `_get_email_analytics()` - Email-specific metrics
     - `_get_sms_analytics()` - SMS-specific metrics
     - `_get_push_analytics()` - Push-specific metrics
     - `_get_user_engagement_patterns()` - Hourly engagement patterns
     - `_get_template_performance()` - Template effectiveness
     - `export_analytics_data()` - Export data for external analysis

---

## 4. notification_preferences_repository.py

### Classes:

1. **ActivePreferencesSpec** (Specification)
   - **Purpose**: Filter users with notifications enabled
   - **Use**: Find users who accept notifications

2. **QuietHoursEnabledSpec** (Specification)
   - **Purpose**: Filter users with quiet hours set
   - **Use**: Respect user's do-not-disturb settings

3. **NotificationPreferencesRepository** (BaseRepository)
   - **Purpose**: Manage user notification preferences and settings
   - **Key Functions**:
     - `get_or_create_preferences()` - Get or create default preferences
     - `update_global_settings()` - Update notification enable/disable
     - `update_quiet_hours()` - Set do-not-disturb hours
     - `update_digest_settings()` - Configure daily/weekly digests
     - `update_channel_preferences()` - Set email/SMS/push preferences
     - `create_unsubscribe_token()` - Generate unsubscribe link token
     - `process_unsubscribe()` - Handle unsubscribe requests
     - `get_preference_analytics()` - Analyze user preferences
     - `find_users_in_quiet_hours()` - Check who's in quiet hours now
     - `get_users_for_digest()` - Find users for digest notifications
     - `get_preference_trends()` - Track preference changes over time

---

## 5. notification_queue_repository.py

### Classes:

1. **PendingQueueItemsSpec** (Specification)
   - **Purpose**: Filter notifications ready for processing
   - **Use**: Get next batch to send

2. **RetryEligibleSpec** (Specification)
   - **Purpose**: Filter failed notifications eligible for retry
   - **Use**: Implement retry logic

3. **NotificationQueueRepository** (BaseRepository)
   - **Purpose**: Manage notification queue and batch processing
   - **Key Functions**:
     - `enqueue_notification()` - Add notification to queue
     - `dequeue_next_batch()` - Get next batch for processing
     - `mark_processing_complete()` - Mark as success/failed
     - `find_stalled_items()` - Find stuck processing items
     - `reset_stalled_items()` - Reset stuck items back to queue
     - `create_batch()` - Create notification batch
     - `update_batch_progress()` - Update batch processing status
     - `get_batch_status()` - Get batch details
     - `get_queue_statistics()` - Get queue depth and performance
     - `get_processing_trends()` - Analyze processing patterns
     - `get_retry_analysis()` - Analyze retry success rates
     - `cleanup_completed_items()` - Remove old completed items
     - `optimize_queue_performance()` - Get optimization suggestions

---

## 6. notification_repository.py

### Classes:

1. **PendingNotificationsSpec** (Specification)
   - **Purpose**: Filter notifications pending delivery
   - **Use**: Find notifications to process

2. **UnreadNotificationsSpec** (Specification)
   - **Purpose**: Filter unread user notifications
   - **Use**: Get unread count and list

3. **NotificationRepository** (BaseRepository)
   - **Purpose**: Core notification lifecycle management
   - **Key Functions**:
     - `create_notification()` - Create new notification
     - `find_by_user()` - Get user's notifications (paginated)
     - `find_unread_for_user()` - Get unread notifications
     - `get_unread_count()` - Count unread notifications
     - `find_scheduled_notifications()` - Get scheduled notifications
     - `find_failed_notifications()` - Get failed notifications
     - `update_status()` - Change notification status
     - `mark_as_read()` - Mark single as read
     - `mark_bulk_as_read()` - Mark multiple as read
     - `get_delivery_statistics()` - Get delivery stats
     - `get_engagement_metrics()` - Get read/click metrics
     - `get_performance_trends()` - Get daily/weekly trends
     - `cleanup_old_notifications()` - Remove old notifications
     - `find_orphaned_notifications()` - Find invalid notifications

---

## 7. notification_routing_repository.py

### Classes:

1. **ActiveRoutingRulesSpec** (Specification)
   - **Purpose**: Filter active routing rules
   - **Use**: Get applicable routing rules

2. **PendingEscalationsSpec** (Specification)
   - **Purpose**: Filter escalations ready for next level
   - **Use**: Process automatic escalations

3. **NotificationRoutingRepository** (BaseRepository)
   - **Purpose**: Intelligent notification routing and escalation
   - **Key Functions**:
     - `create_routing_rule()` - Create routing rule
     - `find_matching_rules()` - Find rules matching context
     - `apply_routing_rule()` - Apply rule to notification
     - `test_routing_rules()` - Test rules without applying
     - `create_escalation_path()` - Create escalation levels
     - `initiate_escalation()` - Start escalation process
     - `process_escalations()` - Process pending escalations
     - `resolve_escalation()` - Mark escalation resolved
     - `get_routing_analytics()` - Analyze rule usage
     - `get_escalation_analytics()` - Analyze escalation performance
     - `get_routing_performance_metrics()` - Get rule effectiveness
     - `find_unused_rules()` - Find rarely used rules
     - `optimize_routing_rules()` - Get optimization suggestions

---

## 8. notification_template_repository.py

### Classes:

1. **ActiveTemplatesSpec** (Specification)
   - **Purpose**: Filter active templates
   - **Use**: Get available templates

2. **PopularTemplatesSpec** (Specification)
   - **Purpose**: Filter frequently used templates
   - **Use**: Identify popular templates

3. **NotificationTemplateRepository** (BaseRepository)
   - **Purpose**: Template management with versioning
   - **Key Functions**:
     - `create_template_with_version()` - Create template with initial version
     - `find_by_code()` - Find template by unique code
     - `find_by_type_and_category()` - Filter by type/category
     - `search_templates()` - Search by name/content
     - `update_template_content()` - Update and create new version
     - `get_template_versions()` - Get version history
     - `revert_to_version()` - Revert to previous version
     - `render_template()` - Render with variables
     - `validate_template_syntax()` - Check for errors
     - `get_template_analytics()` - Get usage analytics
     - `get_template_performance_metrics()` - Get effectiveness metrics
     - `find_unused_templates()` - Find unused templates
     - `find_templates_with_issues()` - Find templates with errors
     - `duplicate_template()` - Clone existing template

---

## 9. push_notification_repository.py

### Classes:

1. **DeliveredPushSpec** (Specification)
   - **Purpose**: Filter successfully delivered push notifications
   - **Use**: Analyze successful deliveries

2. **HighEngagementPushSpec** (Specification)
   - **Purpose**: Filter push notifications that were tapped
   - **Use**: Identify engaging content

3. **PushNotificationRepository** (BaseRepository)
   - **Purpose**: Manage push notifications across platforms
   - **Key Functions**:
     - `create_push_with_targeting()` - Create push with device targeting
     - `find_by_notification_id()` - Find by notification ID
     - `find_by_provider_message_id()` - Find by provider ID
     - `find_for_device_tokens()` - Find for specific devices
     - `update_delivery_status()` - Update delivery status
     - `track_push_tap()` - Record tap/interaction
     - `bulk_update_delivery_status()` - Bulk status update
     - `update_badge_counts()` - Update iOS badges
     - `increment_badge_for_users()` - Increment badges
     - `get_delivery_analytics()` - Get delivery metrics
     - `get_engagement_trends()` - Get tap trends
     - `get_action_analytics()` - Analyze action button usage
     - `get_device_performance()` - Performance by device type
     - `get_optimal_timing_analysis()` - Best time to send
     - `cleanup_old_push_data()` - Remove old data
     - `get_provider_error_analysis()` - Analyze errors

---

## 10. sms_notification_repository.py

### Classes:

1. **DeliveredSMSSpec** (Specification)
   - **Purpose**: Filter successfully delivered SMS
   - **Use**: Analyze successful deliveries

2. **HighCostSMSSpec** (Specification)
   - **Purpose**: Filter expensive SMS messages
   - **Use**: Identify cost anomalies

3. **SMSNotificationRepository** (BaseRepository)
   - **Purpose**: Manage SMS notifications with cost tracking
   - **Key Functions**:
     - `create_sms_with_details()` - Create SMS with segment calculation
     - `find_by_notification_id()` - Find by notification ID
     - `find_by_provider_message_id()` - Find by provider ID
     - `find_pending_delivery_reports()` - Get pending confirmations
     - `update_delivery_status()` - Update delivery status
     - `bulk_update_delivery_status()` - Bulk status update
     - `get_cost_analytics()` - Get cost analysis
     - `get_delivery_analytics()` - Get delivery trends
     - `get_provider_performance()` - Compare SMS providers
     - `find_messages_by_dlt_template()` - DLT compliance (India)
     - `get_dlt_compliance_report()` - DLT compliance report
     - `get_segment_analytics()` - Analyze message segmentation
     - `cleanup_old_sms_data()` - Remove old SMS data
     - `find_high_cost_messages()` - Find expensive messages

---

## Summary by Category

### **Specification Classes (18 total)**
- Define reusable query filters
- Used with Repository pattern for clean code
- Examples: ActiveDeviceTokensSpec, UnreadNotificationsSpec

### **Repository Classes (10 total)**
- Extend BaseRepository
- Encapsulate database operations
- Provide business logic for data access

### **Key Functions by Purpose:**

1. **CRUD Operations**: create, find_by_id, update, delete
2. **Status Tracking**: update_status, mark_as_read, track_delivery
3. **Analytics**: get_*_analytics, get_*_statistics, get_*_trends
4. **Maintenance**: cleanup_*, find_stalled_*, reset_*
5. **Engagement**: track_open, track_click, track_tap
6. **Cost Management**: get_cost_analytics, find_high_cost_*
7. **Preferences**: update_*_settings, get_preference_*
8. **Queue Management**: enqueue, dequeue, process_batch
9. **Routing**: find_matching_rules, apply_routing_rule
10. **Template Management**: render_template, validate_syntax

This structure provides complete separation of concerns with specialized repositories for each notification aspect.
============================================================================================================================
# Complete Payment Repository Architecture - Classes Overview

## 1. **gateway_transaction_repository.py**

### Class: `GatewayTransactionRepository(BaseRepository[GatewayTransaction])`
**Purpose:** Multi-gateway management with load balancing, performance monitoring, and cost optimization

**Key Functions:**
- `create_transaction()` - Create new gateway transaction
- `update_transaction_status()` - Update transaction status (initiated → processing → success/failed)
- `record_webhook()` - Record webhook data from payment gateway
- `mark_verified()` - Mark transaction as verified
- `record_settlement()` - Record settlement information from gateway
- `find_by_gateway_order_id()` - Find transaction by gateway order ID
- `find_by_gateway_transaction_id()` - Find by gateway transaction ID
- `find_by_payment()` - Find all transactions for a payment
- `find_pending_transactions()` - Find transactions stuck in pending state
- `find_failed_transactions()` - Find failed transactions
- `find_unverified_transactions()` - Find successful but unverified transactions
- `find_unsettled_transactions()` - Find transactions not yet settled by gateway
- `calculate_gateway_performance()` - Calculate gateway performance metrics
- `get_failure_reasons()` - Get top failure reasons for a gateway
- `get_payment_method_distribution()` - Payment method distribution analysis
- `increment_retry_count()` - Increment retry count for failed transactions

---

## 2. **payment_aggregate_repository.py**

### Class: `PaymentAggregateRepository`
**Purpose:** Aggregated data and analytics across all payment-related entities. Complex cross-table queries.

**Key Functions:**
- `get_financial_dashboard()` - Complete financial dashboard (revenue, refunds, gateway stats)
- `get_revenue_trends()` - Revenue trends over time (daily/weekly/monthly)
- `get_student_financial_summary()` - Complete financial summary for a student
- `get_student_payment_history()` - Detailed payment history for a student
- `get_outstanding_payments_report()` - Outstanding payments with aging analysis
- `get_gateway_comparison()` - Compare performance across gateways
- `get_payment_method_analysis()` - Payment method usage analysis
- `get_refund_analysis()` - Comprehensive refund analysis
- `get_collection_performance()` - Payment collection performance metrics
- `get_reminder_effectiveness_report()` - Reminder effectiveness analysis
- `get_ledger_reconciliation_report()` - Ledger reconciliation report

---

## 3. **payment_gateway_repository.py**

### Class: `PaymentGatewayRepository(BaseRepository[GatewayTransaction])`
**Purpose:** Simplified gateway transaction tracking (lighter version of gateway_transaction_repository)

**Key Functions:**
- `create_gateway_transaction()` - Create gateway transaction record
- `update_transaction_response()` - Update with gateway response
- `record_webhook_data()` - Record webhook data
- `mark_verified()` - Mark transaction verified
- `update_payment_method_details()` - Update payment method details (card/UPI/bank)
- `record_gateway_fees()` - Record gateway fees and taxes
- `record_transaction_error()` - Record transaction error details
- `find_by_gateway_order_id()` - Find by gateway order ID
- `find_by_gateway_payment_id()` - Find by gateway payment ID
- `find_by_payment_id()` - Find all transactions for a payment
- `find_pending_transactions()` - Find pending transactions
- `find_unverified_transactions()` - Find unverified successful transactions
- `get_gateway_statistics()` - Gateway statistics
- `get_payment_method_breakdown()` - Payment method breakdown
- `get_error_statistics()` - Error statistics
- `increment_retry_count()` - Increment retry count
- `bulk_verify_transactions()` - Bulk verify transactions

---

## 4. **payment_ledger_repository.py**

### Class: `PaymentLedgerRepository(BaseRepository[PaymentLedger])`
**Purpose:** Double-entry bookkeeping, automated reconciliation, financial reporting, audit compliance

**Key Functions:**
- `create_ledger_entry()` - Create single ledger entry
- `create_double_entry()` - Create double-entry (debit + credit)
- `reverse_entry()` - Reverse a ledger entry
- `mark_reconciled()` - Mark entry as reconciled
- `get_student_balance()` - Get current balance for student
- `get_student_ledger()` - Get ledger entries for student
- `get_hostel_ledger()` - Get ledger entries for hostel
- `find_by_payment()` - Find ledger entries for a payment
- `find_unreconciled_entries()` - Find unreconciled entries
- `calculate_financial_summary()` - Calculate financial summary (debits/credits)
- `get_transaction_breakdown()` - Transaction breakdown by type
- `get_student_balances()` - Get balances for all students
- `get_daily_balances()` - Daily balance progression
- `perform_ledger_reconciliation()` - Perform reconciliation
- `detect_reconciliation_discrepancies()` - Detect discrepancies

---

## 5. **payment_refund_repository.py**

### Class: `PaymentRefundRepository(BaseRepository[PaymentRefund])`
**Purpose:** Handle payment refund requests, approvals, and processing

**Key Functions:**
- `create_refund_request()` - Create new refund request
- `approve_refund()` - Approve refund request
- `reject_refund()` - Reject refund request
- `initiate_refund_processing()` - Initiate refund processing
- `complete_refund()` - Mark refund as completed
- `mark_refund_failed()` - Mark refund as failed
- `cancel_refund()` - Cancel refund request
- `find_by_reference()` - Find refund by reference number
- `find_by_payment()` - Find refunds for a payment
- `find_pending_refunds()` - Find pending refund requests
- `find_approved_refunds()` - Find approved refunds ready for processing
- `find_processing_refunds()` - Find refunds stuck in processing
- `calculate_refund_statistics()` - Calculate refund statistics
- `get_refund_approval_time()` - Calculate average approval time
- `get_refund_categories_breakdown()` - Breakdown by refund category
- `get_refund_success_rate()` - Calculate refund success rate

---

## 6. **payment_reminder_repository.py**

### Class: `PaymentReminderRepository(BaseRepository[PaymentReminder])`
**Purpose:** Manage payment reminder configuration and delivery tracking

**Key Functions:**
- `create_reminder()` - Create new payment reminder
- `mark_reminder_sent()` - Mark reminder as sent (email/SMS/push)
- `mark_reminder_delivered()` - Mark reminder as delivered
- `mark_reminder_failed()` - Mark reminder as failed
- `track_email_opened()` - Track email opened event
- `track_email_clicked()` - Track email link clicked
- `track_sms_delivered()` - Track SMS delivered
- `track_push_clicked()` - Track push notification clicked
- `increment_retry_count()` - Increment retry count
- `find_by_reference()` - Find reminder by reference
- `find_by_payment()` - Find reminders for a payment
- `find_by_student()` - Find reminders for a student
- `find_pending_reminders()` - Find pending reminders to send
- `find_failed_reminders()` - Find failed reminders for retry
- `find_by_email_message_id()` - Find by email message ID
- `calculate_reminder_statistics()` - Calculate reminder statistics
- `get_reminder_effectiveness()` - Reminder effectiveness by type
- `get_channel_performance()` - Performance across email/SMS/push
- `get_engagement_trends()` - Engagement trends over time

---

## 7. **payment_repository.py**

### Class: `PaymentRepository(BaseRepository[Payment])`
**Purpose:** Comprehensive payment processing with multi-gateway support, fraud detection, financial compliance

**Key Functions:**
- `create_payment()` - Create new payment record
- `process_payment_transaction()` - Process payment transaction
- `mark_payment_completed()` - Mark payment as completed
- `mark_payment_failed()` - Mark payment as failed
- `handle_payment_refund()` - Update payment with refund info
- `find_by_reference()` - Find payment by reference number
- `find_by_transaction_id()` - Find payment by transaction ID
- `find_by_hostel()` - Find payments for hostel with filters
- `find_by_student()` - Find payments for student
- `find_overdue_payments()` - Find overdue payments
- `find_pending_payments()` - Find pending payments
- `find_refunded_payments()` - Find refunded payments
- `calculate_revenue_statistics()` - Calculate revenue statistics
- `calculate_payment_success_rate()` - Calculate success rate
- `get_payment_method_distribution()` - Payment method distribution
- `get_revenue_trends()` - Revenue trends over time
- `get_payments_needing_reminders()` - Payments needing reminders
- `increment_reminder_count()` - Increment reminder count
- `bulk_update_overdue_status()` - Bulk update overdue status

---

## 8. **payment_schedule_repository.py**

### Class: `PaymentScheduleRepository(BaseRepository[PaymentSchedule])`
**Purpose:** Manage recurring payment schedules for students

**Key Functions:**
- `create_schedule()` - Create new payment schedule
- `update_next_due_date()` - Update next due date
- `increment_payment_generated()` - Increment payment generated count
- `increment_payment_completed()` - Increment payment completed count
- `suspend_schedule()` - Suspend payment schedule
- `resume_schedule()` - Resume suspended schedule
- `pause_schedule()` - Pause schedule temporarily
- `complete_schedule()` - Mark schedule as completed
- `cancel_schedule()` - Cancel schedule
- `find_by_reference()` - Find schedule by reference
- `find_by_student()` - Find schedules for student
- `find_by_hostel()` - Find schedules for hostel
- `find_due_schedules()` - Find schedules with payments due
- `find_overdue_schedules()` - Find overdue schedules
- `find_expiring_schedules()` - Find schedules expiring soon
- `find_suspended_schedules()` - Find suspended schedules
- `calculate_schedule_statistics()` - Calculate schedule statistics
- `calculate_collection_rate()` - Calculate payment collection rate
- `get_revenue_projection()` - Project future revenue from schedules

---

## Summary of Repository Structure:

| Repository | Primary Entity | Main Purpose |
|-----------|---------------|--------------|
| `PaymentRepository` | Payment | Core payment processing & lifecycle |
| `GatewayTransactionRepository` | GatewayTransaction | Multi-gateway transaction management |
| `PaymentGatewayRepository` | GatewayTransaction | Simplified gateway tracking |
| `PaymentLedgerRepository` | PaymentLedger | Double-entry bookkeeping & reconciliation |
| `PaymentRefundRepository` | PaymentRefund | Refund request & processing workflow |
| `PaymentReminderRepository` | PaymentReminder | Reminder delivery & tracking |
| `PaymentScheduleRepository` | PaymentSchedule | Recurring payment schedules |
| `PaymentAggregateRepository` | Multiple | Cross-table analytics & reporting |

**Note:** All repositories extend `BaseRepository` which provides standard CRUD operations (create, read, update, delete, soft delete).
============================================================================================================================
# Complete Clarity: Referral Repository Classes & Their Functions

## 1. **referral_program_repository.py**

### Class: `ReferralProgramRepository`
**Purpose**: Manages referral programs (campaigns/schemes)

**Functions:**
- `create_program()` - Create new referral program
- `get_program_by_id()` - Fetch program by ID
- `get_by_name()` - Fetch program by name
- `get_by_code()` - Fetch program by code
- `update_program()` - Update program details
- `find_active_programs()` - Get all active programs
- `find_by_type()` - Get programs by type
- `find_expiring_programs()` - Get programs expiring soon
- `find_upcoming_programs()` - Get programs starting soon
- `check_user_eligibility()` - Check if user can participate
- `check_referral_limit()` - Check if user reached max referrals
- `validate_booking_eligibility()` - Check if booking qualifies
- `activate_program()` - Activate a program
- `deactivate_program()` - Deactivate a program
- `extend_program()` - Extend program end date
- `increment_referral_count()` - Update referral counter
- `increment_successful_referrals()` - Update success counter
- `add_reward_amount()` - Update total rewards distributed
- `recalculate_statistics()` - Recalculate all program stats
- `get_program_statistics()` - Get comprehensive stats
- `get_program_performance_comparison()` - Compare all programs
- `get_program_timeline_data()` - Get time-series performance
- `search_programs()` - Search with multiple filters

---

## 2. **referral_code_repository.py**

### Class: `ReferralCodeRepository`
**Purpose**: Manages individual referral codes

**Functions:**
- `create_referral_code()` - Create new referral code
- `get_code_by_id()` - Fetch code by ID
- `get_by_code()` - Fetch by code string
- `update_code()` - Update code details
- `find_by_user()` - Get all codes for a user
- `find_by_program()` - Get all codes for a program
- `find_active_codes()` - Get valid active codes
- `find_expiring_codes()` - Get codes expiring soon
- `find_exhausted_codes()` - Get codes at usage limit
- `validate_code()` - Check if code can be used
- `check_code_availability()` - Check if code string available
- `increment_usage()` - Increase usage count
- `increment_shares()` - Track share count
- `increment_clicks()` - Track click count
- `increment_registrations()` - Track registration count
- `increment_bookings()` - Track booking count
- `track_channel_usage()` - Track which channel used
- `activate_code()` - Activate a code
- `deactivate_code()` - Deactivate a code
- `extend_expiry()` - Extend expiration date
- `increase_max_uses()` - Increase usage limit
- `expire_old_codes()` - Auto-expire expired codes
- `get_code_statistics()` - Get code performance stats
- `get_user_code_performance()` - Get user's all codes stats
- `get_top_performing_codes()` - Get best codes by metric
- `get_channel_breakdown()` - Get share channel analytics
- `get_recommended_codes_for_user()` - Suggest best codes
- `suggest_code_optimization()` - Give improvement tips
- `search_codes()` - Search with filters

---

## 3. **referral_repository.py**

### Class: `ReferralRepository`
**Purpose**: Manages individual referral instances (when someone uses a code)

**Functions:**
- `create_referral()` - Create new referral record
- `get_referral_by_id()` - Fetch referral by ID
- `update_referral()` - Update referral details
- `find_by_referrer()` - Get all referrals by a user
- `find_by_referee_email()` - Find by referee email
- `find_by_referee_phone()` - Find by referee phone
- `find_by_referee_user()` - Get referrals for a referee user
- `find_by_code()` - Get all uses of a code
- `find_by_program()` - Get all referrals in a program
- `mark_as_converted()` - Convert referral to booking
- `link_referee_user()` - Link referee after registration
- `update_status()` - Change referral status
- `cancel_referral()` - Cancel a referral
- `expire_old_referrals()` - Auto-expire old pending
- `update_referrer_reward_status()` - Update referrer reward status
- `update_referee_reward_status()` - Update referee reward status
- `get_referral_statistics()` - Get referral stats
- `get_conversion_funnel()` - Get funnel analytics
- `get_top_referrers()` - Get best performing referrers
- `get_referral_sources_breakdown()` - Analytics by source
- `get_pending_rewards()` - Get referrals with pending rewards
- `get_pending_conversions()` - Get old pending referrals
- `search_referrals()` - Search with multiple filters

---

## 4. **referral_reward_repository.py**

### Class: `ReferralRewardRepository`
**Purpose**: Manages rewards and payouts

**Functions:**

#### Reward Management:
- `create_reward()` - Create reward entry
- `get_reward_by_id()` - Fetch reward by ID
- `find_by_user()` - Get user's all rewards
- `find_by_referral()` - Get rewards for a referral
- `find_pending_rewards()` - Get pending approval rewards
- `find_approved_unpaid_rewards()` - Get approved but unpaid
- `approve_reward()` - Approve a reward
- `reject_reward()` - Reject a reward
- `mark_reward_paid()` - Mark as paid
- `cancel_reward()` - Cancel a reward
- `bulk_approve_rewards()` - Approve multiple rewards

#### Payout Management:
- `create_payout_request()` - User requests payout
- `get_payout_by_id()` - Fetch payout by ID
- `find_payouts_by_user()` - Get user's payout requests
- `find_pending_payouts()` - Get pending payout requests
- `approve_payout()` - Approve payout request
- `process_payout()` - Mark as processing
- `complete_payout()` - Mark as completed
- `fail_payout()` - Mark as failed

#### Analytics:
- `get_user_reward_summary()` - User's reward summary
- `get_reward_statistics()` - Overall reward stats
- `get_payout_statistics()` - Overall payout stats

---

## 5. **referral_aggregate_repository.py**

### Class: `ReferralAggregateRepository`
**Purpose**: Cross-entity analytics and system-wide reporting

**Functions:**

#### Dashboards:
- `get_system_overview()` - System-wide summary (programs, codes, referrals, rewards)
- `get_performance_dashboard()` - Performance metrics across system

#### Trends:
- `get_referral_trends()` - Daily referral trends
- `get_conversion_trends()` - Conversion rate over time

#### Comparisons:
- `compare_programs()` - Compare all programs performance

#### User Analytics:
- `get_top_referrers_leaderboard()` - Top referrers ranking
- `get_user_lifetime_value()` - Complete user referral value

#### Financial:
- `get_financial_summary()` - Financial reconciliation report

---

## Summary Table

| Repository | Main Entity | Primary Use |
|-----------|-------------|-------------|
| **ReferralProgramRepository** | ReferralProgram | Program CRUD, eligibility, stats |
| **ReferralCodeRepository** | ReferralCode | Code CRUD, validation, usage tracking |
| **ReferralRepository** | Referral | Referral lifecycle, conversion tracking |
| **ReferralRewardRepository** | ReferralReward, RewardPayout | Reward approval, payout processing |
| **ReferralAggregateRepository** | Cross-entity | System analytics, dashboards |

---

## Data Flow Example

1. **Admin creates program** → `ReferralProgramRepository.create_program()`
2. **User generates code** → `ReferralCodeRepository.create_referral_code()`
3. **User shares code** → `ReferralCodeRepository.increment_shares()`
4. **Someone clicks link** → `ReferralCodeRepository.increment_clicks()`
5. **Someone signs up** → `ReferralRepository.create_referral()` + `ReferralCodeRepository.increment_registrations()`
6. **Referee books** → `ReferralRepository.mark_as_converted()` + `ReferralCodeRepository.increment_bookings()`
7. **Create rewards** → `ReferralRewardRepository.create_reward()` (for referrer & referee)
8. **Approve rewards** → `ReferralRewardRepository.approve_reward()`
9. **User requests payout** → `ReferralRewardRepository.create_payout_request()`
10. **Process payout** → `ReferralRewardRepository.complete_payout()`
11. **View analytics** → `ReferralAggregateRepository.get_system_overview()`

This is the complete structure of your referral repository system.
============================================================================================================================
# Complete Clarity: Review Repository Classes and Their Purpose

## 1. **review_repository.py**

### **Class: ReviewRepository**
**Purpose:** Core CRUD operations and basic queries for reviews

**Key Functions:**
- `create_review()` - Create new review with validation
- `update_review()` - Update existing review
- `delete_review()` - Soft delete review
- `find_by_hostel()` - Get all reviews for a hostel with filters
- `find_by_reviewer()` - Get all reviews by a specific user
- `find_by_status()` - Get reviews by status (draft, published, rejected)
- `find_verified_reviews()` - Get verified stay reviews
- `find_flagged_reviews()` - Get flagged reviews needing moderation
- `find_pending_approval()` - Get reviews waiting for approval
- `search_reviews()` - Full-text search in reviews
- `get_hostel_rating_summary()` - Get rating statistics (avg, min, max)
- `get_rating_distribution()` - Get count of 1-5 star ratings
- `get_aspect_ratings()` - Get average ratings for cleanliness, food, staff, etc.
- `get_review_trends()` - Get rating trends over time
- `approve_review()` - Approve review for publication
- `reject_review()` - Reject review with reason
- `flag_review()` - Flag review for moderation
- `unflag_review()` - Remove flag from review
- `verify_stay()` - Mark review as verified stay

---

## 2. **review_moderation_repository.py**

### **Class: ReviewModerationRepository**
**Purpose:** Handle moderation workflows, flagging, and content safety

**Key Functions:**
- `log_moderation_action()` - Log any moderation action taken
- `get_moderation_history()` - Get all moderation actions for a review
- `get_moderator_activity()` - Get actions by specific moderator
- `get_moderation_statistics()` - Get moderation metrics
- `create_flag()` - Create flag on review (spam, inappropriate, etc.)
- `resolve_flag()` - Resolve a flag with action taken
- `get_pending_flags()` - Get unresolved flags
- `get_review_flags()` - Get all flags for specific review
- `get_flag_statistics()` - Get flag metrics
- `add_to_queue()` - Add review to moderation queue
- `assign_to_moderator()` - Assign queue item to moderator
- `complete_moderation()` - Mark moderation as complete
- `escalate_review()` - Escalate review to higher level
- `get_moderation_queue()` - Get items in moderation queue
- `get_queue_statistics()` - Get queue metrics
- `create_auto_moderation()` - Store AI moderation results (spam detection, toxicity)
- `get_auto_moderation()` - Get AI moderation results
- `get_reviews_for_auto_approval()` - Get reviews that AI says can auto-approve
- `get_reviews_for_auto_rejection()` - Get reviews that AI says should reject
- `get_auto_moderation_statistics()` - Get AI moderation metrics

---

## 3. **review_voting_repository.py**

### **Class: ReviewVotingRepository**
**Purpose:** Handle helpful/not helpful voting and engagement tracking

**Key Functions:**
- `cast_vote()` - User votes review as helpful/not helpful
- `remove_vote()` - Remove vote
- `get_user_vote()` - Get user's vote on review
- `get_review_votes()` - Get all votes for review
- `get_vote_statistics()` - Get vote counts and percentages
- `get_helpfulness_score()` - Get helpfulness score for review
- `calculate_wilson_score()` - Calculate Wilson confidence score for ranking
- `get_top_helpful_reviews()` - Get most helpful reviews
- `update_helpfulness_rankings()` - Update rankings based on votes
- `track_view()` - Track when someone views review
- `track_read_time()` - Track how long someone reads review
- `track_share()` - Track when review is shared
- `track_bookmark()` - Track when review is bookmarked
- `track_booking_influence()` - Track if review led to booking
- `track_inquiry_influence()` - Track if review led to inquiry
- `get_engagement_metrics()` - Get all engagement metrics
- `calculate_engagement_score()` - Calculate overall engagement score
- `get_most_engaged_reviews()` - Get reviews with highest engagement

---

## 4. **review_response_repository.py**

### **Class: ReviewResponseRepository**
**Purpose:** Manage hostel responses to reviews

**Key Functions:**
- `create_response()` - Hostel responds to review
- `update_response()` - Update existing response
- `approve_response()` - Approve response for publication
- `publish_response()` - Publish approved response
- `unpublish_response()` - Hide published response
- `delete_response()` - Delete response
- `get_response_by_review()` - Get response for specific review
- `get_hostel_responses()` - Get all responses by hostel
- `get_pending_approval()` - Get responses waiting approval
- `get_responder_responses()` - Get responses by specific staff member
- `get_response_rate()` - Calculate % of reviews responded to
- `get_average_response_time()` - Calculate avg time to respond
- `get_template_usage_statistics()` - Get template usage metrics
- `create_template()` - Create response template
- `update_template()` - Update template
- `get_templates()` - Get available templates
- `get_template()` - Get specific template
- `apply_template()` - Apply template with placeholders
- `approve_template()` - Approve template for use
- `deactivate_template()` - Deactivate template
- `create_statistics()` - Create response statistics for period
- `get_statistics()` - Get response statistics
- `get_latest_statistics()` - Get most recent statistics

---

## 5. **review_media_repository.py**

### **Class: ReviewMediaRepository**
**Purpose:** Handle photos/videos uploaded with reviews

**Key Functions:**
- `create_media()` - Upload photo/video to review
- `update_media()` - Update media metadata
- `delete_media()` - Delete media
- `get_review_media()` - Get all media for review
- `get_pending_moderation()` - Get media awaiting moderation
- `get_flagged_media()` - Get flagged media
- `get_processing_queue()` - Get media being processed
- `mark_processing_started()` - Mark media processing started
- `mark_processing_completed()` - Mark processing complete
- `mark_processing_failed()` - Mark processing failed
- `update_processing_step()` - Update current processing step
- `approve_media()` - Approve media for display
- `reject_media()` - Reject inappropriate media
- `flag_media()` - Flag media for review
- `update_content_analysis()` - Store AI content analysis results
- `get_media_statistics()` - Get media upload statistics
- `get_processing_statistics()` - Get processing performance stats
- `increment_view_count()` - Track media views

---

## 6. **review_analytics_repository.py**

### **Class: ReviewAnalyticsRepository**
**Purpose:** Generate comprehensive analytics and insights

**Key Functions:**
- `calculate_analytics_summary()` - Calculate overall analytics
- `get_analytics_summary()` - Get existing analytics summary
- `calculate_rating_distribution()` - Calculate 1-5 star distribution
- `get_rating_distribution()` - Get rating distribution
- `calculate_review_trend()` - Calculate trend for specific date
- `get_trend_history()` - Get trends over date range
- `calculate_monthly_rating()` - Calculate monthly aggregations
- `get_monthly_ratings()` - Get monthly ratings
- `calculate_sentiment_analysis()` - Analyze positive/negative sentiment
- `get_sentiment_analysis()` - Get sentiment results
- `calculate_aspect_ratings()` - Calculate ratings for each aspect (cleanliness, food, etc.)
- `get_aspect_ratings()` - Get aspect ratings
- `calculate_competitor_comparison()` - Compare with competitor hostels
- `get_competitor_comparison()` - Get comparison results
- `refresh_all_analytics()` - Recalculate all analytics at once

---

## 7. **review_aggregate_repository.py**

### **Class: ReviewAggregateRepository**
**Purpose:** Complex cross-entity queries and dashboard metrics

**Key Functions:**
- `get_hostel_dashboard_metrics()` - Get comprehensive dashboard stats
- `get_top_performing_reviews()` - Get best reviews by metric
- `get_review_performance_over_time()` - Get performance trends
- `get_reviewer_insights()` - Get reviewer behavior patterns
- `get_common_themes()` - Extract common positive/negative themes
- `compare_time_periods()` - Compare two time periods
- `get_review_export_data()` - Get data for CSV/Excel export

---

## Summary Table

| Repository | Main Entity | Primary Use Case |
|------------|-------------|------------------|
| ReviewRepository | Review | Basic CRUD, queries, approval workflow |
| ReviewModerationRepository | Moderation Logs, Flags, Queue | Content moderation, spam detection |
| ReviewVotingRepository | Votes, Engagement | Helpfulness voting, engagement tracking |
| ReviewResponseRepository | Response, Template | Hostel replies to reviews |
| ReviewMediaRepository | Media, Processing | Photo/video uploads and moderation |
| ReviewAnalyticsRepository | Analytics, Trends | Statistical analysis and insights |
| ReviewAggregateRepository | Cross-entity | Dashboard, reports, exports |

**Total: 7 Repository Classes, ~150+ Functions**
============================================================================================================================
# Complete Room Repositories Module - Classes Overview

## 1. **base_repository.py**

### Classes:
- **BaseRepository[T]** (Generic)
  - **Purpose**: Foundation for all repository classes
  - **Functions**:
    - CREATE operations (single & bulk create)
    - READ operations (find by ID, find all, search by criteria, exists, count)
    - UPDATE operations (single & bulk update)
    - DELETE operations (hard delete, soft delete, restore)
    - PAGINATION (paginate results)
    - TRANSACTION management (begin, commit, rollback, flush, refresh)

---

## 2. **bed_assignment_repository.py**

### Classes:
- **BedAssignmentRepository** (extends BaseRepository[BedAssignment])
  - **Purpose**: Manages bed assignments to students with automation and optimization
  - **Functions**:
    - **Assignment Operations**: Create assignments with validation, check conflicts, find active/current assignments, complete assignments, transfer students between beds
    - **Assignment Rules**: Create and execute automated assignment rules based on conditions
    - **Conflict Management**: Detect, record, find, and resolve assignment conflicts
    - **Optimization**: Run optimization algorithms for best bed-student matching
    - **History Tracking**: Track all assignment changes and modifications
    - **Preferences**: Manage student bed preferences
    - **Statistics**: Generate assignment analytics, find expiring/overdue assignments

---

## 3. **bed_repository.py**

### Classes:
- **BedRepository** (extends BaseRepository[Bed])
  - **Purpose**: Manages individual beds with conditions, configurations, and utilization
  - **Functions**:
    - **Basic Operations**: Create beds with details, find by room/number/code
    - **Availability**: Find available/occupied beds, update status, filter by status
    - **Assignment**: Assign bed to student, release bed from student
    - **Condition Management**: Update and track bed physical condition, find beds needing maintenance/replacement
    - **Configuration**: Manage bed setup (frame type, mattress, amenities)
    - **Accessibility**: Track and find wheelchair-accessible and special needs beds
    - **Preferences**: Manage student bed preferences and matching
    - **Utilization**: Track occupancy rates, revenue, performance metrics
    - **Statistics**: Generate bed analytics, performance rankings, type distribution

---

## 4. **room_aggregate_repository.py**

### Classes:
- **RoomAggregateRepository** (No inheritance - standalone)
  - **Purpose**: Cross-cutting queries and analytics across all room entities
  - **Functions**:
    - **Hostel Overview**: Get comprehensive statistics for entire hostel
    - **Dashboard Metrics**: Generate real-time dashboard data
    - **Search**: Comprehensive multi-filter room search
    - **Analytics**: Occupancy trends, revenue forecasts, performance reports
    - **Reporting**: Generate executive summaries and insights

---

## 5. **room_amenity_repository.py**

### Classes:
- **RoomAmenityRepository** (extends BaseRepository[RoomAmenity])
  - **Purpose**: Manages room amenities with maintenance and feedback
  - **Functions**:
    - **Basic Operations**: Create amenities with details, find by room/type/category, search amenities
    - **Status Management**: Update status, find defective amenities, track warranties
    - **Condition Tracking**: Monitor wear and tear, find items needing maintenance/replacement
    - **Maintenance**: Schedule, track, and complete maintenance activities
    - **Usage Tracking**: Monitor amenity usage patterns and costs
    - **Feedback**: Collect and analyze student feedback on amenities
    - **Inventory**: Track inventory, depreciation, valuations, physical verification
    - **Statistics**: Cost summaries, value analysis, low-rated amenities

---

## 6. **room_availability_repository.py**

### Classes:
- **RoomAvailabilityRepository** (extends BaseRepository[RoomAvailability])
  - **Purpose**: Real-time room availability tracking with forecasting and alerts
  - **Functions**:
    - **Availability Tracking**: Create/update availability, sync with room data, bulk sync
    - **Search**: Find available/low availability/full rooms, get summaries
    - **Windows**: Define time-based availability windows
    - **Rules**: Create and execute availability rules and restrictions
    - **Forecasting**: Generate demand forecasts using ML/statistical models
    - **Alerts**: Create, check, acknowledge, and resolve availability alerts
    - **Optimization**: Run optimization analysis for revenue/occupancy
    - **Demand Tracking**: Monitor inquiries, bookings, demand levels, reset metrics

---

## 7. **room_repository.py**

### Classes:
- **RoomRepository** (extends BaseRepository[Room])
  - **Purpose**: Core room management with specifications and pricing
  - **Functions**:
    - **Basic Operations**: Create rooms with details, find by hostel/number
    - **Search & Filter**: Search available rooms with multiple filters, find by status/maintenance
    - **Occupancy**: Update occupancy, calculate rates, find full/vacant rooms
    - **Pricing**: Update pricing with history, get pricing history
    - **Maintenance**: Mark under/complete maintenance with tracking
    - **Statistics**: Hostel statistics, room type distribution, floor-wise occupancy
    - **Availability Checks**: Check room capacity, find best match rooms

---

## 8. **room_type_repository.py**

### Classes:
- **RoomTypeRepository** (extends BaseRepository[RoomTypeDefinition])
  - **Purpose**: Manages room type definitions, features, and comparisons
  - **Functions**:
    - **Basic Operations**: Create types with features/pricing, find by type/code, find active/featured/popular types
    - **Features**: Add features, get features by category, compare features between types
    - **Pricing**: Add pricing tiers, get current/historical pricing, calculate discounts
    - **Availability**: Update and sync type-level availability from rooms
    - **Comparisons**: Create and manage comparisons between room types
    - **Upgrades**: Define upgrade/downgrade paths between types
    - **Statistics**: Type statistics, pricing comparisons, capacity summaries
    - **Recommendations**: AI-based room type recommendations for students

---

## 9. **__init__.py**

### Classes:
**None** (Package initialization file)

### Functions:
- **get_repository(repository_name, session)**: Factory function to dynamically instantiate repositories

### Exports:
- RoomRepository
- BedRepository
- BedAssignmentRepository
- RoomAmenityRepository
- RoomAvailabilityRepository
- RoomTypeRepository
- RoomAggregateRepository

---

# Summary Matrix

| File | Repository Class | Primary Entity | Key Responsibility |
|------|-----------------|----------------|-------------------|
| base_repository.py | BaseRepository | Generic | Foundation CRUD operations |
| bed_assignment_repository.py | BedAssignmentRepository | BedAssignment | Student-bed assignments & automation |
| bed_repository.py | BedRepository | Bed | Individual bed management & tracking |
| room_aggregate_repository.py | RoomAggregateRepository | Multiple | Cross-entity analytics & reporting |
| room_amenity_repository.py | RoomAmenityRepository | RoomAmenity | Amenity lifecycle & maintenance |
| room_availability_repository.py | RoomAvailabilityRepository | RoomAvailability | Real-time availability & forecasting |
| room_repository.py | RoomRepository | Room | Core room operations & pricing |
| room_type_repository.py | RoomTypeRepository | RoomTypeDefinition | Type definitions & comparisons |
| __init__.py | - | - | Package exports & factory |

---

# Function Categories by Repository

## BaseRepository
- **CRUD**: Create, Read, Update, Delete
- **Query**: Filter, Search, Count, Exists
- **Transaction**: Commit, Rollback, Flush
- **Pagination**: Paginate results

## BedAssignmentRepository
- **Assignments**: Create, Complete, Transfer
- **Rules**: Execute automated assignment rules
- **Conflicts**: Detect & resolve conflicts
- **Optimization**: AI-based bed matching
- **History**: Track changes
- **Preferences**: Student preferences

## BedRepository
- **Bed Management**: Create, Update, Find
- **Conditions**: Track physical state
- **Configuration**: Setup & amenities
- **Accessibility**: Special needs
- **Utilization**: Performance tracking
- **Preferences**: Matching algorithm

## RoomAggregateRepository
- **Overview**: Hostel-wide statistics
- **Search**: Multi-filter queries
- **Analytics**: Trends & forecasts
- **Reporting**: Executive summaries

## RoomAmenityRepository
- **Amenities**: CRUD operations
- **Conditions**: Wear & tear tracking
- **Maintenance**: Schedule & execute
- **Usage**: Monitor patterns
- **Feedback**: Student ratings
- **Inventory**: Asset management

## RoomAvailabilityRepository
- **Tracking**: Real-time availability
- **Windows**: Time-based rules
- **Forecasting**: Demand prediction
- **Alerts**: Automated notifications
- **Optimization**: Revenue/occupancy
- **Demand**: Inquiry tracking

## RoomRepository
- **Rooms**: CRUD & search
- **Occupancy**: Capacity management
- **Pricing**: History & updates
- **Maintenance**: Status tracking
- **Statistics**: Analytics

## RoomTypeRepository
- **Types**: Define room categories
- **Features**: Amenity lists
- **Pricing**: Tier structures
- **Comparisons**: Side-by-side analysis
- **Upgrades**: Upgrade paths
- **Recommendations**: AI matching
============================================================================================================================
# Search Repositories - Complete Class Overview

## 1. `search_aggregate_repository.py`

### **SearchAggregateRepository**
- **Purpose**: Central hub that unifies all search-related repositories
- **Key Functions**:
  - `get_complete_search_dashboard()` - Complete search metrics dashboard
  - `get_search_health_metrics()` - Overall search system health
  - `process_search_event()` - Handle complete search event processing
  - `process_autocomplete_event()` - Handle autocomplete interactions
  - `generate_search_optimization_report()` - Generate optimization insights

---

## 2. `search_analytics_repository.py`

### **SearchTermStatsRepository**
- **Purpose**: Track statistics for individual search terms
- **Key Functions**:
  - `create_or_update_stats()` - Create/update term statistics
  - `get_term_stats()` - Get stats for specific term
  - `get_trending_terms()` - Get trending search terms
  - `get_top_performing_terms()` - Get best performing terms
  - `get_poor_performing_terms()` - Get terms needing optimization
  - `calculate_term_trends()` - Calculate trend metrics

### **SearchMetricsRepository**
- **Purpose**: Track aggregated search metrics over time
- **Key Functions**:
  - `create_or_update_metrics()` - Store daily/weekly/monthly metrics
  - `get_metrics()` - Get metrics for date range
  - `get_latest_metrics()` - Get most recent metrics
  - `get_aggregated_metrics()` - Get combined metrics
  - `compare_periods()` - Compare two time periods

### **PopularSearchTermRepository**
- **Purpose**: Manage ranked popular search terms
- **Key Functions**:
  - `create_or_update_popular_term()` - Update popularity rankings
  - `get_popular_terms()` - Get popular terms for period
  - `get_featured_terms()` - Get featured popular searches

### **TrendingSearchRepository**
- **Purpose**: Track search terms with high growth velocity
- **Key Functions**:
  - `create_trending_search()` - Create trending entry
  - `get_trending_searches()` - Get trending terms with filters

### **ZeroResultTermRepository**
- **Purpose**: Track searches that return no results
- **Key Functions**:
  - `create_or_update_zero_result()` - Track zero result terms
  - `get_unresolved_terms()` - Get unresolved zero results
  - `mark_resolved()` - Mark term as resolved

### **SearchAnalyticsReportRepository**
- **Purpose**: Store pre-computed analytics reports
- **Key Functions**:
  - `create_report()` - Create analytics report
  - `get_latest_report()` - Get latest report of type
  - `get_reports()` - Get reports for date range
  - `publish_report()` - Publish report

---

## 3. `search_autocomplete_repository.py`

### **AutocompleteSuggestionRepository**
- **Purpose**: Manage autocomplete suggestions with scoring
- **Key Functions**:
  - `create_suggestion()` - Create new suggestion
  - `bulk_create_suggestions()` - Bulk insert suggestions
  - `search_suggestions()` - Search suggestions by prefix
  - `get_by_value_and_type()` - Get specific suggestion
  - `get_featured_suggestions()` - Get featured suggestions
  - `get_top_suggestions()` - Get best performing suggestions
  - `update_usage_metrics()` - Update usage stats
  - `update_score()` - Update suggestion scoring
  - `toggle_featured()` - Toggle featured status
  - `recalculate_all_scores()` - Recalculate all scores
  - `cleanup_low_performing()` - Remove poor suggestions

### **AutocompleteQueryLogRepository**
- **Purpose**: Log autocomplete queries for analytics
- **Key Functions**:
  - `log_query()` - Log autocomplete query
  - `get_query_analytics()` - Get autocomplete analytics

### **SuggestionSourceRepository**
- **Purpose**: Manage autocomplete data sources
- **Key Functions**:
  - `get_sources_for_sync()` - Get sources needing sync
  - `update_sync_status()` - Update synchronization status

### **PopularSearchSuggestionRepository**
- **Purpose**: Manage popular search suggestions for fallback
- **Key Functions**:
  - `get_current_popular()` - Get current popular suggestions

### **SuggestionPerformanceRepository**
- **Purpose**: Track suggestion performance over time
- **Key Functions**:
  - `record_performance()` - Record performance metrics
  - `get_suggestion_performance_trend()` - Get performance trends

---

## 4. `search_query_log_repository.py`

### **SearchQueryLogRepository**
- **Purpose**: Log all search queries with comprehensive tracking
- **Key Functions**:
  - `create_query_log()` - Create search query log
  - `bulk_create_query_logs()` - Bulk insert logs
  - `get_by_id()` - Get log by ID
  - `get_user_search_history()` - Get user's search history
  - `get_session_queries()` - Get queries in session
  - `get_zero_result_queries()` - Get zero result queries
  - `get_search_statistics()` - Get comprehensive search stats
  - `get_popular_search_terms()` - Get popular terms with counts
  - `get_search_filters_usage()` - Analyze filter usage
  - `get_performance_metrics()` - Get performance metrics
  - `update_click_interaction()` - Update with click data
  - `update_conversion()` - Update with conversion data

### **SearchSessionRepository**
- **Purpose**: Track search sessions and user journeys
- **Key Functions**:
  - `create_session()` - Create new search session
  - `get_by_session_id()` - Get session by ID
  - `get_active_session()` - Get active session
  - `update_session_activity()` - Update session metrics
  - `end_session()` - End session and calculate metrics
  - `get_user_sessions()` - Get user's sessions
  - `get_session_statistics()` - Get session analytics
  - `cleanup_inactive_sessions()` - Clean up old sessions

### **SavedSearchRepository**
- **Purpose**: Manage user's saved searches and alerts
- **Key Functions**:
  - `create_saved_search()` - Create saved search
  - `update_saved_search()` - Update saved search
  - `get_user_saved_searches()` - Get user's saved searches
  - `get_searches_for_alerts()` - Get searches needing alerts
  - `record_execution()` - Record search execution
  - `update_alert_status()` - Update alert status
  - `toggle_favorite()` - Toggle favorite status
  - `toggle_alerts()` - Toggle alert status

---

## 5. `__init__.py`
- **Purpose**: Package exports - no classes, just imports for easy access

---

## **Summary by Functionality**:

### **Query Logging** (4 classes):
- SearchQueryLogRepository - Individual search logging
- SearchSessionRepository - Session tracking  
- SavedSearchRepository - Saved searches
- SearchAggregateRepository - Unified access

### **Analytics** (6 classes):
- SearchTermStatsRepository - Term-level stats
- SearchMetricsRepository - Aggregated metrics
- PopularSearchTermRepository - Popular term rankings
- TrendingSearchRepository - Trending analysis
- ZeroResultTermRepository - Zero result tracking
- SearchAnalyticsReportRepository - Pre-computed reports

### **Autocomplete** (5 classes):
- AutocompleteSuggestionRepository - Suggestion management
- AutocompleteQueryLogRepository - Autocomplete logging
- SuggestionSourceRepository - Data source management
- PopularSearchSuggestionRepository - Popular fallback suggestions
- SuggestionPerformanceRepository - Performance tracking

**Total: 15 Repository Classes** covering the complete search ecosystem.
============================================================================================================================
# Complete Clarity: Student Repository Classes, Their Purpose & Functions

## 1. **student_repository.py**
### Class: `StudentRepository`
**Purpose:** Core student lifecycle management - enrollment to checkout

**Key Functions:**
- `create()` - Create new student record
- `find_by_id()` - Get student by ID
- `find_by_user_id()` - Get student by user ID
- `update()` - Update student information
- `soft_delete()` - Soft delete student
- `restore()` - Restore deleted student
- `check_in_student()` - Process student check-in with room assignment
- `check_out_student()` - Process student check-out
- `initiate_notice_period()` - Start notice period for leaving
- `suspend_student()` - Suspend student account
- `reactivate_student()` - Reactivate suspended student
- `find_by_hostel()` - Get students by hostel
- `find_active_residents()` - Get all active students
- `find_by_room()` - Get students in a room
- `find_in_notice_period()` - Get students in notice period
- `find_pending_checkout()` - Get students with upcoming checkout
- `find_by_institution()` - Get students by college/university
- `find_by_company()` - Get students by employer
- `search_students()` - Search by name, email, phone, student ID
- `find_pending_verification()` - Get students with unverified documents
- `verify_id_proof()` - Mark ID proof as verified
- `verify_institutional_id()` - Mark college ID as verified
- `verify_company_id()` - Mark company ID as verified
- `find_security_deposit_pending()` - Get students who haven't paid deposit
- `mark_security_deposit_paid()` - Record deposit payment
- `process_security_deposit_refund()` - Record deposit refund
- `get_hostel_statistics()` - Get comprehensive hostel stats
- `get_status_breakdown()` - Get count by status
- `get_institution_breakdown()` - Get count by institution
- `get_average_stay_duration()` - Calculate average stay
- `count_by_criteria()` - Count students by filters
- `bulk_update_status()` - Update status for multiple students
- `bulk_assign_hostel()` - Assign multiple students to hostel
- `exists_by_user_id()` - Check if student exists
- `exists_by_student_id_number()` - Check if student ID is unique
- `can_check_in()` - Validate check-in eligibility
- `can_check_out()` - Validate check-out eligibility

---

## 2. **student_profile_repository.py**
### Class: `StudentProfileRepository`
**Purpose:** Extended student profile information (personal, medical, educational details)

**Key Functions:**
- `create()` - Create student profile
- `find_by_id()` - Get profile by ID
- `find_by_student_id()` - Get profile by student ID
- `update()` - Update profile
- `update_by_student_id()` - Update profile by student ID
- `_calculate_profile_completeness()` - Calculate profile completion %
- `get_profile_completeness()` - Get completion percentage
- `find_incomplete_profiles()` - Get profiles below threshold
- `get_age_distribution()` - Get age group statistics
- `get_blood_group_distribution()` - Get blood group stats
- `get_nationality_breakdown()` - Get nationality distribution
- `count_international_students()` - Count non-Indian students
- `find_with_medical_conditions()` - Get students with medical issues
- `find_with_allergies()` - Get students with allergies
- `find_requiring_special_accommodation()` - Get students needing special care
- `search_by_qualification()` - Search by education level
- `search_by_field_of_study()` - Search by major/field
- `find_scholarship_holders()` - Get scholarship students
- `find_referred_students()` - Get students referred by someone
- `count_referrals()` - Count referrals by student
- `get_top_referrers()` - Get top referral generators
- `get_average_profile_completeness()` - Average completion across hostel
- `count_profiles_by_completeness_range()` - Distribution by completion
- `bulk_update_language_preference()` - Set language for multiple students
- `exists_for_student()` - Check if profile exists

---

## 3. **student_document_repository.py**
### Class: `StudentDocumentRepository`
**Purpose:** Document lifecycle management (upload, verify, expire, replace)

**Key Functions:**
- `create()` - Upload new document
- `find_by_id()` - Get document by ID
- `find_by_student_id()` - Get all documents for student
- `update()` - Update document details
- `soft_delete()` - Soft delete document
- `verify_document()` - Approve document
- `reject_document()` - Reject document with reason
- `find_pending_verification()` - Get unverified documents
- `find_rejected_documents()` - Get rejected documents
- `find_expiring_documents()` - Get documents expiring soon
- `find_expired_documents()` - Get expired documents
- `mark_as_expired()` - Mark document as expired
- `mark_expiry_notified()` - Mark notification sent
- `process_expired_documents()` - Batch mark expired documents
- `replace_document()` - Upload new version
- `get_document_history()` - Get all versions
- `get_current_version()` - Get latest version
- `get_verification_statistics()` - Verification stats
- `get_document_type_breakdown()` - Count by document type
- `get_average_verification_time()` - Average time to verify
- `track_download()` - Record document download
- `get_most_downloaded_documents()` - Get frequently accessed docs
- `mark_compliance_checked()` - Mark compliance audit
- `find_compliance_pending()` - Get pending compliance check
- `generate_compliance_report()` - Create compliance report
- `search_documents()` - Search by name, number
- `bulk_verify_documents()` - Verify multiple documents
- `bulk_mark_expired()` - Expire multiple documents
- `count_by_student_and_type()` - Count specific document type

---

## 4. **student_preferences_repository.py**
### Class: `StudentPreferencesRepository`
**Purpose:** Student preferences (notifications, privacy, meal, UI/UX settings)

**Key Functions:**
- `create()` - Create preferences with defaults
- `find_by_id()` - Get preferences by ID
- `find_by_student_id()` - Get preferences by student ID
- `update()` - Update preferences
- `update_by_student_id()` - Update by student ID
- `update_notification_channels()` - Set email/SMS/push/WhatsApp
- `update_notification_types()` - Set payment/attendance/event alerts
- `set_quiet_hours()` - Configure do-not-disturb time
- `enable_digest_mode()` - Set daily digest notifications
- `find_digest_subscribers()` - Get students with digest enabled
- `update_privacy_settings()` - Set profile visibility
- `find_public_profiles()` - Get visible profiles
- `find_searchable_profiles()` - Get searchable students
- `update_meal_preferences()` - Set meal plan
- `find_by_meal_plan()` - Get students by meal plan
- `get_meal_plan_distribution()` - Meal plan statistics
- `update_lifestyle_preferences()` - Set room/sleep preferences
- `find_compatible_roommates()` - Match compatible students
- `update_ui_preferences()` - Set theme, layout
- `get_theme_distribution()` - Theme usage stats
- `update_language_preference()` - Set preferred language
- `find_by_language()` - Get students by language
- `get_language_distribution()` - Language stats
- `get_notification_statistics()` - Notification preference stats
- `bulk_update_notification_channel()` - Update for multiple students
- `exists_for_student()` - Check if preferences exist

---

## 5. **guardian_contact_repository.py**
### Class: `GuardianContactRepository`
**Purpose:** Parent/guardian contact management (emergency contacts, verification, communication)

**Key Functions:**
- `create()` - Add guardian contact
- `find_by_id()` - Get contact by ID
- `find_by_student_id()` - Get all guardians for student
- `update()` - Update contact details
- `soft_delete()` - Delete contact
- `get_primary_contact()` - Get primary guardian
- `set_primary_contact()` - Make guardian primary
- `_ensure_single_primary_contact()` - Enforce one primary
- `get_emergency_contacts()` - Get emergency contacts by priority
- `get_first_emergency_contact()` - Get highest priority contact
- `update_emergency_priority()` - Set emergency order
- `find_24x7_available_contacts()` - Get always-available contacts
- `verify_phone()` - Mark phone verified
- `verify_email()` - Mark email verified
- `verify_id_proof()` - Mark ID verified
- `find_unverified_contacts()` - Get pending verification
- `get_fully_verified_contacts()` - Get completely verified guardians
- `get_authorized_for_pickup()` - Get pickup-authorized guardians
- `get_authorized_for_leave_approval()` - Get leave-approvers
- `get_financial_guardians()` - Get payment-responsible guardians
- `update_authorizations()` - Set permissions
- `update_communication_preferences()` - Set notification settings
- `find_subscribed_to_monthly_reports()` - Get report subscribers
- `find_subscribed_to_payment_reminders()` - Get payment alert subscribers
- `find_by_language_preference()` - Get by language
- `search_guardians()` - Search by name/phone/email
- `find_by_relation()` - Get by relationship (Father/Mother)
- `find_by_phone()` - Search by phone number
- `get_verification_statistics()` - Verification stats
- `get_relation_distribution()` - Relation breakdown
- `count_by_student()` - Count guardians for student
- `bulk_update_communication_preference()` - Update multiple contacts
- `exists_for_student()` - Check if guardian exists

---

## 6. **room_transfer_history_repository.py**
### Class: `RoomTransferHistoryRepository`
**Purpose:** Track room transfers/assignments (history, approvals, workflow)

**Key Functions:**
- `create()` - Record transfer
- `find_by_id()` - Get transfer by ID
- `find_by_student_id()` - Get transfer history for student
- `update()` - Update transfer record
- `create_transfer_request()` - Create new transfer request
- `approve_transfer()` - Approve transfer
- `reject_transfer()` - Reject transfer
- `complete_transfer()` - Mark transfer complete
- `cancel_transfer()` - Cancel transfer
- `_update_current_assignment()` - Set current room
- `get_current_assignment()` - Get student's current room
- `find_pending_approvals()` - Get pending transfer requests
- `find_in_progress_transfers()` - Get ongoing transfers
- `find_by_room()` - Get transfers for a room
- `find_emergency_transfers()` - Get emergency transfers
- `find_with_financial_impact()` - Get transfers with rent change
- `calculate_total_transfer_charges()` - Sum transfer fees
- `calculate_total_damage_charges()` - Sum damage charges
- `get_rent_change_history()` - Track rent changes
- `get_transfer_statistics()` - Transfer stats
- `_calculate_average_completion_time()` - Average transfer duration
- `get_transfer_type_distribution()` - Transfer type breakdown
- `get_most_active_transfer_months()` - Peak transfer months
- `count_transfers_by_student()` - Count student transfers
- `has_pending_transfer()` - Check for pending transfer

---

## 7. **student_aggregate_repository.py**
### Class: `StudentAggregateRepository`
**Purpose:** Cross-entity analytics, dashboards, comprehensive reports (joins multiple tables)

**Key Functions:**
- `get_complete_student_data()` - Get ALL student data (profile, documents, guardians, transfers)
- `get_hostel_dashboard_stats()` - Comprehensive hostel dashboard
- `get_enrollment_trends()` - Monthly enrollment graph data
- `get_checkout_trends()` - Monthly checkout graph data
- `get_retention_metrics()` - 3-month, 6-month retention
- `segment_students_by_demographics()` - Age/gender/type breakdown
- `get_compliance_overview()` - Compliance score and issues
- `advanced_search()` - Multi-criteria search across tables

---

## 8. **__init__.py**
**Purpose:** Package initialization - exports all repository classes

**Content:**
```python
from student_repository import StudentRepository
from student_profile_repository import StudentProfileRepository
from student_document_repository import StudentDocumentRepository
from student_preferences_repository import StudentPreferencesRepository
from guardian_contact_repository import GuardianContactRepository
from room_transfer_history_repository import RoomTransferHistoryRepository
from student_aggregate_repository import StudentAggregateRepository

__all__ = [list of all classes]
```

---

## **Quick Reference Summary:**

| Repository | Primary Purpose | Key Entity |
|------------|----------------|------------|
| StudentRepository | Core student lifecycle | Student admissions, check-in/out, status |
| StudentProfileRepository | Extended personal info | Bio, education, medical, demographics |
| StudentDocumentRepository | Document management | ID proofs, verification, expiry |
| StudentPreferencesRepository | User preferences | Notifications, privacy, UI settings |
| GuardianContactRepository | Parent/guardian info | Emergency contacts, authorizations |
| RoomTransferHistoryRepository | Room change tracking | Transfer requests, approvals |
| StudentAggregateRepository | Analytics & reports | Cross-table queries, dashboards |

**Design Pattern:** Repository Pattern - Each class handles database operations for one specific domain entity, keeping business logic separate from data access.
============================================================================================================================
# Complete Subscription Repository Architecture

## 1. **booking_commission_repository.py**

### Class: `BookingCommissionRepository`
**Purpose**: Manages commission tracking for bookings made through the subscription system.

**Key Functions**:
- `create_commission()` - Create new commission record
- `create_booking_commission()` - Create commission for a specific booking
- `get_by_id()` - Retrieve commission by ID
- `get_by_booking()` - Get commission for a booking
- `get_by_hostel()` - Get all commissions for a hostel
- `get_by_subscription()` - Get commissions for a subscription
- `get_pending_commissions()` - Get unpaid commissions
- `get_overdue_commissions()` - Get overdue commissions
- `mark_as_paid()` - Mark commission as paid
- `mark_as_processing()` - Mark commission as being processed
- `mark_as_cancelled()` - Cancel commission
- `mark_as_refunded()` - Mark commission as refunded
- `extend_due_date()` - Extend payment due date
- `get_commission_statistics()` - Get commission analytics
- `get_commission_by_period()` - Get commissions for date range
- `batch_mark_as_paid()` - Bulk mark commissions as paid
- `search_commissions()` - Search with multiple filters

---

## 2. **subscription_aggregate_repository.py**

### Class: `SubscriptionAggregateRepository`
**Purpose**: Provides aggregated queries and complex operations across multiple subscription-related entities.

**Key Functions**:
- `get_subscription_dashboard()` - Get comprehensive dashboard metrics
- `get_hostel_subscription_overview()` - Complete subscription overview for a hostel
- `get_revenue_analytics()` - Comprehensive revenue analytics
- `get_plan_performance()` - Performance metrics for each plan
- `get_subscription_health()` - Health indicators and warnings
- `get_feature_usage_analytics()` - Detailed feature usage analytics
- `get_retention_metrics()` - Subscription retention metrics
- `get_financial_analytics()` - Financial analytics (MRR, ARR, etc.)

---

## 3. **subscription_billing_repository.py**

### Class: `SubscriptionBillingRepository`
**Purpose**: Manages billing cycles, schedules, and billing-related operations.

**Key Functions**:
- `create_billing_cycle()` - Create new billing cycle record
- `create_billing_cycles_for_subscription()` - Create all billing cycles for a subscription period
- `get_by_id()` - Get billing cycle by ID
- `get_by_subscription()` - Get all billing cycles for a subscription
- `get_current_cycle()` - Get current active billing cycle
- `get_upcoming_cycles()` - Get future billing cycles
- `get_past_cycles()` - Get historical billing cycles
- `get_billing_due_today()` - Get cycles due for billing today
- `get_billing_due_within_days()` - Get cycles due within X days
- `get_trial_cycles()` - Get billing cycles in trial period
- `mark_as_billed()` - Mark cycle as billed
- `update_days_until_billing()` - Recalculate days until billing
- `update_trial_days()` - Update trial days remaining
- `end_trial_period()` - End trial period
- `update_auto_renew()` - Update auto-renewal status
- `get_billing_statistics()` - Get billing statistics
- `get_revenue_forecast()` - Forecast revenue from upcoming cycles
- `batch_update_days_until_billing()` - Bulk update billing days

---

## 4. **subscription_feature_repository.py**

### Class: `SubscriptionFeatureRepository`
**Purpose**: Manages feature usage tracking, limits enforcement, and feature availability.

**Key Functions**:

### Feature Usage Operations:
- `create_feature_usage()` - Create feature usage record
- `initialize_feature_usage()` - Initialize feature for subscription
- `get_feature_usage()` - Get specific feature usage
- `get_all_feature_usage()` - Get all features for subscription
- `get_enabled_features()` - Get enabled features only
- `get_exceeded_features()` - Get features that exceeded limits
- `increment_usage()` - Increment feature usage count
- `decrement_usage()` - Decrement feature usage count
- `reset_usage()` - Reset feature usage to zero
- `update_usage_limit()` - Update feature usage limit
- `toggle_feature()` - Enable/disable feature

### Subscription Limits Operations:
- `create_subscription_limit()` - Create subscription limit
- `initialize_subscription_limit()` - Initialize limit for subscription
- `get_subscription_limit()` - Get specific limit
- `get_all_subscription_limits()` - Get all limits
- `get_exceeded_limits()` - Get limits that are exceeded
- `get_enforced_limits()` - Get enforced limits
- `increment_limit_value()` - Increment limit value
- `decrement_limit_value()` - Decrement limit value
- `update_limit_threshold()` - Update limit threshold
- `mark_warning_sent()` - Mark warning as sent
- `toggle_limit_enforcement()` - Enable/disable limit enforcement

### Validation:
- `can_use_feature()` - Check if feature can be used
- `can_add_to_limit()` - Check if can add within limit
- `validate_limits()` - Validate all limits
- `get_feature_usage_summary()` - Get usage summary
- `get_limits_summary()` - Get limits summary

---

## 5. **subscription_invoice_repository.py**

### Class: `SubscriptionInvoiceRepository`
**Purpose**: Manages invoice generation, tracking, payment processing, and invoice analytics.

**Key Functions**:
- `create_invoice()` - Create new invoice
- `generate_invoice_number()` - Generate unique invoice number
- `create_subscription_invoice()` - Create invoice for subscription
- `get_by_id()` - Get invoice by ID
- `get_by_invoice_number()` - Get invoice by number
- `get_by_subscription()` - Get all invoices for subscription
- `get_by_hostel()` - Get invoices for hostel
- `get_by_status()` - Get invoices by status
- `get_overdue_invoices()` - Get all overdue invoices
- `get_due_soon()` - Get invoices due within X days
- `get_unpaid_invoices()` - Get all unpaid invoices
- `get_paid_invoices()` - Get paid invoices
- `get_partially_paid_invoices()` - Get partially paid invoices
- `get_draft_invoices()` - Get draft invoices
- `mark_as_sent()` - Mark invoice as sent
- `mark_as_paid()` - Mark invoice as paid
- `record_partial_payment()` - Record partial payment
- `mark_as_overdue()` - Mark invoice as overdue
- `cancel_invoice()` - Cancel invoice
- `void_invoice()` - Void invoice
- `apply_discount()` - Apply discount to invoice
- `update_urls()` - Update invoice and payment URLs
- `extend_due_date()` - Extend invoice due date
- `get_invoice_statistics()` - Get invoice statistics
- `get_revenue_by_period()` - Get revenue for date range
- `get_outstanding_by_hostel()` - Get outstanding summary for hostel
- `get_payment_collection_metrics()` - Get payment collection metrics
- `batch_mark_overdue()` - Bulk mark invoices as overdue
- `search_invoices()` - Search with multiple filters

---

## 6. **subscription_plan_repository.py**

### Class: `SubscriptionPlanRepository`
**Purpose**: Manages subscription plan data with pricing, features, and plan comparison.

**Key Functions**:

### Plan Operations:
- `create_plan()` - Create new subscription plan
- `get_by_id()` - Get plan by ID
- `get_by_name()` - Get plan by name
- `get_by_type()` - Get plan by type enum
- `get_all_active_plans()` - Get all active plans
- `get_public_plans()` - Get public plans for display
- `get_featured_plan()` - Get featured/recommended plan
- `get_plans_by_price_range()` - Get plans within price range
- `get_plans_with_trial()` - Get plans offering trial
- `update_plan()` - Update plan details
- `update_plan_pricing()` - Update plan pricing
- `update_plan_limits()` - Update plan usage limits
- `toggle_plan_status()` - Activate/deactivate plan
- `toggle_plan_visibility()` - Change public visibility
- `set_featured_plan()` - Set plan as featured
- `update_sort_order()` - Update display order
- `delete_plan()` - Delete plan

### Feature Operations:
- `create_plan_feature()` - Create plan feature
- `bulk_create_features()` - Bulk create features
- `get_plan_features()` - Get all features for plan
- `get_feature_by_key()` - Get specific feature
- `get_plans_with_feature()` - Get plans with specific feature
- `update_plan_feature()` - Update feature
- `delete_plan_feature()` - Delete feature

### Analytics:
- `get_plan_statistics()` - Get plan statistics
- `get_pricing_summary()` - Get pricing summary
- `compare_plans()` - Compare multiple plans
- `get_upgrade_options()` - Get upgrade options from current plan
- `get_downgrade_options()` - Get downgrade options
- `search_plans()` - Search with multiple filters
- `validate_plan_limits()` - Validate usage against plan limits
- `check_plan_availability()` - Check if plan is available

---

## 7. **subscription_repository.py**

### Class: `SubscriptionRepository`
**Purpose**: Manages complete subscription lifecycle (creation, activation, renewal, cancellation).

**Key Functions**:

### Core Operations:
- `create_subscription()` - Create new subscription
- `get_by_id()` - Get subscription by ID
- `get_by_reference()` - Get by reference number
- `get_active_by_hostel()` - Get active subscription for hostel
- `get_all_by_hostel()` - Get all subscriptions for hostel
- `get_by_status()` - Get subscriptions by status
- `get_by_plan()` - Get subscriptions by plan

### Status Management:
- `update_status()` - Update subscription status
- `activate_subscription()` - Activate subscription
- `suspend_subscription()` - Suspend subscription
- `expire_subscription()` - Mark as expired
- `cancel_subscription()` - Cancel subscription

### Lifecycle Operations:
- `renew_subscription()` - Renew for next period
- `update_payment_info()` - Update payment information
- `toggle_auto_renew()` - Toggle auto-renewal
- `change_plan()` - Change plan (upgrade/downgrade)
- `end_trial_period()` - End trial period

### Retrieval:
- `get_expiring_soon()` - Get subscriptions expiring soon
- `get_expired_subscriptions()` - Get expired subscriptions
- `get_trial_subscriptions()` - Get trial subscriptions
- `get_trial_ending_soon()` - Get trials ending soon
- `get_auto_renewable_subscriptions()` - Get subscriptions for auto-renewal

### History & Cancellation:
- `create_subscription_history()` - Create history record
- `get_subscription_history()` - Get change history
- `create_cancellation_record()` - Create cancellation record
- `get_cancellation_record()` - Get cancellation details
- `update_cancellation_record()` - Update cancellation

### Analytics:
- `get_subscription_statistics()` - Get overall statistics
- `get_revenue_summary()` - Get revenue metrics (MRR, ARR)
- `get_churn_statistics()` - Calculate churn rate
- `get_renewal_statistics()` - Get renewal metrics
- `get_trial_conversion_rate()` - Trial to paid conversion

### Bulk Operations:
- `batch_expire_subscriptions()` - Bulk expire subscriptions
- `batch_update_status()` - Bulk update status
- `search_subscriptions()` - Search with multiple filters
- `soft_delete_subscription()` - Soft delete subscription
- `restore_subscription()` - Restore deleted subscription

---

## Summary Table

| Repository | Primary Entity | Key Responsibility |
|------------|----------------|-------------------|
| **BookingCommissionRepository** | BookingCommission | Track and manage booking commissions |
| **SubscriptionAggregateRepository** | Multiple entities | Complex queries, analytics, dashboard |
| **SubscriptionBillingRepository** | SubscriptionBillingCycle | Manage billing cycles and schedules |
| **SubscriptionFeatureRepository** | SubscriptionFeatureUsage, SubscriptionLimit | Feature usage tracking and limits |
| **SubscriptionInvoiceRepository** | SubscriptionInvoice | Invoice generation and payment tracking |
| **SubscriptionPlanRepository** | SubscriptionPlan, PlanFeature | Plan management and features |
| **SubscriptionRepository** | Subscription, SubscriptionHistory, SubscriptionCancellation | Subscription lifecycle management |

Each repository follows the **Repository Pattern** to abstract database operations and provide a clean API for business logic layers.
============================================================================================================================
# Supervisor Repositories - Complete Class Structure and Purpose

## 1. supervisor_repository.py (Core Supervisor Management)

### Classes:
1. **SupervisorRepository(BaseRepository[Supervisor])**
   - **Purpose**: Main repository for supervisor lifecycle management
   - **Key Functions**:
     - `create_supervisor()` - Create new supervisor with employment details
     - `get_supervisor_by_id()` - Retrieve supervisor by ID
     - `get_supervisor_by_user_id()` - Get supervisor by associated user
     - `get_supervisor_by_employee_id()` - Get supervisor by employee ID
     - `update_supervisor()` - Update supervisor information
     - `change_supervisor_status()` - Change supervisor status (active/suspended/terminated)
     - `suspend_supervisor()` - Suspend a supervisor
     - `terminate_supervisor()` - Terminate supervisor employment
     - `reactivate_supervisor()` - Reactivate suspended supervisor
     - `get_supervisors_by_hostel()` - Get all supervisors for a hostel
     - `get_active_supervisors()` - Get all active supervisors
     - `get_supervisors_on_probation()` - Get supervisors in probation period
     - `get_contract_supervisors_expiring_soon()` - Get supervisors with expiring contracts
     - `search_supervisors()` - Search supervisors by name/email/employee ID
     - `get_supervisor_statistics()` - Get comprehensive statistics
     - `get_performance_summary()` - Get performance summary for supervisor
     - `add_supervisor_note()` - Add administrative notes
     - `get_supervisor_notes()` - Retrieve supervisor notes
     - `bulk_update_status()` - Update status for multiple supervisors
     - `soft_delete_supervisor()` - Soft delete supervisor
     - `restore_supervisor()` - Restore soft-deleted supervisor

---

## 2. supervisor_permissions_repository.py (Access Control)

### Classes:
1. **SupervisorPermissionsRepository(BaseRepository[SupervisorPermission])**
   - **Purpose**: Manage granular permissions and access control
   - **Key Functions**:
     - `create_permissions()` - Create permission configuration for supervisor
     - `get_permissions()` - Get permission configuration
     - `update_permissions()` - Update supervisor permissions with audit trail
     - `apply_template()` - Apply permission template to supervisor
     - `has_permission()` - Check if supervisor has specific permission
     - `get_granted_permissions()` - Get list of all granted permissions
     - `validate_permission_set()` - Validate permissions for conflicts
     - `create_template()` - Create permission template
     - `get_template_by_name()` - Retrieve template by name
     - `get_all_templates()` - Get all permission templates
     - `update_template()` - Update permission template
     - `deactivate_template()` - Deactivate permission template
     - `get_audit_logs()` - Get permission change audit logs
     - `get_permission_history()` - Get complete permission history
     - `get_permission_usage_statistics()` - Get permission usage stats
     - `find_permission_conflicts()` - Identify permission conflicts
     - `bulk_apply_template()` - Apply template to multiple supervisors
     - `bulk_update_permission()` - Update specific permission for multiple supervisors

---

## 3. supervisor_assignment_repository.py (Hostel Assignments)

### Classes:
1. **SupervisorAssignmentRepository(BaseRepository[SupervisorAssignment])**
   - **Purpose**: Manage supervisor-hostel assignments and transfers
   - **Key Functions**:
     - `create_assignment()` - Create new supervisor assignment to hostel
     - `get_assignment_by_id()` - Get assignment by ID
     - `get_active_assignments()` - Get active assignments with filters
     - `get_current_assignment()` - Get current primary assignment
     - `get_conflicting_assignments()` - Check for conflicting assignments
     - `revoke_assignment()` - Revoke assignment with handover
     - `complete_handover()` - Mark handover as completed
     - `create_transfer_request()` - Create transfer request
     - `approve_transfer()` - Approve transfer request
     - `reject_transfer()` - Reject transfer request
     - `execute_transfer()` - Execute approved transfer
     - `get_pending_transfers()` - Get pending transfer requests
     - `calculate_coverage()` - Calculate supervisor coverage for hostel
     - `get_coverage_gaps()` - Get coverage gaps with severity
     - `calculate_workload()` - Calculate workload metrics
     - `get_overloaded_supervisors()` - Get supervisors with high workload
     - `recommend_workload_rebalancing()` - Recommend workload distribution
     - `get_assignment_statistics()` - Get assignment statistics

---

## 4. supervisor_activity_repository.py (Activity Tracking)

### Classes:
1. **SupervisorActivityRepository(BaseRepository[SupervisorActivity])**
   - **Purpose**: Track and analyze supervisor activities
   - **Key Functions**:
     - `log_activity()` - Log supervisor activity with metadata
     - `get_activities()` - Get activities with comprehensive filters
     - `get_activity_count()` - Get count of activities
     - `get_failed_activities()` - Get failed activities for error analysis
     - `create_session()` - Create new supervisor session
     - `get_session()` - Get session by session ID
     - `get_active_sessions()` - Get all active sessions
     - `update_session_activity()` - Update session last activity
     - `end_session()` - End supervisor session
     - `end_all_sessions()` - End all active sessions
     - `detect_suspicious_sessions()` - Detect potentially suspicious sessions
     - `generate_activity_summary()` - Generate activity summary for period
     - `get_activity_summaries()` - Get activity summaries with filters
     - `calculate_activity_metrics()` - Calculate comprehensive activity metrics
     - `get_activity_metrics()` - Get activity metrics with filters
     - `get_activity_trends()` - Get activity trends over time
     - `get_productivity_comparison()` - Compare productivity across supervisors

---

## 5. supervisor_dashboard_repository.py (Dashboard Data)

### Classes:
1. **SupervisorDashboardRepository(BaseRepository[DashboardMetrics])**
   - **Purpose**: Manage dashboard metrics and real-time data
   - **Key Functions**:
     - `get_or_create_metrics()` - Get or create dashboard metrics
     - `update_metrics()` - Update dashboard metrics
     - `refresh_metrics()` - Refresh all dashboard metrics
     - `should_refresh_metrics()` - Check if metrics need refreshing
     - `create_alert()` - Create dashboard alert
     - `get_active_alerts()` - Get active alerts
     - `dismiss_alert()` - Dismiss dashboard alert
     - `cleanup_expired_alerts()` - Remove expired alerts
     - `create_quick_action()` - Create quick action button
     - `get_quick_actions()` - Get quick actions
     - `update_quick_action_badge()` - Update quick action badge count
     - `get_or_create_schedule()` - Get or create today's schedule
     - `update_schedule()` - Update schedule with new data
     - `mark_attendance_completed()` - Mark attendance as completed
     - `create_performance_indicator()` - Create performance indicator
     - `get_latest_performance_indicator()` - Get latest performance indicator
     - `get_performance_trend()` - Get performance trend over time

---

## 6. supervisor_performance_repository.py (Performance Evaluation)

### Classes:
1. **SupervisorPerformanceRepository(BaseRepository[SupervisorPerformance])**
   - **Purpose**: Manage performance records, reviews, and goals
   - **Key Functions**:
     - `create_performance_record()` - Create comprehensive performance record
     - `update_performance_record()` - Update performance record
     - `get_performance_records()` - Get performance records with filters
     - `get_latest_performance()` - Get latest performance record
     - `calculate_period_performance()` - Calculate performance for period
     - `_calculate_overall_score()` - Calculate overall performance score (private)
     - `_calculate_grade()` - Calculate performance grade (private)
     - `create_performance_review()` - Create formal performance review
     - `get_performance_reviews()` - Get performance reviews
     - `acknowledge_review()` - Acknowledge performance review
     - `create_performance_goal()` - Create SMART performance goal
     - `update_goal_progress()` - Update goal progress
     - `complete_goal()` - Mark goal as completed
     - `get_active_goals()` - Get active goals
     - `get_overdue_goals()` - Get overdue goals
     - `record_performance_metric()` - Record time-series performance metric
     - `get_performance_metrics()` - Get performance metrics
     - `create_peer_comparison()` - Create peer comparison record
     - `calculate_peer_comparisons()` - Calculate peer comparisons for all supervisors
     - `get_peer_comparisons()` - Get peer comparisons with filters
     - `get_performance_statistics()` - Get comprehensive statistics

---

## 7. supervisor_aggregate_repository.py (Cross-Cutting Analytics)

### Classes:
1. **SupervisorAggregateRepository**
   - **Purpose**: Provide aggregate queries across multiple entities
   - **Key Functions**:
     - `get_supervisor_overview()` - Get comprehensive overview for supervisor
     - `get_hostel_supervisor_analytics()` - Get supervisor analytics for hostel
     - `generate_performance_report()` - Generate comprehensive performance report
     - `get_activity_analytics()` - Get comprehensive activity analytics
     - `compare_supervisors()` - Compare multiple supervisors across metrics
     - `get_performance_trends()` - Get performance trends over time

---

## Summary Table

| Repository | Primary Entity | Main Responsibility |
|-----------|---------------|-------------------|
| **SupervisorRepository** | Supervisor | Core CRUD, status management, employment lifecycle |
| **SupervisorPermissionsRepository** | SupervisorPermission | Access control, permission templates, audit logging |
| **SupervisorAssignmentRepository** | SupervisorAssignment | Hostel assignments, transfers, coverage, workload |
| **SupervisorActivityRepository** | SupervisorActivity | Activity logging, session tracking, productivity metrics |
| **SupervisorDashboardRepository** | DashboardMetrics | Real-time dashboard data, alerts, quick actions |
| **SupervisorPerformanceRepository** | SupervisorPerformance | Performance records, reviews, goals, peer comparison |
| **SupervisorAggregateRepository** | Multiple entities | Cross-entity analytics, reports, comparisons |

---

## Common Patterns Across All Repositories

### 1. **Query Methods**
- Get by ID
- Get by filters
- Search functionality
- Get with relationships loaded

### 2. **Statistics Methods**
- Get counts
- Calculate averages
- Generate summaries
- Trend analysis

### 3. **Bulk Operations**
- Bulk updates
- Bulk deletes
- Batch processing

### 4. **Audit Trail**
- Track who made changes
- Track when changes occurred
- Track why changes were made
- Complete history

### 5. **Validation**
- Business rule validation
- Data integrity checks
- Conflict detection
- Dependency validation
============================================================================================================================
# Complete Repository Classes Overview

## 1. **user_repository.py**

### Class: `UserRepository(BaseRepository[User])`
**Purpose**: Core user authentication and identity management

**Key Functions**:
- `find_by_email()` - Find user by email address
- `find_by_phone()` - Find user by phone number
- `find_by_email_or_phone()` - Find by either identifier
- `exists_by_email()` - Check if email already exists
- `exists_by_phone()` - Check if phone already exists
- `find_by_role()` - Get users by role (STUDENT, ADMIN, etc.)
- `count_by_role()` - Count users per role
- `get_role_distribution()` - Get user count by all roles
- `find_active_users()` - Get active users
- `find_unverified_users()` - Get users pending email/phone verification
- `find_inactive_users()` - Get users who haven't logged in for X days
- `find_locked_accounts()` - Get locked accounts
- `update_login_success()` - Update user after successful login
- `increment_failed_login()` - Track failed login attempts and lock account
- `unlock_account()` - Manually unlock user account
- `update_password()` - Change user password
- `find_password_reset_required()` - Get users who must reset password
- `find_passwords_expiring_soon()` - Get users with old passwords
- `verify_email()` - Mark email as verified
- `verify_phone()` - Mark phone as verified
- `activate_account()` - Activate user account
- `deactivate_account()` - Deactivate user account
- `accept_terms()` - Record terms/privacy acceptance
- `get_user_statistics()` - Get platform-wide user metrics
- `get_registration_trends()` - Get daily registration data
- `search_users()` - Advanced user search with filters

---

## 2. **user_profile_repository.py**

### Class: `UserProfileRepository(BaseRepository[UserProfile])`
**Purpose**: Extended user profile and personalization management

**Key Functions**:
- `find_by_user_id()` - Get profile for a user
- `get_by_user_id()` - Get profile (throws error if not found)
- `create_or_update()` - Upsert user profile
- `calculate_completion_percentage()` - Calculate how complete profile is
- `update_completion_percentage()` - Recalculate and save completion %
- `find_incomplete_profiles()` - Get profiles below completion threshold
- `find_by_gender()` - Get profiles by gender
- `find_by_age_range()` - Get profiles within age range
- `find_by_nationality()` - Get profiles by nationality
- `get_demographics_statistics()` - Get gender/nationality/age stats
- `update_notification_preferences()` - Update user notification settings
- `update_privacy_settings()` - Update privacy settings
- `update_communication_preferences()` - Update how user wants to be contacted
- `update_profile_image()` - Update profile picture URL
- `update_social_links()` - Update social media links
- `increment_profile_views()` - Track profile view count
- `find_by_timezone()` - Get profiles by timezone
- `find_by_language()` - Get profiles by preferred language
- `get_language_distribution()` - Get language usage stats
- `get_profile_statistics()` - Get profile completion metrics
- `find_recently_updated()` - Get recently modified profiles

---

## 3. **user_address_repository.py**

### Class: `UserAddressRepository(BaseRepository[UserAddress])`
**Purpose**: Address management with geolocation support

**Key Functions**:
- `find_by_user_id()` - Get all addresses for a user
- `find_primary_address()` - Get user's primary address
- `find_by_type()` - Get address by type (home, permanent, billing, work)
- `set_primary_address()` - Mark an address as primary
- `verify_address()` - Mark address as verified
- `find_unverified_addresses()` - Get unverified addresses
- `update_coordinates()` - Set latitude/longitude/geohash
- `find_by_geohash_prefix()` - Find addresses in same geographic area
- `find_within_radius()` - Find addresses within X km of coordinates (uses Haversine formula)
- `_calculate_distance()` - Calculate distance between two GPS coordinates
- `find_by_city()` - Get addresses in a city
- `find_by_state()` - Get addresses in a state
- `find_by_pincode()` - Get addresses by postal code
- `find_by_country()` - Get addresses by country
- `get_geographic_distribution()` - Get breakdown by city/state/country
- `get_verification_statistics()` - Get address verification metrics
- `find_expiring_addresses()` - Get addresses expiring soon
- `deactivate_expired_addresses()` - Auto-deactivate expired addresses

---

## 4. **emergency_contact_repository.py**

### Class: `EmergencyContactRepository(BaseRepository[EmergencyContact])`
**Purpose**: Emergency contact management with verification and prioritization

**Key Functions**:
- `find_by_user_id()` - Get all emergency contacts for a user
- `find_primary_contact()` - Get primary emergency contact
- `find_by_priority()` - Get contact by priority level (1, 2, 3...)
- `set_primary_contact()` - Mark a contact as primary
- `reorder_priorities()` - Bulk update contact priorities
- `get_next_priority()` - Get next available priority number
- `verify_contact()` - Mark contact as verified
- `find_unverified_contacts()` - Get unverified contacts
- `get_verification_statistics()` - Get verification metrics
- `record_consent()` - Record consent from emergency contact
- `find_without_consent()` - Get contacts without consent
- `update_authorization()` - Update what contact can do (make decisions, access medical info)
- `log_contact_attempt()` - Record that we tried to contact them
- `find_never_contacted()` - Get contacts never reached
- `find_frequently_contacted()` - Get most-contacted contacts
- `find_by_relationship()` - Get contacts by relationship type (Father, Mother, etc.)
- `get_relationship_distribution()` - Get breakdown by relationship
- `search_contacts()` - Search by name/phone/email
- `validate_contact_uniqueness()` - Check if phone already used
- `get_contact_statistics()` - Get comprehensive contact metrics
- `find_contacts_needing_update()` - Get outdated contacts

---

## 5. **user_session_repository.py**

### Class: `UserSessionRepository(BaseRepository[UserSession])`
**Purpose**: Session management with security tracking

**Key Functions**:
- `find_by_user_id()` - Get all sessions for a user
- `find_by_refresh_token_hash()` - Find session by refresh token
- `find_by_jti()` - Find session by JWT Token ID
- `find_by_device_fingerprint()` - Get sessions from same device
- `create_session()` - Create new user session
- `update_last_activity()` - Update session activity timestamp
- `revoke_session()` - Invalidate a session
- `revoke_all_user_sessions()` - Logout from all devices
- `cleanup_expired_sessions()` - Delete old expired sessions
- `mark_suspicious()` - Flag session as suspicious
- `find_suspicious_sessions()` - Get flagged sessions
- `find_sessions_by_ip()` - Get sessions from specific IP
- `detect_concurrent_sessions()` - Check if too many active sessions
- `find_multiple_ip_sessions()` - Detect potential account sharing
- `find_sessions_by_device_type()` - Get sessions by device (mobile, desktop, tablet)
- `get_unique_devices()` - Get list of unique devices used
- `get_session_statistics()` - Get session metrics
- `get_session_duration_stats()` - Get average session duration
- `find_long_running_sessions()` - Get sessions active for long time
- `find_inactive_sessions()` - Get sessions with no recent activity

---

## 6. **user_security_repository.py**

### Class: `UserSecurityRepository` (NOT extending BaseRepository)
**Purpose**: Login history and password history management

**Key Functions - Login History**:
- `create_login_attempt()` - Record login attempt (success or failure)
- `find_user_login_history()` - Get login history for a user
- `find_failed_login_attempts()` - Get failed login attempts
- `find_suspicious_login_attempts()` - Get flagged suspicious logins
- `mark_login_suspicious()` - Flag login as suspicious
- `get_login_statistics()` - Get login metrics
- `detect_brute_force_attempt()` - Check if email has too many failed attempts

**Key Functions - Password History**:
- `create_password_history()` - Record password change
- `find_user_password_history()` - Get password change history
- `check_password_reuse()` - Prevent reusing recent passwords
- `get_password_change_statistics()` - Get password change metrics
- `cleanup_old_password_history()` - Delete old password records

**Key Functions - Combined**:
- `get_comprehensive_security_report()` - Get complete security overview for a user

---

## 7. **user_aggregate_repository.py**

### Class: `UserAggregateRepository` (NOT extending BaseRepository)
**Purpose**: Complex user queries with related data aggregation

**Key Functions**:
- `get_complete_user()` - Get user with ALL related data (profile, address, contacts, sessions)
- `get_user_summary()` - Get user summary with key metrics
- `advanced_user_search()` - Search with multiple filters (role, city, completion %, dates, etc.)
- `get_platform_overview()` - Get platform-wide analytics
- `get_user_growth_metrics()` - Get daily registration trends
- `get_engagement_metrics()` - Get DAU/MAU and engagement rates
- `get_security_overview()` - Get security metrics (locked accounts, failed logins, etc.)
- `get_incomplete_profiles_report()` - Get profile completion breakdown
- `bulk_verify_emails()` - Verify multiple user emails at once
- `bulk_deactivate_users()` - Deactivate multiple users at once
- `find_stale_unverified_users()` - Get old unverified accounts
- `find_inactive_verified_users()` - Get verified but inactive users

---

## Summary Table

| Repository | Entity Managed | Extends BaseRepository | Primary Purpose |
|------------|----------------|------------------------|-----------------|
| `UserRepository` | `User` | ✅ Yes | Core authentication & identity |
| `UserProfileRepository` | `UserProfile` | ✅ Yes | Extended profile & personalization |
| `UserAddressRepository` | `UserAddress` | ✅ Yes | Address & geolocation |
| `EmergencyContactRepository` | `EmergencyContact` | ✅ Yes | Emergency contacts & verification |
| `UserSessionRepository` | `UserSession` | ✅ Yes | Session lifecycle & tracking |
| `UserSecurityRepository` | `LoginHistory`, `PasswordHistory` | ❌ No | Security tracking & analytics |
| `UserAggregateRepository` | Multiple entities | ❌ No | Cross-entity queries & analytics |

---

## Key Points:

1. **Repositories 1-5**: Manage single entities, extend `BaseRepository` for CRUD operations
2. **Repository 6**: Manages TWO entities (LoginHistory + PasswordHistory) - security focused
3. **Repository 7**: Doesn't manage entities - combines data from multiple repositories for analytics
============================================================================================================================
# Complete Overview of Visitor Repository Classes

## 1. **saved_search_repository.py**

### Classes:

1. **SavedSearchRepository**
   - **Purpose**: Manage saved searches for visitors (persistent search criteria with automated monitoring)
   - **Key Functions**:
     - `create_saved_search()` - Create new saved search with criteria
     - `get_visitor_saved_searches()` - Get all saved searches for a visitor
     - `update_saved_search()` - Modify search criteria
     - `toggle_search_active()` - Activate/deactivate search
     - `pause_search()` / `resume_search()` - Temporarily pause/resume
     - `get_searches_to_execute()` - Get searches ready to run
     - `update_search_execution()` - Update after running search
     - `mark_notification_sent()` - Track notification delivery
     - `get_search_statistics()` - Get stats for specific search
     - `get_visitor_search_summary()` - Summary of all visitor searches

2. **SavedSearchExecutionRepository**
   - **Purpose**: Track history of saved search executions
   - **Key Functions**:
     - `create_execution_record()` - Log each search execution
     - `get_execution_history()` - Get past executions for a search
     - `get_execution_performance_metrics()` - Performance analytics

3. **SavedSearchMatchRepository**
   - **Purpose**: Manage hostels that match saved searches
   - **Key Functions**:
     - `create_match()` - Record hostel matching search
     - `get_search_matches()` - Get all matches for a search
     - `mark_matches_notified()` - Mark matches as sent in notification
     - `mark_match_viewed()` - Track when visitor views match
     - `update_match_verification()` - Check if hostel still matches criteria

4. **SavedSearchNotificationRepository**
   - **Purpose**: Handle notifications sent for saved searches
   - **Key Functions**:
     - `create_notification()` - Create notification record
     - `update_delivery_status()` - Update send status
     - `mark_notification_opened()` - Track when opened
     - `track_link_click()` - Track link clicks in notification
     - `get_notification_history()` - Get past notifications
     - `get_notification_performance()` - Delivery/open/click metrics

---

## 2. **visitor_aggregate_repository.py**

### Classes:

1. **VisitorAggregateRepository**
   - **Purpose**: Complex cross-entity queries and comprehensive analytics
   - **Key Functions**:
     - `get_visitor_dashboard_summary()` - Complete dashboard data (favorites, alerts, searches, activity)
     - `get_visitor_activity_timeline()` - Daily activity over time period
     - `get_visitor_preferences_analysis()` - Analyze behavior patterns (cities, prices, favorites)
     - `get_visitor_engagement_trends()` - Engagement score trends over time
     - `get_conversion_probability()` - Calculate likelihood to book (0-100 score)
     - `get_platform_visitor_metrics()` - Platform-wide statistics

---

## 3. **visitor_dashboard_repository.py**

### Classes:

1. **RecentSearchRepository**
   - **Purpose**: Track visitor's recent search history
   - **Key Functions**:
     - `save_search()` - Save search with filters and results
     - `get_recent_searches()` - Get recent searches
     - `track_search_re_execution()` - Track when search is run again
     - `get_popular_searches()` - Searches run multiple times
     - `cleanup_old_searches()` - Delete old searches, keep recent

2. **RecentlyViewedHostelRepository**
   - **Purpose**: Track hostels visitor has viewed
   - **Key Functions**:
     - `track_hostel_view()` - Record/update hostel view
     - `get_recently_viewed()` - Get recent views
     - `get_most_viewed()` - Get frequently viewed hostels
     - `mark_action_taken()` - Mark if favorited/inquired/booked

3. **RecommendedHostelRepository**
   - **Purpose**: Manage personalized hostel recommendations
   - **Key Functions**:
     - `create_recommendation()` - Create recommendation with match score
     - `get_active_recommendations()` - Get current recommendations
     - `mark_recommendation_viewed()` - Track view
     - `mark_recommendation_clicked()` - Track click
     - `mark_recommendation_converted()` - Track booking
     - `get_recommendation_performance()` - View/click/conversion metrics

4. **PriceDropAlertRepository**
   - **Purpose**: Manage price drop alerts for favorites
   - **Key Functions**:
     - `create_price_drop_alert()` - Create alert when price drops
     - `get_unread_alerts()` - Get unread alerts
     - `mark_alert_read()` - Mark as read
     - `mark_notification_sent()` - Track notification delivery (email/sms/push)

5. **AvailabilityAlertRepository**
   - **Purpose**: Manage availability alerts for favorites
   - **Key Functions**:
     - `create_availability_alert()` - Create alert when beds available
     - `get_unread_alerts()` - Get unread alerts
     - `mark_alert_read()` - Mark as read
     - `mark_notification_sent()` - Track notification delivery

6. **VisitorActivityRepository**
   - **Purpose**: Log all visitor activities for audit trail
   - **Key Functions**:
     - `log_activity()` - Log any visitor action
     - `get_recent_activities()` - Get recent activities
     - `get_activity_summary()` - Activity counts by type/category

---

## 4. **visitor_favorite_repository.py**

### Classes:

1. **VisitorFavoriteRepository**
   - **Purpose**: Manage visitor's favorite/wishlist hostels with price tracking
   - **Key Functions**:
     - `add_favorite()` - Add hostel to favorites
     - `remove_favorite()` - Remove from favorites (soft delete)
     - `find_favorite()` - Find specific favorite
     - `get_visitor_favorites()` - Get all favorites
     - `check_is_favorite()` - Check if hostel is favorited
     - `get_favorites_count()` - Count favorites
     - `update_favorite_price()` - Update price and detect drops
     - `update_favorite_availability()` - Update bed availability
     - `get_favorites_with_price_drops()` - Get favorites with price drops
     - `get_favorites_without_availability()` - Get sold-out favorites
     - `update_favorite_notes()` - Add personal notes
     - `track_favorite_view()` - Track when favorite is viewed
     - `update_alert_preferences()` - Set price/availability alerts
     - `get_favorite_statistics()` - Stats (count, avg price, savings)
     - `get_favorites_by_city()` - Group by city
     - `get_highly_viewed_favorites()` - Most viewed favorites
     - `bulk_update_prices()` - Update multiple prices at once
     - `bulk_update_availability()` - Update multiple availability at once

2. **FavoriteComparisonRepository**
   - **Purpose**: Track when visitor compares favorite hostels
   - **Key Functions**:
     - `create_comparison()` - Create comparison session
     - `complete_comparison()` - Record which hostel was selected
     - `get_visitor_comparisons()` - Get comparison history

3. **FavoritePriceHistoryRepository**
   - **Purpose**: Track price changes over time for favorites
   - **Key Functions**:
     - `get_price_history()` - Get price history for favorite
     - `get_price_trends()` - Analyze trends (increasing/decreasing/stable)

---

## 5. **visitor_preferences_repository.py**

### Classes:

1. **VisitorPreferencesRepository**
   - **Purpose**: Manage visitor preferences (budget, location, amenities, notifications)
   - **Key Functions**:
     - `create_preferences()` - Create preferences record
     - `find_by_visitor_id()` - Find preferences for visitor
     - `update_budget_preferences()` - Update budget min/max
     - `update_location_preferences()` - Update cities/areas/distance
     - `update_amenity_preferences()` - Update required/preferred amenities
     - `update_facility_requirements()` - Update parking/gym/laundry/mess needs
     - `update_notification_preferences()` - Update notification settings

2. **SearchPreferencesRepository**
   - **Purpose**: Manage saved search preferences (similar to saved searches but simpler)
   - **Key Functions**:
     - `create_search_preference()` - Save search criteria
     - `find_active_searches()` - Get active searches
     - `update_search_results()` - Update match counts
     - `mark_notification_sent()` - Track notification

3. **NotificationPreferencesRepository**
   - **Purpose**: Detailed notification channel and timing preferences
   - **Key Functions**:
     - `create_notification_preferences()` - Create with defaults
     - `find_by_visitor_id()` - Get preferences
     - `update_channel_preferences()` - Enable/disable email/sms/push/in-app
     - `update_quiet_hours()` - Set do-not-disturb times

---

## 6. **visitor_repository.py**

### Classes:

1. **VisitorRepository**
   - **Purpose**: Core visitor management with engagement tracking and analytics
   - **Key Functions**:
     - `create_visitor()` - Create new visitor profile
     - `find_by_user_id()` / `find_by_email()` / `find_by_phone()` - Find visitor
     - `get_with_full_profile()` - Get visitor with all relations
     - `track_visitor_activity()` - Track search/view/inquiry/booking
     - `update_engagement_score()` - Recalculate engagement (0-100)
     - `update_conversion_likelihood()` - Set conversion probability
     - `assign_visitor_segment()` - Assign to segment
     - `find_active_visitors()` - Get recently active visitors
     - `find_high_intent_visitors()` - Get high engagement visitors
     - `find_by_segment()` - Get visitors in segment
     - `find_visitors_with_criteria()` - Complex multi-criteria search
     - `get_visitor_statistics()` - Platform-wide stats
     - `get_engagement_distribution()` - Engagement score ranges
     - `get_conversion_funnel()` - Funnel metrics (search→view→inquiry→booking)
     - `get_top_visitors_by_activity()` - Top visitors by activity type
     - `update_budget_preferences()` - Update budget
     - `update_location_preferences()` - Update cities/areas
     - `update_amenity_preferences()` - Update amenities
     - `update_notification_preferences()` - Update notifications
     - `create_visitor_session()` - Start new session
     - `get_visitor_sessions()` - Get session history
     - `bulk_update_engagement_scores()` - Recalculate for all/many
     - `bulk_assign_segments()` - Auto-assign segments based on rules

2. **VisitorSessionRepository**
   - **Purpose**: Manage individual visitor sessions (login to logout)
   - **Key Functions**:
     - `update_session_activity()` - Track page views, searches, views, inquiries
     - `end_session()` - End session and record final metrics

3. **VisitorEngagementRepository**
   - **Purpose**: Track daily engagement metrics per visitor
   - **Key Functions**:
     - `create_or_update_daily_engagement()` - Record/update daily stats
     - Internal: `_calculate_daily_score()` - Calculate daily engagement score

---

## 7. **__init__.py**

### Purpose:
- Package initialization
- Exports all repository classes for easy importing

---

# Summary by Category

## **Core Visitor Management** (3 classes)
- VisitorRepository
- VisitorSessionRepository  
- VisitorEngagementRepository

## **Preferences** (3 classes)
- VisitorPreferencesRepository
- SearchPreferencesRepository
- NotificationPreferencesRepository

## **Favorites/Wishlist** (3 classes)
- VisitorFavoriteRepository
- FavoriteComparisonRepository
- FavoritePriceHistoryRepository

## **Dashboard/Activity** (6 classes)
- RecentSearchRepository
- RecentlyViewedHostelRepository
- RecommendedHostelRepository
- PriceDropAlertRepository
- AvailabilityAlertRepository
- VisitorActivityRepository

## **Saved Searches** (4 classes)
- SavedSearchRepository
- SavedSearchExecutionRepository
- SavedSearchMatchRepository
- SavedSearchNotificationRepository

## **Analytics/Aggregates** (1 class)
- VisitorAggregateRepository

---

# Total: 20 Repository Classes across 7 files
============================================================================================================================

