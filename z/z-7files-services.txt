# Admin Services Classes & Functions

## 1. `admin_activity_service.py`

### `AdminActivityService`
**Use:** Main service for admin activity tracking and security events
**Functions:**
- `log_activity()` - Record admin actions
- `log_bulk_activity()` - Record multiple activities
- `get_recent_activity()` - Fetch recent admin actions
- `get_activity_summary()` - Generate activity metrics
- `get_security_events()` - Retrieve security events
- `flag_suspicious_activity()` - Create security alerts

### `ActivityTracker`
**Use:** Utility for tracking different types of admin activities
**Functions:**
- `track_login()` - Track login activities
- `track_data_access()` - Track data access patterns
- `track_configuration_changes()` - Track system changes
- `get_activity_patterns()` - Analyze activity patterns

### `SecurityEventAnalyzer`
**Use:** Analyzes security events for suspicious patterns
**Functions:**
- `analyze_login_patterns()` - Detect unusual login behavior
- `detect_anomalies()` - Find suspicious activities
- `calculate_risk_score()` - Calculate security risk levels
- `generate_alerts()` - Create security alerts

### `ActivityMetricsCalculator`
**Use:** Calculates various activity metrics and trends
**Functions:**
- `calculate_daily_activity()` - Daily activity metrics
- `calculate_trends()` - Activity trend analysis
- `get_productivity_metrics()` - Calculate productivity scores
- `compare_periods()` - Compare activity across time periods

## 2. `admin_authentication_service.py`

### `AdminAuthenticationService`
**Use:** Main authentication service for admin users
**Functions:**
- `login()` - Authenticate admin users
- `logout()` - End admin sessions
- `refresh()` - Refresh access tokens
- `get_active_sessions()` - Get current sessions
- `revoke_session()` - Revoke specific sessions

### `TokenManager`
**Use:** Handles JWT token lifecycle operations
**Functions:**
- `create_access_token()` - Generate access tokens
- `create_refresh_token()` - Generate refresh tokens
- `validate_token()` - Validate token authenticity
- `revoke_token()` - Invalidate tokens
- `decode_token()` - Extract token payload

### `SessionManager`
**Use:** Manages admin session lifecycle
**Functions:**
- `create_session()` - Create new sessions
- `update_session()` - Update session data
- `end_session()` - Terminate sessions
- `get_session_info()` - Get session details
- `cleanup_expired_sessions()` - Remove old sessions

### `AuthenticationValidator`
**Use:** Validates authentication requests and policies
**Functions:**
- `validate_credentials()` - Check login credentials
- `check_account_status()` - Verify account is active
- `validate_mfa()` - Multi-factor authentication
- `check_password_policy()` - Validate password rules

### `LoginAttemptTracker`
**Use:** Tracks and analyzes failed login attempts
**Functions:**
- `record_attempt()` - Log login attempts
- `check_rate_limits()` - Enforce rate limiting
- `detect_brute_force()` - Detect brute force attacks
- `get_attempt_history()` - Get login history

## 3. `admin_override_service.py`

### `AdminOverrideService`
**Use:** Main service for admin override operations
**Functions:**
- `create_override()` - Create override requests
- `approve_override()` - Approve overrides
- `reject_override()` - Reject overrides
- `get_pending_overrides()` - Get pending requests
- `get_override_summary()` - Get override statistics

### `OverrideWorkflowManager`
**Use:** Manages override approval workflows
**Functions:**
- `initiate_workflow()` - Start approval process
- `route_to_approver()` - Route to appropriate approver
- `escalate_override()` - Escalate to higher authority
- `complete_workflow()` - Finalize approval process

### `OverrideLimitEnforcer`
**Use:** Enforces override limits and business rules
**Functions:**
- `check_daily_limits()` - Check daily override limits
- `check_monthly_limits()` - Check monthly limits
- `validate_override_type()` - Validate override type
- `check_supervisor_authority()` - Verify supervisor permissions

### `OverrideNotificationManager`
**Use:** Handles override-related notifications
**Functions:**
- `send_override_notification()` - Notify supervisors
- `send_approval_notification()` - Notify of approvals
- `send_rejection_notification()` - Notify of rejections
- `send_escalation_alert()` - Send escalation alerts

## 4. `admin_permission_service.py`

### `AdminPermissionService`
**Use:** Main service for admin permission management
**Functions:**
- `get_admin_permissions()` - Get admin permissions
- `update_admin_permissions()` - Update permissions
- `check_permission()` - Check specific permissions
- `apply_permission_template()` - Apply permission templates
- `bulk_update_permissions()` - Update multiple admin permissions

### `PermissionResolver`
**Use:** Resolves complex permission inheritance and conflicts
**Functions:**
- `resolve_conflicts()` - Handle permission conflicts
- `calculate_effective_permissions()` - Calculate final permissions
- `check_inheritance()` - Check permission inheritance
- `validate_permission_hierarchy()` - Validate hierarchy rules

### `PermissionTemplateManager`
**Use:** Manages permission templates and presets
**Functions:**
- `create_template()` - Create permission templates
- `update_template()` - Update existing templates
- `delete_template()` - Remove templates
- `get_all_templates()` - List available templates
- `apply_template()` - Apply template to admin

### `PermissionAuditTracker`
**Use:** Tracks permission changes for audit purposes
**Functions:**
- `log_permission_change()` - Log permission modifications
- `get_permission_history()` - Get change history
- `generate_audit_report()` - Create audit reports
- `track_template_usage()` - Track template applications

### `ContextualPermissionValidator`
**Use:** Validates permissions within specific contexts
**Functions:**
- `validate_hostel_context()` - Check hostel-specific permissions
- `validate_amount_limits()` - Check financial limits
- `validate_time_constraints()` - Check time-based restrictions
- `validate_location_access()` - Check location permissions

## 5. `admin_role_service.py`

### `AdminRoleService`
**Use:** Main service for admin role management
**Functions:**
- `create_role()` - Create new roles
- `update_role()` - Update existing roles
- `delete_role()` - Remove roles
- `get_all_roles()` - List all roles
- `update_role_permissions()` - Update role permissions
- `compare_roles()` - Compare role permissions

### `RoleHierarchyManager`
**Use:** Manages role hierarchy and inheritance
**Functions:**
- `build_hierarchy()` - Build role hierarchy structure
- `validate_hierarchy()` - Validate hierarchy rules
- `get_subordinate_roles()` - Get lower-level roles
- `check_role_authority()` - Check role authority levels

### `RolePermissionMapper`
**Use:** Maps roles to permissions and validates assignments
**Functions:**
- `map_role_permissions()` - Map permissions to roles
- `validate_permission_assignment()` - Validate assignments
- `get_role_permissions()` - Get permissions for role
- `sync_permissions()` - Synchronize permission changes

### `RoleTransitionManager`
**Use:** Handles role transitions and migrations
**Functions:**
- `transition_role()` - Change admin roles
- `migrate_permissions()` - Migrate permission data
- `validate_transition()` - Validate role changes
- `rollback_transition()` - Undo role changes

## 6. `admin_user_service.py`

### `AdminUserService`
**Use:** Main service for admin user lifecycle management
**Functions:**
- `create_admin_user()` - Create new admin users
- `update_admin_user()` - Update admin information
- `activate_admin()` - Activate admin accounts
- `suspend_admin()` - Suspend admin accounts
- `get_admin_hierarchy()` - Get organizational hierarchy
- `search_admins()` - Search and filter admins

### `AdminUserFactory`
**Use:** Factory for creating admin users with proper validation
**Functions:**
- `create_admin()` - Factory method for admin creation
- `validate_admin_data()` - Validate creation data
- `setup_default_permissions()` - Set default permissions
- `create_admin_profile()` - Create admin profile

### `HierarchyValidator`
**Use:** Validates admin hierarchy and supervision rules
**Functions:**
- `validate_supervisor_chain()` - Validate supervision hierarchy
- `check_circular_references()` - Prevent circular supervision
- `validate_role_hierarchy()` - Check role-based hierarchy
- `get_reporting_structure()` - Get reporting relationships

### `AdminStatusManager`
**Use:** Manages admin status transitions
**Functions:**
- `change_status()` - Change admin status
- `validate_status_change()` - Validate status transitions
- `handle_suspension()` - Process suspensions
- `handle_activation()` - Process activations
- `get_status_history()` - Get status change history

### `AdminProfileManager`
**Use:** Manages admin profile operations
**Functions:**
- `create_profile()` - Create admin profiles
- `update_profile()` - Update profile information
- `get_profile()` - Retrieve profile data
- `validate_profile_data()` - Validate profile information

## 7. `hostel_assignment_service.py`

### `HostelAssignmentService`
**Use:** Main service for admin-to-hostel assignments
**Functions:**
- `create_assignment()` - Create new assignments
- `update_assignment()` - Update assignments
- `revoke_assignment()` - Remove assignments
- `transfer_assignment()` - Transfer between admins
- `bulk_assign()` - Create multiple assignments
- `get_assignment_coverage()` - Get coverage statistics

### `AssignmentValidator`
**Use:** Validates assignment business rules
**Functions:**
- `validate_assignment()` - Validate new assignments
- `check_multi_hostel_capability()` - Check multi-hostel permissions
- `validate_transfer()` - Validate assignment transfers
- `check_assignment_conflicts()` - Check for conflicts

### `AssignmentTransferManager`
**Use:** Handles assignment transfers between admins
**Functions:**
- `initiate_transfer()` - Start transfer process
- `validate_transfer_eligibility()` - Check transfer eligibility
- `complete_transfer()` - Finalize transfers
- `rollback_transfer()` - Undo transfers

### `AssignmentHistoryTracker`
**Use:** Tracks assignment history and changes
**Functions:**
- `create_history_entry()` - Log assignment changes
- `get_assignment_history()` - Get change history
- `track_assignment_duration()` - Track assignment periods
- `generate_history_report()` - Create history reports

### `BulkAssignmentProcessor`
**Use:** Processes bulk assignment operations
**Functions:**
- `process_bulk_assignments()` - Handle bulk operations
- `validate_bulk_data()` - Validate bulk input
- `handle_assignment_errors()` - Handle processing errors
- `generate_bulk_report()` - Create operation reports

## 8. `hostel_context_service.py`

### `HostelContextService`
**Use:** Main service for hostel context switching and management
**Functions:**
- `get_active_context()` - Get current hostel context
- `switch_hostel()` - Switch active hostel
- `clear_context()` - Clear current context
- `get_context_history()` - Get switch history
- `create_snapshot()` - Create context snapshots
- `restore_snapshot()` - Restore from snapshots

### `ContextSwitchValidator`
**Use:** Validates context switch requests
**Functions:**
- `validate_switch_request()` - Validate switch requests
- `check_hostel_access()` - Verify hostel access rights
- `validate_assignment()` - Check active assignments
- `check_switch_permissions()` - Verify switch permissions

### `ContextSnapshotManager`
**Use:** Manages context snapshots and restoration
**Functions:**
- `create_snapshot()` - Create context snapshots
- `restore_snapshot()` - Restore from snapshots
- `delete_snapshot()` - Remove snapshots
- `get_snapshots()` - List available snapshots
- `validate_snapshot()` - Validate snapshot data

### `ContextPreferenceManager`
**Use:** Manages user context preferences
**Functions:**
- `save_preferences()` - Save user preferences
- `get_preferences()` - Retrieve preferences
- `update_preferences()` - Update preference settings
- `reset_preferences()` - Reset to defaults

### `ContextAnalytics`
**Use:** Analyzes context usage patterns
**Functions:**
- `analyze_switch_patterns()` - Analyze switching behavior
- `calculate_session_duration()` - Calculate session times
- `get_usage_statistics()` - Get usage stats
- `generate_analytics_report()` - Create analytics reports

## 9. `hostel_selector_service.py`

### `HostelSelectorService`
**Use:** Main service for hostel selector UI functionality
**Functions:**
- `get_selector()` - Build comprehensive selector response
- `refresh_selector_cache()` - Refresh selector cache
- `record_access()` - Record hostel access
- `get_quick_stats_for_hostel()` - Get hostel quick stats
- `refresh_quick_stats()` - Refresh stats cache

### `FavoriteManager`
**Use:** Manages favorite hostel operations
**Functions:**
- `add_favorite()` - Add hostel to favorites
- `remove_favorite()` - Remove from favorites
- `update_favorite()` - Update favorite details
- `list_favorites()` - Get favorite hostels
- `reorder_favorites()` - Change favorite order

### `RecentAccessTracker`
**Use:** Tracks and manages recent hostel access
**Functions:**
- `track_access()` - Record hostel access
- `get_recent_hostels()` - Get recently accessed hostels
- `calculate_access_frequency()` - Calculate usage frequency
- `clear_recent_history()` - Clear access history

### `HostelQuickStatsCalculator`
**Use:** Calculates quick stats for hostels
**Functions:**
- `calculate_occupancy()` - Calculate occupancy rates
- `count_pending_tasks()` - Count pending tasks
- `calculate_alerts()` - Count active alerts
- `get_quick_metrics()` - Get summary metrics

### `SelectorCacheManager`
**Use:** Manages selector UI cache
**Functions:**
- `cache_selector_data()` - Cache selector information
- `invalidate_cache()` - Clear cache data
- `refresh_cache()` - Update cache
- `get_cached_data()` - Retrieve cached data

## 10. `multi_hostel_dashboard_service.py`

### `MultiHostelDashboardService`
**Use:** Main service for multi-hostel portfolio analytics
**Functions:**
- `generate_dashboard()` - Generate complete dashboard
- `refresh_dashboard()` - Force dashboard refresh
- `get_aggregated_stats()` - Get portfolio statistics
- `get_hostel_quick_stats()` - Get per-hostel stats
- `create_snapshot()` - Create dashboard snapshots
- `compare_snapshots()` - Compare dashboard snapshots

### `DashboardDataAggregator`
**Use:** Aggregates data from multiple hostels
**Functions:**
- `aggregate_financial_data()` - Aggregate financial metrics
- `aggregate_occupancy_data()` - Aggregate occupancy stats
- `aggregate_performance_metrics()` - Aggregate performance data
- `calculate_portfolio_totals()` - Calculate portfolio totals

### `WidgetConfigManager`
**Use:** Manages dashboard widget configurations
**Functions:**
- `save_widget_config()` - Save widget settings
- `get_widget_config()` - Get widget configuration
- `update_widget()` - Update single widget
- `delete_widget()` - Remove widget
- `reset_widgets()` - Reset to default widgets

### `DashboardSnapshotManager`
**Use:** Manages dashboard snapshots and comparisons
**Functions:**
- `create_snapshot()` - Create dashboard snapshot
- `get_snapshots()` - List available snapshots
- `compare_snapshots()` - Compare two snapshots
- `delete_snapshot()` - Remove snapshot
- `schedule_snapshots()` - Schedule automatic snapshots

### `CrossHostelAnalyzer`
**Use:** Performs cross-hostel analysis and comparisons
**Functions:**
- `compare_performance()` - Compare hostel performance
- `rank_hostels()` - Rank hostels by metrics
- `identify_outliers()` - Find performance outliers
- `generate_comparison_report()` - Create comparison reports

### `DashboardCacheManager`
**Use:** Manages dashboard cache and refresh policies
**Functions:**
- `cache_dashboard()` - Cache dashboard data
- `get_cached_dashboard()` - Retrieve cached data
- `invalidate_cache()` - Clear dashboard cache
- `schedule_cache_refresh()` - Schedule cache updates

=============================================================================================================================================

# Complete Analytics Services Class Structure

## 1. **analytics_engine_service.py**

### Classes:
- **`AnalyticsEngineService`** - Main orchestrator service
  - **Purpose**: Coordinates analytics generation across all domains
  - **Key Functions**:
    - `refresh_all_for_hostel()` - Refresh analytics for specific hostel
    - `refresh_multiple_hostels()` - Bulk refresh for multiple hostels
    - `refresh_platform_metrics()` - Platform-wide refresh
    - `run_background_jobs()` - Execute async calculations
    - `get_global_dashboard()` - Unified platform metrics
    - `get_refresh_status()` - Check refresh status
    - `invalidate_cache()` - Clear cached data

---

## 2. **analytics_export_service.py**

### Classes:
- **`ExportFormat`** (Enum) - Supported export formats
  - Values: EXCEL, XLSX, CSV, JSON, PDF

- **`ExportType`** (Enum) - Types of analytics exports  
  - Values: BOOKING_SUMMARY, COMPLAINT_DASHBOARD, FINANCIAL_REPORT, OCCUPANCY_REPORT, PLATFORM_OVERVIEW, etc.

- **`AnalyticsExportService`** - Export analytics to files
  - **Purpose**: Generate reports in multiple formats with export history
  - **Key Functions**:
    - `export_booking_summary()` - Export booking analytics
    - `export_complaint_dashboard()` - Export complaint analytics  
    - `export_financial_report()` - Export financial analytics
    - `export_occupancy_report()` - Export occupancy analytics
    - `export_platform_overview()` - Export platform analytics
    - `export_supervisor_analytics()` - Export supervisor analytics
    - `export_visitor_analytics()` - Export visitor analytics
    - `export_custom_report()` - Export custom reports
    - `get_export_history()` - Retrieve export history

---

## 3. **booking_analytics_service.py**

### Classes:
- **`BookingAnalyticsService`** - Booking analytics and KPIs
  - **Purpose**: Analyze booking performance, trends, and forecasting
  - **Key Functions**:
    - `get_summary()` - Complete booking analytics summary
    - `get_kpis()` - Booking KPIs with period comparison
    - `get_trend()` - Booking trends over time
    - `get_funnel()` - Booking conversion funnel
    - `get_cancellations()` - Cancellation analytics
    - `get_source_metrics()` - Booking source performance
    - `get_revenue_forecast()` - Revenue forecasting

---

## 4. **complaint_analytics_service.py**

### Classes:
- **`ComplaintAnalyticsService`** - Complaint analytics with SLA tracking
  - **Purpose**: Track complaints, SLA compliance, and resolution metrics
  - **Key Functions**:
    - `get_dashboard()` - Complaint analytics dashboard
    - `get_kpis()` - Complaint KPIs with SLA metrics
    - `get_trend()` - Complaint trends with anomaly detection
    - `get_category_breakdown()` - Complaints by category
    - `get_priority_breakdown()` - Complaints by priority
    - `get_sla_metrics()` - SLA compliance metrics
    - `get_resolution_analytics()` - Resolution time analytics

---

## 5. **dashboard_analytics_service.py**

### Classes:
- **`UserRole`** (Enum) - User roles for dashboard customization
  - Values: ADMIN, MANAGER, SUPERVISOR, STAFF, VIEWER

- **`WidgetType`** (Enum) - Dashboard widget types
  - Values: KPI, CHART, TABLE, ALERT, QUICK_STAT, TREND

- **`DashboardAnalyticsService`** - Role-based dashboard analytics
  - **Purpose**: Provide customizable dashboards with widgets and alerts
  - **Key Functions**:
    - `get_dashboard_metrics()` - Dashboard metrics for scope
    - `get_role_dashboard()` - Role-specific dashboard
    - `get_active_alerts()` - Active alerts for scope
    - `get_quick_stats()` - Quick statistics summary
    - `get_kpi_timeseries()` - KPI time series data
    - `create_custom_widget()` - Create custom widgets
    - `update_widget_layout()` - Update dashboard layout

---

## 6. **financial_analytics_service.py**

### Classes:
- **`FinancialPeriodType`** (Enum) - Financial reporting periods
  - Values: DAILY, WEEKLY, MONTHLY, QUARTERLY, ANNUAL

- **`RevenueCategory`** (Enum) - Revenue categories
  - Values: ROOM_BOOKINGS, SERVICES, FOOD_BEVERAGE, EVENTS, OTHER

- **`ExpenseCategory`** (Enum) - Expense categories  
  - Values: SALARIES, UTILITIES, MAINTENANCE, SUPPLIES, MARKETING, INSURANCE, OTHER

- **`FinancialAnalyticsService`** - Financial reporting and analysis
  - **Purpose**: Comprehensive financial analytics with health assessment
  - **Key Functions**:
    - `get_financial_report()` - Complete financial report
    - `get_profit_and_loss()` - P&L statements
    - `get_cashflow()` - Cashflow analysis with forecasting
    - `get_ratios()` - Financial ratios with benchmarks
    - `get_revenue_breakdown()` - Detailed revenue breakdown
    - `get_expense_breakdown()` - Detailed expense breakdown
    - `get_tax_summary()` - Tax calculations
    - `get_budget_comparison()` - Budget vs actual analysis

---

## 7. **occupancy_analytics_service.py**

### Classes:
- **`ForecastModelType`** (Enum) - Forecast model types
  - Values: SIMPLE_AVERAGE, WEIGHTED_AVERAGE, MOVING_AVERAGE, EXPONENTIAL_SMOOTHING, LINEAR_REGRESSION, SEASONAL_NAIVE

- **`SeasonType`** (Enum) - Season types for patterns
  - Values: PEAK, HIGH, SHOULDER, LOW

- **`OccupancyAnalyticsService`** - Occupancy analytics with advanced forecasting
  - **Purpose**: Track occupancy, forecast demand, optimize pricing
  - **Key Functions**:
    - `get_report()` - Comprehensive occupancy report
    - `get_kpis()` - Occupancy KPIs with comparisons
    - `get_trend()` - Occupancy trends with anomaly detection
    - `get_forecast()` - Multiple model forecasting
    - `get_room_type_breakdown()` - Occupancy by room type
    - `get_floor_breakdown()` - Occupancy by floor
    - `get_seasonal_patterns()` - Seasonal pattern analysis
    - `get_optimal_pricing_periods()` - Pricing recommendations

---

## 8. **platform_analytics_service.py**

### Classes:
- **`TenantSegment`** (Enum) - Tenant segmentation
  - Values: ENTERPRISE, PROFESSIONAL, STARTER, TRIAL

- **`HealthStatus`** (Enum) - System health status
  - Values: EXCELLENT, GOOD, FAIR, POOR, CRITICAL

- **`PlatformAnalyticsService`** - Multi-tenant platform analytics
  - **Purpose**: Platform-wide metrics, growth tracking, churn analysis
  - **Key Functions**:
    - `get_platform_metrics()` - Platform performance metrics
    - `get_growth()` - Growth metrics with trend analysis
    - `get_churn()` - Churn analysis with predictions
    - `get_system_health()` - System health monitoring
    - `get_usage_analytics()` - Platform usage analytics
    - `get_revenue_metrics()` - Revenue metrics with forecasting
    - `get_tenant_metrics()` - Individual tenant metrics
    - `get_cohort_analysis()` - Cohort retention analysis
    - `get_platform_overview()` - Complete platform overview

---

## 9. **predictive_analytics_service.py**

### Classes:
- **`PredictionModel`** (Enum) - Prediction model types
  - Values: LINEAR_REGRESSION, TIME_SERIES, ENSEMBLE, MOVING_AVERAGE

- **`ScenarioType`** (Enum) - Scenario types for what-if analysis
  - Values: OPTIMISTIC, PESSIMISTIC, REALISTIC

- **`PredictiveAnalyticsService`** - Advanced predictive analytics
  - **Purpose**: Forecasting, scenario modeling, predictive insights
  - **Key Functions**:
    - `forecast_occupancy_and_revenue()` - Combined forecasting
    - `predict_demand()` - Demand prediction for specific dates
    - `forecast_financial_performance()` - Financial forecasting
    - `analyze_pricing_optimization()` - Pricing optimization analysis
    - `predict_churn_risk()` - Customer churn risk prediction
    - `generate_what_if_scenario()` - What-if scenario analysis

---

## 10. **report_generation_service.py**

### Classes:
- **`ReportType`** (Enum) - Report types
  - Values: TABULAR, CHART, DASHBOARD, SUMMARY, DETAILED

- **`ReportFormat`** (Enum) - Report output formats
  - Values: PDF, EXCEL, CSV, JSON, HTML

- **`ScheduleFrequency`** (Enum) - Report schedule frequencies
  - Values: DAILY, WEEKLY, MONTHLY, QUARTERLY

- **`ReportGenerationService`** - Custom report management
  - **Purpose**: Create, manage, schedule custom reports with permissions
  - **Key Functions**:
    - `create_report_definition()` - Create custom report
    - `update_report_definition()` - Update report definition
    - `execute_report()` - Execute report with caching
    - `schedule_report()` - Schedule automatic reports
    - `get_scheduled_reports()` - Get user's scheduled reports
    - `cancel_schedule()` - Cancel scheduled report
    - `export_report_result()` - Export report to file
    - `get_report_history()` - Get execution history
    - `share_report()` - Share report with permissions
    - `delete_report_definition()` - Delete report definition

---

## 11. **supervisor_analytics_service.py**

### Classes:
- **`SupervisorAnalyticsService`** - Supervisor performance analytics
  - **Purpose**: Track supervisor performance, workload, team analytics
  - **Key Functions**:
    - `get_dashboard()` - Supervisor analytics dashboard
    - `compare_supervisors()` - Compare supervisor performance
    - `get_team_analytics()` - Team-wide analytics
    - `get_workload_analysis()` - Detailed workload analysis
    - `get_performance_rating()` - Performance scoring

---

## 12. **visitor_analytics_service.py**

### Classes:
- **`TrafficSource`** (Enum) - Traffic source types
  - Values: ORGANIC, DIRECT, REFERRAL, SOCIAL, PAID, EMAIL

- **`VisitorSegment`** (Enum) - Visitor segment types
  - Values: NEW, RETURNING, LOYAL, AT_RISK

- **`VisitorAnalyticsService`** - Visitor behavior analytics
  - **Purpose**: Track visitor behavior, conversion funnels, traffic sources
  - **Key Functions**:
    - `get_funnel()` - Visitor conversion funnel
    - `get_traffic_source_analytics()` - Traffic source performance
    - `get_behavior_analytics()` - Visitor behavior analysis
    - `get_conversion_paths()` - Conversion path analysis
    - `get_search_behavior()` - Search behavior analytics
    - `get_engagement_metrics()` - Visitor engagement metrics
    - `get_visitor_segmentation()` - Visitor segmentation analysis

---

## **Summary**
- **Total Classes**: 15 main service classes + 8 enum classes
- **Total Methods**: 80+ key business methods
- **Coverage**: Complete analytics ecosystem for hostel management
- **Features**: Forecasting, reporting, exports, dashboards, performance tracking

Each service focuses on a specific domain while providing comprehensive analytics capabilities with caching, error handling, and performance optimization.


==============================================================================================================================================

# Announcement Service Layer - Classes Overview

## 1. **AnnouncementService** (`announcement_service.py`)
**Purpose**: Core announcement CRUD operations and lifecycle management

### Main Functions:
- `create_announcement()` - Create new draft announcements
- `update_announcement()` - Update existing announcements with versioning
- `publish()` - Publish announcements (immediate or scheduled)
- `unpublish()` - Remove published announcements from visibility
- `archive()` - Soft-delete announcements from active listings
- `unarchive()` - Restore archived announcements
- `get_detail()` - Retrieve detailed announcement information
- `list_for_hostel()` - List announcements with filtering and pagination

---

## 2. **AnnouncementTargetingService** (`announcement_targeting_service.py`)
**Purpose**: Manage audience selection and targeting rules

### Main Functions:
- `apply_targeting()` - Apply targeting rules to select announcement audience
- `preview_targeting()` - Preview audience selection before applying
- `compute_summary()` - Get targeting statistics and recipient counts
- `update_targeting()` - Modify existing targeting configuration
- `clear_targeting()` - Remove all targeting rules

---

## 3. **AnnouncementSchedulingService** (`announcement_scheduling_service.py`)
**Purpose**: Handle future publishing and recurring announcements

### Main Functions:
- `schedule()` - Schedule announcement for future publishing
- `create_recurring()` - Create recurring announcement patterns
- `update_schedule()` - Modify existing schedules
- `cancel()` - Cancel scheduled or recurring announcements
- `publish_now()` - Override schedule and publish immediately
- `list_scheduled()` - List upcoming scheduled announcements

---

## 4. **AnnouncementApprovalService** (`announcement_approval_service.py`)
**Purpose**: Manage multi-level approval workflows

### Main Functions:
- `submit_for_approval()` - Submit announcements for approval review
- `approve()` - Approve pending announcements
- `reject()` - Reject announcements with reasons
- `bulk_decide()` - Process multiple approvals/rejections at once
- `get_workflow()` - Get approval workflow status
- `get_supervisor_queue()` - Get pending approvals for supervisors
- `get_history()` - Get approval history timeline
- `withdraw_submission()` - Withdraw pending approval requests

---

## 5. **AnnouncementDeliveryService** (`announcement_delivery_service.py`)
**Purpose**: Execute multi-channel delivery (email, SMS, push, in-app)

### Main Functions:
- `initialize_delivery()` - Set up delivery tasks for all channels
- `execute()` - Execute delivery with batch processing
- `retry()` - Retry failed deliveries with backoff strategy
- `pause()` - Pause delivery processing for maintenance
- `resume()` - Resume paused deliveries
- `get_status()` - Get real-time delivery status
- `get_report()` - Get comprehensive delivery analytics
- `get_failed_deliveries()` - List failed deliveries for troubleshooting

---

## 6. **AnnouncementTemplateService** (`announcement_template_service.py`)
**Purpose**: Manage reusable content templates with variable substitution

### Main Functions:
- `create_template()` - Create new announcement templates
- `update_template()` - Update existing templates with versioning
- `get_template()` - Retrieve template by code
- `list_templates()` - List templates with filtering
- `delete_template()` - Soft-delete templates
- `preview_template()` - Preview template with variable substitution
- `apply_to_announcement()` - Generate announcement from template

---

## 7. **AnnouncementTrackingService** (`announcement_tracking_service.py`)
**Purpose**: Track engagement, analytics, and student interactions

### Main Functions:
- `record_view()` - Record when students view announcements
- `submit_read_receipt()` - Track reading time and engagement
- `acknowledge()` - Handle student acknowledgments
- `get_acknowledgment_tracking()` - Track acknowledgment progress
- `compute_engagement()` - Calculate engagement analytics
- `get_student_engagement()` - Get individual student engagement metrics
- `get_engagement_trend()` - Get time-series engagement data
- `get_pending_acknowledgments()` - List pending student acknowledgments

---

## Service Dependencies & Usage Flow:

```
AnnouncementService (Core)
├── AnnouncementTargetingService (Audience Selection)
├── AnnouncementTemplateService (Content Templates)
├── AnnouncementSchedulingService (Future Publishing)
├── AnnouncementApprovalService (Workflow Management)
├── AnnouncementDeliveryService (Multi-channel Delivery)
└── AnnouncementTrackingService (Analytics & Engagement)
```

Each service is designed to handle a specific aspect of announcement management, allowing for modular functionality and clear separation of concerns.

=============================================================================================================================

# Attendance Services - Classes and Functions Overview

## 1. **attendance_service.py**

### **Class: AttendanceService**
**Purpose:** Core attendance marking and querying operations

**Functions:**
- `mark_attendance()` - Mark attendance for single student
- `bulk_mark_attendance()` - Mark attendance for multiple students at once
- `quick_mark_all()` - Mark all students present with exceptions for absent/late
- `update_record_status()` - Update existing attendance record status
- `list_attendance()` - List attendance records with filtering and pagination
- `get_daily_summary()` - Get hostel-level daily attendance summary
- `get_student_attendance()` - Get attendance history for specific student

---

## 2. **attendance_alert_service.py**

### **Class: AttendanceAlertService**
**Purpose:** Manage attendance alerts, configuration, and notifications

**Functions:**
- `save_configuration()` - Save alert configuration per hostel
- `get_configuration()` - Get current alert configuration for hostel
- `trigger_alert()` - Trigger manual alerts
- `acknowledge()` - Acknowledge alerts with optional resolution
- `list_alerts()` - List alerts with filtering and statistics
- `get_summary()` - Get alert summary for dashboards
- `resolve_alert()` - Mark alerts as resolved

---

## 3. **attendance_correction_service.py**

### **Class: AttendanceCorrectionService**
**Purpose:** Handle attendance corrections with approval workflow

**Functions:**
- `submit_correction()` - Submit correction request for attendance record
- `get_correction_history()` - Get correction history for specific record
- `approve_correction()` - Approve pending correction requests
- `reject_correction()` - Reject correction requests with reason

---

## 4. **attendance_policy_service.py**

### **Class: AttendancePolicyService**
**Purpose:** Manage attendance policies and detect violations

**Functions:**
- `get_policy()` - Fetch current attendance policy for hostel
- `create_policy()` - Create new attendance policy for hostel
- `update_policy()` - Update existing policy configuration
- `detect_violations()` - Detect policy violations for given period
- `get_violation_summary()` - Get summary of violations by type and severity

---

## 5. **attendance_report_service.py**

### **Class: AttendanceReportService**
**Purpose:** Generate comprehensive attendance reports and analytics

**Functions:**
- `generate_hostel_report()` - Generate comprehensive hostel attendance report
- `generate_monthly_report()` - Generate monthly report with student summaries
- `generate_student_report()` - Generate detailed report for specific student
- `compare_attendance()` - Compare attendance across students/hostels/rooms
- `get_weekly_summary()` - Get weekly attendance summary
- `get_trend_analysis()` - Get attendance trends for visualization
- `export_report()` - Export reports in various formats (PDF, Excel, CSV)

---

## 6. **check_in_service.py**

### **Class: CheckInService**
**Purpose:** Handle check-in/check-out operations with device tracking

**Functions:**
- `check_in()` - Mark student check-in with timestamp and device info
- `check_out()` - Mark student check-out with timestamp
- `get_check_in_status()` - Get current check-in/out status for student

---

## **Key Characteristics:**

### **All Classes Inherit From:**
- `BaseService[Model, Repository]` - Provides common functionality like error handling, validation, and database session management

### **Common Patterns:**
- All methods return `ServiceResult[T]` - Standardized response wrapper
- Database transaction management (commit/rollback)
- Comprehensive logging and error handling
- Input validation and sanitization
- Metadata tracking for audit trails

### **Service Layer Responsibilities:**
- **Business Logic:** Implement complex business rules and validation
- **Transaction Management:** Handle database transactions and rollbacks
- **Error Handling:** Convert exceptions to standardized service errors
- **Coordination:** Orchestrate between multiple repositories if needed
- **Validation:** Validate input data and business rules
- **Logging:** Comprehensive operation logging for debugging and audit

Each service focuses on a specific domain within attendance management, ensuring separation of concerns and maintainability.

===============================================================================================================================

# Authentication Services - Complete Class Overview

## 1. `authentication_service.py`

### **AuthenticationService**
**Purpose**: Core login/logout operations and token issuance
**Functions**:
- `login()` - Email-based authentication
- `phone_login()` - Phone-based authentication  
- `refresh()` - Refresh access tokens
- `logout()` - User logout (single/all devices)
- `_create_authenticated_session()` - Create session with tokens
- `_create_access_token()` - Generate access token
- `_create_refresh_token()` - Generate refresh token
- `_record_successful_login()` - Log successful attempts
- `_record_failed_login()` - Log failed attempts
- `_is_account_locked()` - Check lockout status

---

## 2. `mfa_service.py`

### **MFAService**
**Purpose**: TOTP-based Multi-Factor Authentication management
**Functions**:
- `enroll()` - Initiate MFA enrollment with QR code
- `verify_enrollment()` - Complete MFA setup with backup codes
- `disable()` - Disable MFA for user
- `verify_login_code()` - Verify TOTP/backup code during login
- `regenerate_backup_codes()` - Generate new backup codes
- `_verify_mfa_code()` - Verify TOTP or backup code
- `_generate_backup_codes()` - Create backup codes
- `_hash_backup_code()` - Hash backup codes for storage

---

## 3. `otp_service.py`

### **OTPService**
**Purpose**: One-Time Password generation and verification via email/SMS
**Functions**:
- `generate()` - Generate and send OTP
- `verify()` - Verify OTP code
- `resend()` - Resend OTP with rate limiting
- `_validate_generate_request()` - Validate OTP request
- `_invalidate_existing_otps()` - Clear previous OTPs
- `_mask_destination()` - Hide email/phone for privacy

---

## 4. `password_service.py`

### **PasswordService**
**Purpose**: Password management with security policies
**Functions**:
- `change_password()` - Change user password
- `request_reset()` - Initiate password reset flow
- `confirm_reset()` - Complete password reset with token
- `strength_check()` - Analyze password strength
- `_validate_new_password()` - Comprehensive password validation
- `_is_password_reused()` - Check password history

---

## 5. `security_monitoring_service.py`

### **SecurityMonitoringService**
**Purpose**: Security event tracking and threat analysis
**Functions**:
- `get_recent_attempts()` - Retrieve login attempts
- `analyze_login_pattern()` - Detect anomalous patterns
- `get_failed_attempts_by_ip()` - IP-based attempt analysis
- `record_event()` - Log security events
- `get_events()` - Retrieve security events
- `resolve_event()` - Mark events as resolved
- `analyze_threat_level()` - Calculate user threat score
- `_analyze_time_distribution()` - Time-based pattern analysis
- `_analyze_geographic_distribution()` - Location analysis
- `_detect_anomalies()` - Identify suspicious activity
- `_calculate_risk_score()` - Risk assessment

---

## 6. `session_service.py`

### **SessionService**
**Purpose**: User session lifecycle management across devices
**Functions**:
- `list_active()` - List user's active sessions
- `get_session()` - Get specific session details
- `revoke()` - Revoke single session
- `revoke_all()` - Revoke all/other sessions
- `update_activity()` - Update session activity timestamp
- `cleanup_expired()` - Remove expired sessions
- `get_statistics()` - Session usage statistics
- `_parse_device_info()` - Parse user agent for device info
- `_get_location_from_ip()` - IP geolocation
- `_is_current_session()` - Identify current session

---

## 7. `social_auth_service.py`

### **SocialAuthService**
**Purpose**: OAuth integration for Google/Facebook login
**Functions**:
- `google_login()` - Google OAuth authentication
- `facebook_login()` - Facebook OAuth authentication
- `link_social_account()` - Link social account to existing user
- `unlink_social_account()` - Remove social account link
- `_get_or_create_social_user()` - User provisioning for social login
- `_update_social_profile()` - Sync social profile data
- `_create_social_auth_response()` - Build authentication response

---

## 8. `token_blacklist_service.py`

### **TokenBlacklistService**
**Purpose**: Token revocation and blacklist management
**Functions**:
- `blacklist_token()` - Add token to blacklist
- `is_blacklisted()` - Check if token is revoked
- `revoke_all_for_user()` - Bulk token revocation
- `cleanup_expired()` - Remove expired blacklist entries
- `get_revocation_history()` - Token revocation audit trail

---

## 9. `token_service.py`

### **TokenService**
**Purpose**: JWT token lifecycle management and validation
**Functions**:
- `issue_tokens()` - Generate access/refresh token pair
- `refresh()` - Refresh access token with rotation
- `validate()` - Validate token and extract claims
- `decode_token_payload()` - Decode token without validation

---

## Summary by Responsibility

| **Service** | **Primary Responsibility** | **Key Operations** |
|-------------|---------------------------|-------------------|
| **AuthenticationService** | Core auth operations | Login, logout, token issuance |
| **MFAService** | Multi-factor auth | TOTP enrollment, verification |
| **OTPService** | One-time passwords | Generate, verify, resend OTP |
| **PasswordService** | Password management | Change, reset, strength validation |
| **SecurityMonitoringService** | Security analysis | Threat detection, event logging |
| **SessionService** | Session management | Track, list, revoke sessions |
| **SocialAuthService** | OAuth integration | Google/Facebook login |
| **TokenBlacklistService** | Token revocation | Blacklist, cleanup revoked tokens |
| **TokenService** | Token operations | Issue, validate, refresh JWT tokens |

Each service follows the **Single Responsibility Principle** and provides comprehensive functionality for its specific authentication domain.

===============================================================================================================================

# Background Services Classes Overview

## 1. cleanup_service.py

### **Classes:**

**CleanupTask (Enum)**
- **Purpose**: Enumeration of available cleanup tasks
- **Values**: OTP_TOKENS, USER_SESSIONS, BLACKLISTED_TOKENS, TEMP_UPLOADS, STALE_QUEUES, AUDIT_LOGS

**CleanupConfig (Dataclass)**
- **Purpose**: Configuration for cleanup operations
- **Properties**: retention periods, batch size, parallel execution settings

**CleanupResult (Dataclass)**
- **Purpose**: Result of a single cleanup task
- **Properties**: task type, count, success status, duration, error

**CleanupService (BaseService)**
- **Purpose**: Orchestrates cleanup tasks by delegating to repositories
- **Key Functions**:
  - `run_daily_cleanup()` - Execute daily cleanup tasks
  - `cleanup_otps()` - Purge expired OTP tokens
  - `cleanup_sessions()` - Purge expired user sessions
  - `cleanup_blacklist()` - Purge old blacklisted tokens
  - `cleanup_temp_uploads()` - Remove incomplete uploads
  - `cleanup_queues()` - Clean stale queue items
  - `cleanup_audit_logs()` - Purge old audit logs
  - `get_cleanup_stats()` - Get cleanup statistics

---

## 2. data_sync_service.py

### **Classes:**

**SyncDirection (Enum)**
- **Purpose**: Data synchronization direction
- **Values**: INBOUND, OUTBOUND, BIDIRECTIONAL

**SyncStatus (Enum)**
- **Purpose**: Synchronization status
- **Values**: SUCCESS, PARTIAL, FAILED

**SyncConfig (Dataclass)**
- **Purpose**: Configuration for sync operations
- **Properties**: batch sizes, retry settings, reconciliation settings

**SyncMetrics (Dataclass)**
- **Purpose**: Metrics for a sync operation
- **Properties**: provider, direction, status, items processed, duration, errors

**DataSyncService (BaseService)**
- **Purpose**: Orchestrates third-party data synchronization
- **Key Functions**:
  - `pull_webhooks()` - Process pending inbound webhooks
  - `pull_updates()` - Poll provider for updates
  - `push_updates()` - Push local changes to provider
  - `reconcile()` - Run reconciliation job between local and provider data
  - `sync_all_providers()` - Execute sync for all providers

---

## 3. health_check_service.py

### **Classes:**

**HealthStatus (Enum)**
- **Purpose**: Health status levels
- **Values**: HEALTHY, DEGRADED, UNHEALTHY, UNKNOWN

**ComponentType (Enum)**
- **Purpose**: System component types
- **Values**: DATABASE, CACHE, QUEUE, STORAGE, EXTERNAL_API, EMAIL, SMS, PAYMENT

**HealthCheckConfig (Dataclass)**
- **Purpose**: Configuration for health checks
- **Properties**: timeouts, thresholds, parallel execution settings

**ComponentHealth (Dataclass)**
- **Purpose**: Health status of a system component
- **Properties**: component name, type, status, latency, error details

**SystemHealth (Dataclass)**
- **Purpose**: Overall system health status
- **Properties**: overall status, component list, counts, duration

**HealthCheckService (BaseService)**
- **Purpose**: Performs and aggregates health checks across components
- **Key Functions**:
  - `get_system_health()` - Return consolidated health status
  - `check_component()` - Check health of specific component
  - `invalidate_cache()` - Clear health check cache
  - `_check_database()` - Database health check
  - `_check_redis()` - Redis health check
  - `_check_payments()` - Payment provider health check

---

## 4. metrics_collection_service.py

### **Classes:**

**MetricCategory (Enum)**
- **Purpose**: Categories of metrics
- **Values**: PERFORMANCE, CAPACITY, AVAILABILITY, USAGE, ERROR

**MetricsConfig (Dataclass)**
- **Purpose**: Configuration for metrics collection
- **Properties**: collection intervals, retention, aggregation settings

**MetricSnapshot (Dataclass)**
- **Purpose**: Single metric snapshot
- **Properties**: name, category, value, unit, timestamp, tags

**MetricsReport (Dataclass)**
- **Purpose**: Collection of metrics
- **Properties**: timestamp, duration, metrics list, summary

**MetricsCollectionService (BaseService)**
- **Purpose**: Collects periodic metrics and persists them
- **Key Functions**:
  - `collect()` - Collect metrics from various subsystems
  - `get_metric_history()` - Retrieve historical data for a metric
  - `delete_old_metrics()` - Delete metrics older than retention period
  - `_collect_performance_metrics()` - Collect performance metrics
  - `_collect_capacity_metrics()` - Collect capacity metrics
  - `_collect_availability_metrics()` - Collect availability metrics

---

## 5. queue_processor_service.py

### **Classes:**

**QueueType (Enum)**
- **Purpose**: Types of queues
- **Values**: NOTIFICATION, ANNOUNCEMENT, WEBHOOK

**ProcessingStatus (Enum)**
- **Purpose**: Processing status
- **Values**: SUCCESS, PARTIAL, FAILED, EMPTY

**QueueProcessingConfig (Dataclass)**
- **Purpose**: Configuration for queue processing
- **Properties**: batch sizes, parallel execution, retry settings, DLQ settings

**ProcessingMetrics (Dataclass)**
- **Purpose**: Metrics for queue processing
- **Properties**: queue type, status, counts, duration, errors

**QueueProcessorService (BaseService)**
- **Purpose**: Coordinates batch processing for configured queues
- **Key Functions**:
  - `process_all()` - Process all supported queues
  - `process_notification_queue()` - Process notification queue
  - `process_announcement_delivery()` - Execute announcement deliveries
  - `process_webhooks()` - Consume webhook events
  - `get_queue_stats()` - Get queue statistics
  - `purge_dead_letter_queue()` - Purge old DLQ items

---

## 6. task_scheduler_service.py

### **Classes:**

**TaskType (Enum)**
- **Purpose**: Types of scheduled tasks
- **Values**: ANNOUNCEMENT, REPORT, BILLING

**TaskStatus (Enum)**
- **Purpose**: Task execution status
- **Values**: SUCCESS, FAILED, TIMEOUT, SKIPPED

**TaskPriority (Enum)**
- **Purpose**: Task priority levels
- **Values**: LOW=1, MEDIUM=5, HIGH=10, CRITICAL=20

**SchedulerConfig (Dataclass)**
- **Purpose**: Configuration for task scheduler
- **Properties**: runtime limits, parallel execution, timeout settings

**TaskExecution (Dataclass)**
- **Purpose**: Execution record for a scheduled task
- **Properties**: task info, status, priority, duration, items processed

**SchedulerReport (Dataclass)**
- **Purpose**: Report of scheduler execution
- **Properties**: timing, counts, execution list

**TaskSchedulerService (BaseService)**
- **Purpose**: Orchestrates scheduled task execution across modules
- **Key Functions**:
  - `run_due_tasks()` - Execute all due scheduled tasks
  - `get_upcoming_tasks()` - Get upcoming scheduled tasks
  - `cancel_task()` - Cancel a scheduled task
  - `_execute_announcement_schedules()` - Execute announcement schedules
  - `_execute_report_schedules()` - Execute report generation
  - `_execute_billing_schedules()` - Execute billing cycle generation

---

## 7. __init__.py

### **Classes:** *(No additional classes - only imports and utility functions)*

**Utility Functions**:
- `get_all_services()` - List all available services
- `get_service_info()` - Get service information
- `get_default_configs()` - Get default configurations
- `generate_service_docs()` - Generate service documentation
- `validate_imports()` - Validate imports
- `print_module_info()` - Print module information
- `show_quick_reference()` - Display quick reference

---

## **Summary by Class Type:**

### **Enum Classes (7):**
- CleanupTask, SyncDirection, SyncStatus, HealthStatus, ComponentType, MetricCategory, QueueType, ProcessingStatus, TaskType, TaskStatus, TaskPriority

### **Dataclass Classes (13):**
- CleanupConfig, CleanupResult, SyncConfig, SyncMetrics, HealthCheckConfig, ComponentHealth, SystemHealth, MetricsConfig, MetricSnapshot, MetricsReport, QueueProcessingConfig, ProcessingMetrics, SchedulerConfig, TaskExecution, SchedulerReport

### **Service Classes (6):**
- CleanupService, DataSyncService, HealthCheckService, MetricsCollectionService, QueueProcessorService, TaskSchedulerService

**Total Classes: 26**

Each service follows the same pattern: Configuration → Execution → Metrics/Results, with comprehensive error handling and logging throughout.

==========================================================================================================================================

# Base Services - Classes and Functions Overview

## 1. **audit_service.py**

### Classes:
- **`AuditService`** - Service for logging audit trails
  - `log_action()` - Log user actions
  - `log_change()` - Log data changes 
  - `get_actor_activity()` - Get user activity history
  - `get_entity_history()` - Get entity change history

## 2. **authorization_service.py**

### Classes:
- **`AuthorizationService`** - Role-based access control service
  - `has_permission()` - Check if user has specific permission
  - `has_any_permission()` - Check if user has any of listed permissions
  - `has_all_permissions()` - Check if user has all listed permissions
  - `require_permission()` - Enforce permission requirement
  - `get_admin_permissions()` - Get all user permissions

## 3. **base_service.py**

### Classes:
- **`BaseService`** - Abstract base class for all services
  - `get_by_id()` - Retrieve entity by ID
  - `create()` - Create new entity
  - `update()` - Update existing entity
  - `delete()` - Delete entity
  - `transaction()` - Context manager for transactions
  - `_handle_exception()` - Convert exceptions to ServiceResult
  - `_validate_create()/_validate_update()/_validate_delete()` - Validation hooks
  - `_after_create()/_after_update()/_after_delete()` - Lifecycle hooks

## 4. **cache_service.py**

### Classes:
- **`CacheService`** - Redis-based caching service
  - `get()` - Get cached value
  - `set()` - Set cache value
  - `delete()` - Delete cached value
  - `exists()` - Check if key exists
  - `get_ttl()` - Get remaining time-to-live
  - `get_many()`/`set_many()`/`delete_many()` - Bulk operations
  - `delete_pattern()` - Delete keys matching pattern
  - `cached()` - Decorator for caching function results
  - `warm()` - Warm cache with data
  - `clear_all()` - Clear all cached data

## 5. **error_handler.py**

### Classes:
- **`ErrorHandler`** - Centralized error handling
  - `handle()` - Handle exception and convert to ServiceResult
  - `handle_validation_error()` - Handle validation-specific errors
  - `handle_not_found()` - Handle entity not found errors
  - `handle_permission_denied()` - Handle permission denied errors
  - `_map_exception()` - Map exception types to error codes

## 6. **event_dispatcher.py**

### Classes:
- **`DispatchedEvent`** - Result of event dispatch operation
- **`DispatchResult`** - Aggregated result of multiple event dispatches
- **`EventDispatcher`** - Dispatch domain events to event bus
  - `dispatch()` - Dispatch single event
  - `dispatch_many()` - Dispatch multiple events
  - `dispatch_async()`/`dispatch_many_async()` - Async dispatching
  - `add_filter()`/`add_transformer()` - Add event filters/transformers
- **`EventDispatcherFactory`** - Factory for creating event dispatchers

## 7. **notification_dispatcher.py**

### Enums:
- **`NotificationPriority`** - Notification priority levels (LOW, NORMAL, HIGH, URGENT)
- **`NotificationChannel`** - Delivery channels (EMAIL, SMS, PUSH, IN_APP, WEBHOOK)

### Classes:
- **`NotificationDispatcher`** - Multi-channel notification service
  - `send()` - Send single notification
  - `send_bulk()` - Send multiple notifications
  - `send_to_multiple_recipients()` - Send same notification to multiple users
  - `send_from_template()` - Send notification from template
  - `get_user_notifications()` - Get user's notifications
  - `mark_as_read()`/`mark_all_as_read()` - Mark notifications as read
  - `delete_notification()` - Delete notification
  - `get_notification_stats()` - Get notification statistics

## 8. **service_factory.py**

### Classes:
- **`ServiceFactory`** - Factory for creating service instances
  - `audit()` - Get/create audit service
  - `authorization()` - Get/create authorization service
  - `notification()` - Get/create notification dispatcher
  - `cache()` - Get/create cache service
  - `create_service()` - Generic service creation
  - `clear_cache()` - Clear cached services
- **`ServiceFactoryProvider`** - Provider for managing factory lifecycle

## 9. **service_result.py**

### Enums:
- **`ErrorCode`** - Standard error codes (INTERNAL_ERROR, VALIDATION_ERROR, NOT_FOUND, etc.)
- **`ErrorSeverity`** - Error severity levels (INFO, WARNING, ERROR, CRITICAL)

### Classes:
- **`ServiceError`** - Represents service operation error
  - `to_dict()` - Convert error to dictionary
- **`ServiceResult`** - Standardized service operation result
  - `success()` - Create successful result
  - `failure()` - Create failed result
  - `from_exception()` - Create failed result from exception
  - `unwrap()` - Get data or raise exception
  - `unwrap_or()` - Get data or default value
  - `to_dict()` - Convert result to dictionary

## 10. **transaction_manager.py**

### Classes:
- **`TransactionContext`** - Context information for a transaction
- **`TransactionManager`** - Advanced transaction management
  - `start()` - Start new transaction
  - `savepoint()` - Create savepoint within transaction
  - `add_before_commit_hook()`/`add_after_commit_hook()`/`add_on_rollback_hook()` - Transaction hooks
  - `get_active_transactions()` - Get active transactions
  - `get_transaction_stats()` - Get transaction statistics
- **`TransactionManagerFactory`** - Factory for creating transaction managers

## 11. **validation_service.py**

### Classes:
- **`ValidationRule`** - Base class for validation rules
  - `validate()` - Validate a value
- **`ValidationService`** - Comprehensive validation service
  - **Required Field Validation:**
    - `require()` - Validate field has value
    - `require_all()` - Validate all required fields present
  - **Type Validation:**
    - `validate_type()` - Validate value type
  - **Numeric Validation:**
    - `ensure_positive_number()` - Validate positive number
    - `validate_range()` - Validate number within range
  - **Date/Time Validation:**
    - `validate_date_range()` - Validate date range
    - `validate_future_date()` - Validate future date
  - **String Validation:**
    - `validate_length()` - Validate string length
    - `validate_pattern()` - Validate regex pattern
    - `validate_email()` - Validate email format
    - `validate_phone()` - Validate phone format
  - **Collection Validation:**
    - `validate_choice()` - Validate value in allowed choices
    - `validate_list_items()` - Validate each list item
  - **Batch Validation:**
    - `validate_all()` - Aggregate multiple validation results

## 12. **__init__.py**

### Classes:
- **`ServiceConfig`** - Configuration container for services
  - `configure()` - Configure service settings
  - `get_config()` - Get current configuration
- **`ServiceRegistry`** - Registry for dependency injection
  - `register()` - Register service instance/factory
  - `get()` - Get service instance
  - `clear()` - Clear registered services
  - `list_services()` - List all registered services

### Functions:
- `create_service_factory()` - Convenience function to create service factory
- `create_transaction_manager()` - Convenience function to create transaction manager
- `create_error_handler()` - Convenience function to create error handler
- `handle_service_errors()` - Decorator for automatic error handling
- `cache_result()` - Decorator for caching method results
- `cleanup()` - Cleanup function for graceful shutdown

---

## Summary by Purpose:

**Core Infrastructure:**
- `BaseService` - Base class for all services
- `ServiceResult`/`ServiceError` - Standardized result pattern
- `ServiceFactory` - Dependency injection and service creation

**Data Management:**
- `CacheService` - Redis caching
- `TransactionManager` - Database transaction handling
- `AuditService` - Audit logging

**Security & Validation:**
- `AuthorizationService` - Permission checking
- `ValidationService` - Data validation
- `ErrorHandler` - Error management

**Event & Notification:**
- `EventDispatcher` - Domain event dispatching
- `NotificationDispatcher` - Multi-channel notifications

**Configuration & Utilities:**
- `ServiceConfig` - Configuration management
- `ServiceRegistry` - Service dependency injection
- Various decorators and utility functions
=============================================================================================================================
# Booking Services - Complete Class Structure

## 1. `booking_service.py`
### **BookingService**
**Purpose**: Core booking CRUD operations and basic queries

**Key Methods**:
- `create_booking()` - Create new booking (admin-side)
- `create_from_request()` - Create booking from public request
- `quick_create()` - Minimal booking for fast-track flows
- `update_booking()` - Update existing booking
- `get_detail()` - Get detailed booking information
- `list_bookings()` - List bookings with pagination
- `get_by_reference()` - Find booking by reference number
- `get_statistics()` - Get booking statistics for hostel

---

## 2. `booking_search_service.py`
### **BookingSearchService**
**Purpose**: Advanced booking search, filtering, and export operations

**Key Methods**:
- `search()` - Search bookings with advanced criteria
- `list_with_filters()` - List with complex filtering and sorting
- `search_by_guest()` - Search bookings by guest name
- `get_upcoming_bookings()` - Get upcoming bookings for hostel
- `export_bookings()` - Prepare booking data for export (CSV/Excel/JSON)
- `clear_cache()` - Clear search result cache

---

## 3. `booking_approval_service.py`
### **BookingApprovalService**
**Purpose**: Booking approval workflow management

**Key Methods**:
- `approve()` - Approve a booking
- `reject()` - Reject booking with reason
- `bulk_approve()` - Approve multiple bookings at once
- `get_settings()` - Get approval settings for hostel
- `update_settings()` - Update approval settings
- `get_pending_approvals()` - Get pending approval requests
- `get_approval_history()` - Get approval history for booking

---

## 4. `booking_assignment_service.py`
### **BookingAssignmentService**
**Purpose**: Room/bed assignment management for bookings

**Key Methods**:
- `assign()` - Assign room/bed to booking
- `reassign()` - Reassign booking to different room/bed
- `bulk_assign()` - Assign multiple bookings in bulk
- `get_assignment_history()` - Get assignment history for booking
- `get_current_assignment()` - Get current assignment for booking
- `check_availability()` - Check room/bed availability for dates

---

## 5. `booking_calendar_service.py`
### **BookingCalendarService**
**Purpose**: Calendar views and availability analytics

**Key Methods**:
- `get_month_view()` - Get monthly calendar view of bookings
- `get_week_view()` - Get weekly calendar view
- `get_day_view()` - Get daily view of bookings
- `get_availability_calendar()` - Get availability calendar for capacity planning
- `get_occupancy_rate()` - Calculate occupancy rate for date range
- `get_capacity_forecast()` - Generate capacity forecast
- `get_peak_periods()` - Identify peak booking periods
- `clear_cache()` - Clear calendar cache

---

## 6. `booking_cancellation_service.py`
### **BookingCancellationService**
**Purpose**: Booking cancellation and refund management

**Key Methods**:
- `cancel()` - Cancel a booking
- `bulk_cancel()` - Cancel multiple bookings in bulk
- `calculate_refund()` - Calculate refund amount for booking
- `preview_cancellation()` - Preview cancellation details without executing
- `get_policy()` - Get cancellation policy for hostel
- `update_policy()` - Update cancellation policy
- `get_cancellation_statistics()` - Get cancellation statistics
- `get_cancellation_history()` - Get cancellation history for booking

---

## 7. `booking_conversion_service.py`
### **BookingConversionService**
**Purpose**: Convert confirmed bookings to student/resident profiles

**Key Methods**:
- `convert()` - Convert booking to student profile
- `get_checklist()` - Get conversion checklist for validation
- `update_checklist_item()` - Update checklist item status
- `rollback()` - Rollback a conversion
- `get_conversion_history()` - Get conversion history for hostel
- `get_conversion_statistics()` - Get conversion statistics

---

## 8. `booking_guest_service.py`
### **BookingGuestService**
**Purpose**: Manage guest information and documents

**Key Methods**:
- `update_guest_information()` - Update guest info for booking
- `get_guest_information()` - Get guest information
- `add_guest_document()` - Add document to booking
- `remove_guest_document()` - Remove document from booking
- `get_guest_documents()` - Get all documents for booking
- `verify_guest_document()` - Verify or reject guest document
- `bulk_update_guest_information()` - Bulk update guest info
- `anonymize_guest_data()` - Anonymize guest data (GDPR compliance)

---

## 9. `booking_modification_service.py`
### **BookingModificationService**
**Purpose**: Handle booking modification requests and approvals

**Key Methods**:
- `request_modification()` - Request general booking modification
- `change_date()` - Request date change for booking
- `change_duration()` - Request duration change
- `change_room_type()` - Request room type change
- `approve_modification()` - Approve or reject modification request
- `get_pending_modifications()` - Get pending modification requests
- `get_modification_history()` - Get modification history for booking
- `calculate_price_difference()` - Calculate price difference for modification

---

## 10. `booking_notification_service.py`
### **BookingNotificationService**
**Purpose**: Booking-specific notifications (confirmations, reminders, etc.)

**Key Methods**:
- `send_confirmation()` - Send booking confirmation notification
- `send_cancellation()` - Send booking cancellation notification
- `send_payment_reminder()` - Send payment reminder
- `send_check_in_reminder()` - Send check-in reminder
- `send_modification_notification()` - Send modification approval/rejection notification
- `schedule_check_in_reminders()` - Schedule check-in reminders for upcoming bookings
- `send_bulk_notification()` - Send notifications to multiple bookings

---

## 11. `booking_pricing_service.py`
### **BookingPricingService**
**Purpose**: Booking pricing calculation and quote generation

**Key Methods**:
- `quote()` - Calculate quote for given booking parameters
- `recompute_for_booking()` - Recompute fees for existing booking
- `get_price_breakdown()` - Get detailed price breakdown
- `apply_discount()` - Apply discount code to booking
- `compare_prices()` - Compare prices across multiple room types
- `clear_cache()` - Clear pricing cache

---

## 12. `booking_waitlist_service.py`
### **BookingWaitlistService**
**Purpose**: Waitlist management with priority queue and analytics

**Key Methods**:
- `join()` - Add user to waitlist
- `cancel()` - Remove user from waitlist
- `notify_availability()` - Send availability notification to waitlist entry
- `notify_next_in_queue()` - Notify next person(s) in waitlist queue
- `conversion_response()` - Handle user response to availability notification
- `get_status()` - Get status of waitlist entry
- `management_view()` - Get management view of waitlist for room type
- `get_user_waitlist_entries()` - Get all waitlist entries for user
- `get_waitlist_statistics()` - Get waitlist statistics
- `get_conversion_rate()` - Get waitlist to booking conversion rate
- `get_average_wait_time()` - Get average wait time for waitlist entries
- `bulk_notify()` - Send notifications to multiple waitlist entries
- `expire_old_entries()` - Expire old waitlist entries

---

## Summary by Service Category:

**Core Operations**: BookingService, BookingSearchService  
**Workflow Management**: BookingApprovalService, BookingAssignmentService, BookingModificationService  
**Financial Operations**: BookingPricingService, BookingCancellationService  
**Communication**: BookingNotificationService  
**Capacity Planning**: BookingCalendarService, BookingWaitlistService  
**Data Management**: BookingGuestService, BookingConversionService

Each service follows the same pattern:
- Inherits from BaseService
- Has validation methods (`_validate_*`)
- Implements business logic methods
- Includes error handling and logging
- Supports caching where appropriate
- Provides bulk operations where relevant
===============================================================================================================================

# Complete Class & Function Breakdown - Communication Services

---

## 1. `broadcast_service.py`

### Class: `BroadcastService`

**Purpose:** Mass messaging service for sending notifications to multiple users with intelligent routing, preference filtering, and batch processing.

| Function | Purpose |
|----------|---------|
| `__init__()` | Initialize with notification, queue, routing, and preferences repositories |
| `broadcast()` | Send multiple notifications with routing rules and user preferences |
| `_process_broadcast()` | Process broadcast requests with batching and error tracking |
| `_check_user_preferences()` | Check if notification is enabled for user based on preferences |
| `_create_and_queue_notification()` | Create notification and add to appropriate queue |
| `_capture_error_detail()` | Capture detailed error information for failed notifications |
| `_validate_batch_size()` | Validate and normalize batch size parameter |
| `get_broadcast_status()` | Get status and statistics for broadcast operations |

---

## 2. `chatbot_service.py`

### Class: `ChatbotService`

**Purpose:** Chatbot session orchestration with third-party provider integration (Dialogflow, Lex, OpenAI, etc.) for automated conversations.

| Function | Purpose |
|----------|---------|
| `__init__()` | Initialize with third-party repository and database session |
| `start_session()` | Initiate a chatbot session and return session context from provider |
| `send_user_message()` | Send user message to provider and receive bot response |
| `get_history()` | Retrieve chat history for a session |
| `end_session()` | Explicitly end a chatbot session |
| `_prepare_session_metadata()` | Prepare enhanced session metadata with user/channel info |
| `_prepare_message_context()` | Prepare message context with timestamp |
| `_enhance_session_data()` | Enhance session data with additional fields |
| `_enhance_message_response()` | Enhance message response with metadata |
| `_validate_history_limit()` | Validate and normalize history limit |

---

## 3. `chat_service.py`

### Class: `ChatService`

**Purpose:** In-app peer-to-peer chat service leveraging the notification subsystem for one-on-one messaging and thread management.

| Function | Purpose |
|----------|---------|
| `__init__()` | Initialize with notification repository and database session |
| `send_message()` | Send a chat message to a recipient |
| `get_conversation()` | Retrieve messages for a conversation between two users |
| `list_threads()` | List active conversation threads for a user |
| `mark_as_read()` | Mark messages in a thread as read |
| `_validate_message()` | Validate message content (empty check, length limit) |
| `_generate_thread_id()` | Generate consistent thread ID for two users using hash |
| `_create_message_notification()` | Create notification request for chat message |
| `_enhance_threads()` | Enhance thread data with unread counts and metadata |
| `_validate_limit()` | Validate and normalize limit parameter |

---

## 4. `communication_analytics_service.py`

### Enum: `AnalyticsPeriod`

**Purpose:** Predefined time periods for analytics queries.

| Value | Meaning |
|-------|---------|
| `LAST_HOUR` | Last 1 hour |
| `LAST_24_HOURS` | Last 24 hours |
| `LAST_7_DAYS` | Last 7 days |
| `LAST_30_DAYS` | Last 30 days |
| `LAST_90_DAYS` | Last 90 days |
| `CUSTOM` | Custom date range |

---

### Class: `CommunicationAnalyticsService`

**Purpose:** Cross-channel communication analytics and reporting for performance metrics, delivery reports, and trend analysis.

| Function | Purpose |
|----------|---------|
| `__init__()` | Initialize with notification, aggregate, email, and SMS repositories |
| `get_overview()` | Get overall communication performance across all channels |
| `get_channel_stats()` | Get detailed statistics for each communication channel |
| `get_delivery_report()` | Get detailed delivery report with success/failure breakdown |
| `get_engagement_metrics()` | Get engagement metrics (opens, clicks, responses) |
| `get_trend_analysis()` | Get trend analysis for a specific metric over time |
| `_resolve_time_period()` | Resolve time period from explicit dates or predefined period |
| `_serialize_stats()` | Serialize stats object to dictionary |
| `_enhance_overview_metrics()` | Add calculated metrics (delivery rate, failure rate) to overview |
| `_enhance_delivery_report()` | Enhance delivery report with failure analysis |
| `_calculate_channel_comparison()` | Calculate comparative metrics across channels |
| `_calculate_engagement_score()` | Calculate overall engagement score (0-100) |

---

## 5. `communication_service.py`

### Class: `CommunicationService`

**Purpose:** Unified communication orchestration facade providing a single interface for all communication channels (email, SMS, push, in-app).

| Function | Purpose |
|----------|---------|
| `__init__()` | Initialize with email service, SMS service, dispatcher, and database session |
| **Email Operations** | |
| `send_email()` | Send a single email (delegates to EmailService) |
| `send_bulk_email()` | Send bulk emails (delegates to EmailService) |
| `send_email_using_template()` | Send templated email (delegates to EmailService) |
| `schedule_email()` | Schedule email for future delivery |
| **SMS Operations** | |
| `send_sms()` | Send a single SMS (delegates to SMSService) |
| `send_bulk_sms()` | Send bulk SMS messages (delegates to SMSService) |
| **Push/In-App Operations** | |
| `send_in_app()` | Send in-app or push notification via dispatcher |
| `send_push()` | Send push notification (alias with type validation) |
| **Multi-Channel Operations** | |
| `send_multi_channel()` | Send message across multiple channels simultaneously |
| `_send_email_to_user()` | Helper to send email to user (requires profile lookup) |
| `_send_sms_to_user()` | Helper to send SMS to user (requires profile lookup) |
| `get_communication_health()` | Get health status of all communication channels |

---

## 6. `email_service.py`

### Class: `EmailService`

**Purpose:** Email communication service with template rendering, scheduling, tracking (opens/clicks), and delivery analytics.

| Function | Purpose |
|----------|---------|
| `__init__()` | Initialize with email repository, template repository, and database session |
| `send()` | Queue and/or send a single email with tracking |
| `send_bulk()` | Send bulk emails with batching support |
| `send_template()` | Render an email template and send to recipients |
| `schedule()` | Schedule email for future or recurring delivery |
| `get_stats()` | Get email statistics for a time period |
| `get_tracking()` | Get detailed tracking information for a specific email |
| `retry_failed()` | Retry failed email delivery |
| `_validate_email_request()` | Validate email request (recipients, subject, body) |
| `_is_valid_email()` | Validate email address format using regex |
| `_serialize_tracking()` | Serialize tracking object to dictionary |
| `_serialize_stats()` | Serialize stats object to dictionary |

---

## 7. `sms_service.py`

### Class: `SMSService`

**Purpose:** SMS communication service with phone validation, message segmentation, quota management, and delivery tracking.

| Function | Purpose |
|----------|---------|
| `__init__()` | Initialize with SMS repository and database session |
| `send()` | Queue and/or send a single SMS message |
| `send_bulk()` | Send SMS messages to multiple recipients |
| `get_stats()` | Get SMS statistics for a time period |
| `get_quota()` | Get current SMS quota information |
| `check_delivery_status()` | Check delivery status of a specific SMS |
| `_validate_sms_request()` | Validate SMS request (recipient, message) |
| `_is_valid_phone()` | Validate phone number format (E.164) |
| `_calculate_segments()` | Calculate number of SMS segments required for message |
| `_check_quota()` | Check if quota allows sending specified number of messages |
| `_serialize_result()` | Serialize result object to dictionary |
| `format_phone_number()` | Format phone number to E.164 standard |

---

## 8. `__init__.py`

### Module-Level Functions

**Purpose:** Package initialization with exports and service registry for dynamic loading.

| Function | Purpose |
|----------|---------|
| `get_service()` | Get service class by name from registry |
| `list_services()` | List all available service names |

### Service Registry

```
SERVICE_REGISTRY = {
    "communication": CommunicationService,
    "email": EmailService,
    "sms": SMSService,
    "broadcast": BroadcastService,
    "chat": ChatService,
    "chatbot": ChatbotService,
    "analytics": CommunicationAnalyticsService,
}
```

---

## Visual Class Hierarchy

```
BaseService (from app.services.base)
    │
    ├── BroadcastService
    │       └── Mass notification broadcasting
    │
    ├── ChatbotService
    │       └── AI chatbot session management
    │
    ├── ChatService
    │       └── Peer-to-peer in-app messaging
    │
    ├── CommunicationAnalyticsService
    │       └── Cross-channel analytics/reporting
    │
    ├── EmailService
    │       └── Email sending, templates, tracking
    │
    └── SMSService
            └── SMS sending, validation, quotas

CommunicationService (Facade - does NOT extend BaseService)
    │
    ├── Delegates to → EmailService
    ├── Delegates to → SMSService
    └── Delegates to → NotificationDispatcher
```

---

## Summary Table

| Class | File | Primary Responsibility |
|-------|------|----------------------|
| `BroadcastService` | broadcast_service.py | Mass messaging with routing & batching |
| `ChatbotService` | chatbot_service.py | AI chatbot session & provider integration |
| `ChatService` | chat_service.py | Peer-to-peer in-app chat |
| `AnalyticsPeriod` | communication_analytics_service.py | Time period enum for analytics |
| `CommunicationAnalyticsService` | communication_analytics_service.py | Cross-channel analytics & reporting |
| `CommunicationService` | communication_service.py | Unified facade for all channels |
| `EmailService` | email_service.py | Email sending, templates, tracking |
| `SMSService` | sms_service.py | SMS sending, validation, quotas |

===============================================================================================================================

# Complaint Service Layer - Classes and Functions Overview

## 1. **complaint_service.py**

### **Class: ComplaintService**
**Purpose**: Core complaint CRUD operations and primary lifecycle management

**Functions**:
- `create()` - Create new complaint with validation
- `update()` - Update existing complaint details  
- `change_status()` - Change complaint status with state validation
- `get_detail()` - Retrieve complete complaint details by ID
- `search()` - Text-based search with filters
- `list_with_filters()` - Advanced filtering, sorting, pagination
- `get_summary()` - Get complaint summary stats for hostel
- `get_stats()` - Detailed statistics for date range

---

## 2. **complaint_assignment_service.py**

### **Class: ComplaintAssignmentService** 
**Purpose**: Manage complaint assignment lifecycle and history

**Functions**:
- `assign()` - Assign complaint to staff member
- `reassign()` - Reassign complaint to different staff
- `unassign()` - Remove assignment from complaint
- `bulk_assign()` - Assign multiple complaints in single operation
- `history()` - Retrieve assignment history for complaint

---

## 3. **complaint_comment_service.py**

### **Class: ComplaintCommentService**
**Purpose**: Handle comments, discussions, and @mention notifications

**Functions**:
- `add()` - Add new comment with mention detection
- `update()` - Update existing comment
- `delete()` - Soft delete comment
- `list_for_complaint()` - List all comments for specific complaint
- `_extract_mentions()` - Extract @mentions from content (helper)
- `_process_mentions()` - Send notifications for mentions (helper)

---

## 4. **complaint_escalation_service.py**

### **Class: ComplaintEscalationService**
**Purpose**: Manual and automatic escalation workflow management

**Functions**:
- `escalate()` - Manually escalate complaint to higher level
- `history()` - Retrieve complete escalation history
- `set_auto_rule()` - Create/update auto-escalation rules
- `get_auto_rule()` - Retrieve auto-escalation rule for hostel
- `delete_auto_rule()` - Delete auto-escalation rule
- `process_auto_escalations()` - Process automatic escalations (scheduled job)

---

## 5. **complaint_resolution_service.py**

### **Class: ComplaintResolutionService**
**Purpose**: Resolution lifecycle management (resolve, reopen, close)

**Functions**:
- `resolve()` - Mark complaint as resolved with details
- `update_resolution()` - Update resolution details
- `reopen()` - Reopen resolved complaint for additional work
- `close()` - Permanently close resolved complaint

---

## 6. **complaint_feedback_service.py**

### **Class: ComplaintFeedbackService**
**Purpose**: Collect and analyze user feedback on resolved complaints

**Functions**:
- `submit()` - Submit feedback for resolved complaint
- `summary()` - Get feedback summary for entity (hostel/staff)
- `analysis()` - Detailed feedback analysis with trends
- `get_rating_trend()` - Rating trends over time

---

## 7. **complaint_analytics_service.py**

### **Class: ComplaintAnalyticsService**
**Purpose**: Comprehensive analytics, dashboards, and reporting

**Functions**:
- `dashboard()` - Get complete complaint dashboard data
- `kpis()` - Key performance indicators
- `trend()` - Complaint trends over time (daily/weekly/monthly)
- `category_breakdown()` - Breakdown by complaint category
- `priority_breakdown()` - Breakdown by priority levels
- `status_breakdown()` - Breakdown by status
- `compare_periods()` - Compare metrics between two time periods

---

## 8. **complaint_sla_service.py**

### **Class: ComplaintSLAService**
**Purpose**: SLA monitoring, breach detection, and threshold management

**Functions**:
- `get_sla_metrics()` - Comprehensive SLA metrics for hostel
- `get_kpis()` - Complete KPIs including SLA metrics
- `get_sla_breaches()` - List complaints that breached SLA
- `get_at_risk_complaints()` - Complaints at risk of breaching SLA
- `get_sla_thresholds()` - Get SLA threshold configuration
- `update_sla_thresholds()` - Update SLA threshold configuration

---

## **Common Base Pattern**

All classes inherit from `BaseService[Model, Repository]` providing:
- **Transaction Management**: Automatic commit/rollback
- **Error Handling**: Consistent error responses
- **Validation**: Input validation helpers
- **Logging**: Structured logging throughout
- **Metadata**: Response metadata for tracking

## **Service Relationships**

- **ComplaintService** = Core operations, used by others
- **AssignmentService** = Tracks who works on complaints  
- **CommentService** = Enables team collaboration
- **EscalationService** = Manages priority increases
- **ResolutionService** = Handles closure workflow
- **FeedbackService** = Measures satisfaction
- **AnalyticsService** = Reports and insights
- **SLAService** = Performance monitoring

Each service is focused, independent, and can be used separately or together for complete complaint management.

================================================================================================================================

# File Management Services - Classes Overview

## 1. `document_processing_service.py`

### **DocumentProcessingService**
**Purpose:** Manages document upload, OCR, validation, verification, and expiry tracking

**Key Functions:**
- `init_document_upload()` - Initialize document upload with metadata
- `validate_document()` - Validate document against business rules
- `run_ocr()` - Extract text from documents using OCR
- `verify_document()` - Manual verification of document authenticity
- `get_document_info()` - Retrieve comprehensive document information
- `list_documents_for_owner()` - List documents with advanced filtering
- `queue_expiry_alerts()` - Schedule alerts for documents expiring soon
- `get_expiring_documents()` - Get documents expiring within specified days
- `archive_document()` - Archive document (soft delete with metadata)
- `restore_archived_document()` - Restore archived document

---

## 2. `file_cleanup_service.py`

### **FileCleanupService**
**Purpose:** Automated cleanup and maintenance of file artifacts

**Key Functions:**
- `purge_incomplete_uploads()` - Remove incomplete uploads older than threshold
- `purge_old_versions()` - Remove old file versions, keeping recent ones
- `purge_failed_images()` - Clean up failed image processing records
- `purge_archived_documents()` - Remove old archived documents
- `run_full_cleanup()` - Execute all cleanup tasks with configurable thresholds
- `get_cleanup_stats()` - Get cumulative cleanup statistics
- `reset_cleanup_stats()` - Reset cleanup counters
- `estimate_storage_savings()` - Calculate potential storage savings

---

## 3. `file_metadata_service.py`

### **FileMetadataService**
**Purpose:** Manages file tags, access control, versions, and analytics

**Key Functions:**
#### Tag Management:
- `add_tag()` - Add single tag to file
- `add_tags_bulk()` - Add multiple tags in bulk
- `remove_tag()` - Remove tag from file
- `list_tags()` - List all tags for file
- `clear_all_tags()` - Remove all tags from file

#### Access Control (ACL):
- `grant_access()` - Grant permission to user/group
- `revoke_access()` - Remove permission from user/group
- `update_access_permission()` - Modify existing permission level
- `list_access()` - List all permissions for file
- `check_access()` - Verify if user has specific permission

#### Version Management:
- `create_version()` - Create new version snapshot
- `list_versions()` - List all versions of file
- `restore_version()` - Restore file to specific version

#### Analytics:
- `increment_access_count()` - Record file access event
- `get_access_logs()` - Retrieve access history
- `get_stats()` - Get file statistics and analytics
- `get_file_analytics()` - Get detailed analytics for specific file

---

## 4. `file_storage_service.py`

### **FileStorageService**
**Purpose:** Storage-level operations and URL management

**Key Functions:**
- `generate_url()` - Create signed URLs (download, upload, preview, inline)
- `delete_file()` - Delete file with options for soft/hard delete
- `copy_object()` - Copy file to different location
- `move_object()` - Move file to different location
- `get_storage_info()` - Get storage-specific metadata
- `restore_deleted_file()` - Restore soft-deleted file

---

## 5. `file_upload_service.py`

### **FileUploadService**
**Purpose:** Handles complete file upload workflows

**Key Functions:**
- `init_upload()` - Initialize single-part upload with pre-signed URL
- `complete_upload()` - Complete upload with checksum verification
- `init_multipart()` - Initialize multipart upload for large files
- `complete_multipart()` - Complete multipart upload by combining parts
- `get_file_info()` - Retrieve comprehensive file information
- `get_download_url()` - Generate time-limited download URL
- `abort_upload()` - Abort in-progress upload and cleanup

---

## 6. `file_validation_service.py`

### **FileValidationService**
**Purpose:** File validation and security scanning

**Key Functions:**
- `preflight_validate()` - Comprehensive pre-upload validation
- `_validate_filename()` - Check filename safety and format
- `_validate_extension()` - Validate against whitelist/blacklist
- `_validate_content_type()` - Verify MIME type
- `_validate_size()` - Check file size limits
- `run_antivirus_scan()` - Trigger virus scanning
- `quarantine_file()` - Quarantine suspicious/infected files
- `release_from_quarantine()` - Release file from quarantine
- `configure_allowed_extensions()` - Set extension whitelist
- `configure_blocked_extensions()` - Set extension blacklist
- `add_blocked_extension()` - Add single blocked extension
- `remove_blocked_extension()` - Remove blocked extension

---

## 7. `image_processing_service.py`

### **ImageProcessingService**
**Purpose:** Image-specific processing and optimization

**Key Functions:**
- `init_image_upload()` - Initialize image upload with validation
- `process_image()` - Generate variants, optimize, extract metadata
- `retry_failed()` - Retry failed image processing
- `get_metadata()` - Retrieve image metadata including EXIF
- `get_variant()` - Get specific image variant (thumbnail, small, etc.)
- `list_variants()` - List all variants for an image
- `optimize_image()` - Optimize existing image for size reduction
- `convert_format()` - Convert image to different format
- `_validate_image_request()` - Validate image-specific constraints
- `_validate_processing_options()` - Validate processing configuration

---

## 8. `__init__.py`

### **SERVICE_REGISTRY** (Dictionary)
**Purpose:** Service registry for dependency injection

**Contains:**
- `"upload"` → FileUploadService
- `"storage"` → FileStorageService  
- `"metadata"` → FileMetadataService
- `"validation"` → FileValidationService
- `"image"` → ImageProcessingService
- `"document"` → DocumentProcessingService
- `"cleanup"` → FileCleanupService

### **get_service()** (Function)
**Purpose:** Factory method to retrieve service class by name

---

## **Summary by Use Case:**

| **Use Case** | **Primary Service** | **Supporting Services** |
|-------------|-------------------|------------------------|
| Upload files | FileUploadService | FileValidationService |
| Process images | ImageProcessingService | FileUploadService |
| Manage documents | DocumentProcessingService | FileValidationService |
| File operations | FileStorageService | FileMetadataService |
| Security scanning | FileValidationService | - |
| Cleanup maintenance | FileCleanupService | All services |
| Access control | FileMetadataService | - |

Each service inherits from `BaseService` and follows the same pattern:
- Constructor with repository and database session
- Service methods returning `ServiceResult`
- Error handling with rollback
- Comprehensive logging

===============================================================================================================================

# Fee Structure Service Layer - Classes Overview

## 1. `fee_structure_service.py`

### **FeeStructureService**
**Purpose**: Core fee structure lifecycle management

**Key Functions**:
- `create_structure()` - Create new fee structures with validation
- `update_structure()` - Update existing structures  
- `set_status()` - Change status (draft → active → inactive → archived)
- `delete_structure()` - Soft/hard delete structures
- `find_applicable()` - Find applicable fee structure for hostel/room/date
- `list_structures()` - List with filtering and pagination
- `get_structure_by_id()` - Retrieve specific structure
- `_validate_fee_structure_data()` - Validate structure data
- `_check_for_overlaps()` - Prevent overlapping structures
- `_is_valid_status_transition()` - Validate status changes
- `_validate_activation()` - Check if structure can be activated
- `_is_structure_in_use()` - Check for active dependencies

---

## 2. `charge_component_service.py`

### **ChargeComponentService** 
**Purpose**: Manage fee components, calculation rules, and discounts

**Key Functions**:

**Component Management**:
- `create_component()` - Create charge components (room rent, utilities, etc.)
- `update_component()` - Update component details
- `delete_component()` - Remove components with dependency checks
- `list_components()` - List components with filtering

**Rule Management**:
- `create_rule()` - Create calculation rules (per day, per month, percentage, etc.)
- `update_rule()` - Update calculation rules
- `delete_rule()` - Remove calculation rules
- `list_rules()` - List rules with filtering

**Discount Management**:
- `create_discount()` - Create discount configurations
- `update_discount()` - Update discount settings
- `delete_discount()` - Remove discounts
- `list_discounts()` - List discount configurations

**Validation Helpers**:
- `_validate_component_data()` - Validate component creation
- `_validate_rule_data()` - Validate rule parameters
- `_validate_discount_data()` - Validate discount configurations

---

## 3. `fee_approval_service.py`

### **FeeApprovalService**
**Purpose**: Handle fee structure approval workflows

**Key Functions**:
- `submit()` - Submit structure for approval
- `approve()` - Approve pending requests with validation
- `reject()` - Reject requests with mandatory reasons
- `withdraw()` - Withdraw pending approval requests
- `history()` - Get complete approval history for a structure
- `get_pending_approvals()` - List pending approvals for reviewers
- `_get_pending_approval()` - Check for existing pending approvals
- `_handle_post_approval_actions()` - Auto-activate approved structures
- `_handle_post_rejection_actions()` - Handle rejection notifications

---

## 4. `fee_calculation_service.py`

### **FeeCalculationService**
**Purpose**: Calculate fees, generate quotes, and manage calculation records

**Key Functions**:
- `calculate_quote()` - Generate real-time quotes without persistence
- `calculate_and_save()` - Calculate and save to database
- `recompute_for_booking()` - Recalculate existing booking fees
- `get_calculation_by_id()` - Retrieve specific calculation
- `get_calculations_for_booking()` - Get all calculations for a booking
- `get_calculations_for_student()` - Get student's fee calculations
- `compare_calculations()` - Compare two calculations for differences
- `_validate_calculation_request()` - Validate calculation inputs
- `_schema_to_model()` - Convert schemas to database models
- `_get_booking_details()` - Fetch booking information
- `_build_comparison()` - Create detailed calculation comparisons

---

## 5. `fee_projection_service.py`

### **FeeProjectionService**
**Purpose**: Generate revenue forecasts and fee projections

**Key Functions**:
- `project_for_hostel()` - Generate hostel-level projections
- `project_for_room_type()` - Room type specific projections
- `compare_projections()` - Compare multiple scenarios (optimistic/realistic/pessimistic)
- `get_historical_accuracy()` - Analyze past projection accuracy
- `export_projection()` - Export projections (JSON/CSV/Excel)
- `_validate_projection_params()` - Validate projection inputs
- `_export_as_json()` - JSON export functionality
- `_export_as_csv()` - CSV export functionality
- `_export_as_excel()` - Excel export functionality

---

## 6. `proration_service.py`

### **ProrationService**
**Purpose**: Calculate pro-rated amounts for partial periods and changes

**Key Functions**:
- `prorate_monthly_amount()` - Calculate pro-rated amounts for partial months
- `calculate_refund()` - Calculate refunds for early terminations
- `calculate_upgrade_differential()` - Calculate amount differences for plan changes
- `_validate_proration_inputs()` - Validate proration parameters
- `_prorate_actual_days()` - Use actual calendar days method
- `_prorate_30_day_month()` - Use consistent 30-day months
- `_prorate_365_day_year()` - Use 365-day year basis

---

## 7. `__init__.py`

**Purpose**: Package initialization and service exports

**Contents**:
- Import all service classes
- Define `__all__` for public API
- Set package version

---

## **Service Dependencies & Relationships**:

1. **FeeStructureService** → Core service that others depend on
2. **ChargeComponentService** → Works with FeeStructureService for component management
3. **FeeApprovalService** → Manages workflow for FeeStructureService changes
4. **FeeCalculationService** → Uses FeeStructureService to find applicable structures
5. **FeeProjectionService** → Uses FeeCalculationService for forecasting
6. **ProrationService** → Standalone utility for partial period calculations

Each service follows the **BaseService** pattern with standardized error handling, logging, and ServiceResult return types.
===============================================================================================================================

# Complete Hostel Services Classes Breakdown

## 1. **constants.py**
**No Classes** - Only contains configuration constants and error messages

---

## 2. **hostel_amenity_service.py**

### `HostelAmenityService`
**Purpose**: Manages hostel amenities and their booking system

**Key Functions**:
- `create_amenity()` - Add new amenities to hostels
- `update_amenity()` - Modify existing amenities
- `delete_amenity()` - Remove amenities (soft/hard delete)
- `list_amenities()` - Get amenities with filtering
- `book_amenity()` - Create booking for amenity usage
- `cancel_booking()` - Cancel existing amenity bookings
- `get_bookings()` - Retrieve booking records with filters
- `clear_cache()` - Clear cached amenity data

---

## 3. **hostel_analytics_service.py**

### `HostelAnalyticsService`
**Purpose**: Provides comprehensive analytics and reporting for hostel operations

**Key Functions**:
- `get_dashboard()` - Complete analytics dashboard for hostels
- `get_summary()` - Quick summary metrics for specific periods
- `occupancy_stats()` - Detailed occupancy statistics and trends
- `get_occupancy_forecast()` - Predict future occupancy using historical data
- `revenue_stats()` - Revenue analysis with breakdowns
- `get_revenue_trends()` - Period-over-period revenue comparison
- `get_booking_analytics()` - Booking patterns and conversion metrics
- `get_review_analytics()` - Review and rating analysis
- `get_complaint_analytics()` - Complaint tracking and resolution metrics
- `compare_periods()` - Compare analytics between two time periods
- `clear_cache()` - Clear analytics cache

---

## 4. **hostel_comparison_service.py**

### `HostelComparisonService`
**Purpose**: Enables cross-hostel comparisons and competitive analysis

**Key Functions**:
- `compare()` - Comprehensive multi-hostel comparison
- `compare_by_criteria()` - Compare specific criteria only
- `compare_pricing()` - Detailed pricing comparison analysis
- `compare_amenities()` - Feature and amenity comparison
- `compare_performance()` - Operational performance benchmarking
- `get_recommendations()` - Generate hostel recommendations with scoring
- `rank_hostels()` - Rank hostels by specific criteria
- `get_competitive_insights()` - Competitive analysis for a hostel
- `get_market_position()` - Market positioning analysis
- `clear_cache()` - Clear comparison cache

---

## 5. **hostel_media_service.py**

### `HostelMediaService`
**Purpose**: Manages all media assets (images, videos, documents) for hostels

**Key Functions**:
- `add_media()` - Upload and add new media with validation
- `update_media()` - Modify existing media information
- `delete_media()` - Remove media (with optional storage cleanup)
- `list_media()` - Get media with advanced filtering
- `bulk_add_media()` - Add multiple media items in single transaction
- `set_primary_media()` - Set media as primary for hostel/category
- `clear_cache()` - Clear media cache

---

## 6. **hostel_onboarding_service.py**

### `OnboardingStep`
**Purpose**: Represents a single step in the onboarding workflow

**Key Properties**:
- `name` - Step identifier
- `handler` - Function to execute for this step
- `required` - Whether step is mandatory
- `rollback_handler` - Cleanup function if step fails
- `status` - Current step status
- `error` - Error information if failed
- `result` - Step execution result

### `HostelOnboardingService`
**Purpose**: Orchestrates complete hostel setup with multi-step workflow

**Key Functions**:
- `onboard()` - Complete hostel onboarding with defaults
- `onboard_with_progress()` - Onboarding with progress callback
- `quick_onboard()` - Minimal setup for quick hostel creation
- `batch_onboard()` - Onboard multiple hostels in batch
- Private step methods:
  - `_step_create_hostel()` - Create hostel record
  - `_step_seed_settings()` - Apply default settings
  - `_step_seed_policies()` - Create default policies
  - `_step_seed_amenities()` - Add default amenities
  - `_step_initialize_analytics()` - Setup analytics tracking
  - `_step_set_initial_status()` - Set initial hostel status

---

## 7. **hostel_policy_service.py**

### `HostelPolicyService`
**Purpose**: Manages policy documents and compliance tracking

**Key Functions**:
- `create_policy()` - Create new policies with versioning
- `update_policy()` - Update existing policies (with version control)
- `delete_policy()` - Remove policies (soft delete preferred)
- `list_policies()` - Get policies with filtering
- `acknowledge()` - Record user acknowledgment of policies
- `check_acknowledgment()` - Check if user acknowledged specific policy
- `get_acknowledgment_status()` - Comprehensive compliance status
- `record_violation()` - Record policy violations
- `get_violations()` - Retrieve violation records with filtering
- `resolve_violation()` - Mark violations as resolved
- `clear_cache()` - Clear policy cache

---

## 8. **hostel_service.py**

### `HostelService`
**Purpose**: Core hostel operations - main CRUD and operational management

**Key Functions**:
- `create_hostel()` - Create new hostel with validation
- `update_hostel()` - Update hostel information
- `update_media()` - Update media references
- `update_seo()` - Update SEO metadata
- `get_detail()` - Get detailed hostel information
- `list_hostels()` - List hostels with filtering and pagination
- `get_stats()` - Retrieve hostel statistics
- `set_visibility()` - Control public visibility and features
- `set_status()` - Update operational status
- `update_capacity()` - Update room/bed capacity
- `clear_all_cache()` - Clear all hostel cache

---

## 9. **hostel_settings_service.py**

### `HostelSettingsService`
**Purpose**: Manages operational settings and configurations for hostels

**Key Functions**:
- `get_settings()` - Retrieve hostel settings with caching
- `update_settings()` - Update settings with validation
- `reset_to_defaults()` - Reset settings to default values
- `bulk_update_settings()` - Update multiple hostel settings in batch
- `clear_cache()` - Clear settings cache

---

## 10. **__init__.py**
**No Classes** - Contains:
- Service imports and exports
- Service categorization metadata
- Utility functions: `get_service_info()`, `get_services_by_category()`

---

## **Summary of Service Architecture**

### **Core Services** (Basic Operations):
- `HostelService` - Main CRUD operations
- `HostelSettingsService` - Configuration management

### **Feature Services** (Extended Functionality):
- `HostelAmenityService` - Amenity and booking management
- `HostelMediaService` - Media asset management
- `HostelPolicyService` - Policy and compliance management

### **Analytics Services** (Data & Insights):
- `HostelAnalyticsService` - Reporting and analytics
- `HostelComparisonService` - Cross-hostel analysis

### **Operations Services** (Workflow Management):
- `HostelOnboardingService` - Initial setup orchestration
- `OnboardingStep` - Workflow step representation

Each service follows the same pattern:
- Inherits from `BaseService`
- Uses repository pattern for data access
- Implements caching strategies
- Provides comprehensive error handling
- Supports transaction management
==============================================================================================================================

Based on the inquiry services folder analysis, here's the complete breakdown of classes and their purposes:

## File: `inquiry_analytics_service.py`

### Class: `InquiryAnalyticsService`
**Purpose**: Provides comprehensive inquiry analytics and reporting capabilities

**Key Functions**:
- `get_overview()` - Get aggregated metrics and KPIs for a date range
- `get_trends()` - Get time-series trends (daily/weekly/monthly)
- `get_source_breakdown()` - Analyze inquiry sources with performance metrics
- `get_response_metrics()` - Calculate response time statistics and SLA performance
- `get_performance_comparison()` - Compare current vs previous period performance
- `get_forecast()` - Predict future inquiry volumes based on historical data

---

## File: `inquiry_assignment_service.py`

### Class: `InquiryAssignmentService`
**Purpose**: Manages inquiry assignment lifecycle and ownership

**Key Functions**:
- `assign()` - Assign inquiry to a staff member or admin
- `unassign()` - Remove assignment from an inquiry
- `transfer()` - Transfer inquiry from one user to another
- `get_assigned_inquiries()` - Get all inquiries assigned to a specific user
- `get_assignment_history()` - Get assignment timeline for an inquiry
- `get_workload_stats()` - Get workload statistics for an assignee

---

## File: `inquiry_conversion_service.py`

### Class: `InquiryConversionService`
**Purpose**: Converts qualified inquiries into bookings

**Key Functions**:
- `convert()` - Convert inquiry to booking with validation
- `reverse_conversion()` - Reverse a conversion (mark as not converted)
- `get_conversion_metrics()` - Get conversion rate statistics
- `get_conversion_funnel()` - Get funnel data (inquiry stages to booking)
- `get_convertible_inquiries()` - Get list of inquiries eligible for conversion

---

## File: `inquiry_follow_up_service.py`

### Class: `InquiryFollowUpService`
**Purpose**: Manages inquiry follow-up interactions and timeline tracking

**Key Functions**:
- `record()` - Record a follow-up interaction (calls, emails, messages)
- `bulk_record()` - Record multiple follow-ups in one transaction
- `timeline()` - Get comprehensive inquiry timeline with all events
- `get_follow_up_history()` - Get follow-up history filtered by interaction type
- `get_follow_up_metrics()` - Get follow-up statistics for an inquiry
- `schedule_follow_up()` - Schedule future follow-up reminders
- `get_upcoming_follow_ups()` - Get upcoming scheduled follow-ups
- `update_follow_up()` - Update existing follow-up records

---

## File: `inquiry_service.py`

### Class: `InquiryService`
**Purpose**: Core inquiry operations - CRUD, status management, and querying

**Key Functions**:
- `create()` - Create new inquiry with validation
- `update()` - Update existing inquiry (partial updates)
- `change_status()` - Change inquiry status with validation
- `bulk_change_status()` - Change status for multiple inquiries
- `get_detail()` - Get detailed inquiry information with relationships
- `list_with_filters()` - List inquiries with advanced filtering and pagination
- `search()` - Full-text search across inquiry fields
- `get_stats()` - Get inquiry statistics and metrics
- `delete()` - Delete or soft-delete inquiries

---

## File: `__init__.py`

### No Classes - Factory Functions Only
**Purpose**: Service initialization and dependency injection

**Factory Functions**:
- `get_inquiry_service()` - Creates InquiryService instance
- `get_inquiry_assignment_service()` - Creates InquiryAssignmentService instance
- `get_inquiry_follow_up_service()` - Creates InquiryFollowUpService instance
- `get_inquiry_conversion_service()` - Creates InquiryConversionService instance
- `get_inquiry_analytics_service()` - Creates InquiryAnalyticsService instance

---

## Summary

Each file contains **exactly one main service class** that handles a specific domain of inquiry management:

1. **InquiryService** - Core operations (CRUD, status, querying)
2. **InquiryAssignmentService** - Assignment and ownership
3. **InquiryFollowUpService** - Follow-ups and timeline
4. **InquiryConversionService** - Booking conversions
5. **InquiryAnalyticsService** - Analytics and reporting

All classes extend `BaseService` and return `ServiceResult` objects for consistent error handling and response structure.

===============================================================================================================================

# Complete Hostel Services Classes Breakdown

## 1. **constants.py**
**No Classes** - Only contains configuration constants and error messages

---

## 2. **hostel_amenity_service.py**

### `HostelAmenityService`
**Purpose**: Manages hostel amenities and their booking system

**Key Functions**:
- `create_amenity()` - Add new amenities to hostels
- `update_amenity()` - Modify existing amenities
- `delete_amenity()` - Remove amenities (soft/hard delete)
- `list_amenities()` - Get amenities with filtering
- `book_amenity()` - Create booking for amenity usage
- `cancel_booking()` - Cancel existing amenity bookings
- `get_bookings()` - Retrieve booking records with filters
- `clear_cache()` - Clear cached amenity data

---

## 3. **hostel_analytics_service.py**

### `HostelAnalyticsService`
**Purpose**: Provides comprehensive analytics and reporting for hostel operations

**Key Functions**:
- `get_dashboard()` - Complete analytics dashboard for hostels
- `get_summary()` - Quick summary metrics for specific periods
- `occupancy_stats()` - Detailed occupancy statistics and trends
- `get_occupancy_forecast()` - Predict future occupancy using historical data
- `revenue_stats()` - Revenue analysis with breakdowns
- `get_revenue_trends()` - Period-over-period revenue comparison
- `get_booking_analytics()` - Booking patterns and conversion metrics
- `get_review_analytics()` - Review and rating analysis
- `get_complaint_analytics()` - Complaint tracking and resolution metrics
- `compare_periods()` - Compare analytics between two time periods
- `clear_cache()` - Clear analytics cache

---

## 4. **hostel_comparison_service.py**

### `HostelComparisonService`
**Purpose**: Enables cross-hostel comparisons and competitive analysis

**Key Functions**:
- `compare()` - Comprehensive multi-hostel comparison
- `compare_by_criteria()` - Compare specific criteria only
- `compare_pricing()` - Detailed pricing comparison analysis
- `compare_amenities()` - Feature and amenity comparison
- `compare_performance()` - Operational performance benchmarking
- `get_recommendations()` - Generate hostel recommendations with scoring
- `rank_hostels()` - Rank hostels by specific criteria
- `get_competitive_insights()` - Competitive analysis for a hostel
- `get_market_position()` - Market positioning analysis
- `clear_cache()` - Clear comparison cache

---

## 5. **hostel_media_service.py**

### `HostelMediaService`
**Purpose**: Manages all media assets (images, videos, documents) for hostels

**Key Functions**:
- `add_media()` - Upload and add new media with validation
- `update_media()` - Modify existing media information
- `delete_media()` - Remove media (with optional storage cleanup)
- `list_media()` - Get media with advanced filtering
- `bulk_add_media()` - Add multiple media items in single transaction
- `set_primary_media()` - Set media as primary for hostel/category
- `clear_cache()` - Clear media cache

---

## 6. **hostel_onboarding_service.py**

### `OnboardingStep`
**Purpose**: Represents a single step in the onboarding workflow

**Key Properties**:
- `name` - Step identifier
- `handler` - Function to execute for this step
- `required` - Whether step is mandatory
- `rollback_handler` - Cleanup function if step fails
- `status` - Current step status
- `error` - Error information if failed
- `result` - Step execution result

### `HostelOnboardingService`
**Purpose**: Orchestrates complete hostel setup with multi-step workflow

**Key Functions**:
- `onboard()` - Complete hostel onboarding with defaults
- `onboard_with_progress()` - Onboarding with progress callback
- `quick_onboard()` - Minimal setup for quick hostel creation
- `batch_onboard()` - Onboard multiple hostels in batch
- Private step methods:
  - `_step_create_hostel()` - Create hostel record
  - `_step_seed_settings()` - Apply default settings
  - `_step_seed_policies()` - Create default policies
  - `_step_seed_amenities()` - Add default amenities
  - `_step_initialize_analytics()` - Setup analytics tracking
  - `_step_set_initial_status()` - Set initial hostel status

---

## 7. **hostel_policy_service.py**

### `HostelPolicyService`
**Purpose**: Manages policy documents and compliance tracking

**Key Functions**:
- `create_policy()` - Create new policies with versioning
- `update_policy()` - Update existing policies (with version control)
- `delete_policy()` - Remove policies (soft delete preferred)
- `list_policies()` - Get policies with filtering
- `acknowledge()` - Record user acknowledgment of policies
- `check_acknowledgment()` - Check if user acknowledged specific policy
- `get_acknowledgment_status()` - Comprehensive compliance status
- `record_violation()` - Record policy violations
- `get_violations()` - Retrieve violation records with filtering
- `resolve_violation()` - Mark violations as resolved
- `clear_cache()` - Clear policy cache

---

## 8. **hostel_service.py**

### `HostelService`
**Purpose**: Core hostel operations - main CRUD and operational management

**Key Functions**:
- `create_hostel()` - Create new hostel with validation
- `update_hostel()` - Update hostel information
- `update_media()` - Update media references
- `update_seo()` - Update SEO metadata
- `get_detail()` - Get detailed hostel information
- `list_hostels()` - List hostels with filtering and pagination
- `get_stats()` - Retrieve hostel statistics
- `set_visibility()` - Control public visibility and features
- `set_status()` - Update operational status
- `update_capacity()` - Update room/bed capacity
- `clear_all_cache()` - Clear all hostel cache

---

## 9. **hostel_settings_service.py**

### `HostelSettingsService`
**Purpose**: Manages operational settings and configurations for hostels

**Key Functions**:
- `get_settings()` - Retrieve hostel settings with caching
- `update_settings()` - Update settings with validation
- `reset_to_defaults()` - Reset settings to default values
- `bulk_update_settings()` - Update multiple hostel settings in batch
- `clear_cache()` - Clear settings cache

---

## 10. **__init__.py**
**No Classes** - Contains:
- Service imports and exports
- Service categorization metadata
- Utility functions: `get_service_info()`, `get_services_by_category()`

---

## **Summary of Service Architecture**

### **Core Services** (Basic Operations):
- `HostelService` - Main CRUD operations
- `HostelSettingsService` - Configuration management

### **Feature Services** (Extended Functionality):
- `HostelAmenityService` - Amenity and booking management
- `HostelMediaService` - Media asset management
- `HostelPolicyService` - Policy and compliance management

### **Analytics Services** (Data & Insights):
- `HostelAnalyticsService` - Reporting and analytics
- `HostelComparisonService` - Cross-hostel analysis

### **Operations Services** (Workflow Management):
- `HostelOnboardingService` - Initial setup orchestration
- `OnboardingStep` - Workflow step representation

Each service follows the same pattern:
- Inherits from `BaseService`
- Uses repository pattern for data access
- Implements caching strategies
- Provides comprehensive error handling
- Supports transaction management

===============================================================================================================================

# Integration Services - Classes and Functions Overview

## 1. **api_integration_service.py**

### `APIIntegrationService`
**Purpose:** Manages API-level operations including credentials, authentication, request proxying, and health checks.

**Key Functions:**
- `rotate_credentials()` - Rotate provider credentials with audit trail
- `refresh_access_token()` - Handle OAuth token refresh flows
- `proxy_request()` - Proxy HTTP requests to providers with circuit breaking
- `perform_health_check()` - Execute provider health verification
- `batch_health_check()` - Check health of multiple providers
- `get_provider_metrics()` - Retrieve performance metrics

---

## 2. **calendar_sync_service.py**

### `CalendarSyncService`
**Purpose:** Manages bidirectional calendar synchronization with external providers (Google Calendar, Outlook).

**Key Functions:**
- `pull_events()` - Pull calendar events from external providers
- `push_events()` - Push local events to external calendars
- `sync_bidirectional()` - Perform two-way sync with conflict resolution
- `delete_event()` - Delete events from external calendars
- `_deduplicate_events()` - Remove duplicate events
- `_validate_event_data()` - Validate event structure

---

## 3. **email_provider_service.py**

### `EmailProviderService`
**Purpose:** Manages email provider configurations, testing, and health monitoring (SES, SendGrid, Postmark, SMTP, Mailgun).

**Key Functions:**
- `upsert_config()` - Create/update email provider configuration
- `get_config()` - Retrieve provider configuration
- `health_check()` - Test provider connectivity and credentials
- `send_test()` - Send test email through provider
- `get_send_statistics()` - Retrieve email sending statistics
- `list_providers()` - List all configured email providers
- `_validate_provider()` - Validate provider identifier
- `_validate_email()` - Validate email address format
- `_validate_config()` - Validate provider-specific configuration

---

## 4. **integration_service.py**

### `IntegrationService`
**Purpose:** Top-level orchestrator for all integrations providing centralized management, monitoring, and diagnostics.

**Key Functions:**
- `register_provider()` - Register new integration provider
- `update_provider_config()` - Update provider configuration
- `get_provider_config()` - Retrieve provider configuration
- `list_providers()` - List all registered providers
- `enable_provider()` / `disable_provider()` - Control provider status
- `get_provider_health()` - Get provider health status
- `check_and_consume_rate_limit()` - Handle rate limiting
- `get_rate_limit_status()` - Check current rate limit status
- `reset_rate_limit()` - Reset rate limit counters
- `get_integration_overview()` - Dashboard overview of all integrations
- `get_provider_analytics()` - Detailed provider analytics
- `get_error_log()` - Retrieve integration error logs

---

## 5. **payment_gateway_integration.py**

### `PaymentGatewayIntegrationService`
**Purpose:** Handles payment gateway operations across multiple providers (Razorpay, Stripe, PayPal, Square, Braintree).

**Key Functions:**
- `initiate()` - Initiate payment with gateway
- `handle_webhook()` - Process payment webhooks
- `handle_callback()` - Handle payment return callbacks
- `verify()` - Verify payment status with gateway
- `refund()` - Process payment refunds
- `get_transaction_status()` - Get transaction status
- `list_transactions()` - List transactions with filters
- `_validate_gateway_request()` - Validate payment request
- `_check_idempotency()` - Handle idempotent requests

---

## 6. **push_provider_service.py**

### `PushProviderService`
**Purpose:** Manages push notification providers (FCM, APNs, OneSignal, Pusher) with device management.

**Key Functions:**
- `upsert_config()` - Configure push provider
- `get_config()` - Retrieve provider configuration
- `health_check()` - Test provider connectivity
- `send_test()` - Send test push notification
- `register_device()` - Register device for notifications
- `unregister_device()` - Remove device registration
- `get_send_statistics()` - Get push statistics
- `list_providers()` - List configured providers
- `_validate_provider()` - Validate provider identifier
- `_validate_device_token()` - Validate device token format
- `_validate_config()` - Validate provider configuration

---

## 7. **sms_provider_service.py**

### `SMSProviderService`
**Purpose:** Manages SMS provider configurations and operations (Twilio, SNS, Msg91, Nexmo, Plivo).

**Key Functions:**
- `upsert_config()` - Configure SMS provider
- `get_config()` - Retrieve provider configuration
- `health_check()` - Test provider health and balance
- `send_test()` - Send test SMS message
- `get_delivery_status()` - Check SMS delivery status
- `get_send_statistics()` - Retrieve SMS statistics
- `list_providers()` - List configured providers
- `_validate_provider()` - Validate provider identifier
- `_validate_phone_number()` - Validate phone number format (E.164)
- `_validate_config()` - Validate provider configuration

---

## 8. **third_party_sync_service.py**

### `ThirdPartySyncService`
**Purpose:** Provides generic synchronization capabilities for third-party integrations with bidirectional sync and conflict resolution.

**Key Functions:**
- `pull()` - Pull updates from third-party provider
- `push()` - Push local changes to provider
- `sync_bidirectional()` - Two-way sync with conflict resolution
- `reconcile()` - Compare and reconcile data differences
- `get_sync_status()` - Get current sync status
- `cancel_sync()` - Cancel active sync operations
- `get_sync_history()` - Retrieve sync history
- `_detect_conflicts()` - Identify data conflicts
- `_resolve_conflicts()` - Resolve conflicts using strategy
- `_acquire_sync_lock()` / `_release_sync_lock()` - Prevent concurrent syncs

### `SyncDirection` (Enum)
**Purpose:** Defines sync direction types.
- `PULL` - Pull from remote
- `PUSH` - Push to remote  
- `BIDIRECTIONAL` - Both directions

### `ConflictResolution` (Enum)
**Purpose:** Defines conflict resolution strategies.
- `LOCAL_WINS` - Local data takes precedence
- `REMOTE_WINS` - Remote data takes precedence
- `LATEST_WINS` - Most recent data wins
- `MANUAL` - Manual resolution required

---

## 9. **webhook_service.py**

### `WebhookService`
**Purpose:** Manages webhook lifecycle including registration, verification, delivery, and retry logic.

**Key Functions:**
- `register_webhook()` - Register webhook endpoint
- `process_inbound()` - Verify and process incoming webhooks
- `deliver_outbound()` - Deliver outbound webhooks
- `retry()` - Retry failed webhook deliveries
- `list_webhooks()` - List registered webhooks
- `update_webhook()` - Update webhook configuration
- `delete_webhook()` - Remove webhook registration
- `get_delivery_history()` - Get webhook delivery history
- `_verify_signature()` - Verify webhook signatures
- `_generate_webhook_secret()` - Generate secure webhook secrets

---

## **Summary of Class Responsibilities**

| **Service Class** | **Primary Responsibility** | **Key Capability** |
|---|---|---|
| `APIIntegrationService` | API operations & health | Circuit breakers, credential rotation |
| `CalendarSyncService` | Calendar synchronization | Bidirectional sync, deduplication |
| `EmailProviderService` | Email provider management | Multi-provider support, testing |
| `IntegrationService` | Central orchestration | Provider registry, rate limiting |
| `PaymentGatewayIntegrationService` | Payment processing | Multi-gateway, webhooks, refunds |
| `PushProviderService` | Push notifications | Device management, testing |
| `SMSProviderService` | SMS management | Multi-carrier, delivery tracking |
| `ThirdPartySyncService` | Generic synchronization | Conflict resolution, reconciliation |
| `WebhookService` | Webhook management | Security, retry logic, tracking |

Each service follows consistent patterns with validation, error handling, caching, and comprehensive logging.
==============================================================================

# Leave Management Service Layer - Complete Class Overview

## 1. `LeaveApplicationService`
**File:** `leave_application_service.py`

### Purpose
Manages the complete lifecycle of leave applications from submission to completion.

### Key Functions
- **`apply()`** - Submit new leave application with validation
- **`cancel()`** - Cancel pending/approved leave applications  
- **`update_application()`** - Update existing leave application details
- **`get_detail()`** - Retrieve comprehensive leave application details
- **`list_for_student()`** - Get all leave applications for a specific student
- **`list_for_hostel()`** - Get leave applications for a hostel with pagination
- **`summary()`** - Generate leave statistics and analytics

---

## 2. `LeaveApprovalService`
**File:** `leave_approval_service.py`

### Purpose
Handles approval workflows including decisions, multi-level approvals, and workflow management.

### Key Functions
- **`decide()`** - Process simple approve/reject decisions
- **`workflow_action()`** - Execute complex workflow actions (escalate, delegate, request changes)
- **`get_history()`** - Retrieve complete approval history for a leave
- **`get_workflow()`** - Get current workflow state and next steps
- **`get_pending_approvals()`** - List pending approvals for an approver

---

## 3. `LeaveBalanceService` 
**File:** `leave_balance_service.py`

### Purpose
Manages leave balances, quotas, and usage tracking across different leave types.

### Key Functions
- **`get_balance_summary()`** - Get comprehensive balance summary for a student
- **`get_balance_for_type()`** - Get balance for specific leave type
- **`update_quota()`** - Update leave quota configuration for hostel
- **`adjust_balance()`** - Manually adjust student leave balance
- **`list_usage_details()`** - Get detailed usage history with transactions
- **`get_quota_by_hostel()`** - Retrieve all quota configurations for a hostel

---

## 4. `LeaveCalendarService`
**File:** `leave_calendar_service.py`

### Purpose
Provides calendar-based visualizations and analytics for leave data.

### Key Functions
- **`hostel_month_calendar()`** - Generate monthly calendar view for a hostel
- **`student_month_calendar()`** - Generate monthly calendar view for a student
- **`period_calendar()`** - Create calendar for custom date ranges
- **`get_occupancy_stats()`** - Calculate occupancy statistics and trends

---

## 5. `LeaveNotificationService`
**File:** `leave_notification_service.py`

### Purpose
Manages all leave-related notifications across multiple communication channels.

### Key Functions
- **`send_submission_ack()`** - Send leave application submission acknowledgment
- **`send_decision_notice()`** - Notify about approval/rejection decisions
- **`send_return_reminder()`** - Send reminders about upcoming return dates
- **`send_escalation_alert()`** - Alert higher authorities about escalated approvals
- **`send_status_change_notification()`** - Notify about leave status changes
- **`send_bulk_notifications()`** - Send notifications to multiple recipients

---

## 6. `LeaveTypeService`
**File:** `leave_type_service.py`

### Purpose
Configures leave types, policies, rules, and restrictions at the hostel level.

### Key Functions

#### Leave Type Configuration
- **`create_type()`** - Create new leave type for a hostel
- **`update_type()`** - Update existing leave type configuration
- **`list_types()`** - List all leave types for a hostel
- **`delete_type()`** - Delete/deactivate leave type

#### Policy Management
- **`set_policy()`** - Set or update leave policy for hostel
- **`get_policy()`** - Retrieve current leave policy

#### Blackout Date Management
- **`add_blackout()`** - Add blackout periods when leaves cannot be taken
- **`remove_blackout()`** - Remove blackout date periods
- **`list_blackouts()`** - List all blackout dates with filtering

---

## Common Pattern Across All Services

### Base Functionality (Inherited from BaseService)
- **Error handling** with detailed logging
- **Transaction management** (commit/rollback)
- **Validation** at service layer
- **Audit trails** for all operations
- **Standardized responses** using ServiceResult

### Private Validation Methods
Each service has private `_validate_*()` methods for:
- Input validation
- Business rule enforcement
- Data integrity checks
- Permission verification

### Dependencies
- **Repository layer** for data access
- **Database session** for transaction management
- **Logging** for audit and debugging
- **Schema models** for type safety

This architecture provides a comprehensive, maintainable, and scalable leave management system with clear separation of concerns.

===============================================================================================================================

# Complete Maintenance Services Classes Overview

## 1. **MaintenanceAnalyticsService**
**File:** `maintenance_analytics_service.py`

**Purpose:** Provides comprehensive analytics and performance metrics for maintenance operations

### Key Functions:
- `get_hostel_analytics()` - Get comprehensive maintenance analytics for a hostel
- `get_analytics_comparison()` - Compare analytics between two periods  
- `get_performance_metrics()` - Get detailed performance metrics (SLA compliance, response times)
- `get_productivity_metrics()` - Get staff and vendor productivity metrics
- `get_category_breakdown()` - Get breakdown of maintenance requests by category
- `get_vendor_performance()` - Get comparative vendor performance analytics
- `get_dashboard_summary()` - Get summary dashboard data for maintenance overview

---

## 2. **MaintenanceApprovalService**
**File:** `maintenance_approval_service.py`

**Purpose:** Manages approval workflow for maintenance requests with multi-level approval support

### Key Functions:
- `approve_maintenance_request()` - Approve a maintenance request at current approval level
- `reject_maintenance_request()` - Reject a maintenance approval request
- `delegate_approval()` - Delegate an approval to another user
- `get_threshold_config_for_hostel()` - Retrieve approval threshold configuration
- `update_threshold_config()` - Update approval threshold configuration
- `get_workflow_for_request()` - Retrieve complete approval workflow for a request

---

## 3. **MaintenanceAssignmentService**
**File:** `maintenance_assignment_service.py`

**Purpose:** Manages assignment of maintenance tasks to internal staff and external vendors

### Key Functions:
- `assign_to_staff()` - Assign a maintenance request to internal staff member
- `assign_to_vendor()` - Assign a maintenance request to external vendor
- `update_assignment()` - Update an existing assignment
- `reassign_task()` - Reassign a task to different staff/vendor
- `bulk_assign()` - Bulk assign multiple maintenance requests to single assignee
- `get_assignment_history_for_request()` - Get complete assignment history for request
- `get_staff_workload()` - Get current workload for staff member
- `get_vendor_assignments()` - Get all assignments for a vendor

---

## 4. **MaintenanceCompletionService**
**File:** `maintenance_completion_service.py`

**Purpose:** Handles completion workflow for maintenance tasks including quality checks

### Key Functions:
- `record_completion()` - Record completion of maintenance request
- `update_completion()` - Update completion record with additional information
- `record_quality_check()` - Record quality check for completed maintenance
- `get_quality_checks_for_request()` - Get all quality checks for request
- `generate_completion_certificate()` - Generate completion certificate for finished task
- `get_completion_for_request()` - Get completion record for maintenance request
- `create_completion_checklist()` - Create completion checklist for request
- `update_checklist_item()` - Update checklist item completion status

---

## 5. **MaintenanceCostService**
**File:** `maintenance_cost_service.py`

**Purpose:** Comprehensive cost tracking and budget management for maintenance operations

### Key Functions:
- `record_cost_for_request()` - Record cost information for maintenance request
- `update_cost_record()` - Update existing cost record
- `get_cost_for_request()` - Get cost record for maintenance request
- `get_budget_allocation_for_hostel()` - Get budget allocation for hostel in fiscal year
- `create_budget_allocation()` - Create new budget allocation for hostel
- `update_budget_allocation()` - Update existing budget allocation
- `list_category_budgets_for_hostel()` - List all category budgets for hostel
- `create_category_budget()` - Create category-specific budget
- `get_category_budget_status()` - Get detailed budget status for specific category
- `get_expense_report()` - Generate comprehensive expense report
- `get_monthly_expenses()` - Get month-by-month expense breakdown
- `get_cost_analysis()` - Generate detailed cost analysis with trends
- `record_vendor_invoice()` - Record vendor invoice for maintenance work
- `get_vendor_invoices()` - Get all invoices for vendor

---

## 6. **MaintenanceRequestService**
**File:** `maintenance_request_service.py`

**Purpose:** Handles complete lifecycle of maintenance requests with validation and performance

### Key Functions:
- `create_resident_request()` - Create maintenance request submitted by resident
- `create_supervisor_submission()` - Create maintenance request submitted by supervisor
- `create_emergency_request()` - Create high-priority emergency maintenance request
- `get_request()` - Get detailed information for specific maintenance request
- `list_requests_for_hostel()` - List maintenance requests for hostel with filtering
- `get_requests_by_status()` - Get maintenance requests filtered by status
- `get_overdue_requests()` - Get overdue maintenance requests for hostel

---

## 7. **MaintenanceScheduleService**
**File:** `maintenance_schedule_service.py`

**Purpose:** Manages preventive maintenance schedules with intelligent scheduling

### Key Functions:
- `create_schedule()` - Create new preventive maintenance schedule
- `update_schedule()` - Update existing preventive maintenance schedule
- `get_schedule()` - Get specific preventive maintenance schedule
- `delete_schedule()` - Delete or deactivate preventive maintenance schedule
- `list_schedules_for_hostel()` - List all preventive maintenance schedules for hostel
- `get_due_schedules()` - Get schedules that are due or upcoming
- `get_overdue_schedules()` - Get all overdue preventive maintenance schedules
- `record_execution()` - Record execution of preventive maintenance schedule
- `update_execution()` - Update execution record
- `get_history_for_schedule()` - Get execution history for schedule with analytics
- `get_compliance_report()` - Generate compliance report for schedules
- `get_schedule_performance_metrics()` - Get performance metrics for specific schedule

---

## 8. **MaintenanceVendorService**
**File:** `maintenance_vendor_service.py`

**Purpose:** Comprehensive vendor management for maintenance operations

### Key Functions:
- `create_vendor()` - Register new maintenance vendor
- `update_vendor()` - Update vendor information
- `get_vendor()` - Get vendor details
- `delete_vendor()` - Delete or deactivate vendor
- `list_vendors_for_hostel()` - List vendors for hostel with filtering
- `search_vendors_by_capability()` - Search vendors by specific capability
- `get_top_rated_vendors()` - Get top-rated vendors for hostel
- `list_contracts_for_vendor()` - List all contracts for vendor
- `create_contract()` - Create new vendor contract
- `get_expiring_contracts()` - Get contracts expiring within specified days
- `list_performance_reviews_for_vendor()` - List performance reviews for vendor
- `create_performance_review()` - Create vendor performance review
- `get_vendor_performance_summary()` - Get comprehensive performance summary
- `suspend_vendor()` - Suspend vendor temporarily
- `reactivate_vendor()` - Reactivate suspended or inactive vendor

---

## 9. **PredictiveMaintenanceService**
**File:** `predictive_maintenance_service.py`

**Purpose:** Uses historical analytics for risk assessment and predictive maintenance

### Key Functions:
- `get_risk_assessment_for_hostel()` - Perform comprehensive risk assessment for maintenance
- `get_category_risk_assessment()` - Assess risk for specific maintenance category
- `recommend_preventive_actions()` - Generate preventive maintenance action recommendations
- `predict_equipment_failures()` - Predict potential equipment failures based on patterns
- `optimize_maintenance_schedule()` - Analyze patterns and suggest schedule optimizations

---

## **Summary of Class Responsibilities:**

| **Service Class** | **Primary Responsibility** |
|------------------|----------------------------|
| **MaintenanceAnalyticsService** | Analytics, metrics, performance reporting |
| **MaintenanceApprovalService** | Approval workflows, threshold management |
| **MaintenanceAssignmentService** | Task assignments, workload management |
| **MaintenanceCompletionService** | Work completion, quality checks, certificates |
| **MaintenanceCostService** | Cost tracking, budgets, expense management |
| **MaintenanceRequestService** | Request lifecycle, creation, retrieval |
| **MaintenanceScheduleService** | Preventive maintenance scheduling |
| **MaintenanceVendorService** | Vendor management, contracts, performance |
| **PredictiveMaintenanceService** | Risk assessment, failure prediction |

Each service class acts as a **high-level orchestration layer** that:
- Validates input data
- Coordinates with repositories for data persistence
- Implements business logic and rules
- Provides comprehensive error handling
- Generates insights and recommendations

===============================================================================================================================

# Mess Services - Complete Class Overview

## 1. `dietary_option_service.py`

### **DietaryOptionService**
**Purpose**: Manages hostel-level dietary configurations and student dietary preferences

**Key Functions**:
- `get_hostel_dietary_options()` - Get hostel dietary config (veg/non-veg/vegan options)
- `set_hostel_dietary_options()` - Configure hostel dietary policies
- `get_student_preferences()` - Get student's dietary preferences
- `set_student_preferences()` - Set/update student dietary preferences
- `bulk_get_student_preferences()` - Get preferences for multiple students
- `get_allergen_profile()` - Get student's allergen information
- `set_allergen_profile()` - Set/update allergen profile
- `list_restrictions_for_student()` - Get all dietary restrictions for student
- `add_restriction()` - Add new dietary restriction
- `remove_restriction()` - Remove dietary restriction
- `bulk_add_restrictions()` - Add multiple restrictions at once
- `list_customizations_for_student()` - Get meal customizations
- `create_customization()` - Create meal customization
- `delete_customization()` - Remove customization
- `get_hostel_dietary_summary()` - Analytics on dietary preferences

---

## 2. `meal_item_service.py`

### **MealItemService**
**Purpose**: Manages meal items, categories, ingredients, and popularity tracking

**Key Functions**:
- `create_item()` - Create new meal item
- `get_item()` - Get meal item details
- `update_item()` - Update meal item
- `delete_item()` - Delete meal item
- `list_items_for_hostel()` - List all items for hostel
- `bulk_create_items()` - Create multiple items
- `bulk_update_items()` - Update multiple items
- `list_categories()` - Get item categories
- `create_category()` - Create new category
- `get_category()` - Get category details
- `list_allergens_for_item()` - Get allergens for item
- `add_allergen_to_item()` - Add allergen to item
- `remove_allergen_from_item()` - Remove allergen from item
- `get_item_popularity()` - Get popularity metrics
- `get_popular_items()` - Get most popular items
- `update_item_popularity()` - Update popularity stats
- `search_items()` - Search items by name/description
- `filter_items_by_dietary_preferences()` - Filter by dietary needs

---

## 3. `menu_approval_service.py`

### **MenuApprovalService**
**Purpose**: Handles menu approval workflows and multi-level approvals

**Key Functions**:
- `submit_for_approval()` - Submit menu for approval
- `resubmit_for_approval()` - Resubmit rejected menu
- `approve_menu()` - Approve a menu
- `reject_menu()` - Reject menu with reason
- `bulk_approve()` - Approve multiple menus
- `bulk_reject()` - Reject multiple menus
- `get_workflow_for_menu()` - Get approval workflow status
- `get_approval_history_for_menu()` - Get complete approval history
- `get_pending_approvals_for_user()` - Get pending approvals for approver
- `get_approval_statistics()` - Get approval analytics

---

## 4. `menu_feedback_service.py`

### **MenuFeedbackService**
**Purpose**: Manages feedback collection, ratings, and quality analytics

**Key Functions**:
- `submit_feedback()` - Submit menu feedback
- `update_feedback()` - Update existing feedback
- `delete_feedback()` - Remove feedback
- `get_feedback()` - Get specific feedback
- `get_feedback_for_menu()` - Get all feedback for menu
- `get_student_feedback_for_menu()` - Get student's feedback for menu
- `get_ratings_summary()` - Get aggregated ratings
- `get_item_ratings()` - Get item-level ratings
- `get_quality_metrics()` - Get quality metrics for period
- `get_quality_trends()` - Get quality trends over time
- `get_feedback_analysis()` - Comprehensive feedback analysis
- `get_sentiment_analysis()` - Sentiment analysis of comments
- `compare_menus()` - Compare feedback across menus

---

## 5. `menu_planning_service.py`

### **MenuPlanningService**
**Purpose**: Orchestrates menu planning with templates and AI suggestions

**Key Functions**:
- `create_template()` - Create menu template
- `get_template()` - Get template details
- `update_template()` - Update template
- `delete_template()` - Delete template
- `list_templates_for_hostel()` - List all templates
- `search_templates()` - Search templates
- `create_weekly_plan()` - Create weekly menu plan
- `get_weekly_plan()` - Get weekly plan
- `update_weekly_plan()` - Update weekly plan
- `generate_weekly_plan_from_template()` - Generate from template
- `create_monthly_plan()` - Create monthly plan
- `get_monthly_plan()` - Get monthly plan
- `update_monthly_plan()` - Update monthly plan
- `generate_plan_from_request()` - AI-powered plan generation
- `create_daily_plan()` - Create daily plan
- `get_daily_plan()` - Get daily plan
- `get_daily_plans_for_range()` - Get plans for date range
- `create_special_menu()` - Create special occasion menu
- `get_special_menu()` - Get special menu
- `list_special_menus_for_hostel()` - List special menus
- `update_special_menu()` - Update special menu
- `delete_special_menu()` - Delete special menu
- `get_menu_suggestions()` - Get AI menu suggestions
- `generate_suggestions()` - Generate suggestions for date range
- `accept_suggestion()` - Accept and convert suggestion to plan
- `reject_suggestion()` - Reject suggestion
- `get_plan_coverage_report()` - Analytics on plan coverage
- `get_variety_analysis()` - Menu variety analysis
- `get_cost_analysis()` - Cost analysis

---

## 6. `mess_inventory_service.py`

### **MessInventoryService**
**Purpose**: Manages ingredient inventory, stock levels, and forecasting

**Key Functions**:
- `list_ingredients_for_hostel()` - List all ingredients
- `get_ingredient()` - Get ingredient details
- `create_ingredient()` - Add new ingredient
- `update_ingredient()` - Update ingredient
- `delete_ingredient()` - Remove ingredient
- `adjust_stock()` - Adjust stock levels (±)
- `bulk_adjust_stock()` - Bulk stock adjustments
- `record_purchase()` - Record ingredient purchase
- `record_consumption()` - Record ingredient usage
- `record_waste()` - Record waste/spoilage
- `get_low_stock_items()` - Get low stock ingredients
- `get_critical_stock_items()` - Get critically low stock
- `get_expiring_items()` - Get ingredients expiring soon
- `get_stock_valuation()` - Calculate total stock value
- `get_consumption_report()` - Consumption analytics
- `get_waste_report()` - Waste analytics
- `get_purchase_history()` - Purchase history for ingredient
- `forecast_stock_requirements()` - AI-powered stock forecasting
- `get_reorder_suggestions()` - Reorder recommendations

---

## 7. `mess_menu_service.py`

### **MessMenuService**
**Purpose**: Manages daily mess menus with CRUD and publishing workflows

**Key Functions**:
- `create_menu()` - Create new daily menu
- `get_menu()` - Get menu by ID
- `update_menu()` - Update menu
- `delete_menu()` - Delete menu
- `get_menu_by_date()` - Get menu for specific date
- `get_today_menu_for_hostel()` - Get today's menu with details
- `get_weekly_menu_for_hostel()` - Get week's menus
- `list_daily_summaries_for_month()` - Monthly menu summaries
- `get_menus_for_date_range()` - Get menus for date range
- `publish_menu()` - Publish menu to students
- `unpublish_menu()` - Hide menu from students
- `bulk_publish_menus()` - Publish multiple menus
- `bulk_unpublish_menus()` - Unpublish multiple menus
- `duplicate_menu()` - Copy menu to new date
- `copy_menu_to_week()` - Copy menu to multiple days
- `get_menu_statistics()` - Menu analytics
- `get_publication_history()` - Publication history
- `get_unpublished_menus()` - Get draft/unpublished menus

---

## 8. `nutritional_info_service.py`

### **NutritionalInfoService**
**Purpose**: Handles nutritional analysis, RDA compliance, and health tracking

**Key Functions**:
- `get_nutritional_info_for_item()` - Get nutrition for menu item
- `create_nutritional_info()` - Add nutrition data for item
- `update_nutritional_info()` - Update nutrition data
- `bulk_update_nutritional_info()` - Update multiple items
- `get_nutritional_report_for_menu()` - Complete menu nutrition report
- `get_nutritional_report_for_period()` - Period nutrition analysis
- `get_meal_type_breakdown()` - Nutrition by meal (breakfast/lunch/dinner)
- `analyze_nutritional_balance()` - Balance analysis against guidelines
- `check_dietary_compliance()` - Check against dietary requirements
- `get_nutritional_trends()` - Nutrition trends over time
- `compare_menus_nutritionally()` - Nutritional comparison across menus

---

## **Service Architecture Summary**

Each service follows the **same pattern**:
1. **Repository Injection** - Takes repository dependencies in constructor
2. **Business Logic** - Handles validation, orchestration, and complex operations
3. **Error Handling** - Consistent exception handling and validation
4. **Analytics** - Provides reporting and trend analysis
5. **Batch Operations** - Supports bulk operations for efficiency

**Dependencies**: All services depend on their respective repositories and use common schemas for data transfer.

===============================================================================================================================

# Complete Class Structure Overview - Notification Services

## 1. `device_token_service.py`

### **DeviceTokenService**
**Purpose**: Manages device tokens for push notifications
**Key Functions**:
- `register_device()` - Register new device tokens
- `unregister_device()` - Remove/deactivate device tokens
- `list_devices_for_user()` - Get all devices for a user
- `get_device()` - Get device by token
- `register_devices_bulk()` - Batch register multiple devices
- `get_active_device_count()` - Count active devices

---

## 2. `email_notification_service.py`

### **EmailNotificationService**
**Purpose**: Orchestrates email notification creation and scheduling
**Key Functions**:
- `send_email()` - Send single email notification
- `send_bulk_email()` - Send batch email notifications
- `get_email_stats_for_hostel()` - Get email statistics
- `get_email_status()` - Check delivery status
- `cancel_scheduled_email()` - Cancel pending emails

---

## 3. `in_app_notification_service.py`

### **InAppNotificationService**
**Purpose**: Manages in-app notifications with real-time delivery
**Key Functions**:
- `create_notification()` - Create new in-app notification
- `update_notification()` - Update existing notification
- `list_notifications_for_user()` - Get user's notifications with filtering
- `get_notification()` - Get detailed notification
- `mark_as_read()` - Mark single notification as read
- `mark_bulk_as_read()` - Mark multiple notifications as read
- `mark_all_as_read()` - Mark all unread as read
- `get_unread_count()` - Get unread count
- `delete_notification()` - Delete notification
- `cleanup_old_notifications()` - Clean up old notifications

---

## 4. `notification_preference_service.py`

### **NotificationPreferenceService**
**Purpose**: Manages user notification preferences and unsubscribe flows
**Key Functions**:
- `get_preferences()` - Get user's notification preferences
- `set_preferences()` - Set complete preferences
- `update_preferences()` - Update partial preferences
- `process_unsubscribe()` - Handle unsubscribe requests
- `generate_unsubscribe_token()` - Generate secure unsubscribe tokens
- `get_preference_summary()` - Get preference overview

---

## 5. `notification_queue_service.py`

### **NotificationQueueService**
**Purpose**: Manages notification processing queue with worker coordination
**Key Functions**:
- `enqueue_notification()` - Add notification to queue
- `dequeue_for_worker()` - Get items for worker processing
- `mark_processed()` - Mark item as successfully processed
- `mark_failed()` - Mark item as failed with retry logic
- `get_queue_status()` - Get current queue status
- `get_queue_stats()` - Get processing statistics
- `get_queue_health()` - Check queue health
- `register_worker()` - Register worker with system
- `heartbeat_worker()` - Update worker heartbeat
- `cleanup_stale_items()` - Clean stuck items

---

## 6. `notification_routing_service.py`

### **NotificationRoutingService**
**Purpose**: Evaluates routing rules and manages escalation paths
**Key Functions**:
- `get_routing_config_for_hostel()` - Get routing configuration
- `update_routing_config()` - Update routing rules
- `route_notification()` - Compute routing for notifications
- `test_routing_rule()` - Test rule against sample data
- `get_routing_analytics()` - Get routing performance analytics

**Internal Helper Methods**:
- `_evaluate_rule_conditions()` - Check if rule matches context
- `_find_matching_rule()` - Find applicable routing rule
- `_build_route_from_rule()` - Build route from matched rule
- `_build_escalation_path()` - Create escalation sequence

---

## 7. `notification_service.py` (Main Facade)

### **NotificationService**
**Purpose**: Unified API coordinating all notification channels
**Key Functions**:
- `send_notification()` - Main entry point for sending notifications
- `get_notification_detail()` - Get comprehensive notification details
- `send_bulk_notifications()` - Send multiple notifications efficiently
- `get_notification_analytics()` - Get cross-channel analytics

**Internal Helper Methods**:
- `_create_in_app_notification()` - Create primary notification
- `_process_immediate_channels()` - Handle real-time channels
- `_process_queued_channels()` - Handle async channels
- `_send_email_notification()` - Send via email service
- `_send_sms_notification()` - Send via SMS service
- `_send_push_notification()` - Send via push service
- `_schedule_escalation()` - Set up escalation timers

---

## 8. `notification_template_service.py`

### **NotificationTemplateService**
**Purpose**: Manages templates with versioning and rendering
**Key Functions**:
- `create_template()` - Create new template
- `update_template()` - Update existing template
- `delete_template()` - Delete template
- `list_templates()` - Get templates with filtering
- `list_templates_by_category()` - Get categorized templates
- `preview_template()` - Render template preview
- `test_template_rendering()` - Test with multiple variables
- `copy_template()` - Copy existing template
- `get_template_versions()` - Get version history
- `restore_template_version()` - Restore previous version

**Internal Helper Methods**:
- `_validate_template_content()` - Validate template structure
- `_check_template_security()` - Security validation
- `_create_template_version()` - Create version backup

---

## 9. `push_notification_service.py`

### **PushNotificationService**
**Purpose**: Handles platform-optimized push notifications
**Key Functions**:
- `send_push()` - Send single push notification
- `send_bulk_push()` - Send batch push notifications
- `list_devices_for_user()` - Get user's devices
- `cleanup_inactive_devices()` - Remove stale devices
- `get_push_stats_for_hostel()` - Get push statistics
- `get_push_delivery_status()` - Check delivery status
- `retry_failed_push()` - Retry failed notifications
- `test_device_connectivity()` - Test device reachability
- `get_push_analytics()` - Get comprehensive analytics

**Internal Helper Methods**:
- `_optimize_payload_for_platform()` - Platform-specific optimization
- `_get_active_device_tokens_for_users()` - Batch device retrieval
- `_validate_device_tokens()` - Filter valid tokens

**Enums**:
- `PushPriority` - Priority levels (LOW, NORMAL, HIGH, CRITICAL)
- `DeviceType` - Device types (IOS, ANDROID, WEB)

---

## 10. `sms_notification_service.py`

### **SMSNotificationService**
**Purpose**: Handles SMS with cost optimization and multi-provider support
**Key Functions**:
- `send_sms()` - Send single SMS
- `send_bulk_sms()` - Send batch SMS with cost control
- `get_sms_stats_for_hostel()` - Get SMS statistics
- `get_sms_delivery_status()` - Check delivery status
- `retry_failed_sms()` - Retry with alternate provider
- `estimate_bulk_sms_cost()` - Cost estimation
- `get_provider_status()` - Provider health check
- `optimize_message_for_cost()` - Message optimization

**Internal Helper Methods**:
- `_validate_phone_number()` - Validate/normalize phone numbers
- `_analyze_message_content()` - Analyze segments and encoding
- `_optimize_message_content()` - Reduce message cost
- `_estimate_sms_cost()` - Calculate costs

**Enums**:
- `SMSPriority` - Priority levels (LOW, NORMAL, HIGH, URGENT)
- `SMSProvider` - Providers (TWILIO, AWS_SNS, TEXTLOCAL, MSG91)

---

## 11. `__init__.py`

### **Utility Functions (No Classes)**
**Purpose**: Package initialization and service management
**Key Functions**:
- `create_service_factory()` - Create service factory with config
- `validate_service_dependencies()` - Check dependency satisfaction
- `get_initialization_order()` - Get correct init order
- `create_all_services()` - Initialize all services properly

**Constants**:
- `SERVICE_REGISTRY` - Mapping of service names to classes
- `SERVICE_DEPENDENCIES` - Service dependency graph
- `SERVICE_CONFIG` - Default configuration for all services

---

## Summary by Responsibility

### **Core Business Logic Classes:**
- `NotificationService` - Main orchestrator
- `NotificationRoutingService` - Routing and escalation logic

### **Channel-Specific Classes:**
- `InAppNotificationService` - In-app notifications
- `EmailNotificationService` - Email delivery
- `SMSNotificationService` - SMS delivery with cost optimization
- `PushNotificationService` - Push notifications with platform optimization

### **Supporting Classes:**
- `DeviceTokenService` - Device management
- `NotificationPreferenceService` - User preferences
- `NotificationTemplateService` - Template management
- `NotificationQueueService` - Queue processing

### **Infrastructure:**
- Package utilities in `__init__.py` for dependency injection and service factory patterns

Each service is designed to be independent with clear boundaries, comprehensive validation, error handling, and performance optimizations.

===============================================================================================================================

# Payment Services Module - Complete Class Breakdown

## 1. **payment_fraud_service.py**

### **PaymentFraudService**
**Purpose:** Fraud detection and risk assessment for payment transactions

**Key Functions:**
- `assess_transaction_risk()` - Calculate risk score using multiple factors
- `create_security_event_if_suspicious()` - Create security events for high-risk payments
- `assess_batch_risk()` - Assess risk for multiple payments
- `get_fraud_statistics()` - Generate fraud analytics and statistics

---

## 2. **payment_gateway_service.py**

### **GatewayClient** (Protocol)
**Purpose:** Interface definition for gateway implementations

**Key Functions:**
- `initiate_payment()` - Start payment with gateway
- `verify_payment()` - Verify payment status with gateway
- `refund_payment()` - Process refunds through gateway

### **PaymentGatewayService**
**Purpose:** Gateway orchestration and transaction management

**Key Functions:**
- `initiate_online_payment()` - Start online payment flow
- `handle_callback()` - Process browser redirects from gateway
- `handle_webhook()` - Process server-to-server notifications
- `verify_payment_with_gateway()` - Verify payment status
- `initiate_gateway_refund()` - Start refund process with gateway

---

## 3. **payment_ledger_service.py**

### **PaymentLedgerService**
**Purpose:** Financial ledger management and account statements

**Key Functions:**
- `get_account_statement_for_student()` - Generate student account statements
- `get_account_statement_for_hostel()` - Generate hostel account statements
- `apply_balance_adjustment()` - Apply manual balance corrections
- `reverse_balance_adjustment()` - Reverse previous adjustments
- `apply_write_off()` - Write off uncollectible amounts
- `get_current_balance()` - Get current account balance
- `get_receivables_summary()` - Get accounts receivable summary

---

## 4. **payment_reconciliation_service.py**

### **PaymentReconciliationService**
**Purpose:** Reconcile internal payments with gateway transactions

**Key Functions:**
- `reconcile_for_date()` - Reconcile payments for specific date
- `reconcile_for_date_range()` - Reconcile payments for date range
- `mark_discrepancy_resolved()` - Mark discrepancies as resolved
- `get_unresolved_discrepancies()` - Get list of unresolved issues
- `generate_reconciliation_report()` - Generate comprehensive reports
- `_auto_correct_discrepancies()` - Auto-fix reconcilable differences

---

## 5. **payment_refund_service.py**

### **PaymentRefundService**
**Purpose:** Complete refund lifecycle management

**Key Functions:**
- `request_refund()` - Create refund request with validation
- `approve_refund()` - Approve and process refund
- `reject_refund()` - Reject refund with reason
- `list_refunds_for_payment()` - Get all refunds for a payment
- `list_pending_refunds()` - Get pending refunds for approval
- `bulk_approve_refunds()` - Approve multiple refunds at once

---

## 6. **payment_reminder_service.py**

### **PaymentReminderService**
**Purpose:** Payment reminder configuration and delivery

**Key Functions:**
- `set_reminder_config()` - Configure reminder settings per hostel
- `get_reminder_config()` - Get reminder configuration
- `send_reminders()` - Send reminders to specific payments/criteria
- `process_automated_reminders()` - Run scheduled reminder processing
- `get_reminders_for_payment()` - Get reminder history for payment
- `get_reminder_statistics()` - Get reminder delivery statistics

---

## 7. **payment_reporting_service.py**

### **PaymentReportingService**
**Purpose:** Payment analytics and reporting

**Key Functions:**
- `get_payment_report()` - Generate grouped/aggregated reports
- `get_payment_analytics()` - Get comprehensive payment analytics
- `get_payment_trends()` - Analyze payment trends over time
- `generate_custom_report()` - Create custom reports with configuration
- `export_report()` - Export reports in various formats (JSON, CSV, Excel)

---

## 8. **payment_schedule_service.py**

### **PaymentScheduleService**
**Purpose:** Recurring payment schedule management

**Key Functions:**
- `create_schedule()` - Create new payment schedule
- `update_schedule()` - Modify existing schedule
- `suspend_schedule()` - Temporarily suspend schedule
- `resume_schedule()` - Resume suspended schedule
- `deactivate_schedule()` - Permanently deactivate schedule
- `generate_payments()` - Generate actual payments from schedule
- `generate_payments_for_all_due()` - Batch generate all due payments
- `bulk_create_schedules()` - Create schedules for multiple students
- `preview_schedule_payments()` - Preview upcoming scheduled payments

---

## 9. **payment_service.py**

### **PaymentService**
**Purpose:** Core payment operations and CRUD

**Key Functions:**
- `record_manual_payment()` - Record offline payments (cash, cheque, etc.)
- `get_payment()` - Retrieve single payment by ID
- `get_payment_by_reference()` - Get payment by reference number
- `list_payments_for_student()` - List student payments with filtering
- `list_payments_for_hostel()` - List hostel payments with filtering
- `mark_payment_status()` - Update payment status
- `bulk_update_status()` - Update status for multiple payments
- `get_student_payment_summary()` - Get payment summary for student
- `get_hostel_payment_summary()` - Get payment summary for hostel
- `cancel_payment()` - Cancel pending payments

---

## 10. **__init__.py**
**Purpose:** Package initialization and exports
- No classes, only imports and exports of all service classes

---

# **Service Dependencies & Integration:**

## **Core Flow:**
1. **PaymentService** - Entry point for basic payment operations
2. **PaymentGatewayService** - Handles online payment processing
3. **PaymentLedgerService** - Records all financial transactions
4. **PaymentReconciliationService** - Ensures data consistency

## **Business Logic:**
1. **PaymentScheduleService** - Automates recurring payments
2. **PaymentRefundService** - Handles refund workflows
3. **PaymentReminderService** - Manages payment notifications

## **Analytics & Security:**
1. **PaymentReportingService** - Provides business insights
2. **PaymentFraudService** - Ensures transaction security

Each service operates independently but can be orchestrated together for complete payment workflow management in a hostel management system.

===============================================================================================================================

# Referral Services - Complete Class Structure

## 1. **referral_code_service.py**

### **ReferralCodeService**
**Purpose**: Manages the complete lifecycle of referral codes

**Functions**:
- `generate_code()` - Create new referral codes with collision handling
- `validate_code()` - Validate if a code is usable with comprehensive checks
- `list_codes_for_user()` - Get all codes owned by a user with pagination
- `get_code_stats()` - Get detailed statistics for a specific code
- `deactivate_code()` - Deactivate a referral code
- `reactivate_code()` - Reactivate a previously deactivated code
- `_validate_generation_request()` - Private validation for code generation

---

## 2. **referral_program_service.py**

### **ReferralProgramService** 
**Purpose**: Manages referral program definitions, analytics, and performance tracking

**Functions**:
- `create_program()` - Create new referral programs with validation
- `update_program()` - Update existing program details
- `delete_program()` - Soft delete programs (with active referral checks)
- `get_program()` - Retrieve specific program by ID
- `list_programs()` - List programs with filtering and pagination
- `get_program_stats()` - Get aggregated statistics for a program
- `get_program_analytics()` - Get detailed analytics with trends
- `compare_programs()` - Compare multiple programs across metrics
- `activate_program()` - Activate a referral program
- `deactivate_program()` - Deactivate a referral program
- `_validate_program_create()` - Private validation for program creation
- `_validate_program_update()` - Private validation for program updates
- `_validate_date_range()` - Private date range validation

---

## 3. **referral_reward_service.py**

### **ReferralRewardService**
**Purpose**: Manages referral rewards, payouts, and reward tracking with multi-tier calculations

**Functions**:
- `get_reward_config()` - Retrieve reward configuration (global or per program)
- `update_reward_config()` - Update reward configuration settings
- `calculate_reward_for_referral()` - Calculate rewards for a single referral
- `apply_reward_for_referral()` - Apply calculated reward and update balances
- `get_reward_tracking_for_user()` - Get or create reward tracking for a user
- `create_payout_request()` - Create payout requests with validation
- `approve_or_reject_payout()` - Process payout requests (approve/reject)
- `cancel_payout_request()` - Cancel pending payout requests
- `get_payout_history_for_user()` - Get user's payout history with pagination
- `get_reward_summary()` - Get aggregated reward summary over time periods
- `_get_default_reward_config()` - Private method for default configuration
- `_validate_reward_config()` - Private reward configuration validation
- `_validate_payout_request()` - Private payout request validation
- `_validate_payout_limits()` - Private payout limits validation
- `_approve_payout()` - Private payout approval logic
- `_reject_payout()` - Private payout rejection logic
- `_validate_date_range()` - Private date range validation
- `_get_empty_reward_summary()` - Private method for empty summary defaults

---

## 4. **referral_service.py**

### **ReferralService**
**Purpose**: Core referral lifecycle management including creation, conversions, and analytics

**Functions**:
- `create_referral()` - Create new referrals with comprehensive validation
- `update_referral()` - Update existing referral details
- `cancel_referral()` - Cancel referrals with reason tracking
- `record_conversion()` - Mark referrals as converted (idempotent)
- `get_referral()` - Get detailed referral information
- `list_referrals_for_program()` - List referrals by program with filtering
- `list_referrals_for_user()` - List referrals by user (referrer/referee role)
- `get_user_stats()` - Get comprehensive referral statistics for users
- `get_leaderboard()` - Get referral leaderboard with top performers
- `get_referral_analytics()` - Get detailed analytics with trends
- `get_referral_timeline()` - Get chronological timeline of referral events
- `_validate_referral_create()` - Private referral creation validation
- `_validate_referral_update()` - Private referral update validation
- `_validate_conversion_request()` - Private conversion validation
- `_validate_status_transition()` - Private status transition validation
- `_validate_pagination()` - Private pagination validation
- `_validate_date_range()` - Private date range validation
- `_is_duplicate_referral()` - Private duplicate referral check
- `_get_empty_user_stats()` - Private method for empty user stats

---

## 5. **__init__.py**

### **No Classes - Only Functions**

**Functions**:
- `create_referral_services()` - Factory function to create all referral services with proper dependency injection

---

## **Summary by Service Responsibility**

| Service | Primary Purpose | Key Operations |
|---------|----------------|----------------|
| **ReferralCodeService** | Code Management | Generate, Validate, Track, Manage codes |
| **ReferralProgramService** | Program Management | Create, Update, Analytics, Performance tracking |
| **ReferralRewardService** | Reward & Payout Management | Calculate, Track, Process payouts |
| **ReferralService** | Core Referral Operations | Create, Convert, Track, Analytics |

Each service follows the same pattern:
- **Public methods** for business operations
- **Private methods** (prefixed with `_`) for validation and internal logic
- **Comprehensive error handling** with custom exceptions
- **Structured logging** for audit trails
- **Repository delegation** for data operations

=================================================================================================================================
# Complete Class Overview - Reporting Services

## 1. ComplianceReportService (`compliance_report_service.py`)

### **Class: ComplianceReportService**
**Purpose**: Generates compliance and security audit reports for regulatory frameworks (GDPR, SOC2, etc.)

**Key Methods**:
- `generate_compliance_report()` - Creates compliance-focused reports
- `generate_security_audit_report()` - Creates security audit reports  
- `generate_full_audit_report()` - Combines compliance + security reports
- `_validate_date_range()` - Validates input date ranges
- `_generate_trends()` - Calculates trend analysis
- `_generate_insights()` - Generates findings and recommendations

---

## 2. CustomReportService (`custom_report_service.py`)

### **Class: CustomReportService**
**Purpose**: Handles user-defined custom reports - creation, execution, caching, and history management

**Key Methods**:
- `create_definition()` - Creates new custom report definitions
- `update_definition()` - Updates existing report definitions
- `delete_definition()` - Deletes report definitions
- `list_definitions_for_owner()` - Lists user's report definitions
- `run_report()` - Executes ad-hoc custom reports
- `run_saved_report()` - Executes saved report definitions
- `get_cached_result()` - Retrieves cached report results
- `invalidate_cached_results()` - Clears cached results
- `_validate_report_request()` - Validates report requests
- `_validate_cache_freshness()` - Checks cache validity

---

## 3. FinancialReportService (`financial_report_service.py`)

### **Class: FinancialReportService**
**Purpose**: Generates financial reports including P&L statements, cashflow summaries, and comprehensive financial analysis

**Key Methods**:
- `get_profit_and_loss()` - Generates P&L statements
- `get_cashflow_summary()` - Creates cashflow analysis
- `get_financial_report()` - Comprehensive financial reports (P&L + cashflow + ratios)
- `get_comparative_analysis()` - Compares two periods
- `_validate_date_range()` - Validates financial report date ranges
- `_validate_hostel_id()` - Validates hostel identifiers
- `_calculate_comparative_metrics()` - Calculates variance and growth metrics

---

## 4. OperationalReportService (`operational_report_service.py`)

### **Class: OperationalReportService**
**Purpose**: Aggregates operational data from multiple sources (bookings, complaints, occupancy, team performance) into unified reports

**Key Methods**:
- `get_operational_report()` - Creates comprehensive operational reports
- `get_performance_summary()` - Generates quick performance summaries
- `_validate_inputs()` - Validates operational report inputs
- `_get_booking_analytics()` - Fetches booking data
- `_get_complaint_analytics()` - Fetches complaint data
- `_get_occupancy_analytics()` - Fetches occupancy data
- `_get_team_analytics()` - Fetches team performance data
- `_calculate_key_metrics()` - Calculates KPIs from analytics
- `_calculate_trends()` - Generates trend analysis
- `_generate_recommendations()` - Creates actionable recommendations

---

## 5. ReportExportService (`report_export_service.py`)

### **Class: ReportExportService**
**Purpose**: Exports report results to various formats (JSON, CSV, Excel, PDF) with compression and formatting options

**Key Methods**:
- `export_custom_report()` - Main export method for all formats
- `get_export_filename()` - Generates appropriate filenames
- `_validate_export_request()` - Validates export requests
- `_export_to_json()` - Exports to JSON format
- `_export_to_excel()` - Exports to Excel format
- `_export_to_pdf()` - Exports to PDF format
- `_export_to_csv()` - Exports to CSV format

---

## 6. ReportSchedulingService (`report_scheduling_service.py`)

### **Class: ReportSchedulingService**
**Purpose**: Manages scheduled execution of custom reports with automated scheduling, execution tracking, and failure handling

**Key Methods**:
- `create_schedule()` - Creates new report schedules
- `update_schedule()` - Updates existing schedules
- `delete_schedule()` - Deletes schedules
- `list_schedules_for_definition()` - Lists schedules for reports
- `run_due_schedules()` - Executes all due schedules (for cron jobs)
- `get_execution_history()` - Retrieves execution history
- `_validate_schedule()` - Validates schedule configurations
- `_calculate_next_run()` - Calculates next execution time
- `_update_schedule_next_run()` - Updates schedule timing
- `_record_execution_failure()` - Records failed executions

---

## 7. ReportService (`report_service.py`)

### **Class: ReportService** 
**Purpose**: Facade service providing unified interface to all reporting functionality - coordinates between specialized services

**Key Methods**:
- `get_financial_report()` - Delegates to FinancialReportService
- `get_profit_and_loss()` - Delegates P&L generation
- `get_cashflow_summary()` - Delegates cashflow generation
- `get_operational_report()` - Delegates to OperationalReportService
- `get_performance_summary()` - Delegates performance summaries
- `get_compliance_report()` - Delegates to ComplianceReportService
- `get_security_audit_report()` - Delegates security audit generation
- `get_full_audit_report()` - Delegates full audit generation
- `run_custom_report()` - Delegates to CustomReportService
- `run_saved_report()` - Delegates saved report execution
- `get_unified_dashboard()` - Combines all report types into single dashboard

---

## 8. Package Init (`__init__.py`)

### **No Classes - Package Configuration**
**Purpose**: Package initialization and exports

**Contains**:
- Import statements for all service classes
- `__all__` list for public API
- Version and author information
- Package documentation

---

## **Summary by Responsibility**

| **Class** | **Primary Function** | **Key Output** |
|-----------|---------------------|----------------|
| `ComplianceReportService` | Regulatory compliance reporting | Audit reports, compliance metrics |
| `CustomReportService` | User-defined reports | Custom report definitions & results |
| `FinancialReportService` | Financial analysis | P&L, cashflow, financial metrics |
| `OperationalReportService` | Operational analytics | KPIs, performance metrics, trends |
| `ReportExportService` | Data export | Files in JSON/CSV/Excel/PDF |
| `ReportSchedulingService` | Automated execution | Scheduled reports, execution history |
| `ReportService` | Unified interface | Coordinated access to all reports |

Each class follows the **single responsibility principle** and includes comprehensive error handling, validation, logging, and performance tracking.

=================================================================================================================================
# Review Services Package - Complete Class Structure

## 1. **review_service.py**
### `ReviewService` - Core Review Management
**Purpose**: Main service for user-facing review operations

**Key Functions**:
- `get_eligibility()` - Check if user can review a hostel
- `get_guidelines()` - Get review writing guidelines
- `submit_review()` - Create new review
- `update_review()` - Edit existing review
- `delete_review()` - Soft delete review
- `get_draft()` - Get saved draft
- `save_draft()` - Save/update draft
- `delete_draft()` - Remove draft
- `get_review()` - Get single review details
- `list_reviews_for_hostel()` - List hostel reviews with filters
- `search_reviews()` - Full-text search reviews
- `get_hostel_summary()` - Get aggregated review stats

---

## 2. **review_moderation_service.py**
### `ReviewModerationService` - Admin Moderation
**Purpose**: Handle admin-side review moderation workflow

**Key Functions**:
- `moderate_review()` - Apply single moderation action
- `flag_review()` - User flagging of inappropriate reviews
- `bulk_moderate()` - Apply action to multiple reviews
- `get_moderation_queue()` - Get pending reviews for moderation
- `get_pending_reviews()` - List individual pending reviews
- `get_moderation_stats()` - Get moderation statistics

---

## 3. **review_voting_service.py**
### `ReviewVotingService` - Helpfulness Voting
**Purpose**: Manage review helpfulness voting system

**Key Functions**:
- `cast_vote()` - Submit or update vote on review
- `remove_vote()` - Remove previously cast vote
- `get_vote_history()` - Get user's voting history
- `get_voting_stats_for_hostel()` - Get hostel voting stats
- `get_review_vote_details()` - Get vote details for specific review

---

## 4. **review_response_service.py**
### `ReviewResponseService` - Owner Responses
**Purpose**: Handle hostel owner responses to reviews

**Key Functions**:
- `create_response()` - Create owner response to review
- `update_response()` - Edit existing response
- `delete_response()` - Remove response
- `get_response_guidelines()` - Get response best practices
- `get_response_stats()` - Get response statistics
- `list_templates()` - Get response templates
- `create_template()` - Create new response template
- `update_template()` - Edit response template
- `delete_template()` - Remove response template

---

## 5. **review_media_service.py**
### `ReviewMediaService` - Media Management
**Purpose**: Handle review media attachments (images/videos)

**Key Functions**:
- `list_media_for_review()` - Get all media for a review
- `attach_media()` - Register media file for review
- `mark_media_processed()` - Update media processing status
- `delete_media()` - Remove media attachment
- `get_processing_stats()` - Get media processing statistics

---

## 6. **review_analytics_service.py**
### `ReviewAnalyticsService` - Analytics & Insights
**Purpose**: Generate review analytics and business insights

**Key Functions**:
- `get_analytics_for_hostel()` - Get comprehensive analytics
- `get_competitor_comparison()` - Compare with competitors
- `get_trends()` - Get trend data over time
- `get_sentiment_analysis()` - Get sentiment metrics

---

## 7. **review_incentive_service.py**
### `ReviewIncentiveService` - Reward System
**Purpose**: Manage review incentives and rewards

**Key Functions**:
- `should_reward_for_review()` - Check if review qualifies for reward
- `award_incentive_for_review()` - Award points for review
- `get_user_reward_summary()` - Get user's reward summary
- `get_reward_history()` - Get user's reward history

---

## 8. **__init__.py**
### No Classes - Package Initialization
**Purpose**: Export all service classes and define package interface

**Content**:
- Imports all service classes
- Defines `__all__` for public API
- Sets package version

---

## Service Dependencies & Flow

```
ReviewService (Core)
├── Uses ReviewModerationService (for moderation checks)
├── Integrates with ReviewMediaService (for attachments)
├── Connects to ReviewIncentiveService (for rewards)
└── Links to ReviewVotingService (for vote counts)

ReviewResponseService
├── Independent service for owner responses
└── Uses templates and guidelines

ReviewAnalyticsService
├── Reads data from all other services
└── Generates insights and reports
```

## Key Design Patterns Used

1. **Service Layer Pattern** - Each class handles specific business logic
2. **Repository Pattern** - Services depend on repository interfaces
3. **Validation Separation** - Private methods handle validation
4. **Caching Strategy** - Performance optimization with cache decorators
5. **Error Handling** - Comprehensive exception management
6. **Rate Limiting** - Fraud prevention in voting and incentives

Each service is designed to be:
- **Independent** - Can work standalone
- **Testable** - Clear dependencies and interfaces  
- **Scalable** - Optimized queries and caching
- **Maintainable** - Single responsibility principle

=================================================================================================================================
# Room Services Classes Overview

## 1. `bed_assignment_service.py`

### **BedAssignmentService**
**Purpose**: Manages assignment of beds to students and high-level bed operations

**Key Functions**:
- `assign_bed()` - Assign a bed to a student with validation
- `release_bed()` - Release (vacate) a bed with condition tracking  
- `swap_beds()` - Swap beds between two students atomically
- `list_assignments_for_bed()` - Get assignment history for a bed
- `list_assignments_for_student()` - Get assignment history for a student
- `get_bed_status()` - Get comprehensive bed status with metrics

---

## 2. `bed_service.py`

### **BedService**
**Purpose**: Core CRUD and read operations for Bed entity

**Key Functions**:
- `create_bed()` - Create a new bed with validation
- `create_beds_batch()` - Create multiple beds in single transaction
- `update_bed()` - Update an existing bed
- `delete_bed()` - Delete a bed (soft delete if supported)
- `get_bed()` - Retrieve a bed by ID
- `list_beds_for_room()` - List all beds in a specific room
- `list_beds_for_hostel()` - List all beds in a hostel with filtering
- `get_available_beds_count()` - Count available beds for room/hostel
- `update_bed_status()` - Update the status of a bed

---

## 3. `room_allocation_service.py`

### **RoomAllocationService**
**Purpose**: Automatic room/bed allocation algorithms and suggestions

**Key Functions**:
- `suggest_allocation_for_booking()` - Suggest optimal room/bed for booking with intelligent scoring
- `reserve_allocation_for_booking()` - Suggest and reserve bed atomically
- `suggest_bulk_allocations()` - Suggest allocations for multiple bookings efficiently

---

## 4. `room_amenity_service.py`

### **RoomAmenityService**
**Purpose**: Manages amenities attached to rooms (furniture, appliances, etc.)

**Key Functions**:
- `list_amenities_for_room()` - List amenities in a room with filtering
- `add_amenity_to_room()` - Add new amenity to room with validation
- `add_amenities_batch()` - Add multiple amenities in single transaction
- `update_amenity()` - Update an existing amenity
- `remove_amenity()` - Remove an amenity from room
- `get_amenity_summary_for_room()` - Get summary statistics of amenities
- `check_amenity_maintenance_needed()` - Check which amenities need maintenance

---

## 5. `room_availability_service.py`

### **RoomAvailabilityService**
**Purpose**: Availability checks and availability calendars

**Key Functions**:
- `check_availability()` - Check availability for hostel/date range
- `get_availability_calendar()` - Build monthly availability calendar for room
- `get_availability_calendar_range()` - Get calendars for date range
- `bulk_check_availability()` - Check availability across multiple hostels
- `get_availability_forecast()` - Generate availability forecast for upcoming days
- `get_room_availability_status()` - Get current availability status for specific room

---

## 6. `room_maintenance_service.py`

### **RoomMaintenanceService**
**Purpose**: Connects rooms/beds with maintenance request/approval/completion flows

**Key Functions**:
- `create_maintenance_request_for_room()` - Create maintenance request for specific room
- `create_maintenance_request_for_bed()` - Create maintenance request for specific bed
- `list_maintenance_requests_for_room()` - List maintenance requests for room
- `list_maintenance_requests_for_hostel()` - List maintenance requests for hostel
- `get_maintenance_summary_for_room()` - Get maintenance summary statistics
- `get_high_priority_maintenance_requests()` - Get high-priority open requests
- `create_bulk_maintenance_requests()` - Create multiple requests in single transaction

---

## 7. `room_pricing_service.py`

### **RoomPricingService**
**Purpose**: Manages room pricing updates and effective price calculations

**Key Functions**:
- `update_room_pricing()` - Update room pricing with validation and history tracking
- `bulk_update_room_pricing()` - Update pricing for multiple rooms
- `get_pricing_history()` - Retrieve pricing history for room
- `calculate_effective_price()` - Calculate effective monthly price using fee structures
- `get_pricing_comparison()` - Compare pricing across multiple rooms
- `get_pricing_analytics()` - Get pricing analytics for hostel over date range

---

## 8. `room_service.py`

### **RoomService**
**Purpose**: Core CRUD and read operations for Room entity

**Key Functions**:
- `create_room()` - Create new room with validation
- `create_rooms_batch()` - Create multiple rooms in single transaction
- `update_room()` - Update an existing room
- `delete_room()` - Delete room (with optional force delete)
- `get_room()` - Retrieve detailed room information
- `list_rooms_for_hostel()` - List rooms in hostel with filtering and pagination
- `get_room_with_beds()` - Retrieve room information including all beds
- `get_room_occupancy_stats()` - Retrieve occupancy statistics for room
- `get_room_financial_summary()` - Retrieve financial summary for room
- `get_hostel_room_summary()` - Get summary statistics for all rooms in hostel

---

## 9. `room_type_service.py`

### **RoomTypeService**
**Purpose**: Manages room type definitions, features, pricing, and comparisons

**Key Functions**:
- `create_room_type()` - Create new room type definition
- `get_room_type()` - Retrieve room type by ID
- `list_room_types_for_hostel()` - List all room types for hostel
- `update_room_type()` - Update room type definition
- `update_room_type_pricing()` - Update pricing attributes for room type
- `delete_room_type()` - Delete room type (with optional force delete)
- `get_room_type_summary()` - Get summary of room types for hostel
- `compare_room_types()` - Compare multiple room types

---

## 10. `__init__.py`
**Purpose**: Package initialization - exports all service classes for easy importing

**No Classes** - Only imports and exports the service classes from other files.

---

## **Summary by Domain**:

- **Core Operations**: RoomService, BedService, RoomTypeService
- **Assignment & Allocation**: BedAssignmentService, RoomAllocationService  
- **Availability & Booking**: RoomAvailabilityService
- **Management**: RoomAmenityService, RoomMaintenanceService
- **Financial**: RoomPricingService

=================================================================================================================================
# Search Services Module - Complete Class Overview

## 1. `search_analytics_service.py`

### **SearchAnalyticsService**
**Purpose:** Generates analytics and insights over search behavior and performance

**Key Functions:**
- `get_analytics()` - Retrieve analytics for a given date range
- `_validate_request()` - Validate analytics request parameters
- `_fetch_analytics_data()` - Fetch data from repository

---

## 2. `search_autocomplete_service.py`

### **SearchAutocompleteService**
**Purpose:** Provides typeahead/autocomplete suggestions for search queries

**Key Functions:**
- `get_suggestions()` - Generate autocomplete suggestions for a prefix
- `_fetch_suggestions()` - Get raw suggestions from repository
- `_parse_suggestions()` - Convert raw data to Suggestion objects
- `_log_autocomplete_async()` - Log autocomplete performance metrics
- `_validate_request()` - Validate autocomplete request parameters

---

## 3. `search_indexing_service.py`

### **SearchIndexingService**
**Purpose:** Coordinates indexing operations for the search backend (SQL/Elasticsearch)

**Key Functions:**
- `index_hostel()` - Index a single hostel by ID
- `index_multiple_hostels()` - Bulk index multiple hostels in batches
- `remove_hostel_from_index()` - Remove a hostel from search index
- `remove_multiple_hostels()` - Remove multiple hostels from index
- `rebuild_full_index()` - Trigger complete index rebuild
- `_validate_hostel_id()` - Validate hostel UUID
- `_validate_batch_size()` - Validate batch processing parameters

---

## 4. `search_optimization_service.py`

### **SearchOptimizationService**
**Purpose:** Analyzes search analytics to suggest ranking tweaks, synonym additions, and filter defaults

**Key Functions:**
- `analyze_and_suggest_optimizations()` - Generate comprehensive optimization recommendations
- `_suggest_synonyms()` - Derive potential synonyms from search patterns
- `_suggest_field_boosts()` - Recommend field weight adjustments for better relevance
- `_suggest_default_filters()` - Propose default filter values based on user behavior
- `_identify_problematic_terms()` - Find zero-result terms needing attention
- `_calculate_quality_score()` - Calculate overall search quality score (0-100)
- `_calculate_term_severity()` - Determine severity level for problematic terms
- `_generate_term_suggestions()` - Generate improvement suggestions for problematic terms

---

## 5. `search_personalization_service.py`

### **SearchPersonalizationService**
**Purpose:** Provides personalization utilities to adjust search behavior per user/visitor

**Key Functions:**
- `personalize_advanced_request()` - Apply personalization to search requests based on visitor history
- `get_personalization_insights()` - Get visitor preference insights without applying them
- `_fetch_visitor_summary()` - Get visitor behavior data from repository
- `_has_sufficient_history()` - Check if visitor has enough interaction history
- `_apply_personalization()` - Apply personalized defaults (city, room types, budget, etc.)
- `_count_personalizations()` - Count how many fields were personalized

---

## 6. `search_service.py`

### **SearchService**
**Purpose:** Core search orchestration for basic, advanced, and nearby searches (backend-agnostic)

**Key Functions:**
- `search_basic()` - Execute basic keyword search
- `search_advanced()` - Execute advanced search with filters and pagination
- `search_nearby()` - Execute geolocation-based nearby search
- `_execute_search()` - Generic search execution wrapper with timing and logging
- `_log_search_async()` - Log search queries for analytics (non-blocking)
- `_validate_basic_request()` - Validate basic search parameters
- `_validate_advanced_request()` - Validate advanced search filters and pagination
- `_validate_nearby_request()` - Validate geolocation parameters

---

## **Summary by Responsibility:**

- **SearchService** → Core search execution and orchestration
- **SearchAutocompleteService** → Typeahead suggestions
- **SearchAnalyticsService** → Search behavior analytics
- **SearchIndexingService** → Search index management
- **SearchOptimizationService** → Search quality improvements
- **SearchPersonalizationService** → User-specific search customization

Each service is designed to be stateless, testable, and backend-agnostic with comprehensive validation and error handling.

=================================================================================================================================
# Student Services Module - Complete Class Overview

## 1. `guardian_contact_service.py`

### **GuardianContactService**
**Purpose:** Manages guardian/parent contacts for students with validation and primary contact management

**Key Functions:**
- `list_guardians()` - Get all guardian contacts for a student
- `get_guardian()` - Get single guardian contact by ID
- `get_primary_guardian()` - Get the primary guardian for a student
- `create_guardian()` - Create new guardian contact
- `update_guardian()` - Update existing guardian contact
- `delete_guardian()` - Delete guardian contact
- `set_primary_guardian()` - Designate a guardian as primary contact
- `ensure_primary_guardian()` - Auto-designate primary if none exists
- `import_guardians()` - Bulk import multiple guardians for a student

---

## 2. `room_transfer_service.py`

### **RoomTransferService**
**Purpose:** Handles student room/bed transfers, swaps, and maintains transfer history with workflow support

**Key Functions:**
- `get_room_history()` - Retrieve comprehensive room history for a student
- `submit_transfer_request()` - Submit room transfer request for approval
- `approve_transfer()` - Approve or reject transfer requests
- `get_transfer_status()` - Get current status of transfer request
- `get_pending_transfers()` - Get all pending transfer requests
- `execute_bulk_transfer()` - Execute multiple transfers (admin operation)
- `request_room_swap()` - Execute room swap between two students
- `get_transfer_statistics()` - Get transfer statistics for a hostel

---

## 3. `student_checkout_service.py`

### **StudentCheckoutService**
**Purpose:** Orchestrates student checkout workflow including clearance, settlements, and account closure

**Key Functions:**
- `checkout_student()` - Execute full checkout workflow
- `emergency_checkout()` - Perform emergency checkout with relaxed requirements
- `get_student_after_checkout()` - Retrieve student details after checkout
- `get_checkout_status()` - Get checkout status and pending requirements
- `submit_clearance()` - Submit clearance for specific department
- `get_clearance_status()` - Get all clearance statuses for student
- `calculate_final_settlement()` - Calculate final financial settlement
- `bulk_checkout()` - Checkout multiple students

---

## 4. `student_communication_service.py`

### **StudentCommunicationService**
**Purpose:** Provides multi-channel communication capabilities for students and guardians

**Key Functions:**
- `get_contact_info()` - Retrieve comprehensive contact information
- `validate_contact_availability()` - Check if communication channel is available
- `send_notification_to_student()` - Send notification to student via multiple channels
- `send_general_notice_to_student()` - Send general informational message (legacy)
- `send_notification_to_guardian()` - Send notification to student's guardians
- `send_notice_to_guardian()` - Send notice to primary guardian (legacy)
- `send_batch_notification()` - Send same notification to multiple recipients
- `send_emergency_notification()` - Send emergency notification via all channels

---

## 5. `student_document_service.py`

### **StudentDocumentService**
**Purpose:** Manages student documents including upload, verification, and expiry tracking

**Key Functions:**
- `get_student_documents()` - Retrieve comprehensive document set for student
- `get_document_info()` - Get single document information
- `get_document_summary_for_student()` - Get student-centric document summary
- `register_uploaded_document()` - Register document after file upload
- `update_document()` - Update document metadata
- `delete_document()` - Delete document record (soft/hard delete)
- `verify_document()` - Verify or reject a document
- `bulk_verify_documents()` - Bulk verify/reject multiple documents
- `get_expiring_documents()` - Get documents expiring within specified days
- `get_expired_documents()` - Get all expired documents
- `extend_document_expiry()` - Extend document expiry date
- `get_document_statistics()` - Get comprehensive document statistics

---

## 6. `student_onboarding_service.py`

### **StudentOnboardingService**
**Purpose:** Orchestrates student onboarding workflow including check-in, room assignment, and setup

**Key Functions:**
- `onboard_from_booking()` - Execute onboarding workflow for confirmed booking
- `quick_check_in()` - Execute quick check-in for walk-in students
- `get_student_after_onboarding()` - Retrieve student details after onboarding
- `get_onboarding_status()` - Get onboarding status and completion checklist
- `complete_onboarding()` - Manually mark onboarding as complete
- `cancel_onboarding()` - Cancel in-progress onboarding
- `bulk_onboard()` - Onboard multiple students from bookings

---

## 7. `student_preference_service.py`

### **StudentPreferenceService**
**Purpose:** Manages student-specific preferences, privacy settings, and notification preferences

**Key Functions:**
- `get_preferences()` - Retrieve student preferences
- `set_preferences()` - Create or completely replace preferences
- `update_preferences()` - Partially update preferences
- `delete_preferences()` - Delete preferences (reset to defaults)
- `get_privacy_settings()` - Retrieve privacy settings
- `set_privacy_settings()` - Create or replace privacy settings
- `update_privacy_settings()` - Partially update privacy settings
- `update_notification_preferences()` - Update notification-specific preferences
- `bulk_update_privacy()` - Bulk update privacy for multiple students

---

## 8. `student_profile_service.py`

### **StudentProfileService**
**Purpose:** Manages extended student profile information beyond core student data

**Key Functions:**
- `get_profile()` - Retrieve student profile by student ID
- `create_profile()` - Create new student profile
- `update_profile()` - Update existing profile
- `upsert_profile()` - Create or update profile (upsert operation)
- `delete_profile()` - Delete student profile
- `get_student_with_profile()` - Get complete student detail including profile
- `check_profile_completeness()` - Analyze profile completeness and missing fields
- `get_incomplete_profiles()` - Get students with incomplete profiles

---

## 9. `student_service.py`

### **StudentService**
**Purpose:** Core CRUD and high-level operations for Student entity with comprehensive data views

**Key Functions:**
- `create_student()` - Create new student record
- `update_student()` - Update existing student record
- `delete_student()` - Delete student record (soft/hard delete)
- `get_student()` - Retrieve comprehensive student details
- `get_student_by_user_id()` - Retrieve student by associated user ID
- `list_students_for_hostel()` - List students for hostel with pagination/filtering
- `search_students()` - Search students by name, email, or registration
- `get_financial_info()` - Retrieve student financial information
- `get_contact_info()` - Retrieve contact information including guardians
- `get_document_info()` - Retrieve student document summary
- `bulk_update_status()` - Update status for multiple students
- `get_hostel_statistics()` - Get comprehensive statistics for hostel's students

---

## **Summary by Responsibility:**

- **StudentService** → Core student CRUD operations and data retrieval
- **StudentProfileService** → Extended profile information management
- **StudentPreferenceService** → Preferences, privacy, and notification settings
- **StudentDocumentService** → Document lifecycle management and verification
- **GuardianContactService** → Guardian/parent contact management
- **RoomTransferService** → Room transfers, swaps, and history tracking
- **StudentOnboardingService** → Check-in and onboarding workflows
- **StudentCheckoutService** → Checkout workflows and clearances
- **StudentCommunicationService** → Multi-channel messaging and notifications

Each service is designed with dependency injection, comprehensive validation, error handling, and performance optimization.

=================================================================================================================================
# Subscription Services Module - Complete Class Overview

## 1. `booking_commission_service.py`

### **BookingCommissionService**
**Purpose:** Manages commission records for bookings under subscription programs

**Key Functions:**
- `create_commission_for_booking()` - Create commission record for a booking
- `get_commission()` - Retrieve commission record by ID
- `get_commission_by_booking()` - Retrieve commission for specific booking
- `list_commissions_for_subscription()` - List commissions for a subscription
- `list_commissions_for_hostel()` - List commissions for a hostel with filters
- `get_total_commissions_for_hostel()` - Calculate total commission amount
- `mark_commission_paid()` - Mark commission as paid with payment details
- `update_commission_status()` - Update commission status (waived, disputed, etc.)
- `bulk_update_commission_status()` - Update status for multiple commissions

---

## 2. `subscription_billing_service.py`

### **SubscriptionBillingService**
**Purpose:** Handles subscription billing cycle information and operations

**Key Functions:**
- `get_billing_cycle_info()` - Get current billing cycle info for subscription
- `get_billing_cycle_by_date()` - Get billing cycle for specific date
- `list_billing_cycles()` - List past and upcoming billing cycles
- `get_upcoming_billing_cycles()` - Get upcoming billing cycles for next N months
- `get_past_billing_cycles()` - Get past billing cycles
- `recalculate_billing_cycles()` - Recalculate cycles when subscription terms change
- `create_billing_cycle()` - Manually create a billing cycle
- `get_total_billed_amount()` - Calculate total billed amount within date range
- `get_next_billing_date()` - Get next billing date for subscription
- `is_billing_cycle_active()` - Check if billing cycle is active on given date

---

## 3. `subscription_invoice_service.py`

### **SubscriptionInvoiceService**
**Purpose:** Manages invoices generated for subscription billing cycles

**Key Functions:**
- `generate_invoice()` - Generate invoice for subscription billing cycle
- `generate_invoices_batch()` - Generate multiple invoices in batch
- `get_invoice()` - Retrieve invoice by ID
- `get_invoice_by_number()` - Retrieve invoice by invoice number
- `list_invoices_for_subscription()` - List invoices for subscription with filters
- `list_invoices_for_hostel()` - List invoices for hostel with filters
- `search_invoices()` - Search invoices with multiple criteria
- `get_overdue_invoices()` - Get all overdue invoices
- `mark_invoice_paid()` - Mark invoice as paid or partially paid
- `update_invoice_status()` - Update invoice status (cancelled, refunded, etc.)
- `void_invoice()` - Void an invoice with specific reason
- `get_invoice_summary()` - Get summary statistics for invoices
- `get_total_revenue()` - Calculate total revenue from paid invoices

---

## 4. `subscription_plan_service.py`

### **SubscriptionPlanService**
**Purpose:** Manages subscription plans and their feature sets

**Key Functions:**
- `create_plan()` - Create new subscription plan
- `update_plan()` - Update existing subscription plan
- `delete_plan()` - Delete subscription plan (soft/hard delete)
- `archive_plan()` - Archive plan (unavailable for new subscriptions)
- `get_plan()` - Retrieve subscription plan by ID
- `get_plan_by_name()` - Retrieve plan by name
- `list_plans()` - List subscription plans with filters
- `search_plans()` - Search plans with multiple criteria
- `get_recommended_plans()` - Get recommended plans based on criteria
- `get_plan_features()` - Return human-friendly feature set for plan
- `compare_plans()` - Build comparison matrix of multiple plans
- `get_feature_availability()` - Check which plans include specific feature
- `get_most_popular_plans()` - Get most popular plans by subscription count
- `get_plan_statistics()` - Get statistics for specific plan

---

## 5. `subscription_service.py`

### **SubscriptionService**
**Purpose:** Core subscription management operations and lifecycle

**Key Functions:**
- `create_subscription()` - Create new subscription with validation
- `update_subscription()` - Update existing subscription
- `get_subscription()` - Retrieve subscription by ID
- `list_subscriptions_for_hostel()` - List all subscriptions for hostel
- `get_active_subscription_for_hostel()` - Get active subscription for hostel
- `list_subscriptions()` - List subscriptions with pagination and filters
- `get_expiring_subscriptions()` - Get subscriptions expiring within specified days
- `get_billing_history()` - Get billing history for subscription
- `activate_subscription()` - Activate pending or trial subscription
- `suspend_subscription()` - Suspend active subscription
- `renew_subscription()` - Renew expiring or expired subscription
- `preview_cancellation()` - Compute cancellation impact without applying
- `cancel_subscription()` - Cancel subscription with refund calculation
- `get_subscription_metrics()` - Get subscription metrics and statistics

---

## 6. `subscription_upgrade_service.py`

### **SubscriptionUpgradeService**
**Purpose:** Handles plan change (upgrade/downgrade) operations with proration

**Key Functions:**
- `preview_plan_change()` - Preview financial impact of plan changes
- `preview_upgrade()` - Convenience method to preview upgrade with defaults
- `preview_downgrade()` - Convenience method to preview downgrade with defaults
- `apply_plan_change()` - Apply previously previewed plan change
- `upgrade_subscription()` - Upgrade subscription to higher-tier plan
- `downgrade_subscription()` - Downgrade subscription to lower-tier plan
- `cancel_pending_plan_change()` - Cancel pending plan change
- `get_plan_change_history()` - Get history of plan changes for subscription
- `get_upgrade_recommendations()` - Get recommended upgrade plans based on usage
- `calculate_plan_change_savings()` - Calculate savings/costs of plan change over time

---

## 7. `subscription_usage_service.py`

### **SubscriptionUsageService**
**Purpose:** Manages subscription feature usage tracking and limits enforcement

**Key Functions:**
- `get_usage_overview()` - Get aggregated usage & limit overview for subscription
- `get_feature_usage()` - Get detailed usage information for specific feature
- `list_all_feature_usage()` - List usage for all features in subscription
- `can_use_feature()` - Check if feature can be used given current limits
- `get_usage_status()` - Get usage status (normal, warning, critical, exceeded)
- `check_multiple_features()` - Check if multiple features can be used
- `increment_feature_usage()` - Increment usage for feature with limit checking
- `decrement_feature_usage()` - Decrement usage (for refunds or corrections)
- `set_feature_usage()` - Set usage to specific value (admin operation)
- `reset_feature_usage()` - Reset usage counter for feature to zero
- `reset_all_usage()` - Reset usage for all features (billing cycle reset)
- `get_usage_trends()` - Get usage trends for feature over time
- `get_peak_usage_periods()` - Get periods of peak usage for feature
- `predict_usage_exhaustion()` - Predict when feature limit will be exhausted

---

## **Summary by Responsibility:**

- **BookingCommissionService** → Commission tracking and payment management for bookings
- **SubscriptionBillingService** → Billing cycle management and calculations
- **SubscriptionInvoiceService** → Invoice generation, payment tracking, and status management
- **SubscriptionPlanService** → Plan management, features, and comparison tools
- **SubscriptionService** → Core subscription lifecycle and operations
- **SubscriptionUpgradeService** → Plan changes with proration and financial calculations
- **SubscriptionUsageService** → Feature usage tracking, limits, and analytics

Each service is designed with comprehensive validation, error handling, financial precision (using Decimal for money calculations), detailed logging, and rich analytics capabilities for subscription management.

=================================================================================================================================
# Supervisor Services Module - Complete Class Overview

## 1. `supervisor_activity_service.py`

### **SupervisorActivityService**
**Purpose:** Logs and queries supervisor activity and metrics with enhanced filtering and validation

**Key Functions:**
- `log_activity()` - Log single supervisor activity entry with validation
- `bulk_log_activities()` - Log multiple activity entries in bulk
- `get_activity_summary()` - Get aggregated activity summary for supervisor with filters
- `list_activities()` - List activity entries matching filters with pagination
- `get_activity_timeline()` - Get activity timeline grouped by time period
- `get_activity_count()` - Get total count of activities matching filters

---

## 2. `supervisor_assignment_service.py`

### **SupervisorAssignmentService**
**Purpose:** Manages supervisor ↔ hostel assignments and related lifecycle with enhanced validation

**Key Functions:**
- `assign_supervisor()` - Create new supervisor assignment to hostel
- `update_assignment()` - Update existing assignment (employment type, permissions, etc.)
- `revoke_assignment()` - Revoke supervisor's assignment from hostel
- `transfer_assignment()` - Transfer assignment to different hostel
- `list_assignments_for_supervisor()` - List all assignments for supervisor across hostels
- `list_assignments_for_hostel()` - List all supervisor assignments for hostel
- `get_active_assignment()` - Get active assignment for supervisor-hostel pair

---

## 3. `supervisor_dashboard_service.py`

### **SupervisorDashboardService**
**Purpose:** Builds comprehensive supervisor dashboard views with performance optimization

**Key Functions:**
- `get_dashboard()` - Build and return complete supervisor dashboard payload
- `get_dashboard_metrics()` - Get only the metrics section of dashboard
- `get_dashboard_alerts()` - Get only the alerts section of dashboard
- `get_recent_tasks()` - Get recent tasks for supervisor
- `refresh_dashboard_cache()` - Refresh dashboard cache for supervisor

---

## 4. `supervisor_performance_service.py`

### **SupervisorPerformanceService**
**Purpose:** Handles performance metrics, reports, and reviews with comprehensive analytics

**Key Functions:**
- `get_performance_metrics()` - Get summarized performance metrics for supervisor and period
- `get_performance_report()` - Build comprehensive performance report
- `export_performance_report()` - Export performance report in specified format
- `create_performance_review()` - Persist completed performance review
- `update_performance_review()` - Update existing performance review
- `list_performance_reviews()` - List all reviews for supervisor with pagination
- `get_performance_trends()` - Get performance trends over time
- `calculate_overall_rating()` - Calculate overall performance rating for supervisor

---

## 5. `supervisor_permission_service.py`

### **SupervisorPermissionService**
**Purpose:** Manages supervisor permissions and permission checks with role-based access control

**Key Functions:**
- `get_permissions()` - Retrieve supervisor's permissions
- `update_permissions()` - Partially update supervisor's permissions
- `create_default_permissions()` - Create default permissions for new supervisor
- `apply_permission_template()` - Apply named permission template to supervisor
- `bulk_apply_permission_template()` - Apply template to multiple supervisors
- `list_available_templates()` - List all available permission templates
- `check_permission()` - Check if supervisor has given permission in context
- `bulk_check_permissions()` - Check multiple permissions at once
- `get_permission_history()` - Get permission change history for supervisor

---

## 6. `supervisor_scheduling_service.py`

### **SupervisorSchedulingService**
**Purpose:** Provides high-level operations around daily schedules for supervisors with calendar integration

**Key Functions:**
- `get_today_schedule()` - Get today's (or specific date's) schedule for supervisor
- `get_weekly_schedule()` - Get weekly schedule (7 days) for supervisor
- `get_monthly_schedule_summary()` - Get monthly schedule summary
- `add_schedule_item()` - Add new item to supervisor's schedule
- `update_schedule_item()` - Update existing schedule item
- `delete_schedule_item()` - Delete schedule item
- `check_schedule_conflicts()` - Check for schedule conflicts on specific date/time

---

## 7. `supervisor_service.py`

### **SupervisorService**
**Purpose:** Core supervisor CRUD and retrieval operations with enhanced validation and error handling

**Key Functions:**
- `create_supervisor()` - Create new supervisor record with initial assignment
- `update_supervisor()` - Update supervisor information (employment, status, notes)
- `get_supervisor()` - Retrieve full detail of supervisor (including relationships)
- `get_supervisor_profile()` - Retrieve full profile data for supervisor
- `list_supervisors()` - List supervisors globally or filtered by hostel with pagination
- `supervisor_exists()` - Check if supervisor exists in system
- `get_supervisor_count()` - Get total count of supervisors, optionally filtered by hostel

---

## 8. `supervisor_training_service.py`

### **SupervisorTrainingService**
**Purpose:** Suggests training/improvement plans based on performance data with ML-ready analytics

**Key Functions:**
- `get_training_recommendations()` - Generate rule-based training recommendation set
- `generate_learning_path()` - Generate personalized learning path to achieve target performance
- `analyze_skill_gaps()` - Analyze skill gaps for supervisor
- `_analyze_performance_and_recommend()` - Analyze performance metrics and generate recommendations
- `_calculate_overall_score()` - Calculate overall performance score from metrics
- `_estimate_completion_time()` - Estimate completion time in weeks
- `_calculate_total_hours()` - Calculate total training hours
- `_create_milestones()` - Create learning milestones
- `_calculate_gap_severity()` - Calculate gap severity based on score

---

## **Summary by Responsibility:**

- **SupervisorService** → Core supervisor CRUD operations and profile management
- **SupervisorActivityService** → Activity logging, tracking, and metrics analysis
- **SupervisorAssignmentService** → Hostel assignment management and lifecycle
- **SupervisorDashboardService** → Dashboard views, metrics, and performance optimization
- **SupervisorPerformanceService** → Performance analytics, reports, and reviews
- **SupervisorPermissionService** → Role-based access control and permission management
- **SupervisorSchedulingService** → Schedule management and calendar integration
- **SupervisorTrainingService** → AI/ML-ready training recommendations and skill gap analysis

Each service is designed with comprehensive validation, error handling, detailed logging, type safety, and rich analytics capabilities for complete supervisor management.

=================================================================================================================================
# User Services Package - Complete Class Structure

## 1. **emergency_contact_service.py**
### `EmergencyContactService` - Emergency Contact Management
**Purpose**: Manages user-level emergency contacts with validation and limits

**Key Functions**:
- `list_contacts()` - Get all emergency contacts for a user
- `get_contact()` - Get specific contact by ID
- `get_primary_contact()` - Get user's primary emergency contact
- `create_contact()` - Add new emergency contact
- `update_contact()` - Edit existing contact information
- `delete_contact()` - Remove emergency contact
- `set_primary_contact()` - Mark contact as primary
- `bulk_create_contacts()` - Create multiple contacts at once
- `delete_all_contacts()` - Remove all contacts for user

---

## 2. **user_address_service.py**
### `UserAddressService` - Address Management
**Purpose**: Manages user addresses with support for multiple address types

**Key Functions**:
- `list_addresses()` - Get all addresses for user
- `get_address()` - Get specific address by ID
- `get_primary_address()` - Get user's primary address
- `get_addresses_by_type()` - Get addresses of specific type
- `create_address()` - Add new address
- `update_address()` - Edit existing address
- `delete_address()` - Remove address
- `set_primary_address()` - Mark address as primary
- `delete_all_addresses()` - Remove all addresses for user

---

## 3. **user_data_export_service.py**
### `UserDataExportService` - Data Export & GDPR Compliance
**Purpose**: Exports user data in various formats for compliance and reporting

**Key Functions**:
- `export_user_data()` - Export single user's data (JSON/Excel/PDF/CSV)
- `export_multiple_users()` - Export multiple users in bulk
- `export_gdpr_package()` - Create GDPR-compliant data package
- `_build_export_data()` - Structure data for export
- `_sanitize_sensitive_data()` - Remove/mask sensitive information
- `_export_to_excel()` - Convert to Excel format
- `_export_to_pdf()` - Convert to PDF format
- `_export_to_csv()` - Convert to CSV format
- `_export_gdpr_to_pdf()` - Create GDPR PDF report

---

## 4. **user_preference_service.py**
### `UserPreferenceService` - User Preferences Management
**Purpose**: Manages notification settings, quiet hours, and user preferences

**Key Functions**:
- `get_notification_preferences()` - Get user's notification settings
- `update_notification_preferences()` - Update notification settings
- `reset_to_defaults()` - Reset preferences to default values
- `set_quiet_hours()` - Configure quiet hours for notifications
- `disable_quiet_hours()` - Turn off quiet hours
- `is_in_quiet_hours()` - Check if current time is in quiet hours
- `enable_channel()` - Enable specific notification channel
- `disable_channel()` - Disable specific notification channel

---

## 5. **user_profile_service.py**
### `UserProfileService` - Profile Management
**Purpose**: Manages user profile information and completeness tracking

**Key Functions**:
- `get_profile()` - Get full user profile details
- `get_profile_completeness()` - Calculate profile completion percentage
- `update_profile()` - Update profile fields (name, gender, DOB)
- `update_profile_image()` - Update profile picture URL
- `remove_profile_image()` - Remove profile picture
- `update_contact_info()` - Update email/phone/emergency contacts

---

## 6. **user_service.py**
### `UserService` - Core User Management
**Purpose**: Main service for user CRUD operations and account management

**Key Functions**:
- `create_user()` - Create new user account
- `update_user()` - Update core user fields
- `deactivate_user()` - Deactivate user account
- `activate_user()` - Reactivate user account
- `delete_user()` - Delete user (soft or hard)
- `get_user()` - Get user by ID with full details
- `get_user_by_email()` - Find user by email address
- `get_user_by_phone()` - Find user by phone number
- `list_users()` - List users with filtering options
- `count_users()` - Count users with filters
- `search_users()` - Search users by name/email/phone
- `get_user_stats()` - Get user statistics

---

## 7. **user_session_service.py**
### `UserSessionService` - Session Management & Security
**Purpose**: Manages user login sessions with security features and analytics

**Key Functions**:
- `list_active_sessions()` - Get all active sessions for user
- `get_session()` - Get specific session details
- `get_session_analytics()` - Get session usage analytics
- `create_session()` - Create new login session
- `update_session_activity()` - Update last activity timestamp
- `revoke_session()` - Revoke single session
- `revoke_all_sessions()` - Revoke all user sessions
- `revoke_expired_sessions()` - Clean up expired sessions
- `revoke_inactive_sessions()` - Remove inactive sessions
- `detect_suspicious_sessions()` - Find potentially suspicious activity

---

## 8. **user_verification_service.py**
### `UserVerificationService` - Email/Phone Verification
**Purpose**: Handles verification workflows for email and phone numbers

**Key Functions**:
- `initiate_email_verification()` - Start email verification process
- `verify_email()` - Verify email with OTP code
- `initiate_phone_verification()` - Start phone verification process
- `verify_phone()` - Verify phone with OTP code
- `resend_verification_code()` - Resend verification code
- `get_verification_status()` - Get current verification status
- `_check_rate_limit()` - Prevent verification spam
- `_check_resend_cooldown()` - Limit resend frequency

---

## 9. **__init__.py**
### No Classes - Package Initialization
**Purpose**: Export all service classes and define package interface

**Content**:
- Imports all service classes
- Defines `__all__` for public API

---

## Service Relationships & Dependencies

```
UserService (Core)
├── UserProfileService (profile management)
├── UserAddressService (address management)
├── EmergencyContactService (emergency contacts)
├── UserPreferenceService (preferences)
├── UserVerificationService (verification flows)
├── UserSessionService (session security)
└── UserDataExportService (data export/GDPR)

UserVerificationService
├── Uses UserService (for user lookup)
└── Integrates with OTP services

UserSessionService
├── Uses UserService (for user validation)
└── Tracks security analytics

UserDataExportService
├── Reads from all other services
└── Generates compliance reports
```

## Key Design Patterns Used

1. **Service Layer Pattern** - Each class handles specific user-related business logic
2. **Repository Pattern** - Services depend on repository interfaces for data access
3. **Validation Separation** - Private methods handle input validation
4. **Rate Limiting** - Built-in protection against abuse
5. **Privacy Protection** - Data masking and sanitization features
6. **Audit Trail** - Comprehensive logging for security events

Each service is designed to be:
- **Independent** - Can work standalone with minimal dependencies
- **Secure** - Built-in rate limiting and validation
- **Compliant** - GDPR-ready with data export capabilities
- **Scalable** - Optimized for performance with caching strategies
- **Maintainable** - Clear separation of concerns and responsibilities

=================================================================================================================================

# Visitor Services Package - Complete Class Structure

## 1. **saved_search_service.py**
### `SavedSearchService` - Saved Search Management
**Purpose**: Manages visitor saved searches and their execution with result tracking

**Key Functions**:
- `create_saved_search()` - Create new saved search with criteria
- `update_saved_search()` - Update existing saved search
- `delete_saved_search()` - Remove saved search
- `list_saved_searches()` - Get all saved searches for visitor
- `get_saved_search()` - Get specific saved search by ID
- `execute_saved_search()` - Execute search and track results
- `get_execution_history()` - Get search execution history
- `record_notification_for_saved_search()` - Track notifications sent
- `get_searches_pending_notification()` - Find searches needing notifications

---

## 2. **visitor_conversion_service.py**
### `VisitorConversionService` - Conversion Journey Tracking
**Purpose**: Tracks visitor conversions through the journey (inquiry → booking → student)

**Key Functions**:
- `record_booking_conversion()` - Track visitor completing a booking
- `record_student_conversion()` - Track visitor becoming a student
- `record_inquiry_conversion()` - Track visitor creating an inquiry
- `get_conversion_funnel()` - Get complete conversion stages for visitor
- `_is_booking_conversion_recorded()` - Check if conversion already tracked

---

## 3. **visitor_dashboard_service.py**
### `VisitorDashboardService` - Dashboard Data Aggregation
**Purpose**: Builds comprehensive visitor dashboard views by aggregating data from multiple sources

**Key Functions**:
- `get_dashboard()` - Build complete dashboard for visitor
- `get_dashboard_summary()` - Get lightweight dashboard summary
- `get_activity_timeline()` - Get recent activity timeline
- `get_quick_actions()` - Get personalized quick action recommendations
- `_enrich_dashboard_data()` - Add computed metrics to dashboard data
- `_compute_engagement_level()` - Calculate engagement level from score
- `_compute_trends()` - Generate trend indicators

---

## 4. **visitor_favorite_service.py**
### `VisitorFavoriteService` - Favorite Hostels Management
**Purpose**: Manages visitor favorites with notes, tags, and comparison functionality

**Key Functions**:
- `toggle_favorite()` - Add or remove hostel from favorites
- `add_favorite()` - Add hostel to favorites with notes/tags
- `remove_favorite()` - Remove hostel from favorites
- `update_favorite_notes()` - Update notes on favorite hostel
- `update_favorite_tags()` - Update tags for organization
- `list_favorites()` - Get all favorites with filtering options
- `get_favorite()` - Get specific favorite by ID
- `get_comparison()` - Create side-by-side comparison of favorites
- `get_comparison_history()` - Get past comparison sessions

---

## 5. **visitor_preference_service.py**
### `VisitorPreferenceService` - Preference Management
**Purpose**: Manages three types of visitor preferences (general, search, notification)

**Key Functions**:
- `get_preferences()` - Get general visitor preferences
- `set_preferences()` - Create/replace visitor preferences
- `update_preferences()` - Partially update preferences
- `reset_preferences()` - Reset to default values
- `get_search_preferences()` - Get search preference defaults
- `save_search_preferences()` - Save search criteria templates
- `clear_search_preferences()` - Clear search preferences
- `get_notification_preferences()` - Get notification settings
- `update_notification_preferences()` - Update notification settings
- `opt_out_all_notifications()` - Disable all notifications
- `get_all_preferences()` - Get all preference types at once

---

## 6. **visitor_recommendation_service.py**
### `VisitorRecommendationService` - Personalized Recommendations
**Purpose**: ML-ready recommendation engine using hybrid strategies for hostel suggestions

**Key Functions**:
- `generate_recommendations()` - Generate personalized hostel recommendations
- `get_recommendations()` - Fetch existing recommendations (cached)
- `refresh_recommendations()` - Force refresh recommendations
- `_generate_hybrid_recommendations()` - Combine multiple recommendation signals
- `_generate_behavioral_recommendations()` - Based on user behavior patterns
- `_generate_popular_recommendations()` - Based on trending/popular hostels
- `_generate_preference_recommendations()` - Based on explicit preferences
- `_get_behavioral_candidates()` - Find hostels matching behavior patterns
- `_get_preference_candidates()` - Find hostels matching preferences
- `_get_popular_candidates()` - Get trending hostel candidates
- `_score_candidates()` - Score and rank recommendations

---

## 7. **visitor_service.py**
### `VisitorService` - Core Visitor Management
**Purpose**: Main service for visitor CRUD operations and profile management

**Key Functions**:
- `create_visitor()` - Create new visitor profile
- `update_visitor()` - Update visitor profile data
- `delete_visitor()` - Delete visitor (soft/hard delete)
- `get_visitor()` - Get detailed visitor profile by ID
- `get_visitor_by_user_id()` - Find visitor by associated user ID
- `get_visitor_by_email()` - Find visitor by email address
- `list_visitors()` - List visitors with pagination/filtering
- `get_visitor_stats()` - Get comprehensive visitor statistics
- `get_engagement_summary()` - Get engagement metrics summary
- `update_profile_completeness()` - Recalculate profile completion
- `get_profile_completion_suggestions()` - Get suggestions for completing profile

---

## 8. **visitor_tracking_service.py**
### `VisitorTrackingService` - Behavioral Tracking
**Purpose**: Tracks visitor behavior and interactions for analytics and personalization

**Key Functions**:
- `track_search()` - Track search events with metadata
- `get_recent_searches()` - Get visitor's recent search history
- `clear_recent_searches()` - Clear search history
- `track_hostel_view()` - Track hostel detail page views
- `get_recently_viewed()` - Get recently viewed hostels
- `clear_recently_viewed()` - Clear viewing history
- `track_inquiry()` - Track inquiry creation events
- `track_booking()` - Track booking completion events
- `track_activity()` - Generic activity tracking
- `get_activity_history()` - Get visitor activity history
- `start_session()` - Begin visitor session tracking
- `end_session()` - End visitor session
- `update_session_activity()` - Update session activity timestamp

---

## 9. **__init__.py**
### No Classes - Package Initialization
**Purpose**: Export all service classes and define package interface

**Content**:
- Imports all service classes
- Defines `__all__` for public API
- Sets package version

---

## Service Relationships & Data Flow

```
VisitorService (Core)
├── VisitorTrackingService (tracks behavior)
├── VisitorPreferenceService (manages settings)
├── VisitorFavoriteService (favorite hostels)
├── SavedSearchService (saved searches)
├── VisitorConversionService (conversion tracking)
├── VisitorRecommendationService (personalization)
└── VisitorDashboardService (aggregated views)

Data Flow:
User Actions → VisitorTrackingService → Engagement Metrics
Engagement Data → VisitorRecommendationService → Personalized Suggestions
All Services → VisitorDashboardService → Unified Dashboard View
```

## Key Design Patterns Used

1. **Service Layer Pattern** - Each class handles specific visitor-related business logic
2. **Repository Pattern** - Services depend on repository interfaces for data access
3. **Event Tracking** - Comprehensive behavioral tracking for analytics
4. **Recommendation Engine** - ML-ready hybrid recommendation system
5. **Preference Management** - Centralized preference handling
6. **Conversion Funnel** - Tracks visitor journey stages
7. **Caching Strategy** - Performance optimization for frequently accessed data
8. **Privacy Protection** - GDPR-compliant tracking and data handling

## Core Capabilities

**Visitor Management:**
- Complete visitor lifecycle management
- Profile completion tracking
- Engagement analytics

**Personalization:**
- Behavioral tracking and analysis
- Preference-based customization
- ML-ready recommendation engine
- Personalized dashboard views

**Feature Management:**
- Saved search execution and notifications
- Favorite hostel organization and comparison
- Conversion tracking and optimization
- Activity timeline and analytics

Each service is designed to be:
- **Independent** - Can work standalone with clear interfaces
- **Scalable** - Optimized for performance with caching
- **Privacy-Aware** - GDPR-compliant tracking and data handling
- **Extensible** - Ready for ML/AI enhancements
- **Analytics-Ready** - Comprehensive data collection for insights
=================================================================================================================================
# Workflow Services Classes Overview

## 1. `approval_workflow_service.py`

### **ApprovalDecision** (Enum)
**Purpose**: Enhanced approval decision types
- `APPROVE` - Approve the request
- `REJECT` - Reject the request  
- `CONDITIONAL_APPROVE` - Approve with conditions
- `REQUEST_INFORMATION` - Request more information
- `ESCALATE` - Escalate to higher level

### **ApprovalRule** (DataClass)
**Purpose**: Rule configuration for automatic approval decisions
**Key Attributes**: `name`, `condition`, `action`, `priority`, `metadata`

### **ApprovalContext** (DataClass)  
**Purpose**: Enhanced context for approval processing
**Key Attributes**: `approval_type`, `entity_id`, `entity_data`, `approver_id`, `decision`, `auto_approved`

### **ApprovalWorkflowService**
**Purpose**: Enhanced service for managing approval workflows with smart auto-approval
**Key Functions**:
- `process_approval()` - Process approval decision with comprehensive validation
- `process_bulk_approvals()` - Process multiple approvals in batches
- `add_auto_approval_rule()` - Add custom auto-approval rule
- `_apply_auto_approval_rules()` - Apply intelligent auto-approval rules
- `_validate_approval_permissions()` - Validate approver permissions
- `_process_booking_approval_decision()` - Process booking approval decision
- `_process_maintenance_approval_decision()` - Process maintenance approval decision
- `_process_leave_approval_decision()` - Process leave approval decision

---

## 2. `checkout_workflow_service.py`

### **CheckoutStage** (Enum)
**Purpose**: Enhanced checkout workflow stages
- `NOTICE_VALIDATION`, `CLEARANCE_INITIATION`, `DUES_VERIFICATION`, `COMPLAINT_CLEARANCE`, etc.

### **ClearanceStatus** (Enum)
**Purpose**: Clearance verification status
- `PENDING`, `IN_PROGRESS`, `CLEARED`, `BLOCKED`, `CONDITIONAL`

### **ClearanceCertificate** (DataClass)
**Purpose**: Digital clearance certificate
**Key Attributes**: `certificate_id`, `student_id`, `clearance_status`, `total_dues`, `refund_amount`
**Functions**: `to_dict()` - Convert to dictionary format

### **FinancialSettlement** (DataClass)
**Purpose**: Comprehensive financial settlement details
**Key Attributes**: `outstanding_dues`, `damage_charges`, `security_deposit`, `total_refund`
**Functions**: `calculate_totals()` - Calculate total charges and settlements

### **CheckoutContext** (DataClass)
**Purpose**: Enhanced context for checkout workflow
**Key Attributes**: `student_id`, `checkout_date`, `financial_settlement`, `clearance_certificate`

### **CheckoutWorkflowService**
**Purpose**: Enhanced service for managing student checkout workflows
**Key Functions**:
- `checkout_student()` - Execute comprehensive student checkout workflow
- `submit_notice_period()` - Process notice period submission
- `get_checkout_progress()` - Get real-time checkout progress
- `get_clearance_status()` - Get detailed clearance status
- `_verify_notice_period_compliance()` - Verify notice period compliance
- `_conduct_detailed_room_inspection()` - Conduct comprehensive room inspection
- `_calculate_comprehensive_settlement()` - Calculate comprehensive financial settlement

---

## 3. `escalation_workflow_service.py`

### **EscalationType** (Enum)
**Purpose**: Enhanced escalation types
- `COMPLAINT`, `MAINTENANCE`, `APPROVAL`, `SLA_BREACH`, `QUALITY`, `SECURITY`, `FINANCIAL`, `EMERGENCY`

### **EscalationLevel** (Enum)
**Purpose**: Enhanced escalation hierarchy levels
- `LEVEL_1` to `LEVEL_6` (supervisor to board)
**Property**: `numeric_value` - Return numeric value for level comparison

### **EscalationTrigger** (Enum)
**Purpose**: Escalation trigger types
- `SLA_BREACH`, `MANUAL_REQUEST`, `AUTO_RULE`, `QUALITY_THRESHOLD`, etc.

### **EscalationRule** (DataClass)
**Purpose**: Enhanced escalation rule configuration
**Key Attributes**: `rule_id`, `escalation_type`, `trigger`, `condition`, `target_level`

### **SLAConfiguration** (DataClass)
**Purpose**: SLA configuration for different entity types
**Key Attributes**: `entity_type`, `priority_sla`, `escalation_thresholds`, `business_hours_only`

### **EscalationMetrics** (DataClass)
**Purpose**: Comprehensive escalation metrics
**Key Attributes**: `total_escalations`, `auto_escalations`, `resolved_at_level`, `escalation_success_rate`

### **EscalationWorkflowService**
**Purpose**: Enhanced service for managing escalation workflows with intelligent routing
**Key Functions**:
- `escalate_complaint()` - Execute intelligent complaint escalation
- `auto_escalate_on_sla_breach()` - Execute auto-escalation on SLA breach
- `mass_escalate_related_issues()` - Execute mass escalation for related issues
- `de_escalate()` - Execute intelligent de-escalation
- `get_escalation_analytics()` - Get comprehensive escalation analytics
- `_determine_optimal_escalation_path()` - Determine optimal escalation path
- `_select_optimal_escalation_recipient()` - Select optimal escalation recipient

---

## 4. `notification_workflow_service.py`

### **DeliveryStrategy** (Enum)
**Purpose**: Notification delivery strategies
- `IMMEDIATE`, `BATCH`, `SCHEDULED`, `OPTIMAL_TIME`, `FALLBACK_CASCADE`

### **NotificationStatus** (Enum)
**Purpose**: Enhanced notification status tracking
- `CREATED`, `QUEUED`, `PROCESSING`, `SENT`, `DELIVERED`, `READ`, `CLICKED`, `FAILED`, `EXPIRED`, `CANCELLED`

### **NotificationTemplate** (DataClass)
**Purpose**: Enhanced notification template with multi-channel support
**Key Attributes**: `template_id`, `channels`, `templates`, `delivery_strategy`, `retry_config`

### **DeliveryMetrics** (DataClass)
**Purpose**: Comprehensive delivery metrics
**Key Attributes**: `total_sent`, `total_delivered`, `channel_metrics`, `user_engagement`

### **UserNotificationPreference** (DataClass)
**Purpose**: Enhanced user notification preferences
**Key Attributes**: `channel_preferences`, `quiet_hours`, `frequency_limits`, `language`

### **NotificationWorkflowService**
**Purpose**: Enhanced notification orchestration service with intelligent delivery optimization
**Key Functions**:
- `send_approval_notification()` - Send intelligent approval notification
- `send_escalation_notification()` - Send escalation notification with priority handling
- `send_onboarding_notifications()` - Send comprehensive onboarding notification sequence
- `send_checkout_notifications()` - Send checkout completion notifications
- `send_bulk_notifications()` - Send notifications to multiple users efficiently
- `get_notification_analytics()` - Get comprehensive notification analytics
- `_determine_optimal_channels()` - Determine optimal delivery channels
- `_determine_optimal_timing()` - Determine optimal delivery timing

---

## 5. `onboarding_workflow_service.py`

### **OnboardingStage** (Enum)
**Purpose**: Enhanced onboarding stages
- `BOOKING_VALIDATION`, `DOCUMENT_VERIFICATION`, `PAYMENT_PROCESSING`, `ROOM_ASSIGNMENT`, etc.

### **DocumentType** (Enum)
**Purpose**: Required document types for onboarding
- `ID_PROOF`, `PHOTO`, `ADDRESS_PROOF`, `EDUCATION_PROOF`, `GUARDIAN_ID`, `MEDICAL_CERTIFICATE`

### **OnboardingChecklist** (DataClass)
**Purpose**: Checklist for tracking onboarding progress
**Key Attributes**: `booking_confirmed`, `documents_verified`, `payments_completed`, etc.
**Functions**: `get_completion_percentage()` - Calculate completion percentage

### **OnboardingContext** (DataClass)
**Purpose**: Enhanced context for onboarding workflow
**Key Attributes**: `booking_id`, `student_user_id`, `checklist`, `assigned_room_id`

### **OnboardingWorkflowService**
**Purpose**: Enhanced service for managing student onboarding workflows
**Key Functions**:
- `onboard_student()` - Execute comprehensive student onboarding workflow
- `onboard_walkin_student()` - Execute walk-in student onboarding workflow
- `get_onboarding_progress()` - Get real-time onboarding progress
- `_validate_booking_eligibility()` - Comprehensive booking eligibility validation
- `_verify_student_documents()` - Comprehensive document verification with AI
- `_assign_optimal_room_and_bed()` - Assign optimal room and bed using intelligent algorithms
- `_create_comprehensive_student_profile()` - Create comprehensive student profile
- `_provision_access_credentials()` - Provision physical and digital access credentials

---

## 6. `scheduled_task_service.py`

### **TaskPriority** (Enum)
**Purpose**: Task execution priorities
- `CRITICAL`, `HIGH`, `NORMAL`, `LOW`
**Property**: `value_int` - Return numeric priority value for sorting

### **TaskStatus** (Enum)
**Purpose**: Task execution status
- `PENDING`, `RUNNING`, `COMPLETED`, `FAILED`, `CANCELLED`, `RETRYING`

### **TaskFrequency** (Enum)
**Purpose**: Task execution frequencies
- `CONTINUOUS`, `EVERY_MINUTE`, `EVERY_5_MINUTES`, `HOURLY`, `DAILY`, `WEEKLY`, `MONTHLY`

### **TaskConfiguration** (DataClass)
**Purpose**: Enhanced task configuration
**Key Attributes**: `task_id`, `handler`, `frequency`, `priority`, `retry_count`, `dependencies`

### **TaskExecution** (DataClass)
**Purpose**: Task execution tracking
**Key Attributes**: `execution_id`, `task_id`, `started_at`, `status`, `result`
**Functions**: `to_dict()` - Convert execution to dictionary

### **TaskMetrics** (DataClass)
**Purpose**: Comprehensive task metrics
**Key Attributes**: `total_executions`, `failure_rate`, `average_execution_time`, `performance_trend`

### **ScheduledTaskService**
**Purpose**: Enhanced orchestration for scheduled and background tasks
**Key Functions**:
- `register_task()` - Register a new scheduled task with validation
- `enable_task()` / `disable_task()` - Enable/disable tasks
- `trigger_task_manually()` - Manually trigger a task execution
- `get_task_status()` - Get comprehensive status for a specific task
- `get_system_overview()` - Get comprehensive system overview
- `_run_comprehensive_sla_checks()` - Enhanced SLA monitoring with intelligent escalation
- `_run_comprehensive_daily_analytics()` - Generate comprehensive daily analytics
- `_send_intelligent_payment_reminders()` - Send intelligent payment reminders

---

## 7. `workflow_engine_service.py`

### **WorkflowState** (Enum)
**Purpose**: Workflow execution states with enhanced tracking
- `PENDING`, `QUEUED`, `RUNNING`, `COMPLETED`, `FAILED`, `CANCELLED`, `SUSPENDED`, `RETRYING`

### **WorkflowPriority** (Enum)
**Purpose**: Workflow execution priorities with numeric values
- `CRITICAL`, `HIGH`, `NORMAL`, `LOW`
**Property**: `value_int` - Return numeric priority value for sorting

### **StepMetrics** (DataClass)
**Purpose**: Metrics for workflow step execution
**Key Attributes**: `execution_time`, `retry_count`, `memory_usage`, `cpu_usage`

### **WorkflowMetrics** (DataClass)
**Purpose**: Comprehensive workflow execution metrics
**Key Attributes**: `total_execution_time`, `step_metrics`, `error_count`, `retry_count`

### **WorkflowStep**
**Purpose**: Enhanced workflow step with improved error handling and metrics
**Key Functions**:
- `execute()` - Execute step with comprehensive error handling and metrics
- `rollback()` - Execute rollback with comprehensive error handling
- `_execute_handler()` - Execute the step handler with proper async handling
- `_evaluate_condition()` - Evaluate step execution condition
- `_validate_result()` - Validate step execution result

### **WorkflowDefinition**
**Purpose**: Enhanced workflow definition with validation and caching
**Key Functions**:
- `add_step()` - Add a step with validation
- `add_validator()` - Add a pre-execution validator
- `on_complete()` / `on_error()` - Add completion/error handlers
- `get_step()` - Get step by name with caching
- `get_required_steps()` / `get_optional_steps()` - Get required/optional steps with caching

### **WorkflowExecution** (DataClass)
**Purpose**: Enhanced workflow execution with comprehensive tracking
**Key Attributes**: `execution_id`, `definition`, `state`, `executed_steps`, `metrics`
**Functions**:
- `to_dict()` - Convert execution to comprehensive dictionary
- `get_duration()` - Get execution duration in seconds
- `get_progress_percentage()` - Calculate execution progress percentage
- `add_error()` - Add error with metadata
- `add_tag()` / `has_tag()` - Tag management

### **WorkflowEngineService**
**Purpose**: Enhanced workflow engine with improved performance, monitoring, and reliability
**Key Functions**:
- `register_workflow()` - Register workflow with enhanced validation
- `execute_workflow()` - Execute workflow with enhanced features and monitoring
- `cancel_execution()` - Cancel execution with proper cleanup
- `get_execution()` - Get execution by ID with caching
- `get_executions_by_type()` - Get executions by type with filtering
- `get_statistics()` - Get comprehensive engine statistics
- `_execute_steps()` - Execute workflow steps with enhanced monitoring
- `_rollback_execution()` - Enhanced rollback with comprehensive error handling

---

## 8. `__init__.py`

### **WorkflowRegistry**
**Purpose**: Central registry for workflow services and configurations
**Key Functions**:
- `register_service()` - Register a workflow service with the registry
- `get_service()` - Get a registered workflow service
- `get_service_health()` - Get health status of a workflow service
- `update_service_health()` - Update health status of a workflow service
- `get_service_metrics()` - Get metrics for a workflow service
- `get_system_overview()` - Get comprehensive system overview

### **WorkflowServiceFactory**
**Purpose**: Factory for creating and configuring workflow services with proper dependencies
**Key Functions**:
- `create_approval_workflow_service()` - Create and configure approval workflow service
- `create_onboarding_workflow_service()` - Create and configure onboarding workflow service
- `create_checkout_workflow_service()` - Create and configure checkout workflow service
- `create_escalation_workflow_service()` - Create and configure escalation workflow service
- `create_notification_workflow_service()` - Create and configure notification workflow service
- `create_scheduled_task_service()` - Create and configure scheduled task service

---

## **Global Functions Available**:

### **Factory Functions**:
- `create_workflow()` - Factory function to create workflow definition
- `create_step()` - Factory function to create workflow step

### **Decorators**:
- `@workflow_step()` - Decorator to define workflow steps
- `@workflow_validator()` - Decorator to define workflow validators

### **Health & Monitoring**:
- `check_workflow_health()` - Check health of all workflow services
- `get_workflow_metrics()` - Get comprehensive workflow performance metrics
- `configure_workflow_services()` - Configure all workflow services
- `initialize_workflow_services()` - Initialize all workflow services with proper dependencies

### **Global Instances**:
- `workflow_engine` - Global workflow engine instance
- `workflow_registry` - Global workflow registry instance

---

## **Summary by Domain**:

- **Core Engine**: WorkflowEngineService, WorkflowDefinition, WorkflowStep, WorkflowExecution
- **Approval Management**: ApprovalWorkflowService, ApprovalDecision, ApprovalRule, ApprovalContext
- **Student Lifecycle**: OnboardingWorkflowService, CheckoutWorkflowService + their contexts and data classes
- **Issue Management**: EscalationWorkflowService + escalation-related enums and configurations  
- **Communication**: NotificationWorkflowService + delivery strategies and user preferences
- **Automation**: ScheduledTaskService + task configurations and execution tracking
- **System Management**: WorkflowRegistry, WorkflowServiceFactory + health monitoring functions

=================================================================================================================================