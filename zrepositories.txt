Here’s a clean map of what classes belong in each repository file you shared, grouped by module. I’ll list only the classes that should be defined in each file (not the models they import).

---

## 1. Admin Repositories (`app/repositories/admin`)

### `admin_hostel_assignment_repository.py`
Should define:

- `AdminHostelAssignmentRepository(BaseRepository[AdminHostelAssignment])`  
  Repository for multi‑hostel admin assignments, transfers, workload balancing, coverage analysis, and assignment analytics.

_No other classes should be defined here._

---

### `admin_override_repository.py`
Should define:

- `AdminOverrideRepository(BaseRepository[AdminOverride])`  
  Repository for admin overrides of supervisor decisions, approvals, and impact analysis.

---

### `admin_permissions_repository.py`
Should define:

- `AdminPermissionsRepository(BaseRepository[AdminPermission])`  
  Repository for granular admin permissions (per hostel & global), templates, validation, conflict detection, and auditing.

---

### `admin_user_repository.py`
Should define:

- `AdminUserRepository(BaseRepository[AdminUser])`  
  Repository for admin user management: creation, search, hierarchy, permissions (at a high level), sessions, security, status, and analytics.

---

### `hostel_context_repository.py`
Should define:

- `HostelContextRepository(BaseRepository[HostelContext])`  
  Repository for per‑admin hostel context (active hostel, context switches, stats caching, context preferences, snapshots, cleanup, recommendations).

---

### `hostel_selector_repository.py`
Should define:

- `HostelSelectorRepository(BaseRepository[RecentHostel])`  
  Repository for managing hostel selection UI: recent hostels, favorites, hostel quick stats, selector cache, and analytics.

---

### `multi_hostel_dashboard_repository.py`
Should define:

- `MultiHostelDashboardRepository(BaseRepository[MultiHostelDashboard])`  
  Repository for multi‑hostel dashboards: aggregated metrics, cross‑hostel comparisons, performance rankings, widgets, snapshots, and portfolio summary.

---

### `__init__.py` (admin)
Should define:

- Imports/exports:
  - `AdminUserRepository`
  - `AdminPermissionsRepository`
  - `AdminHostelAssignmentRepository`
  - `AdminOverrideRepository`
  - `HostelContextRepository`
  - `HostelSelectorRepository`
  - `MultiHostelDashboardRepository`

- `class AdminRepositoryFactory:`  
  Factory providing methods:
  - `get_admin_user_repository`
  - `get_admin_permissions_repository`
  - `get_admin_assignment_repository`
  - `get_admin_override_repository`
  - `get_hostel_context_repository`
  - `get_hostel_selector_repository`
  - `get_dashboard_repository`
  - `clear_cache`

- `def get_admin_repository_factory(db_session) -> AdminRepositoryFactory`

_No additional repository classes should be defined here._

---

## 2. Analytics Repositories (`app/repositories/analytics`)

### `analytics_aggregate_repository.py`
Should define:

- `AnalyticsAggregateRepository(BaseRepository)`  
  Aggregate analytics repository: unified dashboard metrics, platform‑wide metrics, comparative analysis, trends, and export.

---

### `booking_analytics_repository.py`
Should define:

- `BookingAnalyticsRepository(BaseRepository)`  
  Repository for booking KPIs, trends, funnels, cancellations, source performance, forecasts, summaries, and optimization insights.

---

### `complaint_analytics_repository.py`
Should define:

- `ComplaintAnalyticsRepository(BaseRepository)`  
  Repository for complaint KPIs, SLA metrics, trends, category/priority breakdowns, dashboards, efficiency scores, comparisons, and forecasts.

---

### `custom_reports_repository.py`
Should define:

- `CustomReportsRepository(BaseRepository)`  
  Repository for custom report definitions, sharing, scheduling, execution history, caching, and statistics.

---

### `dashboard_analytics_repository.py`
Should define:

- `DashboardAnalyticsRepository(BaseRepository)`  
  Repository for generic dashboard KPIs, timeseries metrics, widgets, alerts, quick stats, and role‑specific dashboards.

---

### `financial_analytics_repository.py`
Should define:

- `FinancialAnalyticsRepository(BaseRepository)`  
  Repository for revenue/expense breakdowns, ratios, P&L statements, cashflow, budgets vs actuals, tax summary, and financial reports.

---

### `occupancy_analytics_repository.py`
Should define:

- `OccupancyAnalyticsRepository(BaseRepository)`  
  Repository for occupancy KPIs, trends, room/floor breakdowns, seasonal patterns, forecasting, and occupancy reports.

---

### `platform_analytics_repository.py`
Should define:

- `PlatformAnalyticsRepository(BaseRepository)`  
  Repository for multi‑tenant/platform‑wide metrics: tenant health & churn, platform metrics, growth, churn analysis, system health, usage analytics, and revenue metrics.

---

### `supervisor_analytics_repository.py`
Should define:

- `SupervisorAnalyticsRepository(BaseRepository)`  
  Repository for supervisor KPIs, workload, performance ratings, trend points, comparative rankings, and team analytics.

---

### `visitor_analytics_repository.py`
Should define:

- `VisitorAnalyticsRepository(BaseRepository)`  
  Repository for visitor funnel, traffic source metrics, search behaviour, engagement, visitor behaviour analytics, and traffic source analytics.

---

### `__init__.py` (analytics)
Should define:

- Exports:
  - `AnalyticsAggregateRepository`
  - `BookingAnalyticsRepository`
  - `ComplaintAnalyticsRepository`
  - `CustomReportsRepository`
  - `DashboardAnalyticsRepository`
  - `FinancialAnalyticsRepository`
  - `OccupancyAnalyticsRepository`
  - `PlatformAnalyticsRepository`
  - `SupervisorAnalyticsRepository`
  - `VisitorAnalyticsRepository`

_No extra classes beyond imports/exports._

---

## 3. Announcement Repositories (`app/repositories/announcement`)

### `announcement_aggregate_repository.py`
Should define:

- `AnnouncementAggregateRepository`  
  Orchestrator across all announcement sub‑repositories:
  - `create_complete_announcement`
  - `process_approval_and_publish`
  - `initialize_delivery`
  - `process_scheduled_publications`
  - `process_recurring_announcements`
  - `generate_comprehensive_report`
  - `get_hostel_dashboard_metrics`
  - `cleanup_expired_announcements`
  - `recalculate_all_metrics`

And private helpers like `_create_recipient_records`, `_analyze_channel_performance`, `_analyze_category_performance`.

---

### `announcement_approval_repository.py`
Should define:

- `AnnouncementApprovalRepository(BaseRepository[AnnouncementApproval])`  
  Repository for approval workflow:
  - Create/approve/reject/resubmit approvals
  - Assign/escalate approvals
  - Auto‑approval & approval rules
  - SLA monitoring and breaches
  - Approval workflows
  - Approval history and statistics

_No other concrete repository class here._

---

### `announcement_delivery_repository.py`
Should define:

- `AnnouncementDeliveryRepository(BaseRepository[AnnouncementDelivery])`  
  Repository for delivery execution and management:
  - Create single/bulk deliveries
  - Execute & mark delivered/failed
  - Batching (DeliveryBatch)
  - Channel selection & configuration
  - Pending/failed queries
  - Delivery statistics

Private helpers:
- `_record_failure`
- `_schedule_retry`
- `_get_channel_performance`

---

### `announcement_repository.py`
Should define:

- `class ActiveAnnouncementsSpec(Specification)`  
  Specification for “active” announcements (published, not archived/deleted, not expired).

- `class UrgentAnnouncementsSpec(Specification)`  
  Specification for urgent announcements.

- `class RequiresAcknowledgmentSpec(Specification)`  
  Specification for announcements that require acknowledgment.

- `class AnnouncementRepository(BaseRepository[Announcement])`  
  Core announcement repository responsible for:
  - Creating drafts / from template
  - Querying by id/hostel/status/search
  - Publishing/unpublishing/pinning/urgent flags
  - Updating content with versioning
  - Archiving/unarchiving/bulk archive
  - Statistics & performance metrics
  - Top‑performing announcements

And internal helpers:
- `_create_version`
- `_apply_filters`
- `_count_active`
- `_count_urgent`
- `_count_pending_acknowledgment`

---

### `announcement_scheduling_repository.py`
Should define:

- `AnnouncementSchedulingRepository(BaseRepository[AnnouncementSchedule])`  
  Repository for announcement scheduling:
  - One‑time and recurring schedules
  - Recurring announcement templates
  - Publish queue (PublishQueue) management
  - Execution tracking (ScheduleExecution)
  - SLA breaches
  - Upcoming schedules / recurring templates

And helpers:
- `_add_to_publish_queue`
- `_update_publish_queue`
- `_remove_from_publish_queue`
- `_calculate_next_occurrence`
- `_should_continue_recurrence`
- `_should_continue_schedule`
- `_create_from_recurring_template`
- `_calculate_retry_delay`

---

### `announcement_targeting_repository.py`
Should define:

- `AnnouncementTargetingRepository(BaseRepository[AnnouncementTarget])`  
  Repository for audience targeting:
  - Build single or multi‑criteria segments
  - Calculate target reach & breakdowns
  - Optimize delivery timing
  - Personalization context per student
  - Targeting effectiveness tracking
  - Audience preferences
  - Over‑messaging prevention
  - Bulk targeting rules
  - Audience cache handling

And internal helpers:
- `_calculate_target_audience`
- `_build_rule_filter`
- `_get_audience_breakdown`
- `_update_audience_cache`
- `_validate_targeting`
- `_get_target_by_announcement`
- `_get_notification_preferences`
- `_get_engagement_history`
- `_calculate_estimation_accuracy`
- `_calculate_effectiveness_score`

---

### `announcement_tracking_repository.py`
Should define:

- `AnnouncementTrackingRepository(BaseRepository[AnnouncementView])`  
  Repository for engagement tracking:
  - Views, reading metrics, engagement actions
  - Read receipts (mark/bulk mark as read)
  - Acknowledgments & verification
  - EngagementMetric calculations
  - ReadingTimeAnalytic calculations
  - Per‑student profiles, pending/overdue acks
  - Announcement engagement timeline
  - Cross‑announcement performance comparison
  - Low‑engagement student detection

And internal helper:
- `_calculate_engagement_score`

---

### `__init__.py` (announcement)
Should define:

- Exports:
  - `AnnouncementRepository`
  - `AnnouncementTargetingRepository`
  - `AnnouncementSchedulingRepository`
  - `AnnouncementApprovalRepository`
  - `AnnouncementDeliveryRepository`
  - `AnnouncementTrackingRepository`
  - `AnnouncementAggregateRepository`
  - `ActiveAnnouncementsSpec`
  - `UrgentAnnouncementsSpec`
  - `RequiresAcknowledgmentSpec`

- Repository registry / factory:
  - `REPOSITORY_REGISTRY` (name → class map)
  - `get_repository(repository_name: str, session)`

---

If you want, I can next:

- Flag any **missing** classes (e.g., if you plan to regenerate files and want a checklist), or  
- Propose a directory‑level “contract” (what each repository is responsible for vs what should stay in services/use‑cases).


Here’s a precise map of what classes are expected in each of the repository files you shared, plus which model/enums they depend on. This should let you verify whether anything is missing or mis‑placed.

---

## 1. Attendance Repositories (`app/repositories/attendance`)

### `attendance_aggregate_repository.py`

**Repository / service class in this file:**

- `AttendanceAggregateRepository`
  - Not a `BaseRepository` subclass; it’s an aggregate/service layer over multiple attendance models.
  - Takes a `Session` in `__init__`.

**Model / enum dependencies (must exist elsewhere):**

- From `app.models.attendance.attendance_record`:
  - `AttendanceRecord`
- From `app.models.attendance.attendance_policy`:
  - `AttendancePolicy`
  - `PolicyViolation`
  - `PolicyException`
- From `app.models.attendance.attendance_alert`:
  - `AttendanceAlert`
  - `AlertConfiguration`
- From `app.models.attendance.attendance_report`:
  - `AttendanceSummary`
  - `AttendanceTrend`
- From `app.models.base.enums`:
  - `AttendanceStatus`

---

### `attendance_alert_repository.py`

**Repository class in this file:**

- `AttendanceAlertRepository(BaseRepository[AttendanceAlert])`

**Model dependencies:**

- From `app.models.attendance.attendance_alert`:
  - `AttendanceAlert`
  - `AlertConfiguration`
  - `AlertNotification`

---

### `attendance_policy_repository.py`

**Repository class in this file:**

- `AttendancePolicyRepository(BaseRepository[AttendancePolicy])`

**Model dependencies:**

- From `app.models.attendance.attendance_policy`:
  - `AttendancePolicy`
  - `PolicyViolation`
  - `PolicyException`

---

### `attendance_record_repository.py`

**Repository class in this file:**

- `AttendanceRecordRepository(BaseRepository[AttendanceRecord])`

**Model / enum dependencies:**

- From `app.models.attendance.attendance_record`:
  - `AttendanceRecord`
  - `AttendanceCorrection`
  - `BulkAttendanceLog`
- From `app.models.base.enums`:
  - `AttendanceStatus`
  - `AttendanceMode`

---

### `attendance_report_repository.py`

**Repository class in this file:**

- `AttendanceReportRepository(BaseRepository[AttendanceReport])`

**Model / enum dependencies:**

- From `app.models.attendance.attendance_report`:
  - `AttendanceReport`
  - `AttendanceSummary`
  - `AttendanceTrend`
- From `app.models.base.enums`:
  - `AttendanceStatus` (used in type hints/imports even if not heavily referenced here)

---

### `attendance/__init__.py`

This file should only:

- Import and re‑export repository classes:

  - `AttendanceRecordRepository`
  - `AttendancePolicyRepository`
  - `AttendanceAlertRepository`
  - `AttendanceReportRepository`
  - `AttendanceAggregateRepository`

- Define `__all__` with those names.

No additional classes should be defined here.

---

## 2. Audit Repositories (`app/repositories/audit`)

### `admin_override_log_repository.py`

**Repository class:**

- `AdminOverrideLogRepository(BaseRepository)`
  - BaseRepository is used in the reversed order here (`super().__init__(session, AdminOverrideLog)`), but effectively it’s a repository over `AdminOverrideLog`.

**Model dependency:**

- From `app.models.audit`:
  - `AdminOverrideLog`

---

### `audit_aggregate_repository.py`

**Repository / service class:**

- `AuditAggregateRepository(BaseRepository)`
  - Uses `AuditLog` as its BaseRepository model (`super().__init__(session, AuditLog)`).
  - Functions as an aggregate analytics service across multiple audit models.

**Model dependencies:**

- From `app.models.audit`:
  - `AuditLog`
  - `EntityChangeLog`
  - `SupervisorActivityLog`
  - `AdminOverrideLog`
- From `app.schemas.common.enums`:
  - `AuditActionCategory`

---

### `audit_log_repository.py`

**Repository class:**

- `AuditLogRepository(BaseRepository)`

**Model / enum dependencies:**

- From `app.models.audit`:
  - `AuditLog`
- From `app.schemas.common.enums`:
  - `AuditActionCategory`

---

### `entity_change_log_repository.py`

**Repository classes (two in this file):**

- `EntityChangeLogRepository(BaseRepository)`
  - For fine‑grained field‑level changes.
- `EntityChangeHistoryRepository(BaseRepository)`
  - For snapshot / version history.

**Model dependencies:**

- From `app.models.audit`:
  - `EntityChangeLog`
  - `EntityChangeHistory`

---

### `supervisor_activity_log_repository.py`

**Repository class:**

- `SupervisorActivityLogRepository(BaseRepository)`

**Model / enum dependencies:**

- From `app.models.audit`:
  - `SupervisorActivityLog`
- From `app.schemas.audit.supervisor_activity_log`:
  - `SupervisorActionCategory`

---

### `audit/__init__.py`

Should only:

- Import and re‑export:

  - `AuditLogRepository`
  - `EntityChangeLogRepository`
  - `EntityChangeHistoryRepository`
  - `SupervisorActivityLogRepository`
  - `AdminOverrideLogRepository`
  - `AuditAggregateRepository`

- Define `__all__` with those names.

No additional classes here.

---

## 3. Auth Repositories (`app/repositories/auth`)

### `auth_aggregate_repository.py`

**Aggregate / facade class:**

- `AuthAggregateRepository`
  - Not a `BaseRepository` subclass.
  - Composes many other repositories:
    - `UserSessionRepository`
    - `SessionTokenRepository`
    - `RefreshTokenRepository`
    - `LoginAttemptRepository`
    - `OTPTokenRepository`
    - `OTPTemplateRepository`
    - `OTPDeliveryRepository`
    - `OTPThrottlingRepository`
    - `PasswordResetRepository`
    - `PasswordHistoryRepository`
    - `PasswordPolicyRepository`
    - `PasswordAttemptRepository`
    - `SocialAuthProviderRepository`
    - `SocialAuthTokenRepository`
    - `SocialAuthProfileRepository`
    - `SocialAuthLinkRepository`
    - `BlacklistedTokenRepository`
    - `TokenRevocationRepository`
    - `SecurityEventRepository`

**Enum dependency:**

- From `app.schemas.common.enums`:
  - `OTPType`

---

### `otp_token_repository.py`

**Repository classes in this file:**

- `OTPTokenRepository(BaseRepository[OTPToken])`
- `OTPTemplateRepository(BaseRepository[OTPTemplate])`
- `OTPDeliveryRepository(BaseRepository[OTPDelivery])`
- `OTPThrottlingRepository(BaseRepository[OTPThrottling])`

**Model dependencies:**

- From `app.models.auth`:
  - `OTPToken`
  - `OTPTemplate`
  - `OTPDelivery`
  - `OTPThrottling`
- From `app.schemas.common.enums`:
  - `OTPType`

---

### `password_reset_repository.py`

**Repository classes in this file:**

- `PasswordResetRepository(BaseRepository[PasswordReset])`
- `PasswordHistoryRepository(BaseRepository[PasswordHistory])`
- `PasswordPolicyRepository(BaseRepository[PasswordPolicy])`
- `PasswordAttemptRepository(BaseRepository[PasswordAttempt])`

**Model dependencies:**

- From `app.models.auth`:
  - `PasswordReset`
  - `PasswordHistory`
  - `PasswordPolicy`
  - `PasswordAttempt`

---

### `social_auth_token_repository.py`

**Repository classes in this file:**

- `SocialAuthProviderRepository(BaseRepository[SocialAuthProvider])`
- `SocialAuthTokenRepository(BaseRepository[SocialAuthToken])`
- `SocialAuthProfileRepository(BaseRepository[SocialAuthProfile])`
- `SocialAuthLinkRepository(BaseRepository[SocialAuthLink])`

**Model dependencies:**

- From `app.models.auth`:
  - `SocialAuthProvider`
  - `SocialAuthToken`
  - `SocialAuthProfile`
  - `SocialAuthLink`

---

### `token_blacklist_repository.py`

**Repository classes in this file:**

- `BlacklistedTokenRepository(BaseRepository[BlacklistedToken])`
- `TokenRevocationRepository(BaseRepository[TokenRevocation])`
- `SecurityEventRepository(BaseRepository[SecurityEvent])`

**Model dependencies:**

- From `app.models.auth`:
  - `BlacklistedToken`
  - `TokenRevocation`
  - `SecurityEvent`

---

### `user_session_repository.py`

**Repository classes in this file:**

- `UserSessionRepository(BaseRepository[UserSession])`
- `SessionTokenRepository(BaseRepository[SessionToken])`
- `RefreshTokenRepository(BaseRepository[RefreshToken])`
- `LoginAttemptRepository(BaseRepository[LoginAttempt])`

**Model / enum dependencies:**

- From `app.models.auth`:
  - `UserSession`
  - `SessionToken`
  - `RefreshToken`
  - `LoginAttempt`
- From `app.schemas.common.enums`:
  - `DeviceType` (used in type hints / device categorization)

---

### `auth/__init__.py`

Should only:

- Import and re‑export all auth repository classes:

  - `UserSessionRepository`
  - `SessionTokenRepository`
  - `RefreshTokenRepository`
  - `LoginAttemptRepository`
  - `OTPTokenRepository`
  - `OTPTemplateRepository`
  - `OTPDeliveryRepository`
  - `OTPThrottlingRepository`
  - `PasswordResetRepository`
  - `PasswordHistoryRepository`
  - `PasswordPolicyRepository`
  - `PasswordAttemptRepository`
  - `SocialAuthProviderRepository`
  - `SocialAuthTokenRepository`
  - `SocialAuthProfileRepository`
  - `SocialAuthLinkRepository`
  - `BlacklistedTokenRepository`
  - `TokenRevocationRepository`
  - `SecurityEventRepository`
  - `AuthAggregateRepository`

- Define `__all__` with those names.

No new repository or model classes defined here.

---

## 4. Shared Infrastructure (implicit, but required)

All of the above repositories expect these infrastructure pieces to exist:

- `app.repositories.base.base_repository.BaseRepository`
- Optionally used/shared (some imported but not always used):
  - `QueryBuilder`
  - `PaginationManager`
  - `FilteringEngine`
  - `Specification`

And the various enums referenced:

- `app.schemas.common.enums`:
  - `OTPType`
  - `AuditActionCategory`
- `app.schemas.audit.supervisor_activity_log`:
  - `SupervisorActionCategory`
- `app.models.base.enums`:
  - `AttendanceStatus`
  - `AttendanceMode`
  - `DeviceType`

---

If you want, I can next give you a checklist: for each `app.models.*` module, exactly which model classes it should define so these repositories compile.