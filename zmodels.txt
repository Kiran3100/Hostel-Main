
---

## `admin_user.py`  
**Purpose:** Admin identity, profile, roles, and sessions.

**Classes that should be in this file:**

1. `AdminUser`  
   - Core admin entity (extends base `User` via FK).
   - Handles hierarchy, status, security, multi-hostel flags, and relationships to other admin models.

2. `AdminProfile`  
   - Extended personal/employment/profile details for an `AdminUser`.

3. `AdminRole`  
   - Role definitions with hierarchy and JSON-based permissions (for RBAC).

4. `AdminSession`  
   - Session tracking: tokens, device info, IP, activity, expiration.

No other ORM classes belong in `admin_user.py`.

---

## `admin_permissions.py`  
**Purpose:** Permissions and RBAC infrastructure.

**Classes that should be in this file:**

1. `AdminPermission`  
   - Per-admin (and optionally per-hostel) granular permissions.

2. `PermissionGroup`  
   - Groups related permission keys for organization/UI.

3. `RolePermission`  
   - Mapping of `AdminRole` → individual permission keys/values.

4. `PermissionAudit`  
   - Audit trail for changes to `AdminPermission`.

5. `PermissionTemplate`  
   - Predefined permission sets/templates for quick assignment.

No other ORM classes belong in `admin_permissions.py`.

---

## `admin_hostel_assignment.py`  
**Purpose:** Admin-to-hostel relationship and history.

**Classes that should be in this file:**

1. `AdminHostelAssignment`  
   - Core admin–hostel assignment record, with status, metrics, and permission_level.

2. `AssignmentPermission`  
   - Fine-grained permission overrides scoped to a specific `AdminHostelAssignment`.

3. `AssignmentHistory`  
   - Historical log of changes to an `AdminHostelAssignment`.

4. `PrimaryHostelDesignation`  
   - History of which hostel is marked primary for an admin.

No other ORM classes belong in `admin_hostel_assignment.py`.

---

## `admin_override.py`  
**Purpose:** Supervisor override tracking, approval, and impact.

**Classes that should be in this file:**

1. `AdminOverride`  
   - A single override of a supervisor decision, with reasons, severity, impact, approval, and reversal info.

2. `OverrideReason`  
   - Predefined standardized override reasons.

3. `OverrideApproval`  
   - Higher-level approval workflow items for overrides.

4. `OverrideImpact`  
   - Detailed operational/financial/stakeholder impact assessment for an override.

No other ORM classes belong in `admin_override.py`.

---

## `hostel_context.py`  
**Purpose:** Active hostel context and context switching for admins.

**Classes that should be in this file:**

1. `HostelContext`  
   - Current active hostel for an admin, with session metrics and cached stats.

2. `ContextSwitch`  
   - Individual records of switching from one hostel to another in the UI.

3. `ContextPreference`  
   - Per-context UI and behavior preferences (dashboard layout, filters, etc.).

4. `ContextSnapshot`  
   - Snapshot of hostel/UI state at the moment of a switch.

No other ORM classes belong in `hostel_context.py`.

---

## `hostel_selector.py`  
**Purpose:** Models backing the hostel selector UI (recents, favorites, quick stats, cache).

**Classes that should be in this file:**

1. `RecentHostel`  
   - Tracks recency and frequency of accesses by an admin to a hostel.

2. `FavoriteHostel`  
   - Admin’s favorited hostels with labels, notes, customization.

3. `HostelQuickStats`  
   - Per-hostel cached stats used in selector (occupancy, pending tasks, etc.).

4. `HostelSelectorCache`  
   - Per-admin cached assembled selector payload (recent/favorites/attention, etc.).

No other ORM classes belong in `hostel_selector.py`.

---

## `multi_hostel_dashboard.py`  
**Purpose:** Portfolio-level analytics and dashboard configuration.

**Classes that should be in this file:**

1. `MultiHostelDashboard`  
   - Aggregated statistics across all hostels an admin manages, for a period.

2. `CrossHostelMetric`  
   - Per-metric cross-hostel comparison (best/worst, averages, distribution).

3. `HostelPerformanceRanking`  
   - Ranking of individual hostels according to composite performance scores.

4. `DashboardWidget`  
   - User-configurable dashboard widgets (type, layout, config, cache).

5. `DashboardSnapshot`  
   - Historical snapshots of the dashboard and its summary stats.

No other ORM classes belong in `multi_hostel_dashboard.py`.

---

## `__init__.py` (admin package)  
**Purpose:** Public API and organization for the admin models package.

This file should:

- Import and re-export all ORM classes listed above.
- Define:
  - `__all__`
  - Grouping lists:
    - `ADMIN_USER_MODELS`
    - `PERMISSION_MODELS`
    - `ASSIGNMENT_MODELS`
    - `OVERRIDE_MODELS`
    - `CONTEXT_MODELS`
    - `SELECTOR_MODELS`
    - `DASHBOARD_MODELS`
    - `ALL_MODELS_ORDERED`
  - Helper functions:
    - `get_model_by_name`
    - `get_models_by_category`
  - Optional relationship setup helpers (as you started with `setup_relationships`).

It should not define new ORM models; it is an index/aggregator module.

---
---

## `base_analytics.py`  – Core base classes & mixins

This file should only contain *generic*, cross‑domain building blocks:

- **`BaseAnalyticsModel`**  
  Abstract base model for all analytics entities (UUID `id`, timestamps via `TimestampMixin`, `notes`, `metadata_json`, `to_dict()`).

- **`AnalyticsMixin`**  
  Common analytics fields:
  - `period_start`, `period_end`
  - `calculated_at`, `is_cached`, `cache_expires_at`
  - `calculation_metadata`
  - Table constraints for valid period.

- **`MetricMixin`**  
  Generic metric fields:
  - `metric_value`, `target_value`, `previous_value`, `variance`, `unit`.

- **`TrendMixin`**  
  Generic trend fields:
  - `trend_direction`, `trend_percentage`, `trend_confidence`.

- **`AggregationMixin`**  
  Generic aggregation info:
  - `aggregation_level`, `data_source_count`, `aggregation_method`.

- **`CachedAnalyticsMixin`**  
  Cache lifecycle info:
  - `is_cached`, `cache_key`, `cache_created_at`, `cache_expires_at`, `cache_hit_count`
  - `is_cache_valid` property, `invalidate_cache()` method.

- **`HostelScopedMixin`**  
  Scoping analytics by hostel vs platform:
  - `hostel_id` FK to `hostels.id`
  - `scope_type` enum (`hostel` / `platform`).

- **`ComparisonMixin`**  
  Benchmark / peer comparison fields:
  - `benchmark_value`, `peer_average`, `percentile_rank`, `comparison_group`.

No domain‑specific analytics classes should be here.

---

## `booking_analytics.py` – Booking‑related analytics

File for booking funnel, cancellations, source performance, and summary:

- **`BookingKPI`**  
  Hostel‑scoped KPIs for bookings:
  - booking counts & statuses
  - `booking_conversion_rate`, `cancellation_rate`, `average_lead_time_days`, `approval_rate`
  - `trends` relationship → `BookingTrendPoint`.

- **`BookingTrendPoint`**  
  Daily booking trend time‑series:
  - `trend_date`, booking status counts, `revenue_for_day`, `conversion_rate`
  - FK `kpi_id` → `BookingKPI`.

- **`BookingFunnelAnalytics`**  
  Hostel‑scoped booking funnel:
  - `hostel_page_views` → `bookings_confirmed`
  - stage conversion rates
  - largest drop‑off stage, `total_drop_offs`.

- **`CancellationAnalytics`**  
  Hostel‑scoped cancellation analytics:
  - cancellation counts & timing (within 24h / week, etc.)
  - `cancellations_by_reason`, `cancellations_by_status`, `top_cancellation_reason`.

- **`BookingSourceMetrics`**  
  Per‑source performance:
  - `source`, booking counts, `conversion_rate`
  - revenue metrics & optional marketing metrics (`marketing_cost`, `roi`).

- **`BookingAnalyticsSummary`**  
  Cached, hostel‑scoped aggregate:
  - Links to `BookingKPI`, `BookingFunnelAnalytics`, `CancellationAnalytics`
  - `total_bookings`, `total_revenue`, `overall_conversion_rate`
  - JSONB breakdowns: `bookings_by_source`, `revenue_by_source`, `trend_summary`, and best sources.

---

## `complaint_analytics.py` – Complaint / SLA analytics

File for complaints, SLA, breakdowns, and dashboard:

- **`ComplaintKPI`**  
  Hostel‑scoped complaint KPIs:
  - complaint volumes, resolution metrics, SLA, escalation, reopen, satisfaction, efficiency, backlog
  - `trends` → `ComplaintTrendPoint`
  - `sla_metrics` → `SLAMetrics`.

- **`SLAMetrics`**  
  Detailed SLA compliance for a `ComplaintKPI`:
  - `total_with_sla`, `met_sla`, `breached_sla`
  - `sla_compliance_rate`, `average_sla_buffer_hours`, `at_risk_count`.

- **`ComplaintTrendPoint`**  
  Daily complaint trends:
  - `trend_date`, counts and `resolution_rate`
  - FK to `ComplaintKPI`.

- **`CategoryBreakdown`**  
  Hostel‑scoped per‑category analytics:
  - `category`, counts, % of total, avg resolution time, resolution rate.

- **`PriorityBreakdown`**  
  Hostel‑scoped per‑priority analytics:
  - `priority`, counts, % of total, avg resolution time, SLA compliance, priority score.

- **`ComplaintDashboard`**  
  Cached hostel‑scoped dashboard aggregate:
  - quick totals (`total_complaints`, `open_complaints`, `urgent_complaints`)
  - most common / slowest categories
  - high‑priority %, JSONB category & priority breakdowns, actionable insights
  - FK `kpi_id` → `ComplaintKPI`.

---

## `custom_reports.py` – Custom reporting system

File for report configuration, scheduling, history, and cached results:

- **`CustomReportDefinition`**  
  Saved report definition:
  - ownership (`owner_id`), `report_name`, `module`, `fields`, `filters`, `group_by`, `sort`
  - sharing metadata, usage stats (`run_count`, `last_run_at`, `complexity_score`)
  - relationships: `schedules`, `execution_history`.

- **`ReportSchedule`**  
  Scheduling configuration:
  - `frequency`, `time_of_day`, `day_of_week`, `day_of_month`, `timezone`
  - email recipients, format, status, run tracking
  - FK to `CustomReportDefinition`.

- **`ReportExecutionHistory`**  
  Execution logs:
  - who ran it, execution type, timing, status, result size, errors, parameters
  - FK to `CustomReportDefinition` (and optional `ReportSchedule`).

- **`CachedReportResult`**  
  Cached result of a report run:
  - FK to `CustomReportDefinition`, optional FK to `ReportExecutionHistory`
  - `result_data`, `row_count`, `column_definitions`, `summary_stats`
  - `generated_at`, `parameters_hash`, `data_size_bytes`
  - cache fields from `CachedAnalyticsMixin`.

---

## `dashboard_analytics.py` – Dashboard & widgets

File for generic KPIs, time‑series, widgets, alerts, quick stats, and role dashboards:

- **`DashboardKPI`**  
  Hostel‑scoped KPI entries:
  - `kpi_key`, `kpi_name`, category, trend info, display options, status, period.

- **`TimeseriesMetric`**  
  Time‑series metric points:
  - `metric_key`, optional `hostel_id`, `data_date`, `value`, `label`, `metadata`.

- **`DashboardWidget`**  
  Widget configuration:
  - `user_id` / `role` / `hostel_id` targeting
  - `widget_id`, `widget_type`, `title`, `position`, `size`, `data_source`
  - visibility & `configuration`.

- **`AlertNotification`**  
  Alerts for dashboards:
  - `hostel_id`, `severity`, `title`, `message`, action info
  - expiration & dismissal metadata, `alert_metadata`.

- **`QuickStats`**  
  Cached hostel‑scoped snapshot:
  - totals for hostels, students, visitors
  - daily operations, complaints, maintenance
  - financial stats, occupancy & health indicators
  - `snapshot_date`.

- **`RoleSpecificDashboard`**  
  Cached hostel‑ / user‑ / role‑specific dashboard:
  - `user_id`, `role`, `hostel_id`
  - `sections`, `metrics_by_section`, `kpis_by_section`
  - `accessible_features`, preferences, alerts flags.

---

## `financial_analytics.py` – Financials, P&L, cashflow

File for revenue/expense breakdowns, ratios, P&L, cashflow, budget, tax, and financial report:

- **`RevenueBreakdown`**  
  Hostel‑scoped revenue details:
  - by type, by hostel, by payment type
  - collection metrics & `collection_rate`.

- **`ExpenseBreakdown`**  
  Hostel‑scoped expense details:
  - by category, by hostel, fixed vs variable
  - largest category, staff expense ratio.

- **`FinancialRatios`**  
  Hostel‑scoped ratios:
  - profitability, efficiency, collection, cost ratios
  - status flags.

- **`ProfitAndLossStatement`**  
  Hostel‑scoped cached P&L:
  - links to `RevenueBreakdown`, `ExpenseBreakdown`, `FinancialRatios`
  - gross / operating / net profit, margins, profitability flags, performance summary.

- **`CashflowPoint`**  
  Single cashflow time‑series point:
  - `cashflow_date`, inflow, outflow, net flow, balance, `is_positive_flow`
  - FK to `CashflowSummary`.

- **`CashflowSummary`**  
  Hostel‑scoped cached cashflow:
  - opening/closing balances, totals, net cashflow
  - breakdowns, liquidity metrics, health, burn rate, ratios
  - `timeseries` of `CashflowPoint`.

- **`BudgetComparison`**  
  Hostel‑scoped budget vs actual per category:
  - `budgeted_amount`, `actual_amount`, variance amount & %, severity, favorability.

- **`TaxSummary`**  
  Hostel‑scoped tax summary:
  - taxable vs exempt revenue
  - GST collected/paid/payable, TDS, income tax, effective tax rate.

- **`FinancialReport`**  
  Hostel‑scoped cached consolidated report:
  - links to `ProfitAndLossStatement`, `CashflowSummary`, `TaxSummary`
  - key metrics (collection, overdue, revenue per student/bed, occupancy, ADR)
  - YoY growth, health score, grade, executive summary
  - also includes `ComparisonMixin` fields (benchmarks/peers).

---

## `occupancy_analytics.py` – Occupancy & forecasting

File for occupancy KPIs, trends, breakdowns, seasonal patterns, forecasts, and reports:

- **`OccupancyKPI`**  
  Hostel‑scoped occupancy KPIs:
  - current, average, peak, low occupancy
  - capacity metrics (beds, occupied, available, reserved, maintenance)
  - utilization, turnover, status, pressure, vacancy.

- **`OccupancyTrendPoint`**  
  Daily occupancy time‑series:
  - `trend_date`, occupancy %, beds, check‑ins/outs, `net_change`
  - FK to `OccupancyKPI`.

- **`OccupancyByRoomType`**  
  Hostel‑scoped per‑room‑type breakdown:
  - room/bed counts, occupancy, revenue metrics, rates.

- **`OccupancyByFloor`**  
  Hostel‑scoped per‑floor breakdown:
  - room/bed counts, occupancy.

- **`SeasonalPattern`**  
  Hostel‑scoped recurring patterns:
  - `pattern_name`, months range, average occupancy, variance, confidence, season flag, year identified.

- **`ForecastPoint`**  
  Single forecasted point:
  - `forecast_date`, forecasted occupancy %, occupied beds, confidence bounds and level
  - FK to `ForecastData`.

- **`ForecastData`**  
  Hostel‑scoped cached forecast metadata:
  - `forecast_horizon_days`, `model_used`, accuracy, interval
  - training data window & samples
  - aggregate forecast stats and important dates
  - `forecast_points` relationship
  - `seasonal_patterns` many‑to‑many through association table.

- **`forecast_seasonal_patterns`** (association `Table`)  
  Join table linking `ForecastData` ↔ `SeasonalPattern`.

- **`OccupancyReport`**  
  Hostel‑scoped cached report:
  - links to `OccupancyKPI` and `ForecastData`
  - best/worst room types, trend direction
  - room/floor breakdown JSONB and optimization insights.

---

## `platform_analytics.py` – Platform / multi‑tenant analytics

File for super‑admin / platform‑wide metrics:

- **`TenantMetrics`**  
  Per‑tenant performance & health:
  - subscription info, MRR, usage metrics, activity
  - health & churn risk scores, at‑risk flag, revenue per bed, engagement status.

- **`PlatformMetrics`**  
  Cached platform‑wide aggregates:
  - total/active/trial/suspended/churned hostels
  - user counts by role
  - DAU/MAU, sessions, capacity & occupancy
  - activation rate, conversion potential.

- **`MonthlyMetric`**  
  Monthly metric point for trend charts:
  - `metric_key`, `month` (YYYY-MM), `value`, `label`
  - optional FK to `GrowthMetrics`.

- **`GrowthMetrics`**  
  Cached growth analytics:
  - new/churned/net hostels; growth rate
  - revenue growth (amount & rate)
  - user growth; MRR growth
  - growth flags and scores, CAGR
  - `monthly_data` relationship to `MonthlyMetric`.

- **`ChurnAnalysis`**  
  Cached churn metrics:
  - churn counts, rates, revenue churn
  - churn reasons, at‑risk, retention, status.

- **`SystemHealthMetrics`**  
  Cached system performance/health:
  - uptime, downtime, incidents
  - response time percentiles
  - error rates
  - CPU/memory usage, DB metrics
  - health status and performance grade.

- **`PlatformUsageAnalytics`**  
  Cached platform usage:
  - traffic metrics, error rate, module requests
  - feature adoption, response times, resource usage
  - storage usage, most/least used modules, health indicator.

- **`RevenueMetrics`**  
  Cached platform‑wide revenue:
  - total, subscription, transaction, other revenue
  - MRR, ARR, by plan
  - ARPU, LTV, cohort revenue (new/expansion/churn)
  - diversity score, net new MRR.

---

## `supervisor_analytics.py` – Supervisor / team performance

File for supervisor KPIs, workload, performance, trends, comparisons, and team‑level analytics:

- **`SupervisorWorkload`**  
  Workload metrics linked to one `SupervisorKPI`:
  - current tasks, urgent/overdue
  - capacity, utilization, available capacity, status.

- **`SupervisorPerformanceRating`**  
  Detailed ratings linked to `SupervisorKPI`:
  - efficiency, quality, responsiveness, satisfaction, reliability
  - overall rating, grade, strengths, improvement areas.

- **`SupervisorKPI`**  
  Hostel‑scoped per‑supervisor KPIs:
  - IDs & names
  - workload counts (complaints, maintenance, attendance)
  - performance & SLA metrics, feedback, composite score
  - derived rates & status
  - relationships: `workload`, `performance_rating`, `trends`.

- **`SupervisorTrendPoint`**  
  Periodic trends per supervisor:
  - `period_label`, `period_start`/`end`
  - tasks resolved/completed, scores, feedback, total tasks
  - FK to `SupervisorKPI`.

- **`SupervisorComparison`**  
  Hostel‑ or platform‑scoped cached comparison:
  - `scope_type` (string here)
  - JSONB rankings by various dimensions
  - averages, top performer, variance.

- **`TeamAnalytics`**  
  Hostel‑scoped aggregate team metrics:
  - supervisor counts
  - task assignments/completions, completion rate
  - average team scores, SLA, workload balance, top performers, efficiency label.

---

## `visitor_analytics.py` – Visitor, funnel, traffic & behavior

File for marketing / visitor analytics:

- **`VisitorFunnel`**  
  Cached global visitor funnel:
  - volumes for visits → confirmed bookings
  - conversion rates stage‑by‑stage
  - drop‑off counts and stages, efficiency score.

- **`TrafficSourceMetrics`**  
  Per‑source metrics:
  - visit/engagement metrics, conversions & conversion rates
  - revenue and cost metrics, ROI, quality/engagement scores.

- **`SearchBehavior`**  
  Cached search analytics:
  - search volumes, patterns (cities, keywords)
  - filter usage, price ranges
  - search quality (results, zero‑result searches, rates, score).

- **`EngagementMetrics`**  
  Engagement depth:
  - hostels/pages per session, time on page
  - feature usage for comparison, reviews, photos
  - inquiries & conversion, engagement level.

- **`VisitorBehaviorAnalytics`**  
  Cached consolidated behavior:
  - links to `SearchBehavior` and `EngagementMetrics`
  - exit pages & reasons
  - bounce rate, session duration, return visitor rate
  - quality score and optimization recommendations.

- **`ConversionPathAnalysis`**  
  Conversion path / attribution:
  - touches and days to conversion
  - top paths
  - attribution JSONB (first/last touch)
  - complexity label.

- **`TrafficSourceAnalytics`**  
  Cached aggregate traffic source analytics:
  - `total_visits`
  - visits/registrations/bookings and conversion rates by source
  - best/highest/ROI sources.

---

## `__init__.py` – Analytics package exports

This file should:

- Import all the classes above from their respective modules.
- Define `__all__` to re‑export:
  - Base & mixins
  - Booking, Complaint, Dashboard, Financial, Occupancy, Platform, Supervisor, Visitor analytics
  - Custom report classes.

As written, your `__init__.py` correctly reflects the classes defined in each file.

---
---

## Package-Level View

The announcement models are split by concern:

- **Core**: `announcement.py`
- **Targeting**: `announcement_targeting.py`
- **Scheduling**: `announcement_scheduling.py`
- **Approval workflow**: `announcement_approval.py`
- **Delivery**: `announcement_delivery.py`
- **Tracking & engagement**: `announcement_tracking.py`
- **Exports / wiring**: `__init__.py`

Only a subset of classes in each file are meant to be used directly elsewhere; those are what each module’s `__all__` and the package `__init__.py` expose.

---

## `announcement.py` — Core announcement models

**Public ORM models (exported in `__all__` and from the package):**

1. `Announcement`
   - Core announcement entity with full lifecycle fields (content, status, targeting arrays, delivery flags, metrics, approvals, archiving, etc.).
2. `AnnouncementAttachment`
   - One attachment record (file) associated with an announcement.
3. `AnnouncementVersion`
   - Version history of an announcement (snapshot per edit).
4. `AnnouncementRecipient`
   - Concrete recipient/student for an announcement (post-targeting expansion).

**Also present but not exported from this module:**

- Type-checking-only imports of `Hostel`, `User`, and other related announcement models.

> Practically: when writing app code, you should be importing `Announcement`, `AnnouncementAttachment`, `AnnouncementVersion`, and `AnnouncementRecipient` from this module / package.

---

## `announcement_approval.py` — Approval workflow models

**Public ORM models (exported in `__all__` and from the package):**

1. `AnnouncementApproval`
   - One approval record for a specific announcement (who requested, status, decision, auto-publish, SLA, escalation, etc.).
2. `ApprovalWorkflow`
   - Configuration for multi-step approval workflows at hostel-level (steps, routing rules, SLA, escalation).
3. `ApprovalHistory`
   - Audit trail entries for actions taken in an approval workflow.
4. `ApprovalRule`
   - Auto-approval rules with conditions and usage tracking.

**Internal helper:**

- `ApprovalStatus`
  - A simple constant-holder (`PENDING`, `APPROVED`, `REJECTED`, `NOT_REQUIRED`), used as a string “enum”. Not exported in `__all__`.

---

## `announcement_delivery.py` — Delivery & channels

**Public ORM models (exported in `__all__` and from the package):**

1. `AnnouncementDelivery`
   - Per-recipient, per-channel delivery tracking (status, provider info, retries, open/click data, etc.).
2. `DeliveryChannel`
   - Channel configuration for a hostel (e.g. email via SendGrid, SMS via Twilio), including rate limits & health.
3. `DeliveryBatch`
   - Batch-level processing unit for deliveries (status, progress, metrics).
4. `DeliveryFailure`
   - Detailed failure records for failed deliveries.
5. `DeliveryRetry`
   - Individual retry attempts for a given delivery.

**Internal helper “enum-like” classes:**

- `DeliveryChannelType` (`EMAIL`, `SMS`, `PUSH`, `IN_APP`)
- `DeliveryState` (`PENDING`, `PROCESSING`, `COMPLETED`, `FAILED`, `PAUSED`, `CANCELLED`)
- `DeliveryStrategy` (`IMMEDIATE`, `SCHEDULED`, `BATCHED`)

These are used as constant string sets; not exported in `__all__`.

---

## `announcement_scheduling.py` — Scheduling & recurrence

**Public ORM models (exported in `__all__` and from the package):**

1. `AnnouncementSchedule`
   - Per-announcement scheduling configuration (one-time or recurring, expiry, status, failure counts).
2. `RecurringAnnouncement`
   - Hostel-level recurring template that periodically generates announcements.
3. `ScheduleExecution`
   - Execution attempts of a schedule (when attempted, status, recipients, errors, retries).
4. `PublishQueue`
   - Queue entry for announcements waiting to be published (priority, locking, retries).

**Internal helper “enum-like” classes:**

- `RecurrencePattern` (`DAILY`, `WEEKLY`, `BIWEEKLY`, `MONTHLY`)
- `ScheduleStatus` (`PENDING`, `PUBLISHED`, `CANCELLED`, `FAILED`)

These provide canonical strings; not exported in `__all__`.

---

## `announcement_targeting.py` — Targeting & audience selection

**Public ORM models (exported in `__all__` and from the package):**

1. `AnnouncementTarget`
   - Per-announcement targeting config (type: ALL/ROOM/FLOOR/etc., room/floor/student IDs, filters, estimated vs actual recipients).
2. `TargetingRule`
   - One rule under a `AnnouncementTarget` (field/operator/value, inclusion/exclusion, priority).
3. `TargetAudienceCache`
   - Cached computed list of student IDs and breakdowns for a given announcement+target.
4. `BulkTargetingRule`
   - Higher-level combination of multiple targets (`target_ids`) with union/intersection and global exclusions.

**Enums used but not defined here:**

- `TargetAudience` and `RoomType` are imported from `app.models.base.enums`.

---

## `announcement_tracking.py` — Views, reads, acknowledgments, engagement

**Public ORM models (exported in `__all__` and from the package):**

1. `AnnouncementView`
   - A view record (possibly multiple per student) with context (device, source, reading behavior).
2. `ReadReceipt`
   - One per announcement+student, confirming the student has “read” (with time to read, completeness).
3. `Acknowledgment`
   - One per announcement+student, explicit acknowledgment (optionally with action verification and timing).
4. `EngagementMetric`
   - Aggregated engagement stats per announcement: delivery, reading, acknowledgment, device/channel, interactions, overall engagement score.
5. `ReadingTimeAnalytic`
   - Aggregated reading time distribution stats per announcement (average/median/min/max, quick/normal/thorough, device-specific times).

**Internal helper “enum-like” class:**

- `DeviceType` (`MOBILE`, `WEB`, `TABLET`, `DESKTOP`)

Used as string constants; not exported in `__all__`.

---

## `__init__.py` — Package exports

The package’s `__init__.py` re-exports the **public ORM models** from all the above modules as the public API of `app.models.announcement`.

You can safely assume that the **intended** classes to exist and be used from this package are exactly those in `__all__` here:

- Core:
  - `Announcement`, `AnnouncementAttachment`, `AnnouncementVersion`, `AnnouncementRecipient`
- Targeting:
  - `AnnouncementTarget`, `TargetingRule`, `TargetAudienceCache`, `BulkTargetingRule`
- Scheduling:
  - `AnnouncementSchedule`, `RecurringAnnouncement`, `ScheduleExecution`, `PublishQueue`
- Approval:
  - `AnnouncementApproval`, `ApprovalWorkflow`, `ApprovalHistory`, `ApprovalRule`
- Delivery:
  - `AnnouncementDelivery`, `DeliveryChannel`, `DeliveryBatch`, `DeliveryFailure`, `DeliveryRetry`
- Tracking:
  - `AnnouncementView`, `ReadReceipt`, `Acknowledgment`, `EngagementMetric`, `ReadingTimeAnalytic`

Everything else (the small constant-holder classes) is internal support.


Continuing the mapping for the other model packages you shared.

---

## Attendance models (`app/models/attendance`)

### `attendance_alert.py`

Should contain:

- `AttendanceAlert`
  - Core alert instance for attendance issues (per student/hostel).
- `AlertConfiguration`
  - Per-hostel configuration for when/how alerts are generated and notified.
- `AlertNotification`
  - Individual notification deliveries for a specific alert (per user, per channel).

And `__all__` exports those three.

---

### `attendance_policy.py`

Should contain:

- `AttendancePolicy`
  - Per-hostel policy settings: thresholds, late rules, leave, etc.
- `PolicyViolation`
  - Instances where a student has violated the policy; tracks metrics and notification state.
- `PolicyException`
  - Temporary/approved exceptions to the policy for particular students.

And `__all__` exports those three.

---

### `attendance_record.py`

Should contain:

- `AttendanceRecord`
  - Main daily record per student (check-in/out, status, geolocation, device info).
- `AttendanceCorrection`
  - Audit trail for changes to `AttendanceRecord` (before/after values, approver).
- `BulkAttendanceLog`
  - Logs batch operations on attendance (stats, errors, timing).

And `__all__` exports those three.

---

### `attendance_report.py`

Should contain:

- `AttendanceReport`
  - Cached/generated report artifacts (summary, detailed, analytics, files).
- `AttendanceSummary`
  - Per-student summarised metrics by period (e.g. month, term).
- `AttendanceTrend`
  - Trend/analytics entity over time, potentially per hostel or per student.

And `__all__` exports those three.

---

### `attendance/__init__.py`

Should re-export:

- `AttendanceRecord`, `AttendanceCorrection`, `BulkAttendanceLog`
- `AttendancePolicy`, `PolicyViolation`, `PolicyException`
- `AttendanceAlert`, `AlertConfiguration`, `AlertNotification`
- `AttendanceReport`, `AttendanceSummary`, `AttendanceTrend`

---

## Audit models (`app/models/audit`)

### `admin_override_log.py`

Should contain:

- `AdminOverrideLog`
  - Records admin overrides of supervisor/staff decisions with full context and impact score.

No other classes in this file.

---

### `audit_log.py`

Should contain:

- `AuditLog`
  - System-wide audit log entry:
    - who did what, on which entity, old/new values, request context, compliance flags, etc.
- `EntityChangeLog` (basic version)
  - Field-level change log tied to a specific `AuditLog` entry:
    - one record per field change.
    - Has `audit_log` backref as `change_details`.

Note:  
There is a second, more advanced `EntityChangeLog` in `entity_change_log.py`. The one in `audit_log.py` is a simpler, tightly-coupled-to-AuditLog version. The package `__init__.py` re-exports the advanced one, not this basic one.

---

### `entity_change_log.py`

Should contain:

- `EntityChangeLog` (advanced/primary)
  - Rich, standalone field-level change log:
    - Optional link to `AuditLog`
    - Actor info, source (web/api/import), PII flags, versioning, parent/child changes
    - Helper methods for history/lookups, impact scoring, etc.
- `EntityChangeHistory`
  - Snapshot-style, full-entity version history:
    - Stores complete entity state, version, tags, etc.

This is the main entity-change tracking module used in the package exports.

---

### `supervisor_activity_log.py`

Should contain:

- `SupervisorActivityLog`
  - Detailed log of supervisor actions (tasks, interactions, quality metrics, GPS, shifts).

No other classes in this file.

---

### `audit/__init__.py`

Should re-export:

- `AuditLog`
- `EntityChangeLog` (advanced one from `entity_change_log.py`)
- `EntityChangeHistory`
- `SupervisorActivityLog`
- `AdminOverrideLog`

---

## Auth models (`app/models/auth`)

### `otp_token.py`

Should contain:

- `OTPToken`
  - Core OTP entity: code, type, attempts, expiration, status, metadata.
- `OTPTemplate`
  - Per-type/per-channel/per-language template configuration.
- `OTPDelivery`
  - Individual delivery attempts/status for each channel.
- `OTPThrottling`
  - Throttling records for OTP request rate limiting and blocking.

And `__all__` exports those four.

---

### `password_reset.py`

Should contain:

- `PasswordReset`
  - Password reset token entity (single use, hashed, expiration, context).
- `PasswordHistory`
  - Historical password hashes per user (reuse prevention).
- `PasswordPolicy`
  - Global or per-tenant password policy.
- `PasswordAttempt`
  - Failed password verification attempts (not login attempts; this is password-specific).

And `__all__` exports those four.

---

### `social_auth_token.py`

Should contain:

- `SocialAuthProvider`
  - OAuth provider configuration (client_id/secret, URLs, default scopes).
- `SocialAuthToken`
  - Stored OAuth tokens per user+provider (access/refresh).
- `SocialAuthProfile`
  - Cached social profile information for a user from provider.
- `SocialAuthLink`
  - Link/unlink records between a local account and a provider.

And `__all__` exports those four.

---

### `token_blacklist.py`

Should contain:

- `BlacklistedToken`
  - Blacklisted JWTs for revocation by JTI.
- `TokenRevocation`
  - Higher-level audit record of revocation operations (single/all, forced, etc.).
- `SecurityEvent`
  - Security events (suspicious behavior, anomalies, etc.), with resolution info.

And `__all__` exports those three.

---

### `user_session.py`

Should contain:

- `UserSession`
  - Active session: device, IP, geo, risk, last activity.
- `SessionToken`
  - Access token record for a session (JTI, hash, revocation).
- `RefreshToken`
  - Refresh token with rotation chain and family tracking.
- `LoginAttempt`
  - Login attempt tracking (per email/phone/IP/device): for brute-force detection.

And `__all__` exports those four.

---

### `auth/__init__.py`

Should re-export exactly:

- User session:
  - `UserSession`, `SessionToken`, `RefreshToken`, `LoginAttempt`
- OTP:
  - `OTPToken`, `OTPTemplate`, `OTPDelivery`, `OTPThrottling`
- Password:
  - `PasswordReset`, `PasswordHistory`, `PasswordPolicy`, `PasswordAttempt`
- Social auth:
  - `SocialAuthProvider`, `SocialAuthToken`, `SocialAuthProfile`, `SocialAuthLink`
- Token blacklist/security:
  - `BlacklistedToken`, `TokenRevocation`, `SecurityEvent`

---

## Booking models (`app/models/booking`)

### `booking.py`

Should contain:

- `Booking`
  - Core booking entity: lifecycle (pending→approved→confirmed→checked_in→completed/no_show/cancelled), pricing, dates, relations.
- `BookingStatusHistory`
  - Status transition history (from/to, by, reason).
- `BookingNote`
  - Internal/admin notes about a booking (soft-deletable, pinned, visibility).

---

### `booking_approval.py`

Should contain:

- `BookingApproval`
  - One-to-one approval record for a booking: final amounts, advance requirements, messages, auto-approval flags.
- `RejectionRecord`
  - Detailed rejection data and suggested alternatives.
- `ApprovalSettings`
  - Per-hostel approval policy and auto-approval configs.

`__all__` for this module: `BookingApproval`, `ApprovalSettings`, `RejectionRecord`.

---

### `booking_assignment.py`

Should contain:

- `BookingAssignment`
  - One-to-one assignment of booking → room/bed, metadata, active/deactivated state.
- `AssignmentHistory`
  - History of room/bed changes for that booking (from/to, reason, type).

`__all__`: `BookingAssignment`, `AssignmentHistory`.

---

### `booking_calendar.py`

Should contain:

- `BookingCalendarEvent`
  - Calendar view event for bookings/check-ins/maintenance.
- `DayAvailability`
  - Per-day bed availability (hostel or room scope).
- `CalendarBlock`
  - Blocks of time for maintenance/closure (hostel/room/bed).

`__all__`: `BookingCalendarEvent`, `DayAvailability`, `CalendarBlock`.

---

### `booking_cancellation.py`

Should contain:

- `BookingCancellation`
  - One-to-one cancellation record for a booking: who, why, refunds, refund status.
- `CancellationPolicy`
  - Per-hostel cancellation policy with tiered charges.
- `RefundTransaction`
  - Individual refund transaction objects (decoupled from `Payment` for reconciliation).

`__all__`: `BookingCancellation`, `CancellationPolicy`, `RefundTransaction`.

---

### `booking_conversion.py`

Should contain:

- `BookingConversion`
  - One-to-one record of converting booking → student profile (payments, docs, next rent).
- `ConversionChecklist`
  - One-to-one checklist for that conversion (aggregated state, metrics).
- `ChecklistItem`
  - Individual checklist items linked to `ConversionChecklist`.

`__all__`: `BookingConversion`, `ConversionChecklist`, `ChecklistItem`.

---

### `booking_guest.py`

Should contain:

- `BookingGuest`
  - Guest details tied one-to-one to a booking: contact, emergency, institution, guardian, consents.
- `GuestDocument`
  - Uploaded guest documents (ID, photo, etc.) plus verification and expiry.

`__all__`: `BookingGuest`, `GuestDocument`.

---

### `booking_modification.py`

Should contain:

- `BookingModification`
  - Modification request (date, duration, room type, pricing impact) + workflow.
- `ModificationApprovalRecord`
  - Detailed admin decision for that modification (approved/rejected, adjusted price, notes).

`__all__`: `BookingModification`, `ModificationApprovalRecord`.

---

### `booking_waitlist.py`

Should contain:

- `BookingWaitlist`
  - Waitlist entry for a hostel/room_type/date: status, priority, conversion.
- `WaitlistNotification`
  - Notifications sent to waitlisted visitors when availability appears.

`__all__`: `BookingWaitlist`, `WaitlistNotification`.

---

### `booking/__init__.py`

Should re-export:

- Core: `Booking`, `BookingStatusHistory`, `BookingNote`
- Guest: `BookingGuest`, `GuestDocument`
- Assignment: `BookingAssignment`, `AssignmentHistory`
- Approval: `BookingApproval`, `RejectionRecord`, `ApprovalSettings`
- Cancellation: `BookingCancellation`, `CancellationPolicy`, `RefundTransaction`
- Conversion: `BookingConversion`, `ConversionChecklist`, `ChecklistItem`
- Modification: `BookingModification`, `ModificationApprovalRecord`
- Calendar: `BookingCalendarEvent`, `DayAvailability`, `CalendarBlock`
- Waitlist: `BookingWaitlist`, `WaitlistNotification`

---

---

## `complaint.py`

**Classes that should be here:**

- `Complaint`
  - Core complaint entity (the central record).
  - Owns relationships to:
    - `ComplaintAssignment`
    - `ComplaintComment`
    - `ComplaintEscalation`
    - `ComplaintResolution`
    - `ComplaintFeedback`
  - Also ties to `Hostel`, `User`, `Student`, `Room`.

Nothing else belongs in this file besides imports, `__all__ = ["Complaint"]`, and the model itself.

---

## `complaint_analytics.py`

**Classes that should be here:**

- `ComplaintAnalyticSnapshot`
  - Pre-computed, time-bucketed analytics snapshot (daily/weekly/monthly/etc.).

- `ComplaintCategoryMetric`
  - Per-category metrics (per hostel and period).

- `ComplaintStaffPerformance`
  - Per-staff performance metrics (per hostel and period).

These three are all analytics/aggregation models and belong together here.

---

## `complaint_assignment.py`

**Classes that should be here:**

- `ComplaintAssignment`
  - Assignment history entries for a complaint.
  - Tracks who it was assigned to, when, workload score, duration, etc.

This file is only for assignment history; no other classes.

---

## `complaint_comment.py`

**Classes that should be here:**

- `ComplaintComment`
  - Comments and internal notes on a complaint.
  - Supports threading (parent/child comments), attachments, mentions, edit tracking.

This file is just for the comment/discussion model.

---

## `complaint_escalation.py`

**Classes that should be here:**

- `ComplaintEscalation`
  - Individual escalation events on a complaint (who escalated, level, response, etc.).

- `AutoEscalationRule`
  - Configuration for automatic escalations (per hostel, with thresholds by priority).

Both are escalation-related and belong together here.

---

## `complaint_feedback.py`

**Classes that should be here:**

- `ComplaintFeedback`
  - One feedback record per complaint (enforced unique per `complaint_id`).
  - Holds rating, text feedback, detailed ratings, sentiment, follow-up flags.

This file is just for feedback/satisfaction tracking.

---

## `complaint_resolution.py`

**Classes that should be here:**

- `ComplaintResolution`
  - Resolution history entries for a complaint.
  - Actions taken, attachments, follow-up, quality checks, reopen info.
  - At most one record with `is_final_resolution = true` per complaint (enforced by partial index).

This file is exclusively for resolution history.

---

## `__init__.py` (complaint package)

Should import and expose exactly:

- From `complaint.py`: `Complaint`
- From `complaint_assignment.py`: `ComplaintAssignment`
- From `complaint_comment.py`: `ComplaintComment`
- From `complaint_escalation.py`: `ComplaintEscalation`, `AutoEscalationRule`
- From `complaint_feedback.py`: `ComplaintFeedback`
- From `complaint_resolution.py`: `ComplaintResolution`
- From `complaint_analytics.py`:
  - `ComplaintAnalyticSnapshot`
  - `ComplaintCategoryMetric`
  - `ComplaintStaffPerformance`

And `__all__` should match that list (as in your file).

---

Here’s a clear inventory of what’s defined where, with brief roles, so you know exactly which classes live in which files.

---

## `app.models.fee_structure`

### `fee_structure/charge_component.py`

Contains **fee structure sub-entities**:

- `ChargeComponent`
  - Individual fee components (rent, deposit, mess, utilities, etc.) tied to a `FeeStructure`.
- `ChargeRule`
  - Business rules (discounts, surcharges, waivers, proration, etc.) attached to a `ChargeComponent`.
- `DiscountConfiguration`
  - Reusable discount definitions (percentage/fixed, applicability, validity window, usage limits).

---

### `fee_structure/fee_calculation.py`

Contains **calculation and projection models**:

- `FeeCalculation`
  - Stores a concrete fee computation for a student/booking/estimate, including breakdown, tax, discounts.
- `FeeProjection`
  - Forward-looking revenue/occupancy projections for a `FeeStructure`.

---

### `fee_structure/fee_structure.py`

Contains **core fee configuration + approvals**:

- `FeeStructure`
  - Main pricing config per hostel/room_type/fee_type (base rent, deposit, utilities, mess, validity, etc.).
- `FeeApproval`
  - Tracks approval workflow for changes to `FeeStructure` amounts.

---

### `fee_structure/__init__.py`

Re-exports:

- `FeeStructure`, `FeeApproval`
- `ChargeComponent`, `ChargeRule`, `DiscountConfiguration`
- `FeeCalculation`, `FeeProjection`

---

## `app.models.file_management`

### `file_management/document_upload.py`

Contains **document-level models**:

- `DocumentUpload`
  - Document instance associated with a `FileUpload` (type, expiry, verification, OCR status).
- `DocumentType`
  - Master configuration for document types (requirements, OCR config, expiry defaults, etc.).
- `DocumentValidation`
  - Result of validation checks applied to a `DocumentUpload`.
- `DocumentOCR`
  - OCR output for a `DocumentUpload` (full text, fields, confidence).
- `DocumentVerification`
  - Individual verification events/decisions for a `DocumentUpload`.
- `DocumentExpiry`
  - Expiry tracking and alert/renewal state for a `DocumentUpload`.

---

### `file_management/file_metadata.py`

Contains **metadata/ACL/analytics for files**:

- `FileTag`
  - Tag taxonomy (hierarchical tags, usage counts).
- `FileAccess`
  - ACL entries (who/what can do what with a file).
- `FileVersion`
  - Version history entries for a file.
- `FileAnalytics`
  - Aggregated usage metrics per file.
- `FileAccessLog`
  - Per-access audit log entries.
- `FileFavorite`
  - User–file favorites for quick access.

---

### `file_management/file_upload.py`

Contains **core upload/storage models**:

- `FileUpload`
  - Core file metadata and storage location.
- `UploadSession`
  - Upload session (direct/multipart), lifecycle, and parameters.
- `FileValidation`
  - Validation results for the uploaded file (format, size, type).
- `UploadProgress`
  - Realtime progress for an `UploadSession`.
- `FileQuota`
  - Storage quota and usage per owner (user/hostel/tenant).
- `MultipartUpload`
  - Multipart upload aggregate (total size, parts, status).
- `MultipartUploadPart`
  - Individual chunk/part of a multipart upload.

---

### `file_management/image_upload.py`

Contains **image-specific models**:

- `ImageUpload`
  - Image-specific info attached to a `FileUpload` (dimensions, format, processing flags).
- `ImageVariant`
  - Generated variants (thumbnail/medium/large/webp, etc.).
- `ImageProcessing`
  - Queue/status of image processing workflow.
- `ImageOptimization`
  - Optimization results (compression, size reduction, quality metrics).
- `ImageMetadata`
  - EXIF/GPS/technical metadata for images.

---

### `file_management/__init__.py`

Re-exports:

- From `file_upload`: `FileUpload`, `UploadSession`, `FileValidation`, `UploadProgress`, `FileQuota`, `MultipartUpload`, `MultipartUploadPart`
- From `image_upload`: `ImageUpload`, `ImageVariant`, `ImageProcessing`, `ImageOptimization`, `ImageMetadata`
- From `document_upload`: `DocumentUpload`, `DocumentType`, `DocumentValidation`, `DocumentOCR`, `DocumentVerification`, `DocumentExpiry`
- From `file_metadata`: `FileTag`, `FileAccess`, `FileVersion`, `FileAnalytics`, `FileAccessLog`, `FileFavorite`

---

## `app.models.hostel`

### `hostel/hostel.py`

Contains **core hostel entity**:

- `Hostel`
  - Main hostel record (identity, address, capacity, stats, pricing summary, media URLs) and relationships to many subsystems.

---

### `hostel/hostel_amenity.py`

Contains **amenity-related models**:

- `HostelAmenity`
  - Individual amenity instances per hostel (availability, condition, capacity).
- `AmenityCategory`
  - Master data for amenity categories.
- `AmenityBooking`
  - Booking/reservation entries for bookable amenities.

---

### `hostel/hostel_analytics.py`

Contains **analytics/time-series models**:

- `HostelAnalytic`
  - Aggregated performance metrics per hostel over a period (occupancy, revenue, bookings, complaints, etc.).
- `OccupancyTrend`
  - Daily occupancy metrics.
- `RevenueTrend`
  - Daily/monthly revenue metrics.

---

### `hostel/hostel_comparison.py`

Contains **competitive analysis models**:

- `HostelComparison`
  - Comparison snapshots: one hostel vs a set of others (metrics, rankings, recommendations).
- `BenchmarkData`
  - Industry/regional benchmark aggregates.
- `CompetitorAnalysis`
  - Pairwise analysis: our hostel vs a specific competitor on a given date.

---

### `hostel/hostel_media.py`

Contains **media models**:

- `HostelMedia`
  - Individual media item for a hostel (image/video/virtual tour/document).
- `MediaCategory`
  - Master categories for media organization.

---

### `hostel/hostel_policy.py`

Contains **policy/compliance models**:

- `HostelPolicy`
  - Policy documents per hostel (versioned, effective dates, analytics).
- `PolicyAcknowledgment`
  - Which student acknowledged which policy version.
- `PolicyViolation`
  - Policy violations, evidence, and actions.

---

### `hostel/hostel_settings.py`

Contains **operational settings**:

- `HostelSettings`
  - One-to-one config per hostel for booking/payment/attendance/mess/security/maintenance/leave/feature flags.

---

### `hostel/__init__.py`

Re-exports:

- `Hostel`
- Amenities: `HostelAmenity`, `AmenityCategory`, `AmenityBooking`
- Analytics: `HostelAnalytic`, `OccupancyTrend`, `RevenueTrend`
- Comparison: `HostelComparison`, `BenchmarkData`, `CompetitorAnalysis`
- Media: `HostelMedia`, `MediaCategory`
- Policy: `HostelPolicy`, `PolicyAcknowledgment`, `PolicyViolation`
- Settings: `HostelSettings`

---

## `app.models.inquiry`

### `inquiry/inquiry.py`

Contains **core inquiry/lead model**:

- `Inquiry`
  - Visitor inquiry for a hostel (contact info, preferences, source, status, assignment, conversion tracking, follow-up metadata).

---

### `inquiry/inquiry_follow_up.py`

Contains **follow-up models/enums**:

- `ContactMethod` (enum)
  - `phone`, `email`, `sms`, `whatsapp`, `in_person`, `other`.
- `ContactOutcome` (enum)
  - `connected`, `no_answer`, `voicemail`, `email_sent`, `email_bounced`, `interested`, `not_interested`, `callback_requested`, `wrong_number`, `do_not_contact`.
- `InquiryFollowUp`
  - Individual follow-up attempt, outcome, next steps, sentiment, engagement flags.

---

### `inquiry/__init__.py`

Re-exports:

- `Inquiry`
- `InquiryFollowUp`
- `ContactMethod`, `ContactOutcome`

---

## `app.models.leave`

### `leave/leave_application.py`

Contains **core leave lifecycle models**:

- `LeaveApplication`
  - Main leave request entity (dates, type, reason, status, approvals, cancellations, return tracking).
- `LeaveCancellation`
  - Separate cancellation request entity attached to a `LeaveApplication`.
- `LeaveDocument`
  - Supporting documents attached to a leave.
- `LeaveEmergencyContact`
  - Additional emergency contacts specific to the leave period.
- `LeaveStatusHistory`
  - Status change audit trail for a leave application.

---

### `leave/leave_approval.py`

Contains **approval workflow models**:

- `LeaveApproval`
  - Individual approval/rejection decisions linked to a leave (per approver/level).
- `LeaveApprovalWorkflow`
  - Workflow configuration (per hostel/type) describing levels, auto-approval, escalation.
- `LeaveApprovalStep`
  - Per-step configuration within a workflow (roles, conditions, SLAs).

---

### `leave/leave_balance.py`

Contains **quota/balance/usage models**:

- `LeaveBalance`
  - Current leave balance per student + leave type + academic year.
- `LeaveQuota`
  - Quota configuration per hostel + leave type (annual/semester/monthly, carry-forward, etc.).
- `LeaveUsage`
  - Per-day usage entries tied to a balance and a leave application.
- `LeaveCarryForward`
  - Carried-forward leave days between academic years.
- `LeaveAdjustment`
  - Manual adjustments to a `LeaveBalance`.

---

### `leave/leave_type.py`

Contains **leave type + policy + blackout models**:

- `LeaveTypeConfig`
  - Detailed config per leave type (limits, rules, requirements, approval rules, UI metadata).
- `LeavePolicy`
  - High-level policy document for leave (versioned, hostels, applicable types).
- `LeaveBlackoutDate`
  - Blackout periods for specific leave types (no/limited leave allowed).

---

### `leave/__init__.py`

Re-exports:

- Applications: `LeaveApplication`, `LeaveCancellation`, `LeaveDocument`, `LeaveEmergencyContact`, `LeaveStatusHistory`
- Approvals: `LeaveApproval`, `LeaveApprovalWorkflow`, `LeaveApprovalStep`
- Balance: `LeaveBalance`, `LeaveQuota`, `LeaveUsage`, `LeaveCarryForward`, `LeaveAdjustment`
- Config: `LeaveTypeConfig`, `LeavePolicy`, `LeaveBlackoutDate`

---

Here’s a structured map of what’s in each file, and (where relevant) what *should* be there / what is redundant or conflicting.

---

## 1. `app.models.maintenance` package

### `maintenance_analytics.py`
**Classes:**
- `MaintenanceAnalytic`
- `CategoryPerformanceMetric`

Both belong here: they are aggregate/analytics models for maintenance.

---

### `maintenance_approval.py`
**Classes:**
- `MaintenanceApproval` – per‑request approval workflow entity.
- `ApprovalThreshold` – configuration for approval limits per hostel.
- `ApprovalWorkflow` – state tracking for the approval process per maintenance request.

All three are logically correct in this file. Note: `ApprovalWorkflow` name is reused in mess (`menu_approval.py`), which is allowed but can be confusing; using explicit imports/qualified names is important.

---

### `maintenance_assignment.py`
**Classes:**
- `MaintenanceAssignment` – internal staff assignment for maintenance tasks.
- `VendorAssignment` – external vendor / contractor assignment.

Correctly grouped.

---

### `maintenance_completion.py`
**Classes:**
- `MaintenanceCompletion` – final work completion record.
- `MaintenanceMaterial` – line items for materials used.
- `MaintenanceQualityCheck` – inspection and QC checks.
- `MaintenanceCertificate` – formal completion certificate.

These all form the “completion” sub‑domain, so this file is appropriate for them.

---

### `maintenance_cost.py`
**Classes:**
- `MaintenanceCost` – per‑request cost tracking, variance, budget compliance.
- `BudgetAllocation` – per‑hostel, per‑fiscal‑year maintenance budget.
- `CategoryBudget` – per‑category budget slices.
- `VendorInvoice` – invoices from vendors.
- `ExpenseReport` – aggregated expense reports.

All cost/budget/invoice/report‑type models; correct grouping.

---

### `maintenance_request.py`
**Classes:**
- `MaintenanceRequest` – core maintenance ticket.
- `MaintenanceStatusHistory` – status change audit log for requests.
- `MaintenanceIssueType` – dynamic configuration of issue types (note: name collides with the enum `MaintenanceIssueType` in `app.schemas.common.enums`, but they are different things).

All belong here; the name collision with the enum is something to be aware of.

---

### `maintenance_schedule.py`
**Classes:**
- `MaintenanceSchedule` – preventive maintenance schedule.
- `ScheduleExecution` – execution records for scheduled tasks.

Correctly grouped.

---

### `maintenance_vendor.py`
**Classes:**
- `MaintenanceVendor` – master vendor record.
- `VendorContract` – contracts with vendors.
- `VendorPerformanceReview` – periodic vendor performance evaluations.

Correct grouping.

---

### `maintenance/__init__.py`
Re‑exports all of the above:

- `MaintenanceRequest`, `MaintenanceStatusHistory`, `MaintenanceIssueType`
- `MaintenanceAssignment`, `VendorAssignment`
- `MaintenanceApproval`, `ApprovalThreshold`, `ApprovalWorkflow`
- `MaintenanceCompletion`, `MaintenanceMaterial`, `MaintenanceQualityCheck`, `MaintenanceCertificate`
- `MaintenanceCost`, `BudgetAllocation`, `CategoryBudget`, `VendorInvoice`, `ExpenseReport`
- `MaintenanceSchedule`, `ScheduleExecution`
- `MaintenanceVendor`, `VendorContract`, `VendorPerformanceReview`
- `MaintenanceAnalytic`, `CategoryPerformanceMetric`

This file is fine as a central export hub.

---

## 2. `app.models.mess` package

### `dietary_option.py`
**Classes:**
- `DietaryOption` – per‑hostel configuration of dietary options.
- `StudentDietaryPreference` – per‑student preferences.
- `AllergenProfile` – detailed allergen info for a student.
- `DietaryRestriction` – medical/religious/etc. restrictions.
- `MealCustomization` – per‑meal customization requests.

Correct group: “dietary and per‑student dietary data”.

---

### `meal_item.py`
**Classes:**
- `MealItem` – master menu item.
- `Recipe` – per‑item recipe and instructions.
- `IngredientMaster` – global ingredient catalog.
- `ItemCategory` – hierarchical categories for menu items.
- `ItemAllergen` – per‑item allergen records.
- `ItemPopularity` – popularity/analytics for items.

All are “food item” domain models; appropriate here.

---

### `menu_approval.py`
**Classes:**
- `MenuApproval` – approval state per menu.
- `MenuApprovalRequest` – submission details requesting approval.
- `ApprovalWorkflow` – **menu** approval workflow state (note: same class name as maintenance’s `ApprovalWorkflow`, but in a different module).
- `ApprovalHistory` – aggregate history per menu across submissions.
- `ApprovalAttempt` – per‑submission attempt records.
- `ApprovalRule` – auto‑approval rules.
- `BulkApproval` – batch approval operations.

All are part of “menu approval workflow”. If you want maximum clarity, you could consider renaming this module’s `ApprovalWorkflow` to `MenuApprovalWorkflow` to avoid mental collisions, but structurally it’s valid.

---

### `menu_feedback.py`
**Classes:**
- `MenuFeedback` – per‑student feedback per menu.
- `ItemRating` – aggregated item‑level ratings across menus.
- `RatingsSummary` – per‑menu summary stats.
- `QualityMetrics` – time‑windowed quality metrics for a hostel.
- `SentimentAnalysis` – sentiment breakdown for a **menu**.
- `FeedbackAnalysis` – aggregated feedback insights over a period.
- `FeedbackComment` – threaded comments on feedback.
- `FeedbackHelpfulness` – votes on feedback helpfulness.

All are “feedback and analytics around menus”. Note that `SentimentAnalysis` class name also exists in `review.review_analytics` with different semantics (that one is hostel‑review wide); just keep imports explicit.

---

### `menu_planning.py`
**Classes:**
- `MenuTemplate` – reusable menu templates.
- `WeeklyMenuPlan`
- `MonthlyMenuPlan`
- `DailyMenuPlan`
- `SpecialOccasionMenu`
- `MenuSuggestion` – AI/system suggestions.
- `MenuPlanningRule` – constraints and rules used for planning.
- `SeasonalMenu` – season‑specific configurations.

All are planning/strategy models; correct.

---

### `mess_menu.py`
**Classes:**
- `MessMenu` – actual daily menu entity.
- `MenuCycle` – recurring cycles (weekly/monthly patterns).
- `MenuVersion` – version history for a menu.
- `MenuPublishing` – publication & distribution tracking.
- `MenuAvailability` – real‑time availability of items.

Core “live menu” domain; correct.

---

### `nutritional_info.py`
**Classes:**
- `NutritionalInfo` – per‑item nutrition detail.
- `NutrientProfile` – DV % and derived nutrition profile.
- `DietaryValue` – suitability for specific diets.
- `NutritionalReport` – aggregated nutrition reports over periods.

All are nutrition analytics; correct.

---

### `mess/__init__.py`
Re‑exports all of the above, grouped by concern (`MENU_MODELS`, `ITEM_MODELS`, etc.). This file is fine as is.

---

## 3. `app.models.notification` package

### `device_token.py`
**Classes:**
- `DeviceToken` – per‑device push token & metadata.

Correct place.

---

### `email_notification.py`
**Classes:**
- `EmailNotification` – email‑specific data and tracking (per `Notification`).
- `EmailAttachment` – attachments per `EmailNotification`.
- `EmailClickEvent` – per‑link click events.

Note: there is a bug in the relationships (`EmailAttachment.email` currently points to `"EmailAttachment"` instead of `"EmailNotification"`), but class membership is correct.

---

### `notification.py`
**Classes:**
- `Notification` – core notification entity spanning all channels.
- `NotificationStatusHistory` – status transitions audit log.
- `NotificationReadReceipt` – per‑user read receipts for notifications.

All core; correct.

---

### `notification_preferences.py`
**Classes:**
- `NotificationPreference` – per‑user overall prefs (channels, quiet hours, etc.).
- `ChannelPreference` – fine‑grained per‑channel settings.
- `UnsubscribeToken` – one‑click unsubscribe tokens.

Grouped correctly.

---

### `notification_queue.py`
**Classes:**
- `NotificationQueue` – per‑notification queue entry.
- `NotificationBatch` – batch processing groups.

Correct.

---

### `notification_routing.py`
**Classes:**
- `RoutingRule` – routing rules (who to notify, how).
- `EscalationPath` – escalation workflows.
- `NotificationEscalation` – active escalation instance per notification.
- `NotificationRoute` – the final routing decision/result per notification.

All belong in routing/escalation domain.

---

### `notification_template.py`
**Classes:**
- `NotificationTemplate` – reusable templates.
- `NotificationTemplateVersion` – version history.

Correct.

---

### `push_notification.py`
**Classes:**
- `PushNotification` – per‑notification push‑specific payload & tracking.

Correct.

---

### `sms_notification.py`
**Classes:**
- `SMSNotification` – per‑notification SMS‑specific payload & tracking.

Correct.

---

### `notification/__init__.py`
Re‑exports:

- Core: `Notification`, `NotificationStatusHistory`, `NotificationReadReceipt`
- Templates: `NotificationTemplate`, `NotificationTemplateVersion`
- Email: `EmailNotification`, `EmailAttachment`, `EmailClickEvent`
- SMS: `SMSNotification`
- Push: `PushNotification`
- Devices: `DeviceToken`
- Queue: `NotificationQueue`, `NotificationBatch`
- Preferences: `NotificationPreference`, `ChannelPreference`, `UnsubscribeToken`
- Routing: `RoutingRule`, `EscalationPath`, `NotificationEscalation`, `NotificationRoute`

This layout is consistent.

---

## 4. `app.models.payment` package

> This package is the one with a *real* structural issue: two different `GatewayTransaction` definitions.

### `gateway_transaction.py`
**Classes:**
- `GatewayTransactionStatus` – `Enum` of detailed statuses (initiated, pending, success, refund statuses, etc.).
- `GatewayTransactionType` – `Enum` of transaction types (payment, refund, capture, etc.).
- `GatewayProvider` – `Enum` of providers (razorpay, stripe, etc.).
- `GatewayTransaction` – very detailed gateway interaction model (requests, responses, webhooks, verification, reconciliation, settlement, fraud/risk, etc.).

This appears to be the *new* / more complete gateway model and is the one that should ultimately be used.

---

### `payment.py`
**Classes:**
- `Payment` – core payment entity (amount, method, status, periods, refunds, reminders, ledger, etc.).

Correct.

Note: In `TYPE_CHECKING`, it imports `GatewayTransaction` from `payment_gateway`, but in `__init__.py` you are exporting `GatewayTransaction` from `gateway_transaction.py`. This inconsistency indicates `payment_gateway.py` is legacy.

---

### `payment_gateway.py`
**Classes:**
- `GatewayTransactionStatus` – simpler status enum.
- `GatewayTransaction` – simpler, older gateway transaction model with much less data.

This file *duplicates* the concern handled by `gateway_transaction.py`:

- Same table name: `"gateway_transactions"`.
- Same class name: `GatewayTransaction`.
- Overlapping fields but with different columns.

You should **not** have both. You should pick one design and delete/merge the other. Given the richness and clarity, the `gateway_transaction.py` version looks like the intended final version. Recommended:

- Keep `gateway_transaction.py` (with its enums and class).
- Delete `payment_gateway.py`, and remove any lingering imports/references to it.
- Update `Payment`’s type hints (`TYPE_CHECKING` block) to import from `gateway_transaction` instead.

---

### `payment_ledger.py`
**Classes:**
- `LedgerEntryType` – `Enum` (`DEBIT`, `CREDIT`, etc.).
- `TransactionType` – `Enum` (`PAYMENT`, `REFUND`, `LATE_FEE`, etc.).
- `PaymentLedger` – ledger entries for double‑entry bookkeeping.

Correct.

---

### `payment_refund.py`
**Classes:**
- `RefundStatus` – `Enum` for refund lifecycle.
- `PaymentRefund` – refund request and processing lifecycle.

Correct.

---

### `payment_reminder.py`
**Classes:**
- `ReminderType` – `Enum` (before_due, overdue, etc.).
- `ReminderStatus` – `Enum` (pending, sent, failed, etc.).
- `PaymentReminder` – per‑reminder tracking entity.

Correct.

---

### `payment_schedule.py`
**Classes:**
- `ScheduleStatus` – `Enum` (active, paused, suspended, completed, cancelled).
- `PaymentSchedule` – recurring schedule for payments.

Correct.

---

### `payment/__init__.py`
Re‑exports:

- `Payment`
- `GatewayTransaction`, `GatewayTransactionStatus` (currently from `gateway_transaction.py`)
- `PaymentRefund`, `RefundStatus`
- `PaymentSchedule`, `ScheduleStatus`
- `PaymentReminder`, `ReminderType`, `ReminderStatus`
- `PaymentLedger`, `LedgerEntryType`, `TransactionType`

Once you remove `payment_gateway.py`, this mapping will be consistent.

---

## 5. `app.models.referral` package

### `referral.py`
**Class:**
- `Referral` – per‑referral record (program, referrer, referee, conversion, rewards, status history).

Correct.

---

### `referral_code.py`
**Class:**
- `ReferralCode` – per‑user, per‑program referral code with usage, stats, expiration.

Correct.

---

### `referral_program.py`
**Class:**
- `ReferralProgram` – program definition, reward configuration, eligibility, aggregate stats.

Correct.

---

### `referral_reward.py`
**Classes:**
- `ReferralReward` – per‑user, per‑referral reward entry; status from pending to paid.
- `RewardPayout` – payout request aggregating rewards for a user.

Correct.

---

### `referral/__init__.py`
Re‑exports:
- `ReferralProgram`
- `ReferralCode`
- `Referral`
- `ReferralReward`
- `RewardPayout`

All good.

---

## 6. `app.models.review` package

### `review.py`
**Classes:**
- `Review` – core review entity (overall rating, aspects, verification, moderation flags, engagement counts, etc.).
- `ReviewAspect` – per‑aspect rating/comment records beyond the standard fields.
- `ReviewVerification` – verification of authenticity (booking, student, payment, etc.).
- `ReviewStatusHistory` – audit log of status transitions.

Correct.

---

### `review_analytics.py`
**Classes:**
- `ReviewAnalyticsSummary` – overall hostel review analytics summary.
- `RatingDistribution` – distribution of ratings 1–5 for a hostel.
- `ReviewTrend` – trend per hostel over time.
- `MonthlyRating` – per‑month aggregate ratings.
- `SentimentAnalysis` – sentiment analysis aggregate for a hostel’s reviews.
- `AspectRating` – per‑aspect aggregate ratings.
- `CompetitorComparison` – relative performance vs competitors.

All are “analytics/insights” models; appropriate.

---

### `review_media.py`
**Classes:**
- `ReviewMedia` – per‑review media (photos/videos), moderation, AI signals.
- `ReviewMediaProcessing` – processing logs & performance for a media item.

Correct.

---

### `review_moderation.py`
**Classes:**
- `ReviewModerationLog` – log of moderation actions.
- `ReviewFlag` – user flags for reviews.
- `ReviewModerationQueue` – moderation queue entries for pending reviews.
- `ReviewAutoModeration` – AI/ML moderation result per review.

All moderation‑related; correct.

---

### `review_response.py`
**Classes:**
- `ReviewResponse` – hostel/admin response to a review.
- `ResponseTemplate` – response templates.
- `ResponseStatistics` – response performance metrics per hostel/period.

Correct.

---

### `review_voting.py`
**Classes:**
- `ReviewVote` – per‑user helpful/not‑helpful vote.
- `ReviewHelpfulnessScore` – Wilson‑score based helpfulness ranking.
- `ReviewEngagement` – broader engagement metrics (views, shares, influence).

Correct.

---

### `review/__init__.py`
Re‑exports all the above classes grouped by concern. This is consistent and useful.

---

## Summary of Structural Issues / Key Decisions

1. **Duplicate `GatewayTransaction` in Payment:**
   - `payment_gateway.py` and `gateway_transaction.py` both define `GatewayTransaction` (and status enums) with the same table name.
   - You should **choose one** (likely `gateway_transaction.py`) and remove or migrate away from the other to avoid schema conflicts and ORM confusion.

2. **Name Reuse Across Domains (not strictly wrong, but important to know):**
   - `ApprovalWorkflow` exists in both:
     - `maintenance.maintenance_approval`
     - `mess.menu_approval`
   - `SentimentAnalysis` exists in:
     - `mess.menu_feedback` (menu feedback sentiment)
     - `review.review_analytics` (review sentiment)
   - `GatewayTransactionStatus`, `GatewayTransaction` existed twice in payment (see above: resolve by keeping one).

   This is fine as long as imports are explicit and you’re aware of the context.

Other than those name collisions/duplications, the classes are logically grouped in the correct files.

If you tell me which domain you plan to refactor first (e.g., payments or maintenance), I can propose concrete rename / deletion steps and updated import paths to fully normalize the structure.


Here’s a clear map of **which classes belong in each file you showed**, grouped by package. I’m only listing classes that are actually defined in those files (not mixins or enums imported from elsewhere).

---

## `app.models.room` package

### `bed.py`
**Purpose:** Core bed entity plus bed-level condition, configuration, accessibility, preferences, and analytics.

**Classes in this file:**
- `Bed` – Main bed record (which room, number, type, status, current student, features, pricing, etc.).
- `BedCondition` – Physical condition, cleanliness, wear/tear, maintenance need, replacement indicators.
- `BedConfiguration` – How the bed is set up (frame, mattress, bedding, power, privacy, comfort, cost).
- `BedAccessibility` – Accessibility features for disabled/special‑needs occupants.
- `BedPreference` – Mapping between a `Student` and a `Bed`, storing that student’s preference info for that bed.
- `BedUtilization` – Utilization analytics (occupancy, revenue, maintenance impact, performance scores) for a bed.

---

### `bed_assignment.py`
**Purpose:** Everything about assigning beds to students and the orchestration around that.

**Classes in this file:**
- `BedAssignment` – A concrete assignment of a `Student` to a `Bed`/`Room`/`Hostel` for a period, including pricing, lifecycle, and condition documentation.
- `AssignmentRule` – Rules/algorithms used for automatic bed assignment (preferences, constraints, scoring, etc.).
- `AssignmentConflict` – Records conflicts that arise during assignment (double‑booking, policy violations, etc.).
- `AssignmentOptimization` – Represents an optimization run (bulk allocation/rebalancing) and its results/metrics.
- `AssignmentHistory` – Historical snapshots of `BedAssignment` changes (audit trail over time).
- `AssignmentPreference` – Higher‑level preferences (per hostel/student/admin) that influence automatic assignment.

---

### `room.py`
**Purpose:** Core room entity plus static specs, pricing history, maintenance, access control, and occupancy limits.

**Classes in this file:**
- `Room` – Main room record (hostel, number, type, capacity, pricing, status, media, etc.).
- `RoomSpecification` – Physical/technical specs (dimensions, windows, electrical, bathroom details, safety, etc.).
- `RoomPricingHistory` – Historical records of room pricing changes with effective dates and approvals.
- `RoomMaintenanceStatus` – Real‑time maintenance status and maintenance history summary for the room.
- `RoomAccessControl` – Access/security configuration (keys, RFID/PIN, permissions, sensors, alerts).
- `RoomOccupancyLimit` – Capacity & policy (max/min occupants, gender/age rules, overbooking, alerts).

---

### `room_amenity.py`
**Purpose:** Room‑level amenities and everything about their condition, maintenance, usage, feedback, and inventory.

**Classes in this file:**
- `RoomAmenity` – A specific amenity in a room (furniture, appliance, etc.).
- `AmenityCondition` – Condition assessment for an amenity (wear, damage, maintenance/replacement indicators).
- `AmenityMaintenance` – Individual maintenance events/records for an amenity.
- `AmenityUsage` – Usage metrics and analytics (frequency, duration, consumption, operational cost).
- `AmenityFeedback` – Student feedback and issues on amenities.
- `AmenityInventory` – Asset/inventory tracking for an amenity (valuation, lifecycle, verification, insurance, disposal).

---

### `room_availability.py`
**Purpose:** Dynamic, time‑based availability of rooms plus rules, forecasting, alerts, and optimization.

**Classes in this file:**
- `RoomAvailability` – Real‑time availability state for a room (available/occupied/reserved/blocked; demand; dynamic pricing).
- `AvailabilityWindow` – Time‑boxed windows (peak/off‑peak/seasonal/custom) with overrides and pricing adjustments.
- `AvailabilityRule` – Business rules that affect how availability is computed (capacity, restrictions, timing, pricing).
- `AvailabilityForecast` – Predictive forecast of future availability and demand, with model metadata and recommendations.
- `AvailabilityAlert` – Alerts triggered by critical availability conditions (low availability, overbooking, high demand).
- `AvailabilityOptimization` – An optimization run focused on occupancy/revenue/utilization with recommendations and impact.

---

### `room_type.py`
**Purpose:** Master definitions of room types and their features, pricing structure, availability, comparisons, and upgrade paths.

**Classes in this file:**
- `RoomTypeDefinition` – Master record per room type per hostel (capacity, features, base pricing, marketing flags).
- `RoomTypeFeature` – Individual feature entries for a room type (amenity/furniture/utility/etc. with cost).
- `RoomTypePricing` – Tiered/seasonal pricing records per room type (monthly/yearly, discounts, special offers).
- `RoomTypeAvailability` – Aggregated availability and capacity planning at room‑type level.
- `RoomTypeComparison` – Pairwise comparison between two room types (price/feature/space/value differences).
- `RoomTypeUpgrade` – Allowed upgrade paths between room types with pricing and conditions.

---

### `room/__init__.py`
**Purpose:** Re‑export room‑related models and provide a model registry.

**Contains:**
- No new ORM models; it imports and re‑exports:
  - From `room.py`: `Room`, `RoomSpecification`, `RoomPricingHistory`, `RoomMaintenanceStatus`, `RoomAccessControl`, `RoomOccupancyLimit`
  - From `bed.py`: `Bed`, `BedCondition`, `BedConfiguration`, `BedAccessibility`, `BedPreference`, `BedUtilization`
  - From `bed_assignment.py`: `BedAssignment`, `AssignmentRule`, `AssignmentConflict`, `AssignmentOptimization`, `AssignmentHistory`, `AssignmentPreference`
  - From `room_amenity.py`: `RoomAmenity`, `AmenityCondition`, `AmenityMaintenance`, `AmenityUsage`, `AmenityFeedback`, `AmenityInventory`
  - From `room_availability.py`: `RoomAvailability`, `AvailabilityWindow`, `AvailabilityRule`, `AvailabilityForecast`, `AvailabilityAlert`, `AvailabilityOptimization`
  - From `room_type.py`: `RoomTypeDefinition`, `RoomTypeFeature`, `RoomTypePricing`, `RoomTypeAvailability`, `RoomTypeComparison`, `RoomTypeUpgrade`
- Plus helpers:
  - `ROOM_MODELS` dict – maps string keys to model classes.
  - `get_all_models()` – returns all room‑related model classes.
  - `get_model_by_table_name(table_name)` – look up a model class by key used in `ROOM_MODELS`.

---

## `app.models.search` package

### `search_analytics.py`
**Purpose:** Analytics over search terms and overall search performance, plus pre‑computed reports.

**Classes in this file:**
- `SearchTermStats` – Per search term, per period metrics (usage, results, engagement, trends, breakdowns).
- `SearchMetrics` – Aggregated performance metrics for all searches in a period (optionally by hostel).
- `PopularSearchTerm` – Ranked list of popular search terms per period.
- `TrendingSearch` – Rapidly growing (“trending”) search terms with growth/velocity metrics.
- `ZeroResultTerm` – Terms that tend to return zero results, with intent analysis and resolution workflow.
- `SearchAnalyticsReport` – Stored, precomputed analytics reports (metrics, top/trending/zero result lists, insights).

---

### `search_autocomplete.py`
**Purpose:** Autocomplete suggestions, their logging, sources, and performance tracking.

**Classes in this file:**
- `AutocompleteSuggestion` – A single autocomplete suggestion (text, type, scoring, metadata, status, usage stats).
- `AutocompleteQueryLog` – Logs each autocomplete request (prefix, filters, performance, user actions).
- `SuggestionSource` – Configuration for different suggestion sources (DB, API, AI, manual) with sync and metrics.
- `PopularSearchSuggestion` – Popular search suggestions for default/fallback lists.
- `SuggestionPerformance` – Per‑suggestion, per‑date performance metrics (impressions, selections, conversions).

---

### `search_query_log.py`
**Purpose:** Full search query logging, sessions, and user‑saved searches.

**Classes in this file:**
- `SearchQueryLog` – A complete log of a single search request (query, filters, performance, results, interactions, conversion).
- `SearchSession` – Groups related `SearchQueryLog` entries into a session with journey/engagement/conversion metrics.
- `SavedSearch` – User‑saved search criteria, with alert configuration and execution stats.

---

### `search/__init__.py`
**Purpose:** Re‑export all search‑related models.

**Contains:**
- No new models; re‑exports:
  - `SearchQueryLog`, `SearchSession`, `SavedSearch`
  - `SearchTermStats`, `SearchMetrics`, `PopularSearchTerm`, `TrendingSearch`, `ZeroResultTerm`, `SearchAnalyticsReport`
  - `AutocompleteSuggestion`, `AutocompleteQueryLog`, `SuggestionSource`, `PopularSearchSuggestion`, `SuggestionPerformance`

---

## `app.models.student` package

### `guardian_contact.py`
**Purpose:** Guardian/parent contact and authorization info.

**Class in this file:**
- `GuardianContact` – A single guardian record for a student (relation, contact details, address, occupation, ID, emergency/authorization flags, verification and preferences).

---

### `room_transfer_history.py`
**Purpose:** Historical record of room/bed assignments and transfers for a student.

**Class in this file:**
- `RoomTransferHistory` – One transfer/assignment event (from/to room/bed, dates, reasons, approvals, financial changes, condition/handover, docs, notifications, status).

---

### `student.py`
**Purpose:** Core student entity and its direct relationships to user, hostel, room/bed, booking, financials, status, and basic guardian & institution/employer info.

**Class in this file:**
- `Student` – Main student record linking to:
  - `User`, `Hostel`, current `Room` and `Bed`, optional `Booking`
  - Core documents & verification status
  - Financial info (deposit, rent, mess)
  - Check‑in/out, notice period, status flags
  - One‑to‑one: `StudentProfile`, `StudentPreferences`
  - One‑to‑many: `StudentDocument`, `GuardianContact`, `RoomTransferHistory`, `Payment`, `Complaint`, `AttendanceRecord`, `LeaveApplication`

---

### `student_document.py`
**Purpose:** Uploaded documents associated with a student, with verification and lifecycle.

**Class in this file:**
- `StudentDocument` – One document for a student (type, file info, upload metadata, verification, validity/expiry, replacements/versions, access control, compliance/audit).

---

### `student_preferences.py`
**Purpose:** Student‑specific preferences (notifications, privacy, room/roommate, UI, analytics, integrations).

**Class in this file:**
- `StudentPreferences` – One‑to‑one with `Student`; covers:
  - Meal preferences beyond basic diet type.
  - Notification channels and categories.
  - Quiet hours, digest behavior.
  - Communication language/method.
  - Privacy & discoverability settings.
  - Room/roommate environment preferences.
  - UI/theme/layout options.
  - Analytics & personalization consent.
  - Calendar/integration settings.

---

### `student_profile.py`
**Purpose:** Extended profile data that doesn’t belong in the core `Student` table.

**Class in this file:**
- `StudentProfile` – One‑to‑one with `Student`; includes:
  - Personal details (DOB, age, blood group, demographic info).
  - Contact preferences and alternate contacts.
  - Permanent address.
  - Extended educational and employment details.
  - Medical info and special accommodations.
  - Emergency medical contacts & insurance.
  - Hobbies, interests, social profiles.
  - Referral & marketing info.
  - Preferences for room/roommates/lifestyle.
  - Profile completeness score.

---

### `student/__init__.py`
**Purpose:** Re‑export all student‑related models.

**Contains:**
- Re‑exports: `Student`, `StudentProfile`, `StudentDocument`, `StudentPreferences`, `GuardianContact`, `RoomTransferHistory`.
- No additional model classes.

---

If you want, next I can:
- Propose a naming/organization checklist (e.g., which patterns to enforce for future models), or
- Generate a reference table (model → file → key relationships) for quick navigation.



Below is a clear map of which ORM classes belong in which file for all the model files you’ve shared so far.

---

## `app/models/subscription`

### `subscription_plan.py`
Should contain:

- `SubscriptionPlan`  
  Core definition of a subscription plan (pricing, limits, features, status).
- `PlanFeature`  
  Structured per‑plan feature entries (label, value, category, enabled).

### `subscription.py`
Should contain:

- `Subscription`  
  Active hostel subscription to a plan (billing, status, trial, cancellations, relations).
- `SubscriptionHistory`  
  Change history for a subscription (status changes, plan changes, etc.).
- `SubscriptionCancellation`  
  Detailed record for a cancelled subscription (reason, refund, reactivation).

### `subscription_billing.py`
Should contain:

- `SubscriptionBillingCycle`  
  Per‑cycle billing info (period dates, amount, next billing, trial flags, billed status).

### `subscription_invoice.py`
Should contain:

- `SubscriptionInvoice`  
  Invoices for subscriptions (amounts, tax, status, payment info, periods).

### `subscription_feature.py`
Should contain:

- `SubscriptionFeatureUsage`  
  Feature usage per subscription (current usage, limits, near‑limit, can_use).
- `SubscriptionLimit`  
  Resource limits per subscription (hostels, rooms, etc., current value, exceeded).

### `booking_commission.py`
Should contain:

- `BookingCommission`  
  Commission per booking under a subscription (percent, amount, due/paid/overdue status).

### `__init__.py`
Should re‑export:

- `SubscriptionPlan`, `PlanFeature`
- `Subscription`, `SubscriptionHistory`, `SubscriptionCancellation`
- `SubscriptionBillingCycle`, `SubscriptionInvoice`
- `BookingCommission`
- `SubscriptionFeatureUsage`, `SubscriptionLimit`

---

## `app/models/supervisor`

### `supervisor.py`
Should contain:

- `Supervisor`  
  Core supervisor entity (employment, assignment, status, performance counters, activity).
- `SupervisorEmployment`  
  Employment history per hostel/period (designation, type, performance_rating).
- `SupervisorStatusHistory`  
  Status change log (previous/new status, effective_date, reason, handover).
- `SupervisorNote`  
  Admin notes about a supervisor (type, subject, content, follow‑up).

### `supervisor_activity.py`
Should contain:

- `SupervisorActivity`  
  Detailed action log (action type/category, entity, device, success/failure, impact).
- `SupervisorSession`  
  Login sessions for supervisors (security, device, location, activity).
- `ActivitySummary`  
  Aggregated activity summary per period (counts, breakdowns, sessions).
- `ActivityMetric`  
  KPI‑style metrics over periods (success rate, response time, activity score, productivity).

### `supervisor_assignment.py`
Should contain:

- `SupervisorAssignment`  
  Supervisor ↔ hostel assignment (period, workload, responsibilities, revocation, handover).
- `AssignmentTransfer`  
  Transfers between hostels (request/approval workflow, handover, execution).
- `AssignmentCoverage`  
  Coverage metrics per hostel/shift/day (gaps, severity, mitigation, alerts).
- `WorkloadMetric`  
  Workload indicators per supervisor/hostel/day (tasks counts, utilization, rebalancing).

### `supervisor_dashboard.py`
Should contain:

- `DashboardMetrics`  
  Cached high‑level dashboard metrics (students, occupancy, complaints, maintenance, health score).
- `DashboardAlert`  
  Dashboard alerts/notifications (type, priority, actions, dismissed/expired).
- `QuickAction`  
  Dashboard quick‑action buttons (labels, icons, URL, badges, permission requirement).
- `TodaySchedule`  
  Today’s schedule (attendance, inspections, meetings, tasks, completion rate).
- `PerformanceIndicator`  
  Key performance indicators (complaint resolution, task completion, grades, trends).

### `supervisor_performance.py`
Should contain:

- `SupervisorPerformance`  
  Periodic, detailed performance record (complaints, maintenance, attendance, satisfaction, trends).
- `PerformanceReview`  
  Formal performance review (ratings, strengths, improvements, goals, reviewer/acknowledgment).
- `PerformanceGoal`  
  SMART goals (metric, target, status, progress, deadlines).
- `PerformanceMetric`  
  Time‑series metrics (metric_name/value/date, target, variance, trend).
- `PeerComparison`  
  Peer benchmarking (rank, percentiles, score gaps, per‑metric comparisons).

### `supervisor_permissions.py`
Should contain:

- `SupervisorPermission`  
  Full permission set for a supervisor (complaints, attendance, maintenance, comms, finance, rooms, bookings, reporting, security).
- `PermissionTemplate`  
  Named templates (JSON configs) for permissions (system/custom).
- `PermissionAuditLog`  
  Audit log of permission changes (who/when/what/reason/approval).

### `__init__.py`
Should re‑export all of the above:

- Core: `Supervisor`, `SupervisorEmployment`, `SupervisorStatusHistory`, `SupervisorNote`
- Permissions: `SupervisorPermission`, `PermissionTemplate`, `PermissionAuditLog`
- Assignments: `SupervisorAssignment`, `AssignmentTransfer`, `AssignmentCoverage`, `WorkloadMetric`
- Activity: `SupervisorActivity`, `SupervisorSession`, `ActivitySummary`, `ActivityMetric`
- Dashboard: `DashboardMetrics`, `DashboardAlert`, `QuickAction`, `TodaySchedule`, `PerformanceIndicator`
- Performance: `SupervisorPerformance`, `PerformanceReview`, `PerformanceGoal`, `PerformanceMetric`, `PeerComparison`

---

## `app/models/user`

### `user.py`
Should contain:

- `User`  
  Core auth/user entity (email, phone, password_hash, role, status, security tracking, soft delete).  
  Owns relationships to:
  - `UserProfile`, `UserAddress`, `EmergencyContact`
  - `UserSession`, `LoginHistory`, `PasswordHistory`
  - Role profiles: `AdminUser`, `Supervisor`, `Student`, `Visitor`
  - `Notification` (activity)

### `user_profile.py`
Should contain:

- `UserProfile`  
  Extended demographic and preference data (gender, DOB, bio, media, localization, JSON preferences/privacies/custom fields).

### `user_address.py`
Should contain:

- `UserAddress`  
  Address with geolocation and verification metadata (primary flag, geo coords, validity).

### `emergency_contact.py`
Should contain:

- `EmergencyContact`  
  Emergency contact info for a user (contact details, relation, priority, verification, consent, authorization).

### `login_history.py`
Should contain:

- `LoginHistory`  
  Login attempts log (success/failure, device, location, security flags, method, session reference).

### `password_history.py`
Should contain:

- `PasswordHistory`  
  Historical password hashes per user (for reuse prevention; who changed it, why, where from).

### `user_session.py`
Should contain:

- `UserSession`  
  Refresh‑token based session (device, IP, location, lifecycle, security flags, request counts).

### `__init__.py`
Should re‑export:

- `User`, `UserProfile`, `UserAddress`, `EmergencyContact`
- `UserSession`, `LoginHistory`, `PasswordHistory`

---

## `app/models/visitor`

### `visitor.py`
Should contain:

- `Visitor`  
  Core visitor profile tied to `User` (cached contact info, preferences, budgets, amenities, notifications, activity counters, engagement metrics, segments, metadata).
- `VisitorSession`  
  Analytics‑focused session (traffic source, device, duration, page views, conversions).
- `VisitorJourney`  
  Full funnel journey (stages, first touchpoints, touchpoint sequence, channels, conversion metrics).
- `VisitorSegment`  
  Segment definitions (rules, counts, conversion rates, active flag).
- `VisitorEngagement`  
  Daily engagement metrics per visitor (page views, time on site, searches, engagement score).

### `saved_search.py`
Should contain:

- `SavedSearch`  
  Saved search criteria with monitoring/notifications (filters, arrays, criteria JSON, scheduling, counters, metrics).
- `SavedSearchExecution`  
  Execution log of `SavedSearch` (timing, success, result IDs, counts).
- `SavedSearchMatch`  
  Per‑hostel match for a saved search (match score, cached hostel data, status, engagement).
- `SavedSearchNotification`  
  Notifications sent for saved searches (channels, statuses, engagement).

### `visitor_preferences.py`
Should contain:

- `VisitorPreferences`  
  One‑to‑one, detailed preference record (room, budget, location, amenities, facilities, dietary, move‑in, high‑level notification flags, metadata).
- `SearchPreferences`  
  A more lightweight “saved search” style preferences record (criteria + notification behavior) separate from `SavedSearch`.
- `NotificationPreferences`  
  Very granular notification controls (by channel, by type, quiet hours, digest mode, limits).

### `visitor_favorite.py`
Should contain:

- `VisitorFavorite`  
  Favorite/saved hostels with cached hostel info, price tracking, availability, ratings, notes, alerts, views.
- `FavoriteComparison`  
  Comparison sessions over multiple favorites (favorite_ids, criteria, selection, duration).
- `FavoritePriceHistory`  
  Historical price snapshots for favorites (change amount/percent, type, metadata).

### `visitor_dashboard.py`
Should contain:

- `RecentSearch`  
  Recent searches (criteria, filters, result IDs, re‑execution stats).
- `RecentlyViewedHostel`  
  Recently viewed hostels (cached hostel data, view counts, time spent, engagement flags).
- `RecommendedHostel`  
  Personalized recommendations (match score, algorithm, reasons, engagement).
- `PriceDropAlert`  
  Alerts for price drops on favorites (previous/new price, discount, notification delivery).
- `AvailabilityAlert`  
  Alerts for new availability on previously full favorites (room type, available beds, notifications).
- `VisitorActivity`  
  General visitor activity log (type, category, entity, session, data/metadata).

### `__init__.py`
Should re‑export:

- Core: `Visitor`, `VisitorSession`, `VisitorJourney`, `VisitorSegment`, `VisitorEngagement`
- Preferences: `VisitorPreferences`, `SearchPreferences`, `NotificationPreferences`
- Favorites: `VisitorFavorite`, `FavoriteComparison`, `FavoritePriceHistory`
- Dashboard: `RecentSearch`, `RecentlyViewedHostel`, `RecommendedHostel`, `PriceDropAlert`, `AvailabilityAlert`, `VisitorActivity`
- Saved Searches: `SavedSearch`, `SavedSearchExecution`, `SavedSearchMatch`, `SavedSearchNotification`

---

If you want, I can next:

- Verify for any duplication/overlap (e.g., `SearchPreferences` vs `SavedSearch`) and suggest consolidation, or  
- Propose a refactor plan (e.g., splitting “core entities” vs “analytics/dashboard” into separate subpackages).